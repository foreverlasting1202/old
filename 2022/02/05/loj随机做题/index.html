<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>loj 随机做题 | foreverlasting's blog</title><meta name="keywords" content="OI"><meta name="author" content="foreverlasting"><meta name="copyright" content="foreverlasting"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="玩一下随机做题好了。">
<meta property="og:type" content="article">
<meta property="og:title" content="loj 随机做题">
<meta property="og:url" content="http://foreverlasting1202.github.io/2022/02/05/loj%E9%9A%8F%E6%9C%BA%E5%81%9A%E9%A2%98/index.html">
<meta property="og:site_name" content="foreverlasting&#39;s blog">
<meta property="og:description" content="玩一下随机做题好了。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://pic.imgdb.cn/item/61fa04532ab3f51d91b74efc.jpg">
<meta property="article:published_time" content="2022-02-05T15:30:00.000Z">
<meta property="article:modified_time" content="2022-04-03T13:13:36.980Z">
<meta property="article:author" content="foreverlasting">
<meta property="article:tag" content="OI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.imgdb.cn/item/61fa04532ab3f51d91b74efc.jpg"><link rel="shortcut icon" href="/img/1.jpg"><link rel="canonical" href="http://foreverlasting1202.github.io/2022/02/05/loj%E9%9A%8F%E6%9C%BA%E5%81%9A%E9%A2%98/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'loj 随机做题',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2022-04-03 21:13:36'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/cute.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">141</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">3</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">40</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> Messageboard</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> myself</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://pic.imgdb.cn/item/61fa04532ab3f51d91b74efc.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">foreverlasting's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> Messageboard</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> myself</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">loj 随机做题</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-02-05T15:30:00.000Z" title="Created 2022-02-05 23:30:00">2022-02-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-04-03T13:13:36.980Z" title="Updated 2022-04-03 21:13:36">2022-04-03</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/">做题记录</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="loj 随机做题"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>玩一下随机做题好了。</p>
<p>看大火都有难度标识，我也整个好了，打分类似贴吧的，五分制。（ 主要不了解 CF 的评分，而且我评判肯定是相当不准确的</p>
<p>不是自己写出来的会打颗星。</p>
<span id="more"></span>
<h3 id="loj2250"><a href="#loj2250" class="headerlink" title="[loj2250]"></a>[loj2250]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 仙人掌、dp | Difficulty: 三</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：一般仙人掌的题都是先考虑树上咋做，再不济也能转个圆方树，所以先看看树。</p>
<p>容易想到题意可以转换成选出若干条边不相交链的方案数。这东西直接 dp，即设 $f_x$ 表示 $x$ 的子树内不算父亲边的方案数，$g_x$ 表示 $x$ 的子树内算父亲边的方案数。转移并不困难，考虑儿子之间匹配情况就行了。</p>
<p>更进一步，我们可以发现考不考虑父亲边的意义都不大。因为对于一个点而言，它考虑父亲边也要拿去匹配，不考虑也可以隐性地放置而不去理睬。也就是说，我们可以大胆地考虑直接匹配儿子，因为如果实质上我们并没有选取这个儿子的父亲边，也可以隐性地认为与它匹配的也没有选取，如果选取了，那对应地也选取了。即设 $h_n$ 表示 $n$ 个元素两两匹配的方案数，其中未匹配的元素处于待匹配状态。这样考虑儿子间的匹配情况的话，选取则是待匹配与待匹配合并，而不选取也有已匹配和待匹配合并来完成双射。转移式很显然了，是 $h_n=h_{n-1}+(n-1)h_{n-2}$，于是全部乘起来就算完了。</p>
<p>而仙人掌情况在转换完题意就结束了。环上的边都不能使用，于是去掉所有环上的边，剩下来的连通块都是树，各做一遍就好了。时间复杂度 $O(n+m)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.5 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> f[N];</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; G[N];</span><br><span class="line">    <span class="keyword">int</span> dfn[N],fa[N],tim,du[N];</span><br><span class="line">    <span class="keyword">int</span> vis[N];</span><br><span class="line">    <span class="keyword">int</span> fl;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(res x)</span></span>&#123;</span><br><span class="line">        dfn[x]=++tim;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> tox:G[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(tox==fa[x])<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(!dfn[tox])fa[tox]=x,<span class="built_in">dfs</span>(tox);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(dfn[tox]&gt;dfn[x]) &#123;</span><br><span class="line">                <span class="keyword">for</span>(res now=tox;now!=x;now=fa[now])&#123;</span><br><span class="line">                    <span class="keyword">if</span>(vis[now])&#123;fl=<span class="number">1</span>;<span class="keyword">return</span>;&#125;</span><br><span class="line">                    vis[now]=<span class="number">1</span>,du[now]-=<span class="number">2</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                du[x]-=<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(fl)<span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)vector&lt;<span class="keyword">int</span>&gt;().<span class="built_in">swap</span>(G[i]),du[i]=vis[i]=fa[i]=dfn[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            res u=<span class="built_in">read</span>(),v=<span class="built_in">read</span>();</span><br><span class="line">            G[u].<span class="built_in">pb</span>(v),G[v].<span class="built_in">pb</span>(u);</span><br><span class="line">            du[u]++,du[v]++;</span><br><span class="line">        &#125;</span><br><span class="line">        fl=tim=<span class="number">0</span>,<span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span>(fl)&#123;<span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">        res ans=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)ans=<span class="built_in">mul</span>(ans,f[du[i]]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    f[<span class="number">0</span>]=f[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=N<span class="number">-10</span>;i++)f[i]=<span class="built_in">Add</span>(f[i<span class="number">-1</span>],<span class="built_in">mul</span>(i<span class="number">-1</span>,f[i<span class="number">-2</span>]));</span><br><span class="line">    res Case=<span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">for</span>(res T=<span class="number">1</span>;T&lt;=Case;T++)MAIN::<span class="built_in">MAIN</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj545"><a href="#loj545" class="headerlink" title="[loj545]"></a>[loj545]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 贪心、STL | Difficulty:  思维二，代码实现三</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：说下我的思路历程。</p>
<p>开始我并没有注意到两个相等的数异或这件事，我先是注意到一定要是 $A$ 的 $\mathrm{lowbit}$ 最大的和 $B$ 的 $\mathrm{lowbit}$ 最小的组合，这样减去的会是最多。又因为二进制的特殊性，我也可以证明这样一定是最优的，然后交上去零分。</p>
<p>再想了一下，发现两个相等的数的异或可以更小。于是不加证明地，我猜想每次选择这两种情况中最大的那个一定是最优的，事实证明是这样的，证明也并不复杂。</p>
<p>实现时，不知道为什么 <code>deque</code> 的空间会爆，把其改成 <code>vector</code> 就空间绰绰有余，这是为啥啊。</p>
<p>时间复杂度 $O((n+m)\log )$ 或 $O(n+m)$，我写的前者。</p>
<p>坑：把所有零先行去掉。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.7 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1200000</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="keyword">int</span> a[N],b[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmpa</span><span class="params">(<span class="keyword">const</span> res &amp;x,<span class="keyword">const</span> res &amp;y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">lowbit</span>(x)&gt;<span class="built_in">lowbit</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmpb</span><span class="params">(<span class="keyword">const</span> res &amp;x,<span class="keyword">const</span> res &amp;y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">lowbit</span>(x)&lt;<span class="built_in">lowbit</span>(y);</span><br><span class="line">    &#125;</span><br><span class="line">    map&lt;<span class="keyword">int</span>,vector&lt;<span class="keyword">int</span>&gt; &gt; B,A;</span><br><span class="line">    <span class="keyword">bool</span> va[N],vb[N];</span><br><span class="line">    LL ans;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        res nn=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">if</span>(x)a[++nn]=x,ans+=<span class="built_in">lowbit</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        n=nn,nn=<span class="number">0</span>;</span><br><span class="line">        m=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">if</span>(x)b[++nn]=x;</span><br><span class="line">        &#125;</span><br><span class="line">        m=nn;</span><br><span class="line">        res k=<span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">sort</span>(b+<span class="number">1</span>,b+m+<span class="number">1</span>,cmpb);</span><br><span class="line">        <span class="built_in">sort</span>(a+<span class="number">1</span>,a+n+<span class="number">1</span>,cmpa);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)B[b[i]].<span class="built_in">pb</span>(i);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)A[a[i]].<span class="built_in">pb</span>(i);</span><br><span class="line">        res na=<span class="number">1</span>,nb=<span class="number">1</span>,now=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=k;i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(va[na]&amp;&amp;na&lt;=n)na++;</span><br><span class="line">            <span class="keyword">while</span>(vb[nb]&amp;&amp;nb&lt;=m)nb++;</span><br><span class="line">            <span class="keyword">if</span>(na&gt;n||nb&gt;m)<span class="keyword">break</span>;</span><br><span class="line">            res ret=-<span class="built_in">lowbit</span>(b[nb])+<span class="built_in">lowbit</span>(a[na]);</span><br><span class="line">            <span class="keyword">while</span>(now&lt;=n&amp;&amp;(va[now]||B[a[now]].<span class="built_in">empty</span>()||vb[B[a[now]].<span class="built_in">back</span>()]))&#123;</span><br><span class="line">                <span class="keyword">if</span>(va[now])&#123;</span><br><span class="line">                    A[a[now]].<span class="built_in">pop_back</span>();</span><br><span class="line">                    <span class="keyword">while</span>(!B[a[now]].<span class="built_in">empty</span>()&amp;&amp;vb[B[a[now]].<span class="built_in">back</span>()])B[a[now]].<span class="built_in">pop_back</span>();</span><br><span class="line">                    now++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">while</span>(!B[a[now]].<span class="built_in">empty</span>()&amp;&amp;vb[B[a[now]].<span class="built_in">back</span>()])B[a[now]].<span class="built_in">pop_back</span>();</span><br><span class="line">                    <span class="keyword">if</span>(B[a[now]].<span class="built_in">empty</span>())now++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(now&gt;n)&#123;</span><br><span class="line">                <span class="keyword">if</span>(ret&lt;=<span class="number">0</span>)<span class="keyword">break</span>;</span><br><span class="line">                ans-=ret,va[na]=<span class="number">1</span>,vb[nb]=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                res v=<span class="built_in">lowbit</span>(a[now]);</span><br><span class="line">                <span class="keyword">if</span>(v&gt;ret)&#123;</span><br><span class="line">                    ans-=v,va[now]=<span class="number">1</span>,vb[B[a[now]].<span class="built_in">back</span>()]=<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    ans-=ret,va[na]=<span class="number">1</span>,vb[nb]=<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj6073"><a href="#loj6073" class="headerlink" title="[loj6073]"></a>[loj6073]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 可持久化线段树、重链剖分 | Difficulty: 三</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：太久没写数据结构了，这种题都差点不会了。</p>
<p>首先可以注意到信息是可加减的，即题目所求的可以改成 $f(u)+f(v)-2\ast f(\mathrm{lca})+g(p_{\mathrm{lca}})$，其中 $f$ 表示该点到根路径上的 $g$ 和，而 $g$ 表示那个 $\mathrm{dist}$。那么我们只要对每个点求出它的 $f$ 即可。</p>
<p>而对每个点而言，它的 $f$ 可以由它父亲继承绝大部分，然后加上自己的 $g$。而 $g$ 的求法是显然的，继续拆成到根的路径，即 $g(x)=\mathrm{dist}(x)+\mathrm{dist}(k)-2\ast \mathrm{dist(lca)}$。前者和中间的都是容易的，而后者因为 $k$ 不固定的情况下并不容易求。我们再对 $g$ 进行转化，可以注意到，对每个 $x$ 而言，想要求 $\mathrm{dist(lca)}$ 不一定需要知道 $\mathrm{lca}$ 是谁，若在一棵边权几乎全为 $0$ 的树上，仅将 $x$ 到根的路径的边权赋上，那么 $\mathrm{dist(lca)}$ 就等于 $k$ 到根的路径长度和。更进一步，若干个点与 $k$ 的 $\mathrm{lca}$ 也可以这样处理。这样的话，某点到根的距离我们用重链剖分拆成 $O(\log)$ 段，每一段都是在线段树上连续的一段区间，然后加入一个新的点就等价于链加。发现修改的只有线段树，而这都可以用可持久化线段树来继承。于是就做完了。时间复杂度 $O(q\log^2n)$。</p>
<p>实现时，可持久化下传标记确实有点麻烦，还是写了标记永久化。（ 主要担心爆空间哦 ）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.7 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,q;</span><br><span class="line">    <span class="keyword">int</span> p[N];</span><br><span class="line">    vector&lt;Pair&gt; G[N];</span><br><span class="line">    LL lastans;</span><br><span class="line">    <span class="keyword">int</span> ls[N*<span class="number">120</span>],rs[N*<span class="number">120</span>],tot;</span><br><span class="line">    LL sum[N*<span class="number">120</span>],psum[N];</span><br><span class="line">    <span class="keyword">int</span> tag[N*<span class="number">120</span>];</span><br><span class="line">    <span class="keyword">int</span> fav[N];</span><br><span class="line">    <span class="keyword">int</span> dfn[N],low[N],pos[N],sz[N],son[N],idx,top[N],fa[N];</span><br><span class="line">    <span class="keyword">int</span> Dep[N];</span><br><span class="line">    LL dep[N],dis[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(res &amp;rt,res RT,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        rt=++tot;</span><br><span class="line">        ls[rt]=ls[RT],rs[rt]=rs[RT],sum[rt]=sum[RT]+psum[<span class="built_in">min</span>(r,R)]-psum[<span class="built_in">max</span>(l,L)<span class="number">-1</span>],tag[rt]=tag[RT];</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;tag[rt]++;<span class="keyword">return</span>;&#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="built_in">modify</span>(ls[rt],ls[RT],l,mid,L,R);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)<span class="built_in">modify</span>(rs[rt],rs[RT],mid+<span class="number">1</span>,r,L,R);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">LL <span class="title">query</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!rt)<span class="keyword">return</span> <span class="number">0ll</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)<span class="keyword">return</span> sum[rt];</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        RG LL ret=(psum[<span class="built_in">min</span>(r,R)]-psum[<span class="built_in">max</span>(l,L)<span class="number">-1</span>])*tag[rt];</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)ret+=<span class="built_in">query</span>(ls[rt],l,mid,L,R);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)ret+=<span class="built_in">query</span>(rs[rt],mid+<span class="number">1</span>,r,L,R);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> rt[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(res x,res fax)</span></span>&#123;</span><br><span class="line">        sz[x]=<span class="number">1</span>,fa[x]=fax;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> [tox,c]:G[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(tox==fax)<span class="keyword">continue</span>;</span><br><span class="line">            Dep[tox]=Dep[x]+<span class="number">1</span>,dep[tox]=dep[x]+c,fav[tox]=c,<span class="built_in">dfs</span>(tox,x),sz[x]+=sz[tox];</span><br><span class="line">            <span class="keyword">if</span>(sz[tox]&gt;sz[son[x]])son[x]=tox;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs_top</span><span class="params">(res x,res topx)</span></span>&#123;</span><br><span class="line">        top[pos[dfn[x]=++idx]=x]=topx;</span><br><span class="line">        psum[idx]=psum[idx<span class="number">-1</span>]+fav[x];</span><br><span class="line">        dis[x]=dis[fa[x]]+dep[p[x]];</span><br><span class="line">        <span class="keyword">if</span>(son[x])<span class="built_in">dfs_top</span>(son[x],topx);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> [tox,c]:G[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(tox==fa[x]||tox==son[x])<span class="keyword">continue</span>;</span><br><span class="line">            <span class="built_in">dfs_top</span>(tox,tox);</span><br><span class="line">        &#125;</span><br><span class="line">        low[x]=idx;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(res x)</span></span>&#123;</span><br><span class="line">        rt[x]=rt[fa[x]];</span><br><span class="line">        <span class="keyword">for</span>(res y=p[x];y;y=fa[top[y]])<span class="built_in">modify</span>(rt[x],rt[x],<span class="number">1</span>,n,dfn[top[y]],dfn[y]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> [tox,c]:G[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(tox==fa[x])<span class="keyword">continue</span>;</span><br><span class="line">            <span class="built_in">dfs</span>(tox);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">glca</span><span class="params">(res u,res v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(;top[u]!=top[v];u=fa[top[u]])<span class="keyword">if</span>(Dep[top[u]]&lt;Dep[top[v]])<span class="built_in">swap</span>(u,v);</span><br><span class="line">        <span class="keyword">return</span> dep[u]&lt;dep[v]?u:v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> LL <span class="title">f</span><span class="params">(<span class="keyword">const</span> res &amp;u,<span class="keyword">const</span> res &amp;k)</span></span>&#123;</span><br><span class="line">        RG LL ret=dis[u]+dep[k]*Dep[u];</span><br><span class="line">        <span class="keyword">for</span>(res x=k;x;x=fa[top[x]])ret-=<span class="built_in">query</span>(rt[u],<span class="number">1</span>,n,dfn[top[x]],dfn[x])*<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res typ=<span class="built_in">read</span>();</span><br><span class="line">        n=<span class="built_in">read</span>(),q=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">            res u=<span class="built_in">read</span>(),v=<span class="built_in">read</span>(),w=<span class="built_in">read</span>();</span><br><span class="line">            G[u].<span class="built_in">pb</span>(<span class="built_in">mp</span>(v,w)),G[v].<span class="built_in">pb</span>(<span class="built_in">mp</span>(u,w));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)p[i]=<span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">0</span>),<span class="built_in">dfs_top</span>(<span class="number">1</span>,<span class="number">1</span>),<span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">            LL u0=<span class="built_in">Read</span>(),v0=<span class="built_in">Read</span>(),k0=<span class="built_in">Read</span>();</span><br><span class="line">            res u,v,k;</span><br><span class="line">            <span class="keyword">if</span>(typ)u=(<span class="keyword">int</span>)(u0^lastans),v=(<span class="keyword">int</span>)(v0^lastans),k=(<span class="keyword">int</span>)(k0^lastans);</span><br><span class="line">            <span class="keyword">else</span> u=(<span class="keyword">int</span>)(u0),v=(<span class="keyword">int</span>)(v0),k=(<span class="keyword">int</span>)(k0);</span><br><span class="line">            RG LL ans=<span class="built_in">f</span>(u,k)+<span class="built_in">f</span>(v,k);</span><br><span class="line">            res lca=<span class="built_in">glca</span>(u,v);</span><br><span class="line">            ans-=<span class="built_in">f</span>(lca,k)*<span class="number">2</span>;</span><br><span class="line">            res X=p[lca];</span><br><span class="line">            ans+=dep[X]+dep[k]-dep[<span class="built_in">glca</span>(X,k)]*<span class="number">2</span>;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,lastans=ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj2655"><a href="#loj2655" class="headerlink" title="[loj2655]"></a>[loj2655]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 结论 | Difficulty: 二</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：可以猜一个结论，所有点一定是在 $y=x$ 的同一侧时更优，证明也很容易，假设此刻所有点都是 $x\leq y$，而答案显然是 $\max x_i-\min x_i+\max y_i-\min y_i$，若翻转了某个点，则它现在的 $y$ 只能变得更小，$x$ 只能变得更大。若它原本的 $x,y$ 本就不是最小和最大，那么翻转一定更不优。若是，比如 $x$ 是最小，那么翻转之后则将 $\min y_i$ 变成它原本的 $x$，而 $\min x_i$ 虽然变大了，但由于 $x\leq y$，则新的 $\min x_i$ 一定小于原来的 $\min y_i$，则总答案更不优。同理，我们就证出了这个结论。</p>
<p>但这并不一定是最优的最小花费，但由于边长已经固定了，那么一共只有 $2^2$ 种选取矩形四个点的方式，暴力判一下就好了。时间复杂度 $O(n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.8 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tup tuple<span class="meta-string">&lt;int,int,int&gt;</span></span></span><br><span class="line">    tup a[N];</span><br><span class="line">    <span class="keyword">int</span> ans=inf;</span><br><span class="line">    <span class="keyword">int</span> fl[N],Ans[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R,<span class="keyword">const</span> res &amp;U,<span class="keyword">const</span> res &amp;D)</span></span>&#123;</span><br><span class="line">        res ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            fl[i]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">auto</span> [x,y,c]=a[i];</span><br><span class="line">            <span class="keyword">if</span>(L&lt;=x&amp;&amp;x&lt;=R&amp;&amp;D&lt;=y&amp;&amp;y&lt;=U);</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">swap</span>(x,y);</span><br><span class="line">                <span class="keyword">if</span>(L&lt;=x&amp;&amp;x&lt;=R&amp;&amp;D&lt;=y&amp;&amp;y&lt;=U)ret+=c,fl[i]=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(ans&gt;ret)&#123;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)Ans[i]=fl[i];</span><br><span class="line">            ans=ret;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> L,R,U,D;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),L=inf,R=-inf,U=-inf,D=inf;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>(),y=<span class="built_in">read</span>(),c=<span class="built_in">read</span>();</span><br><span class="line">            a[i]=<span class="built_in">tup</span>(x,y,c);</span><br><span class="line">            <span class="keyword">if</span>(x&gt;y)<span class="built_in">swap</span>(x,y);</span><br><span class="line">            L=<span class="built_in">min</span>(L,x),R=<span class="built_in">max</span>(R,x),U=<span class="built_in">max</span>(U,y),D=<span class="built_in">min</span>(D,y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">solve</span>(L,R,U,D),<span class="built_in">solve</span>(D,R,U,L),<span class="built_in">solve</span>(L,U,R,D),<span class="built_in">solve</span>(D,U,R,L);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld %d\n&quot;</span>,((LL)R-L+U-D)*<span class="number">2</span>,ans);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d&quot;</span>,Ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj3082"><a href="#loj3082" class="headerlink" title="[loj3082*]"></a>[loj3082*]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 线段树、二分 | Difficulty: 五</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：呃呃，要捋清楚再写出来有点累哦。</p>
<p>首先我们能判断出水流的方向，只要看开孔的两侧谁的水比较高就谁从哪一边流过去（ 当然首先得判断孔高度是否大于水 ），不失一般性地，我们假设水从左往右流。</p>
<p>模拟一下水流的过程，大致可以分为三步。设开孔处为 $p$ 与 $p+1$ 之间，修改成 $C$，水高为 $h_i$，孔高为 $c_i$。</p>
<p>最开始，左边和 $p$ 连通的水会一起往左流。连通这里也是容易定义的，即水高一致且比每一个孔都要高。</p>
<p>然后，把所有右边与 $p+1$ 相连的坑填满。</p>
<p>最后，把还剩下的水继续推平。</p>
<p>为了方便，我们将这三个步骤抽象成比较合理的形式语言。</p>
<p>设 $Q(l,r)$ 表示 $\sum_{i=l}^r h_i$，$FL(l,r,h)$ 表示将 $[l,r]$ 的水清空后，要往 $l$ 中加多少水才能使 $r$ 的水高变成 $h$，$ML(l,r,h)$ 表示修改 $[l,r]$ 的水，将其变成执行完 $FL(l,r,h)$ 的样子。更形式化地，$FL$ 可以用后缀最大值表示，即</p>
<script type="math/tex; mode=display">
FL(l,r,h)=\sum_{i=l}^r \max(h,\max_{j=i}^{r-1} c_j)</script><p>接下来将三个步骤表示下。</p>
<p>第一步则是找到 $l$，使得 $[l,p]$ 连通，即对所有的 $i\in [l,p]$，满足 $h_i$ 相等且对所有的 $i\in [l,p)$，有 $c_i&lt;h_i$。同时设 $val=Q(l,p)-FL(l,p,C)$，并执行 $ML(l,p,C)$。</p>
<p>第二步则是找到最大的 $r$，使得 $FL(l,r,c_r)-Q(l,r)\leq val$。这步操作即找到会填的所有坑。</p>
<p>第三步我们除了推平，同时要修正第一步的错误，因为 $p$ 处的水高不一定是 $C$，所以我们要找出真实的水高。设 $r$ 处真实的水高为 $H$，那么它的限制条件就是找到最大的 $H$，使得 $FL(l,r,H)-Q(l,r)\leq val$，然后再执行 $ML(l,r,H)$。</p>
<p>形式化之后，我们要做的就是维护这三个操作了，$Q$ 看起来是容易的，而 $FL$ 显得有点怪异。由于是区间操作，我们会想用线段树维护，那么就得考虑中点有什么性质。</p>
<p>根据 $FL$ 的意义，我们可以推出一个式子，即</p>
<script type="math/tex; mode=display">
FL(l,r,h)=FL(m+1,r,h)+FL(l,m,\max(h,\max_{j=m}^{r-1}c_j))</script><p>看起来没啥用，毕竟直接递归这还是寄完了的。但是，通过观察，可以发现一个非常好的性质。</p>
<p>当 $h&gt;\max_{j=m}^{r-1} c_j$ 时，后者变成了 $FL(l,m,h)$，前者似乎没变化，但由于已经大于区间内所有孔高了，那么它一定是全部填到 $h$，所以前者此时等于 $(r-m)h$。</p>
<p>当 $h\leq \max_{j=m}^{r-1}$，前者没啥变化，但后者直接变成 $FL(l,m,\max_{j=m}^{r-1} c_j)$，这东西与 $h$ 无关，那么在线段树上我们对每个区间算好这个东西就可以了。</p>
<p>于是递归永远只用递归一边，那么复杂度就是 $O(\log n)$。说白了，这东西叫线段树上二分。</p>
<p>修改就直接打标记即可。为了每次都算 $FL$，那么时间复杂度就是 $O(\log^2n)$。</p>
<p>最后考虑找这个 $l,r,val,H$，发现这些东西都具有二分性，且都可以放在线段树上二分，所以总复杂度就是 $O(q\log^2n)$。</p>
<p>呃呃，代码还在路上，这几天事情比较多，估计要一会儿写。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj2829"><a href="#loj2829" class="headerlink" title="[loj2829]"></a>[loj2829]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 贪心 | Difficulty: 二</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：可以注意到与 $x$ 的大小与前面考生的选择无关，只与当前考生的选择有关。不妨设往前 $x$ 是 $C_{i,0}$，往后是 $C_{i,1}$。</p>
<p>再注意到 $B$ 的贡献与当前考生的即时选择无关，即若选择往前的人的个数是固定的，那 $B$ 的贡献也是固定的。设往前的人数为 $p$，那么 $B$ 的贡献就是 $B\cdot \frac{p(p-1)+(m-p)(m-p-1)}{2}$。发现这东西是单峰的。另一方面，若将所有考生按 $C_{i,0}-C_{i,1}$ 排序后，则一定存在一个分界点，分界点前全部选择往前，使得这个式子取到最小。因为 $A$ 的贡献这样是单调的，$B$ 的贡献是单峰的，于是就做完了。算这个 $C$ 等于动态维护前缀和，树状数组即可。时间复杂度 $O(m\log n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.11 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m,A,B;</span><br><span class="line">    <span class="keyword">int</span> tr[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">const</span> res &amp;x,<span class="keyword">const</span> res &amp;y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=x;i&lt;=n;i+=<span class="built_in">lowbit</span>(i))tr[i]+=y;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">const</span> res &amp;x)</span></span>&#123;</span><br><span class="line">        res ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=x;i;i-=<span class="built_in">lowbit</span>(i))ret+=tr[i];</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> b[N][<span class="number">6</span>];</span><br><span class="line">    Pair a[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> RG Pair &amp;x,<span class="keyword">const</span> RG Pair &amp;y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x.fi-x.se&lt;y.fi-y.se;</span><br><span class="line">    &#125;</span><br><span class="line">    LL sum[N][<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>(),A=<span class="built_in">read</span>(),B=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            res x;</span><br><span class="line">            <span class="keyword">char</span> y;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%d%c&quot;</span>,&amp;x,&amp;y);</span><br><span class="line">            y-=<span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">            res ret=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res j=y+<span class="number">1</span>;j&lt;<span class="number">2</span>;j++)ret+=b[x][j]^<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(res j=y<span class="number">-1</span>;j&gt;<span class="number">3</span>;j--)ret+=b[x][j]^<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(y==<span class="number">2</span>)<span class="built_in">modify</span>(x,<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(y==<span class="number">3</span>)<span class="built_in">modify</span>(x,<span class="number">1</span>);</span><br><span class="line">            a[i]=<span class="built_in">mp</span>(ret+<span class="number">2</span>*x-<span class="built_in">query</span>(x),ret+<span class="number">2</span>*(n-x+<span class="number">1</span>)-(<span class="built_in">query</span>(n)-<span class="built_in">query</span>(x<span class="number">-1</span>)));</span><br><span class="line">            b[x][y]^=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(a+<span class="number">1</span>,a+m+<span class="number">1</span>,cmp);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)sum[i][<span class="number">0</span>]=sum[i<span class="number">-1</span>][<span class="number">0</span>]+a[i].fi;</span><br><span class="line">        <span class="keyword">for</span>(res i=m;i;i--)sum[i][<span class="number">1</span>]=sum[i+<span class="number">1</span>][<span class="number">1</span>]+a[i].se;</span><br><span class="line">        LL ans=INF;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            LL ret=(sum[i][<span class="number">0</span>]+sum[i+<span class="number">1</span>][<span class="number">1</span>])*A+((LL)i*(i<span class="number">-1</span>)+(LL)(m-i)*(m-i<span class="number">-1</span>))/<span class="number">2</span>*B;</span><br><span class="line">            ans=<span class="built_in">min</span>(ans,ret);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj2000"><a href="#loj2000" class="headerlink" title="[loj2000]"></a>[loj2000]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 莫比乌斯反演、整除分块 | Difficulty: 二</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：呃呃，一上来就把乘积看成加法了，虽然差不多。</p>
<p>直接推式子就行了，远古题还是比较容易推的。</p>
<script type="math/tex; mode=display">
\begin{align*}
&\prod_{i=1}^n\prod_{j=1}^m f_{\gcd(i,j)}\\
&\prod_{i=1}^n\prod_{j=1}^m\prod_{d=1}^n f_d^{[\gcd(i,j)=d]}\\
&\prod_{d=1}^nf_d^{\sum_{i=1}^n\sum_{j=1}^m[\gcd(i,j)=d]}\\
&\prod_{d=1}^nf_d^{\sum_{i=1}^{\frac{n}{d}}\sum_{j=1}^{\frac{m}{d}}[\gcd(i,j)=1]}\\
&\prod_{d=1}^nf_d^{\sum_{i=1}^{\frac{n}{d}}\sum_{j=1}^{\frac{m}{d}}\sum_{p|i,p|j}\mu_p}\\
&\prod_{d=1}^nf_d^{\sum_{p=1}^n \mu_p \lfloor\frac{n}{d\cdot p}\rfloor\lfloor\frac{m}{d\cdot p}\rfloor}\\
&\prod_{p=1}^n \prod_{d|p}^nf_d^{\mu_{\frac{p}{d}} \lfloor\frac{n}{p}\rfloor\lfloor\frac{m}{p}\rfloor}\\
&\prod_{p=1}^n (\prod_{d|p}^nf_{\frac{p}{d}}^{\mu_{d}})^{\lfloor\frac{n}{p}\rfloor\lfloor\frac{m}{p}\rfloor}\\
&\prod_{p=1}^n (g_p)^{\lfloor\frac{n}{p}\rfloor\lfloor\frac{m}{p}\rfloor}\\
&\end{align*}</script><p>其中 $g$ 是 $f$ 和 $\mu$ 的狄利克雷卷积，直接算就是调和级数的 $O(n\log n)$。而指数上的东西显然的整除分块，所以就是预处理 $O(n\log n)$，单次 $O(\sqrt{n})$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.13 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> prim[N],vis[N],tot,mu[N],f[N],If[N];</span><br><span class="line"><span class="keyword">int</span> g[N],sg[N],Ig[N];</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">        res ans=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res l=<span class="number">1</span>,r;l&lt;=<span class="built_in">min</span>(n,m);l=r+<span class="number">1</span>)&#123;</span><br><span class="line">            r=<span class="built_in">min</span>(n/(n/l),m/(m/l));</span><br><span class="line">            ans=<span class="built_in">mul</span>(ans,<span class="built_in">qpow</span>(<span class="built_in">mul</span>(sg[r],Ig[l<span class="number">-1</span>]),<span class="built_in"><span class="keyword">int</span></span>((LL)(n/l)*(m/l)%(kcz<span class="number">-1</span>))));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    f[<span class="number">1</span>]=If[<span class="number">1</span>]=mu[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=N<span class="number">-10</span>;i++)&#123;</span><br><span class="line">        f[i]=<span class="built_in">Add</span>(f[i<span class="number">-1</span>],f[i<span class="number">-2</span>]),If[i]=<span class="built_in">qpow</span>(f[i]);</span><br><span class="line">        <span class="keyword">if</span>(!vis[i])prim[++tot]=i,mu[i]=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=tot&amp;&amp;prim[j]*i&lt;=N<span class="number">-10</span>;j++)&#123;</span><br><span class="line">            vis[prim[j]*i]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(i%prim[j]==<span class="number">0</span>)<span class="keyword">break</span>;</span><br><span class="line">            mu[prim[j]*i]=-mu[i];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=N<span class="number">-10</span>;i++)g[i]=<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span>(res d=<span class="number">1</span>;d&lt;=N<span class="number">-10</span>;d++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!mu[d])<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=d;i&lt;=N<span class="number">-10</span>;i+=d)&#123;</span><br><span class="line">            g[i]=<span class="built_in">mul</span>(g[i],mu[d]==<span class="number">1</span>?f[i/d]:If[i/d]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    sg[<span class="number">1</span>]=g[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=N<span class="number">-10</span>;i++)sg[i]=<span class="built_in">mul</span>(g[i],sg[i<span class="number">-1</span>]);</span><br><span class="line">    Ig[N<span class="number">-10</span>]=<span class="built_in">qpow</span>(sg[N<span class="number">-10</span>]);</span><br><span class="line">    <span class="keyword">for</span>(res i=N<span class="number">-11</span>;i&gt;=<span class="number">1</span>;i--)Ig[i]=<span class="built_in">mul</span>(Ig[i+<span class="number">1</span>],g[i+<span class="number">1</span>]);</span><br><span class="line">    Ig[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">    res Case=<span class="built_in">read</span>();</span><br><span class="line">    <span class="keyword">for</span>(res T=<span class="number">1</span>;T&lt;=Case;T++)MAIN::<span class="built_in">MAIN</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj6182"><a href="#loj6182" class="headerlink" title="[loj6182]"></a>[loj6182]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: LCP、动态规划 | Difficulty: 三</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：先讲点正常的做法。</p>
<p>枚举两串后，设 $f_{i,j}$ 表示前一个串匹配到 $i$ 的位置后匹配到 $j$ 的位置的最小操作次数，那么转移就是</p>
<script type="math/tex; mode=display">
f_{i,j}=\min\lbrace f_{i-1,j}+1,f_{i,j-1}+1,f_{i-1,j-1}+[a_i\neq b_j]\rbrace</script><p>这样复杂度是 $O(L^2)$ 的，注意到题目要求的只有 $\leq 8$ 的答案，于是改写 $\mathrm{dp}$，即设 $g_{i,j}$ 表示 $f_{i,i+j}$，可以证明 $|j|\leq 8$。这样复杂度就是 $O(16nL)$，依然不太行。</p>
<p>注意到 $g$ 的值域也很小，于是再度改写，设 $h_{i,j}$ 表示最大的 $x$ 使得 $g_{x,j}=i$。正确性显然，然后重新整一下转移，即</p>
<script type="math/tex; mode=display">
h_{i,j}=\max\lbrace h_{i-1,j-1},h_{i-1,j+1}+1,h_{i-1,j}+1\rbrace+\mathrm{LCP(...,...)}</script><p>$\mathrm{LCP}$ 用后缀数组即可维护，于是总复杂度就降到了 $O(128n^2+L\log L)$。</p>
<p>然后一看其他人代码，会立刻发现有不少求 $\mathrm{LCP}$ 都是暴力求的，而且快了无数倍，这下呃呃了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.13 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e6</span>+<span class="number">200</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> str[N];</span><br><span class="line">    <span class="keyword">char</span> s[N];</span><br><span class="line">    <span class="keyword">int</span> n,L;</span><br><span class="line">    <span class="keyword">int</span> rnk[N],buc[N],sa[N],hei[N],fr[N],sc[N],m;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">get_SA</span><span class="params">()</span></span>&#123;</span><br><span class="line">        m=<span class="number">10000</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)buc[fr[i]=str[i]]++;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=m;i++)buc[i]+=buc[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span>(res i=n;i;i--)sa[buc[fr[i]]--]=i;</span><br><span class="line">        <span class="keyword">for</span>(res k=<span class="number">1</span>;k&lt;=n;k&lt;&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">            res num=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=n-k+<span class="number">1</span>;i&lt;=n;i++)sc[++num]=i;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(sa[i]&gt;k)sc[++num]=sa[i]-k;</span><br><span class="line">            <span class="built_in">memset</span>(buc,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(buc));</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)buc[fr[i]]++;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=m;i++)buc[i]+=buc[i<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">for</span>(res i=n;i;i--)sa[buc[fr[sc[i]]]--]=sc[i],sc[i]=<span class="number">0</span>;</span><br><span class="line">            <span class="built_in">swap</span>(fr,sc);</span><br><span class="line">            fr[sa[<span class="number">1</span>]]=<span class="number">1</span>;</span><br><span class="line">            num=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)fr[sa[i]]=(sc[sa[i]]==sc[sa[i<span class="number">-1</span>]]&amp;&amp;sc[sa[i]+k]==sc[sa[i<span class="number">-1</span>]+k])?num:++num;</span><br><span class="line">            <span class="keyword">if</span>(num==n)<span class="keyword">break</span>;</span><br><span class="line">            m=num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">get_hei</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res k=<span class="number">0</span>;</span><br><span class="line">        rnk[sa[<span class="number">1</span>]]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)rnk[sa[i]]=rnk[sa[i<span class="number">-1</span>]]+(fr[sa[i]]!=fr[sa[i<span class="number">-1</span>]]||sc[sa[i]]!=sc[sa[i<span class="number">-1</span>]]);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(rnk[i]==<span class="number">1</span>)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(k)k--;</span><br><span class="line">            res j=sa[rnk[i]<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">while</span>(j+k&lt;=n&amp;&amp;i+k&lt;=n&amp;&amp;str[i+k]==str[j+k])k++;</span><br><span class="line">            hei[rnk[i]]=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> st[N][<span class="number">21</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">PRE</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)st[i][<span class="number">0</span>]=hei[i];</span><br><span class="line">        <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=<span class="number">20</span>;j++)</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i+(<span class="number">1</span>&lt;&lt;j)<span class="number">-1</span>&lt;=n;i++)</span><br><span class="line">                st[i][j]=<span class="built_in">min</span>(st[i][j<span class="number">-1</span>],st[i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))][j<span class="number">-1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> Lg[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query_min</span><span class="params">(res l,res r)</span></span>&#123;</span><br><span class="line">        res k=Lg[r-l];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(st[l][k],st[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">LCP</span><span class="params">(<span class="keyword">const</span> res &amp;l,<span class="keyword">const</span> res &amp;r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l==r)<span class="keyword">return</span> n-l+<span class="number">1</span>;</span><br><span class="line">        res x=rnk[l],y=rnk[r];</span><br><span class="line">        <span class="keyword">if</span>(x&gt;y)<span class="built_in">swap</span>(x,y);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query_min</span>(x+<span class="number">1</span>,y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pre</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)Lg[i]=Lg[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">get_SA</span>(),<span class="built_in">get_hei</span>(),<span class="built_in">PRE</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> pos[N],le[N];</span><br><span class="line">    <span class="keyword">int</span> ans[<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">int</span> f[<span class="number">9</span>][<span class="number">17</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">solve</span><span class="params">(res I,res J)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(le[I]&lt;le[J])<span class="built_in">swap</span>(I,J);</span><br><span class="line">        res l0=le[I],l1=le[J];</span><br><span class="line">        <span class="keyword">if</span>(l0&lt;l1<span class="number">-8</span>||l1&lt;l0<span class="number">-8</span>)<span class="keyword">return</span> <span class="number">9</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=<span class="number">8</span>;i++)<span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=<span class="number">16</span>;j++)f[i][j]=-n<span class="number">-10</span>;</span><br><span class="line">        f[<span class="number">0</span>][<span class="number">8</span>]=<span class="built_in">LCP</span>(pos[I],pos[J]);</span><br><span class="line">        <span class="keyword">if</span>(l0==l1&amp;&amp;f[<span class="number">0</span>][<span class="number">8</span>]&gt;=l0)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">8</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=<span class="number">16</span>;j++)&#123;</span><br><span class="line">                res ret=f[i<span class="number">-1</span>][j]+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(j!=<span class="number">0</span>)ret=<span class="built_in">max</span>(ret,f[i<span class="number">-1</span>][j<span class="number">-1</span>]);</span><br><span class="line">                <span class="keyword">if</span>(j!=<span class="number">16</span>)ret=<span class="built_in">max</span>(ret,f[i<span class="number">-1</span>][j+<span class="number">1</span>]+<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">if</span>(ret+j<span class="number">-8</span>&lt;<span class="number">0</span>)<span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span>(ret&lt;l0&amp;&amp;ret+j<span class="number">-8</span>&lt;l1)ret+=<span class="built_in">LCP</span>(pos[I]+ret,pos[J]+ret+j<span class="number">-8</span>);</span><br><span class="line">                f[i][j]=ret;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(f[i][<span class="number">8</span>+l1-l0]==l0)<span class="keyword">return</span> i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">9</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        L=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=L;i++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s+<span class="number">1</span>);</span><br><span class="line">            res len=(<span class="keyword">int</span>)<span class="built_in">strlen</span>(s+<span class="number">1</span>);</span><br><span class="line">            pos[i]=n+<span class="number">1</span>,le[i]=len;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=len;j++)str[++n]=s[j];</span><br><span class="line">            str[++n]=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">pre</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=L;i++)<span class="keyword">for</span>(res j=i+<span class="number">1</span>;j&lt;=L;j++)ans[<span class="built_in">solve</span>(i,j)]++;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">8</span>;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,ans[i]);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj3025"><a href="#loj3025" class="headerlink" title="[loj3025]"></a>[loj3025]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 模拟、STL | Difficulty: 一</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：直接模拟就行了，将已经发出信号按楼层高低排序，往下会不会碰到直接判就行了。这些动态排序都可以用各种 STL 维护。时间复杂度 $O(n\log n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.13 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tup tuple<span class="meta-string">&lt;int,int,int&gt;</span></span></span><br><span class="line">    tup a[N];</span><br><span class="line">    LL ans[N];</span><br><span class="line">    priority_queue&lt;Pair,vector&lt;Pair&gt;,greater&lt;&gt;&gt; Q;</span><br><span class="line">    <span class="keyword">int</span> vis[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res t=<span class="built_in">read</span>(),d=<span class="built_in">read</span>();</span><br><span class="line">            a[i]=<span class="built_in">tup</span>(t,i,d);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(a+<span class="number">1</span>,a+n+<span class="number">1</span>);</span><br><span class="line">        res l=<span class="number">1</span>,r=<span class="number">1</span>;</span><br><span class="line">        LL nowt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="number">233</span>)&#123;</span><br><span class="line">            <span class="keyword">while</span>(vis[get&lt;<span class="number">1</span>&gt;(a[l])]&amp;&amp;l&lt;=n)l++;</span><br><span class="line">            <span class="keyword">if</span>(l&gt;n)<span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">auto</span> [t,i,d]=a[l];</span><br><span class="line">            vector&lt;<span class="keyword">int</span>&gt; A;</span><br><span class="line">            A.<span class="built_in">pb</span>(i);</span><br><span class="line">            <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">                <span class="keyword">auto</span> [D,I]=Q.<span class="built_in">top</span>();</span><br><span class="line">                <span class="keyword">if</span>(D&gt;d)<span class="keyword">break</span>;</span><br><span class="line">                A.<span class="built_in">pb</span>(I),Q.<span class="built_in">pop</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            LL nt=<span class="built_in">max</span>(nowt,(LL)t)+d<span class="number">-1</span>;</span><br><span class="line">            nowt=nt+d<span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">while</span>(r&lt;=n)&#123;</span><br><span class="line">                <span class="keyword">if</span>(get&lt;<span class="number">0</span>&gt;(a[r])&gt;nowt)<span class="keyword">break</span>;</span><br><span class="line">                <span class="keyword">auto</span> [T,I,D]=a[r];</span><br><span class="line">                <span class="keyword">if</span>(D&gt;d||nt+d&lt;T+D)Q.<span class="built_in">push</span>(<span class="built_in">mp</span>(D,I));</span><br><span class="line">                <span class="keyword">else</span> A.<span class="built_in">pb</span>(I);</span><br><span class="line">                r++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> x:A)ans[x]=nowt,vis[x]=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj2320"><a href="#loj2320" class="headerlink" title="[loj2320]"></a>[loj2320]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 多项式各种操作、prufer 序列 | Difficulty: 三点五</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：看到生成树计数，不是矩阵树就是 prufer 序列。我是先考虑的矩阵树定理，然后发现确实不太难构造出边权，所以就遗憾放弃了。于是就考虑 prufer 序列，推一推式子就出来了。</p>
<p>首先可以把连通块看成点， $a_i$ 看成点权，那么连一条边的贡献就是两个端点的点权之积，于是就轻松地写出第一条式子，并用 prufer 序列推导，即</p>
<script type="math/tex; mode=display">
\begin{align*}
&\sum_T \prod_{(u,v)} (a_ua_v)(\sum d_i^m)(\prod d_i^m)\\
&=\sum_T \prod a_i^{d_i}d_i^m(\sum d_i^m)\\
&=\sum_{\sum d_i=n-2} \frac{(n-2)!}{\prod d_i!} \prod a_i^{d_i+1}(d_i+1)^m(\sum (d_i+1)^m)\\
&=(n-2)!\sum_{\sum d_i=n-2} \prod \frac{a_i^{d_i+1}(d_i+1)^{m+1}}{(d_i+1)!}(\sum (d_i+1)^m)\\
&=(n-2)!\sum_{\sum d_i=n-2} \sum (d_i+1)^m\prod \frac{a_j^{d_j+1}(d_j+1)^{m+1}}{(d_j+1)!}\\
&=(n-2)!\sum_{\sum d_i=n-2} \sum \frac{a_i^{d_i+1}(d_i+1)^{2m+1}}{(d_i+1)!}\prod_{j\neq i} \frac{a_j^{d_j+1}(d_j+1)^{m+1}}{(d_j+1)!}\\
&=(n-2)!\prod a_i\sum_{\sum d_i=n-2} \sum \frac{a_i^{d_i}(d_i+1)^{2m+1}}{(d_i+1)!}\prod_{j\neq i} \frac{a_j^{d_j}(d_j+1)^{m+1}}{(d_j+1)!}\\
&\end{align*}</script><p>推到这一步可以说是结束了，把前者看成一个多项式，后者看成一个多项式，那么 $\sum d_i=n-2$ 就是个卷积，即</p>
<script type="math/tex; mode=display">
\begin{align*}
&A(x)=\sum \frac{(i+1)^mx^i}{i!}\\
&B(x)=\sum \frac{(i+1)^{2m}x^i}{i!}\\
&\end{align*}</script><p>那么答案就是</p>
<script type="math/tex; mode=display">
(n-2)!\prod a_i [x^{n-2}] (\sum \frac{B(a_ix)}{A(a_ix)})(\prod A(a_ix))</script><p>后者取 $\ln$ 后，与前者是一个形式。于是问题就转化成</p>
<p>已知 $F(x)$，求 $\sum_{i=1}^m F(a_ix)$。设 $F(x)=\sum_{n\geq 0} f_nx^n$，那么要求的就是 $\sum_{n\geq 0}f_nx^n(\sum_{i=1}^m a_i^n)$。</p>
<p>这个东西也比较经典了，直接提取系数，即求 $[x^n]\sum_{i=1}^m \frac{1}{1-a_ix}$。而 $\sum_{i=1}^m \frac{1}{1-a_ix}$ 也是很简单的东西了，直接分治+FFT $O(n\log^2n)$，即模拟通分的过程或者积分。</p>
<p>于是总复杂度 $O(n\log^2n)$。</p>
<p>不要问我为什么代码这么怪，主要还是之前的多项式板子有点问题，导致边写边改，希望以后能写个正常的板子出来。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.13 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">4e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> pos[N],inv[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">NTT</span><span class="params">(poly &amp;A,<span class="keyword">const</span> res &amp;type,<span class="keyword">const</span> res &amp;lim)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;lim;i++)<span class="keyword">if</span>(i&lt;pos[i])<span class="built_in">swap</span>(A[i],A[pos[i]]);</span><br><span class="line">        <span class="keyword">for</span>(res mid=<span class="number">1</span>;mid&lt;lim;mid&lt;&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">            res wn=<span class="built_in">qpow</span>(type==<span class="number">1</span>?G:GI,(kcz<span class="number">-1</span>)/(mid&lt;&lt;<span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;lim;j+=mid&lt;&lt;<span class="number">1</span>)&#123;</span><br><span class="line">                res w=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span>(res k=<span class="number">0</span>;k&lt;mid;k++,w=<span class="built_in">mul</span>(w,wn))&#123;</span><br><span class="line">                    res x=A[j+k],y=<span class="built_in">mul</span>(w,A[j+mid+k]);</span><br><span class="line">                    A[j+k]=<span class="built_in">Add</span>(x,y),A[j+mid+k]=<span class="built_in">Add</span>(x,kcz-y);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(type==<span class="number">-1</span>)&#123;</span><br><span class="line">            res INV=<span class="built_in">qpow</span>(lim,kcz<span class="number">-2</span>);</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=lim;i++)A[i]=<span class="built_in">mul</span>(A[i],INV);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">NTT</span><span class="params">(res *A,<span class="keyword">const</span> res &amp;type,<span class="keyword">const</span> res &amp;lim)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;lim;i++)<span class="keyword">if</span>(i&lt;pos[i])<span class="built_in">swap</span>(A[i],A[pos[i]]);</span><br><span class="line">        <span class="keyword">for</span>(res mid=<span class="number">1</span>;mid&lt;lim;mid&lt;&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">            res wn=<span class="built_in">qpow</span>(type==<span class="number">1</span>?G:GI,(kcz<span class="number">-1</span>)/(mid&lt;&lt;<span class="number">1</span>));</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;lim;j+=mid&lt;&lt;<span class="number">1</span>)&#123;</span><br><span class="line">                res w=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span>(res k=<span class="number">0</span>;k&lt;mid;k++,w=<span class="built_in">mul</span>(w,wn))&#123;</span><br><span class="line">                    res x=A[j+k],y=<span class="built_in">mul</span>(w,A[j+mid+k]);</span><br><span class="line">                    A[j+k]=<span class="built_in">Add</span>(x,y),A[j+mid+k]=<span class="built_in">Add</span>(x,kcz-y);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(type==<span class="number">-1</span>)&#123;</span><br><span class="line">            res INV=<span class="built_in">qpow</span>(lim,kcz<span class="number">-2</span>);</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=lim;i++)A[i]=<span class="built_in">mul</span>(A[i],INV);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">derivation</span><span class="params">(<span class="keyword">const</span> res *A,res *B,<span class="keyword">const</span> res &amp;lim)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;lim;i++)B[i<span class="number">-1</span>]=<span class="built_in">mul</span>(i,A[i]);</span><br><span class="line">        B[lim<span class="number">-1</span>]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">integral</span><span class="params">(<span class="keyword">const</span> res *A,res *B,<span class="keyword">const</span> res &amp;lim)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;lim;i++)B[i]=<span class="built_in">mul</span>(A[i<span class="number">-1</span>],inv[i]);</span><br><span class="line">        B[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> A[N],B[N],D[N],E[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getinv</span><span class="params">(<span class="keyword">const</span> res *a,res *b,res lim)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(lim==<span class="number">1</span>)&#123;b[<span class="number">0</span>]=<span class="built_in">qpow</span>(a[<span class="number">0</span>]);<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="built_in">getinv</span>(a,b,lim&gt;&gt;<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;lim;i++)A[i]=a[i],B[i]=b[i];</span><br><span class="line">        res qaq=<span class="number">0</span>,len=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(len&lt;=lim)len&lt;&lt;=<span class="number">1</span>,qaq++;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;len;i++)pos[i]=(pos[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)&lt;&lt;(qaq<span class="number">-1</span>));</span><br><span class="line">        <span class="built_in">NTT</span>(A,<span class="number">1</span>,len),<span class="built_in">NTT</span>(B,<span class="number">1</span>,len);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;len;i++)A[i]=<span class="built_in">mul</span>(A[i],<span class="built_in">mul</span>(B[i],B[i]));</span><br><span class="line">        <span class="built_in">NTT</span>(A,<span class="number">-1</span>,len);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;lim;i++)b[i]=<span class="built_in">Add</span>(b[i],<span class="built_in">Add</span>(b[i],kcz-A[i]));</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;len;i++)A[i]=B[i]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">getln</span><span class="params">(<span class="keyword">const</span> res *a,res *b,<span class="keyword">const</span> res &amp;lim)</span></span>&#123;</span><br><span class="line">        <span class="built_in">derivation</span>(a,D,lim),<span class="built_in">getinv</span>(a,E,lim);</span><br><span class="line">        res qaq=<span class="number">0</span>,len=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(len&lt;=lim)len&lt;&lt;=<span class="number">1</span>,qaq++;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;len;i++)pos[i]=(pos[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)&lt;&lt;(qaq<span class="number">-1</span>));</span><br><span class="line">        <span class="built_in">NTT</span>(D,<span class="number">1</span>,len),<span class="built_in">NTT</span>(E,<span class="number">1</span>,len);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;len;i++)D[i]=<span class="built_in">mul</span>(D[i],E[i]);</span><br><span class="line">        <span class="built_in">NTT</span>(D,<span class="number">-1</span>,len);</span><br><span class="line">        <span class="built_in">integral</span>(D,b,lim);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;len;i++)D[i]=E[i]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> F[N],G[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">getexp</span><span class="params">(<span class="keyword">const</span> res *a,res *b,res lim)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(lim==<span class="number">1</span>)&#123;b[<span class="number">0</span>]=<span class="number">1</span>;<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="built_in">getexp</span>(a,b,lim&gt;&gt;<span class="number">1</span>);</span><br><span class="line">        <span class="built_in">getln</span>(b,G,lim);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;lim;i++)F[i]=b[i],G[i]=<span class="built_in">Add</span>(kcz-G[i],a[i]);</span><br><span class="line">        G[<span class="number">0</span>]=<span class="built_in">Add</span>(G[<span class="number">0</span>],<span class="number">1</span>);</span><br><span class="line">        res qaq=<span class="number">0</span>,len=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(len&lt;=lim)len&lt;&lt;=<span class="number">1</span>,qaq++;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;len;i++)pos[i]=(pos[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)&lt;&lt;(qaq<span class="number">-1</span>));</span><br><span class="line">        <span class="built_in">NTT</span>(F,<span class="number">1</span>,len),<span class="built_in">NTT</span>(G,<span class="number">1</span>,len);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;len;i++)F[i]=<span class="built_in">mul</span>(F[i],G[i]);</span><br><span class="line">        <span class="built_in">NTT</span>(F,<span class="number">-1</span>,len);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;lim;i++)b[i]=F[i];</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;len;i++)F[i]=G[i]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    <span class="function">poly <span class="title">solve</span><span class="params">(res l,res r)</span></span>&#123;</span><br><span class="line">        poly P&#123;&#125;;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">            P.<span class="built_in">pb</span>(<span class="number">1</span>),P.<span class="built_in">pb</span>(kcz-a[l]);</span><br><span class="line">            <span class="keyword">return</span> P;</span><br><span class="line">        &#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        poly L=<span class="built_in">solve</span>(l,mid),R=<span class="built_in">solve</span>(mid+<span class="number">1</span>,r);</span><br><span class="line">        res lim=r-l+<span class="number">2</span>;</span><br><span class="line">        res qaq=<span class="number">0</span>,len=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(len&lt;=lim)len&lt;&lt;=<span class="number">1</span>,qaq++;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;len;i++)pos[i]=(pos[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)&lt;&lt;(qaq<span class="number">-1</span>));</span><br><span class="line">        L.<span class="built_in">resize</span>(len),R.<span class="built_in">resize</span>(len);</span><br><span class="line">        <span class="built_in">NTT</span>(L,<span class="number">1</span>,len),<span class="built_in">NTT</span>(R,<span class="number">1</span>,len);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;len;i++)P.<span class="built_in">pb</span>(<span class="built_in">mul</span>(L[i],R[i]));</span><br><span class="line">        <span class="built_in">NTT</span>(P,<span class="number">-1</span>,len),P.<span class="built_in">resize</span>(lim);</span><br><span class="line">        <span class="keyword">return</span> P;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="keyword">int</span> b[N],c[N],finv[N],d[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">        res ret=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>(),ret=<span class="built_in">mul</span>(ret,a[i]);</span><br><span class="line">        <span class="keyword">for</span>(res i=n<span class="number">-2</span>;i&gt;=<span class="number">1</span>;i--)ret=<span class="built_in">mul</span>(ret,i);</span><br><span class="line">        poly P=<span class="built_in">solve</span>(<span class="number">1</span>,n);</span><br><span class="line">        <span class="built_in">assert</span>(P.<span class="built_in">size</span>()&gt;n);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=n<span class="number">-2</span>;i++)b[i]=P[i];</span><br><span class="line">        res l=<span class="number">1</span>,qaq=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;=(n<span class="number">-1</span>))l&lt;&lt;=<span class="number">1</span>,qaq++;</span><br><span class="line">        finv[<span class="number">0</span>]=finv[<span class="number">1</span>]=inv[<span class="number">0</span>]=inv[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=l;i++)inv[i]=<span class="built_in">mul</span>(inv[kcz%i],kcz-kcz/i),finv[i]=<span class="built_in">mul</span>(finv[i<span class="number">-1</span>],inv[i]);</span><br><span class="line">        <span class="built_in">getln</span>(b,c,l),<span class="built_in">derivation</span>(c,b,l);</span><br><span class="line">        <span class="keyword">for</span>(res i=n<span class="number">-2</span>;i;i--)b[i]=kcz-b[i<span class="number">-1</span>];</span><br><span class="line">        b[<span class="number">0</span>]=n;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=n<span class="number">-2</span>;i++)a[i]=<span class="built_in">mul</span>(<span class="built_in">qpow</span>(i+<span class="number">1</span>,m),finv[i]);</span><br><span class="line">        <span class="built_in">memset</span>(c,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(c));</span><br><span class="line">        <span class="built_in">getln</span>(a,c,l);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=n<span class="number">-2</span>;i++)c[i]=<span class="built_in">mul</span>(c[i],b[i]);</span><br><span class="line">        <span class="keyword">for</span>(res i=n<span class="number">-1</span>;i&lt;l;i++)c[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">getexp</span>(c,d,l);</span><br><span class="line">        <span class="built_in">memset</span>(c,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(c));</span><br><span class="line">        <span class="built_in">getinv</span>(a,c,l);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=n<span class="number">-2</span>;i++)a[i]=<span class="built_in">mul</span>(a[i],<span class="built_in">qpow</span>(i+<span class="number">1</span>,m));</span><br><span class="line">        <span class="keyword">while</span>(l&lt;=<span class="number">2</span>*(n<span class="number">-2</span>))l&lt;&lt;=<span class="number">1</span>,qaq++;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;l;i++)pos[i]=(pos[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)&lt;&lt;(qaq<span class="number">-1</span>));</span><br><span class="line">        <span class="keyword">for</span>(res i=n<span class="number">-1</span>;i&lt;l;i++)a[i]=c[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">NTT</span>(a,<span class="number">1</span>,l),<span class="built_in">NTT</span>(c,<span class="number">1</span>,l);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;l;i++)a[i]=<span class="built_in">mul</span>(a[i],c[i]);</span><br><span class="line">        <span class="built_in">NTT</span>(a,<span class="number">-1</span>,l);</span><br><span class="line">        res ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=n<span class="number">-2</span>;i++)<span class="built_in">add</span>(ans,<span class="built_in">mul</span>(<span class="built_in">mul</span>(a[i],b[i]),d[n<span class="number">-2</span>-i]));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">mul</span>(ans,ret));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj2861"><a href="#loj2861" class="headerlink" title="[loj2861]"></a>[loj2861]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 类虚树 | Difficulty: 二</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：这题唯一的难点就是转化题意，仔细思考下题意到底可以改成什么。由于是凸多边形，于是切割实际上只是选择某一条边，然后分开来，而一条边最多会被两个三角形共用。那么我们将共用一条边的三角形连边后，这一定会是棵树。于是题意转化成了，给一棵树，每个点有颜色，问最多有多少个连通块，使得相同颜色的点一定在一个连通块里。对每一种颜色分别考虑，那么这种颜色构成的虚树一定在同一个连通块里。于是类似地建出虚树，树上差分维护下就好了。时间复杂度 $O(n\log )$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.14 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    map&lt;Pair,<span class="keyword">int</span>&gt; M;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; G[N];</span><br><span class="line">    <span class="keyword">int</span> F[N][<span class="number">21</span>],dfn[N],idx,dep[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(res x,res fax)</span></span>&#123;</span><br><span class="line">        F[x][<span class="number">0</span>]=fax,dfn[x]=++idx;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">20</span>;i++)F[x][i]=F[F[x][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> tox:G[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(tox==fax)<span class="keyword">continue</span>;</span><br><span class="line">            dep[tox]=dep[x]+<span class="number">1</span>,<span class="built_in">dfs</span>(tox,x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">get_lca</span><span class="params">(res x,res y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(dep[x]&lt;dep[y])<span class="built_in">swap</span>(x,y);</span><br><span class="line">        res d=dep[x]-dep[y];</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">20</span>;~i;i--)<span class="keyword">if</span>(d&amp;(<span class="number">1</span>&lt;&lt;i))x=F[x][i];</span><br><span class="line">        <span class="keyword">if</span>(x==y)<span class="keyword">return</span> x;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">20</span>;~i;i--)<span class="keyword">if</span>(F[x][i]!=F[y][i])x=F[x][i],y=F[y][i];</span><br><span class="line">        <span class="keyword">return</span> F[x][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; A[N];</span><br><span class="line">    LL f[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs_f</span><span class="params">(res x,res fax)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> tox:G[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(tox==fax)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="built_in">dfs_f</span>(tox,x),f[x]+=f[tox];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n<span class="number">-2</span>;i++)&#123;</span><br><span class="line">            res a=<span class="built_in">read</span>(),b=<span class="built_in">read</span>(),c=<span class="built_in">read</span>(),d=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">if</span>(a&gt;b)<span class="built_in">swap</span>(a,b);</span><br><span class="line">            <span class="keyword">if</span>(b&gt;c)<span class="built_in">swap</span>(b,c);</span><br><span class="line">            <span class="keyword">if</span>(a&gt;b)<span class="built_in">swap</span>(a,b);</span><br><span class="line">            <span class="keyword">if</span>(M.<span class="built_in">count</span>(<span class="built_in">mp</span>(a,b)))G[M[<span class="built_in">mp</span>(a,b)]].<span class="built_in">pb</span>(i),G[i].<span class="built_in">pb</span>(M[<span class="built_in">mp</span>(a,b)]);</span><br><span class="line">            <span class="keyword">else</span> M[<span class="built_in">mp</span>(a,b)]=i;</span><br><span class="line">            <span class="keyword">if</span>(M.<span class="built_in">count</span>(<span class="built_in">mp</span>(b,c)))G[M[<span class="built_in">mp</span>(b,c)]].<span class="built_in">pb</span>(i),G[i].<span class="built_in">pb</span>(M[<span class="built_in">mp</span>(b,c)]);</span><br><span class="line">            <span class="keyword">else</span> M[<span class="built_in">mp</span>(b,c)]=i;</span><br><span class="line">            <span class="keyword">if</span>(M.<span class="built_in">count</span>(<span class="built_in">mp</span>(a,c)))G[M[<span class="built_in">mp</span>(a,c)]].<span class="built_in">pb</span>(i),G[i].<span class="built_in">pb</span>(M[<span class="built_in">mp</span>(a,c)]);</span><br><span class="line">            <span class="keyword">else</span> M[<span class="built_in">mp</span>(a,c)]=i;</span><br><span class="line">            A[d].<span class="built_in">pb</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n<span class="number">-2</span>;i++)&#123;</span><br><span class="line">            <span class="built_in">sort</span>(A[i].<span class="built_in">begin</span>(),A[i].<span class="built_in">end</span>(),[&amp;](<span class="keyword">const</span> res &amp;x,<span class="keyword">const</span> res &amp;y)&#123;<span class="keyword">return</span> dfn[x]&lt;dfn[y];&#125;);</span><br><span class="line">            res pre=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> x:A[i])&#123;</span><br><span class="line">                <span class="keyword">if</span>(pre)&#123;</span><br><span class="line">                    res lca=<span class="built_in">get_lca</span>(pre,x);</span><br><span class="line">                    f[x]++,f[pre]++,f[lca]-=<span class="number">2</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                pre=x;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dfs_f</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">        res ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n<span class="number">-2</span>;i++)<span class="keyword">if</span>(!f[i])ans++;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj2601"><a href="#loj2601" class="headerlink" title="[loj2601]"></a>[loj2601]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 贪心 | Difficulty: 二</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：设每个景点车要离开的时间为 $M_i$，那么对于一个从 $i\rightarrow j$ 出现时间为 $t$ 的人而言，它的贡献就是 $M_{j-1}-t+D_{j-1}$。而 $M$ 的式子也容易得到，即 $M_i=\max\lbrace T_i,M_{i-1}+D_{i-1}\rbrace$，其中 $T_i$ 表示 $i$ 号景点最后到的人的时间。注意到每次 $D$ 减一后，$M$ 只减不增。设满足 $M_{i-1}+D_{i-1}\leq T_i$ 的 $i$ 为 $i_1&lt;i_2&lt;…&lt;i_k$，那么对于某个处于 $(i_p,i_{p+1})$ 的 $j$ 而言，$M_j$ 就会等于 $T_{i_p}+\sum_{l=i_p}^{j-1} D_l$。于是，我们可以写出最终答案式子，即</p>
<script type="math/tex; mode=display">
\sum_{i=1}^{n-1} a_iD_i+C</script><p>其中 $C$ 为一固定常数，是 $\sum T-\sum t$。</p>
<p>于是，我们可以发现 $D_i$ 的贡献是独立的，且每次减少 $D_i$ 后，会使某一段区间的 $M_i$ 减一，并且当 $M_i$ 取 $T_i$ 的时候， $a_i$ 会减少。由于贡献独立，所以直接按 $a_i$ 贪心就是对的了。我们用线段树来维护这一过程，那么只用维护区间最大，区间减，然后有 $0$ 时暴力递归，递归时要修改当前点所在的左右区间编号，这是区间覆盖。所以总复杂度就是 $O(n\log n)$。</p>
<p>虽然这样已经可以做了，但显然是有点麻烦，我们再改写一下前面的式子。注意到 $M$ 的式子有一部分是 $D$ 的区间和，我们改写成前缀和形式，即 $M_j=T_{i_p}+sD_{j-1}-sD_{i_p-1}$。实际上，每次取分裂这个区间也比较难办，于是直接写出带 $\max$ 的式子，即</p>
<script type="math/tex; mode=display">
M_j=\max_{k=1}^j (T_k+sD_{j-1}-sD_{k-1})=sD_{j-1}+\max_{k=1}^j (T_k-sD_{k-1})</script><p>于是再接着改写下最终答案，即</p>
<script type="math/tex; mode=display">
\sum (sD_{j-2}+D_{j-1}+\max_{k=1}^{j-1} (T_k-sD_{k-1}))-t=\sum (sD_{j-1}+\max_{k=1}^{j-1} (T_k-sD_{k-1})))-C</script><p>另一方面，注意到答案已经与起点无关了，所以再度改写，即</p>
<script type="math/tex; mode=display">
-C+\sum_{j=1}^{n-1}(sD_{j}+\max_{k=1}^j (T_k-sD_{k-1}))*cnt_j</script><p>于是，此时对某个 $D$ 减一的操作就等价于某些后缀 $sD$ 减一，反应到答案上就是答案减去某一段 $cnt$ 的和。而这一段是可以直接算出来的，类似之前地，考虑某些 $i$ 使得 $T_i-sD_{i-1}$ 为前缀最大值，那么选择某一点 $j\in [i_p,i_{p+1})$，就等价于答案减少 $scnt_{i_{p+1}-1}-scnt_{j-1}$。由于 $cnt$ 不变，所以仍然具有贪心性。这就等价于每次从最小值分裂某个区间，然后继续贪心找最大的 $cnt$ 之和即可。时间复杂度仍然是 $O(n\log n)$，但无疑好写很多。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.15 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m,k;</span><br><span class="line">    <span class="keyword">int</span> D[N];</span><br><span class="line">    <span class="keyword">int</span> T[N],cnt[N],scnt[N];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tup tuple<span class="meta-string">&lt;int,int,int&gt;</span></span></span><br><span class="line">    priority_queue&lt;tup&gt; Q;</span><br><span class="line">    <span class="keyword">int</span> sD[N];</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    Pair mn[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> tag[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(res rt,res l,res r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;mn[rt]=<span class="built_in">mp</span>(a[l],l);<span class="keyword">return</span>;&#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(rt&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">        mn[rt]=<span class="built_in">min</span>(mn[rt&lt;&lt;<span class="number">1</span>],mn[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">const</span> res &amp;rt,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        tag[rt]+=v,mn[rt].fi+=v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">const</span> res &amp;rt)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!tag[rt])<span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">change</span>(rt&lt;&lt;<span class="number">1</span>,tag[rt]),<span class="built_in">change</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,tag[rt]),tag[rt]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&gt;R)<span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;<span class="built_in">change</span>(rt,v);<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R,v);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R,v);</span><br><span class="line">        mn[rt]=<span class="built_in">min</span>(mn[rt&lt;&lt;<span class="number">1</span>],mn[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">Pair <span class="title">query</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&gt;R)<span class="keyword">return</span> <span class="built_in">mp</span>(inf,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)<span class="keyword">return</span> mn[rt];</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid&amp;&amp;R&gt;mid)<span class="keyword">return</span> <span class="built_in">min</span>(<span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R),<span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R));</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="keyword">return</span> <span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>(),k=<span class="built_in">read</span>();</span><br><span class="line">        LL ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;n;i++)D[i]=<span class="built_in">read</span>(),sD[i]=sD[i<span class="number">-1</span>]+D[i];</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            res t=<span class="built_in">read</span>(),A=<span class="built_in">read</span>(),B=<span class="built_in">read</span>();</span><br><span class="line">            T[A]=<span class="built_in">max</span>(T[A],t),cnt[B]++,ans-=t;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)scnt[i]=scnt[i<span class="number">-1</span>]+cnt[i];</span><br><span class="line">        res pre=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            a[i]=<span class="built_in">max</span>(<span class="number">0</span>,a[i<span class="number">-1</span>]+T[i<span class="number">-1</span>]+D[i<span class="number">-1</span>]-T[i]);</span><br><span class="line">            <span class="keyword">if</span>(!a[i])Q.<span class="built_in">push</span>(<span class="built_in">tup</span>(scnt[i]-scnt[pre],pre,i)),pre=i;</span><br><span class="line">            ans+=(LL)cnt[i]*(a[i<span class="number">-1</span>]+D[i<span class="number">-1</span>]+T[i<span class="number">-1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(pre!=n)Q.<span class="built_in">push</span>(<span class="built_in">tup</span>(scnt[n]-scnt[pre],pre,n));</span><br><span class="line">        <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">2</span>,n);</span><br><span class="line">        <span class="keyword">while</span>(k&gt;<span class="number">0</span>&amp;&amp;!Q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">            <span class="keyword">auto</span> [v,l,r]=Q.<span class="built_in">top</span>();</span><br><span class="line">            Q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">auto</span> [va,p]=<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">2</span>,n,l+<span class="number">1</span>,r<span class="number">-1</span>);</span><br><span class="line">            va=<span class="built_in">min</span>(&#123;va,k,D[l]&#125;);</span><br><span class="line">            ans-=(LL)va*v,k-=va;</span><br><span class="line">            <span class="keyword">if</span>(va==D[l])p=l+<span class="number">1</span>;</span><br><span class="line">            <span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">2</span>,n,l+<span class="number">1</span>,r<span class="number">-1</span>,-va),D[l]-=va;</span><br><span class="line">            <span class="keyword">if</span>(l&lt;p)Q.<span class="built_in">push</span>(<span class="built_in">tup</span>(scnt[p]-scnt[l],l,p));</span><br><span class="line">            <span class="keyword">if</span>(p&lt;r)Q.<span class="built_in">push</span>(<span class="built_in">tup</span>(scnt[r]-scnt[p],p,r));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj3083"><a href="#loj3083" class="headerlink" title="[loj3083]"></a>[loj3083]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 拆位算贡献、单调栈 | Difficulty: 一点五</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：容易注意到直接算比较困难，于是考虑每一位来算。于是题意等价于找全 $0$ 子矩阵的个数，这东西直接单调栈即可。时间复杂度 $O(nm\log)$。</p>
<p>单调栈算子矩阵贡献时为了不算重，我们对于一个将要弹出栈的点只算它到两边点之间的高度，这样就不会算重了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.9 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> a[N][N],h[N],st[N],top;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)a[i][j]=<span class="built_in">read</span>();</span><br><span class="line">        res ans0=<span class="number">0</span>,ans1=<span class="number">0</span>,sum=<span class="built_in">Mul</span>(n,n+<span class="number">1</span>,<span class="number">2</span>);</span><br><span class="line">        sum=<span class="built_in">mul</span>(sum,sum);</span><br><span class="line">        <span class="keyword">for</span>(res t=<span class="number">0</span>;t&lt;<span class="number">31</span>;t++)&#123;</span><br><span class="line">            res ret=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n+<span class="number">1</span>;j++)h[j]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)</span><br><span class="line">                    <span class="keyword">if</span>(a[i][j]&amp;(<span class="number">1</span>&lt;&lt;t))h[j]++;</span><br><span class="line">                    <span class="keyword">else</span> h[j]=<span class="number">0</span>;</span><br><span class="line">                top=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n+<span class="number">1</span>;j++)&#123;</span><br><span class="line">                    <span class="keyword">while</span>(top&amp;&amp;h[st[top]]&gt;h[j])&#123;</span><br><span class="line">                        <span class="built_in">add</span>(ret,<span class="built_in">mul</span>(h[st[top]]-<span class="built_in">max</span>(h[st[top<span class="number">-1</span>]],h[j]),<span class="built_in">Mul</span>(j-st[top<span class="number">-1</span>]<span class="number">-1</span>,j-st[top<span class="number">-1</span>],<span class="number">2</span>)));</span><br><span class="line">                        top--;</span><br><span class="line">                    &#125;</span><br><span class="line">                    st[++top]=j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">add</span>(ans0,<span class="built_in">mul</span>(ret,<span class="number">1</span>&lt;&lt;t));</span><br><span class="line">            ret=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n+<span class="number">1</span>;j++)h[j]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)</span><br><span class="line">                    <span class="keyword">if</span>(a[i][j]&amp;(<span class="number">1</span>&lt;&lt;t))h[j]=<span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">else</span> h[j]++;</span><br><span class="line">                top=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n+<span class="number">1</span>;j++)&#123;</span><br><span class="line">                    <span class="keyword">while</span>(top&amp;&amp;h[st[top]]&gt;h[j])&#123;</span><br><span class="line">                        <span class="built_in">add</span>(ret,<span class="built_in">mul</span>(h[st[top]]-<span class="built_in">max</span>(h[st[top<span class="number">-1</span>]],h[j]),<span class="built_in">Mul</span>(j-st[top<span class="number">-1</span>]<span class="number">-1</span>,j-st[top<span class="number">-1</span>],<span class="number">2</span>)));</span><br><span class="line">                        top--;</span><br><span class="line">                    &#125;</span><br><span class="line">                    st[++top]=j;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">add</span>(ans1,<span class="built_in">mul</span>(<span class="built_in">Add</span>(sum,kcz-ret),<span class="number">1</span>&lt;&lt;t));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,ans0,ans1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj6104"><a href="#loj6104" class="headerlink" title="[loj6104*]"></a>[loj6104*]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 贪心 | Difficulty: 三</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：都转化模型了却分析不出怎么贪心啊。</p>
<p>首先可以注意到每一列至少要消掉最高的好点以下的所有点，那么题意转化成有序列 $a_i$，每次可以操作相邻的两个，一个减二，一个减一，最少操作次数使得全变成非正整数。然后我思考咋贪心都不会了，总感觉要维护的东西有点多。</p>
<p>于是就看了他人做法。注意到除了减到零的部分外，有些要减更多，减到负数部分。于是我们考虑除了减到零之后，还要多减少有几个。从左往右考虑，假设当前列最多还要操作 $mx$ 次，最少还要 $mn$ 次，对于新的一列而言，我们要考虑刚好让它掉落的情况，那么我们可以通过 $mn$ 和 $mx$ 推出新列的 $mn$ 和 $mx$，而刚好掉落，就等价于选择 $mn$ 和 $mx$ 之间的某个公差为 $3$ 的等差数列。但有可能新的列就算不操作也已经完成了，那么即要减到负的部分了，于是加上这部分答案即可。这样就做完了。</p>
<p>时间复杂度 $O(nm)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.18 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="keyword">char</span> str[N];</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">        res ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=m;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(str[j]==<span class="string">&#x27;*&#x27;</span>&amp;&amp;!a[j])a[j]=n-i+<span class="number">1</span>,ans+=n-i+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res mx=<span class="number">0</span>,mn=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m+<span class="number">1</span>;i++)&#123;</span><br><span class="line">            res nmx=a[i]-(mn/<span class="number">2</span>+(mn&amp;<span class="number">1</span>)*<span class="number">2</span>),nmn=a[i]-mx*<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(nmx&lt;<span class="number">0</span>)ans+=-nmx,nmx=nmn=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(nmn&lt;<span class="number">0</span>)nmn=nmx%<span class="number">3</span>;</span><br><span class="line">            mx=nmx,mn=nmn;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans/<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj6432"><a href="#loj6432" class="headerlink" title="[loj6432]"></a>[loj6432]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 组合数学 | Difficulty: 二</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：怎么以前 PKUSC 还有这么简单的题啊。</p>
<p>对每个人分别考虑，分类讨论这个人是否在那翻倍的人之中，然后剩下的组合数都非常简单，二分找一下数量就好了。时间复杂度 $O(n\log n)$。</p>
<p>坑：注意特判分数为 $0$，因为那样分类讨论的结果会不同。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.20 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,k;</span><br><span class="line">    <span class="keyword">int</span> a[N],b[N];</span><br><span class="line">    <span class="keyword">int</span> fac[N],inv[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">C</span><span class="params">(<span class="keyword">const</span> res &amp;x,<span class="keyword">const</span> res &amp;y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mul</span>(fac[x],<span class="built_in">mul</span>(inv[y],inv[x-y]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),k=<span class="built_in">read</span>(),fac[<span class="number">0</span>]=fac[<span class="number">1</span>]=inv[<span class="number">0</span>]=inv[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)fac[i]=<span class="built_in">mul</span>(fac[i<span class="number">-1</span>],i),inv[i]=<span class="built_in">mul</span>(inv[kcz%i],kcz-kcz/i);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)inv[i]=<span class="built_in">mul</span>(inv[i<span class="number">-1</span>],inv[i]);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=b[i]=<span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">sort</span>(b+<span class="number">1</span>,b+n+<span class="number">1</span>);</span><br><span class="line">        b[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!a[i])&#123;<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">C</span>(n,k));<span class="keyword">continue</span>;&#125;</span><br><span class="line">            res ret=<span class="built_in">C</span>((<span class="keyword">int</span>)(<span class="built_in">upper_bound</span>(b,b+n+<span class="number">1</span>,(a[i]+<span class="number">1</span>)/<span class="number">2</span><span class="number">-1</span>)-<span class="built_in">upper_bound</span>(b,b+n+<span class="number">1</span>,a[i]<span class="number">-1</span>))+n<span class="number">-1</span>,k);</span><br><span class="line">            res t=(<span class="keyword">int</span>)(<span class="built_in">upper_bound</span>(b,b+n+<span class="number">1</span>,<span class="number">2</span>*a[i]<span class="number">-1</span>)-<span class="built_in">upper_bound</span>(b,b+n+<span class="number">1</span>,a[i]<span class="number">-1</span>));</span><br><span class="line">            <span class="keyword">if</span>(k&gt;=t)<span class="built_in">add</span>(ret,<span class="built_in">C</span>(n-t,k-t));</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ret);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj3274"><a href="#loj3274" class="headerlink" title="[loj3274*]"></a>[loj3274*]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 二分图、二分 | Difficulty: 四 （ 这可能只是因为我不会 ）</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：呃呃，我完全不会。第一步转成二分图我都没想到。</p>
<p>我们将可能颜色会变成一样的（ 原色相同、舔狗、有舔狗 ）的连边，那么一个点的度数要么是 $1$，要么是 $3$。如果是 $1$，则那一定是答案。如果是 $3$，考虑将这三个点轮换扔进去询问，可以找到它舔的对象。同样地，可以找到舔它的对象，于是原色相同的就出来了。这样所用次数是小于等于 $6n$ 次。</p>
<p>那么问题就在于找这个二分图。考虑每次找一个最大点独立集，然后暴力三次二分找到独立集外与它相连的边，然后递归地找那些不在点独立集的边。由于点度不过 $3$，每个独立集大小都是大于等于原来的 $\frac{1}{4}$ 的，于是总次数是不过 $10n$，加上询问大概是 $3n\log n$，这样总次数就是足够的了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.25 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1010</span>;</span><br><span class="line">vector&lt;<span class="keyword">int</span>&gt; G[N];</span><br><span class="line"><span class="keyword">int</span> vis[N],lov[N],whlov[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">const</span> res &amp;a,<span class="keyword">const</span> res &amp;b,<span class="keyword">const</span> res &amp;c)</span></span>&#123;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; p;</span><br><span class="line">    p.<span class="built_in">pb</span>(a),p.<span class="built_in">pb</span>(b),p.<span class="built_in">pb</span>(c);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Query</span>(p);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ask</span><span class="params">(vector&lt;<span class="keyword">int</span>&gt; a,<span class="keyword">const</span> res &amp;b)</span></span>&#123;</span><br><span class="line">    a.<span class="built_in">pb</span>(b);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Query</span>(a)==a.<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">findans</span><span class="params">(<span class="keyword">const</span> res &amp;x,vector&lt;<span class="keyword">int</span>&gt; v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(v.<span class="built_in">size</span>()==<span class="number">1</span>)&#123;</span><br><span class="line">        G[x].<span class="built_in">pb</span>(v[<span class="number">0</span>]),G[v[<span class="number">0</span>]].<span class="built_in">pb</span>(x);</span><br><span class="line">        <span class="keyword">return</span> v[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    res mid=(<span class="keyword">int</span>)(v.<span class="built_in">size</span>())&gt;&gt;<span class="number">1</span>;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; L,R;</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;v.<span class="built_in">size</span>();++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(i&lt;mid)L.<span class="built_in">pb</span>(v[i]);</span><br><span class="line">        <span class="keyword">else</span> R.<span class="built_in">pb</span>(v[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">ask</span>(L,x))<span class="keyword">return</span> <span class="built_in">findans</span>(x,R);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">findans</span>(x,L);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Solve</span><span class="params">(res n)</span></span>&#123;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; ve;</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*n;++i)ve.<span class="built_in">pb</span>(i);</span><br><span class="line">    <span class="built_in">random_shuffle</span>(ve.<span class="built_in">begin</span>(),ve.<span class="built_in">end</span>());</span><br><span class="line">    <span class="keyword">while</span>(!ve.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; duli,oth;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x:ve)&#123;</span><br><span class="line">            <span class="keyword">if</span>(duli.<span class="built_in">empty</span>()||<span class="built_in">ask</span>(duli,x))duli.<span class="built_in">pb</span>(x);</span><br><span class="line">            <span class="keyword">else</span> oth.<span class="built_in">pb</span>(x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x:oth)&#123;</span><br><span class="line">            vector&lt;<span class="keyword">int</span>&gt; rec=duli;</span><br><span class="line">            <span class="keyword">do</span>&#123;</span><br><span class="line">                res p=<span class="built_in">findans</span>(x,rec);</span><br><span class="line">                vector&lt;<span class="keyword">int</span>&gt; ne;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">auto</span> y:rec)<span class="keyword">if</span>(y!=p)ne.<span class="built_in">pb</span>(y);</span><br><span class="line">                rec=ne;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">ask</span>(rec,x)) <span class="keyword">break</span>;</span><br><span class="line">            &#125;<span class="keyword">while</span>(!rec.<span class="built_in">empty</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        ve=oth;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*n;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(G[i].<span class="built_in">size</span>()==<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(vis[i]||vis[G[i][<span class="number">0</span>]]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="built_in">Answer</span>(i,G[i][<span class="number">0</span>]);</span><br><span class="line">            vis[i]=vis[G[i][<span class="number">0</span>]]=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=<span class="number">2</span>;++j)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">ask</span>(i,G[i][j],G[i][(j+<span class="number">1</span>)%<span class="number">3</span>])==<span class="number">1</span>)&#123;</span><br><span class="line">                    lov[i]=G[i][(j+<span class="number">2</span>)%<span class="number">3</span>];whlov[lov[i]]=i;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*n;++i)&#123;</span><br><span class="line">        <span class="keyword">if</span>(vis[i])<span class="keyword">continue</span>;</span><br><span class="line">        <span class="keyword">for</span>(res k=<span class="number">0</span>;k&lt;=<span class="number">2</span>;++k)&#123;</span><br><span class="line">            <span class="keyword">if</span>(G[i][k]==lov[i]||G[i][k]==whlov[i]) <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(vis[G[i][k]]) <span class="keyword">continue</span>;</span><br><span class="line">            vis[i]=vis[G[i][k]]=<span class="number">1</span>;</span><br><span class="line">            <span class="built_in">Answer</span>(i,G[i][k]);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj3561"><a href="#loj3561" class="headerlink" title="[loj3561]"></a>[loj3561]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 贪心 | Difficulty: 三点五</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：先考虑对一个 $t&gt;T$ 的人而言，他被唤醒则要求 $\max\lbrace j\mid T+j-t_j\leq i\rbrace$ 与 $i$ 之间不被阻挡。那么每个 $t\leq T$ 的人而言都有一个他的覆盖区间，而若两个覆盖区间是相交的，则相交处实际上对前一个人而言毫无意义，他是不能决定这块区域人是否被唤醒的，所以区间只有相离和包含关系了。</p>
<p>相离的可以独立考虑，那么我们要处理的就是包含关系，然后贪心处理答案。包含关系诈一看前面的选择会影响后面导致没有贪心性，实际上前后若都选，则答案不变。所以我们可以去贪心前面的选择，让前面的选择尽量大即可。从后往前考虑每个区间，隔断处一定是某个区间的起点，此时可以贪心考虑哪处隔断影响答案最大，然后更改其它隔断处的答案。注意到区间是包含关系，所以每个隔断处最多被修改一遍，利用单调栈总复杂度就是 $O(n)$ 了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.27 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m,T;</span><br><span class="line">    <span class="keyword">int</span> L[N],t[N],R[N],cnt[N],sum[N];</span><br><span class="line">    <span class="keyword">int</span> st[N],top;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>(),T=<span class="built_in">read</span>();</span><br><span class="line">        res ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)t[i]=<span class="built_in">read</span>(),ans+=t[i]&lt;=T;</span><br><span class="line">        <span class="keyword">for</span>(res i=n;i;i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(t[i]&gt;T)<span class="keyword">continue</span>;</span><br><span class="line">            res pre=L[i]=i;</span><br><span class="line">            R[i]=<span class="built_in">min</span>(n,T+i-t[i]);</span><br><span class="line">            <span class="keyword">while</span>(top&amp;&amp;R[i]&gt;=R[st[top]])&#123;</span><br><span class="line">                res p=st[top--];</span><br><span class="line">                cnt[sum[i]]--,sum[i]+=L[p]-pre<span class="number">-1</span>,cnt[sum[i]]++;</span><br><span class="line">                sum[i]=<span class="built_in">max</span>(sum[i],sum[p]),pre=R[p];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(top)R[i]=<span class="built_in">min</span>(R[i],L[st[top]]<span class="number">-1</span>);</span><br><span class="line">            cnt[sum[i]]--,sum[i]+=R[i]-pre,cnt[sum[i]]++;</span><br><span class="line">            st[++top]=i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=n;i;i--)&#123;</span><br><span class="line">            res mn=<span class="built_in">min</span>(m,cnt[i]);</span><br><span class="line">            m-=mn,cnt[i]-=mn;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)ans+=i*cnt[i];</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj3545"><a href="#loj3545" class="headerlink" title="[loj3545]"></a>[loj3545]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 平面图对偶、区间 dp | Difficulty: 四</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：不能说是我想出来的，纯纯是因为之前看过题解了。</p>
<p>$k=2$ 时，将异色的端点所处区域染色，同时将平面图转成其对偶图（ 即一个区域看成一个点，相邻区域连边 ），那么题意从最小割就转化成了两个空阔区域间的最短路（ 因为最优染色一定是两个区域，分别是黑白 ）。</p>
<p>$k$ 更大时，考虑顺时针将每两个相邻且异色的射线间的空阔区域染与之前不同的颜色，把这些区域看成一个点，发现一个合法的割方案就等价于选择两个异色点连边，边权为这两个区域间的最小割，且要保证这里的边不交。于是做 $k$ 次 $\mathrm{Dijkstra}$，将每个区域到其他区域的最小割都算出来，剩下的就是个区间 $\mathrm{dp}$。时间复杂度 $O(knm\log nm+k^3)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.28 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">500</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dx[]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">1</span>,<span class="number">-1</span>&#125;,dy[]=&#123;<span class="number">1</span>,<span class="number">-1</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m,T;</span><br><span class="line">    <span class="keyword">int</span> a[N][N],b[N][N];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tup tuple<span class="meta-string">&lt;int,int,int&gt;</span></span></span><br><span class="line">    tup A[N];</span><br><span class="line">    <span class="keyword">int</span> id[N],w[N][N],dis[N][N],vis[N][N],k;</span><br><span class="line">    priority_queue&lt;tup,vector&lt;tup&gt;,greater&lt;&gt;&gt;Q;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dij</span><span class="params">(<span class="keyword">const</span> res &amp;S)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=m;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(dis[i][j]&lt;inf)Q.<span class="built_in">emplace</span>(dis[i][j],i,j);</span><br><span class="line">            vis[i][j]=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">            <span class="keyword">auto</span> [d,x,y]=Q.<span class="built_in">top</span>();</span><br><span class="line">            Q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">if</span>(vis[x][y])<span class="keyword">continue</span>;</span><br><span class="line">            vis[x][y]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(x&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                res nx=x<span class="number">-1</span>,ny=y;</span><br><span class="line">                <span class="keyword">if</span>(dis[nx][ny]&gt;dis[x][y]+b[x][y])dis[nx][ny]=dis[x][y]+b[x][y],Q.<span class="built_in">emplace</span>(dis[nx][ny],nx,ny);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(y&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                res nx=x,ny=y<span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">if</span>(dis[nx][ny]&gt;dis[x][y]+a[x][y])dis[nx][ny]=dis[x][y]+a[x][y],Q.<span class="built_in">emplace</span>(dis[nx][ny],nx,ny);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(x&lt;n)&#123;</span><br><span class="line">                res nx=x+<span class="number">1</span>,ny=y;</span><br><span class="line">                <span class="keyword">if</span>(dis[nx][ny]&gt;dis[x][y]+b[nx][y])dis[nx][ny]=dis[x][y]+b[nx][y],Q.<span class="built_in">emplace</span>(dis[nx][ny],nx,ny);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(y&lt;m)&#123;</span><br><span class="line">                res nx=x,ny=y+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(dis[nx][ny]&gt;dis[x][y]+a[x][ny])dis[nx][ny]=dis[x][y]+a[x][ny],Q.<span class="built_in">emplace</span>(dis[nx][ny],nx,ny);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=k;i++)&#123;</span><br><span class="line">            res j=(i==k)?<span class="number">1</span>:i+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">auto</span> [p,W,opt]=A[i];</span><br><span class="line">            <span class="keyword">if</span>(opt!=get&lt;<span class="number">2</span>&gt;(A[j])&amp;&amp;!opt)&#123;</span><br><span class="line">                <span class="keyword">for</span>(res x=p;x!=get&lt;<span class="number">0</span>&gt;(A[j]);x=(x==n+n+m+m)?<span class="number">1</span>:x+<span class="number">1</span>) &#123;</span><br><span class="line">                    res px,py;</span><br><span class="line">                    <span class="keyword">if</span>(x&lt;=m) px=<span class="number">0</span>,py=x;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(x&lt;=n+m) px=x-m,py=m;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(x&lt;=n+m+m) px=n,py=m-(x-n-m);</span><br><span class="line">                    <span class="keyword">else</span> px=n-(x-n-m-m),py=<span class="number">0</span>;</span><br><span class="line">                    w[S][id[i]]=<span class="built_in">min</span>(w[S][id[i]],dis[px][py]);</span><br><span class="line">                    w[id[i]][S]=<span class="built_in">min</span>(w[id[i]][S],dis[px][py]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> pos[N];</span><br><span class="line">    <span class="keyword">int</span> f[N][N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>(),T=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;n;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=m;j++)a[i][j]=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;m;j++)b[i][j]=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">            k=<span class="built_in">read</span>();</span><br><span class="line">            res tot=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=k;i++)&#123;</span><br><span class="line">                res W=<span class="built_in">read</span>(),p=<span class="built_in">read</span>(),opt=<span class="built_in">read</span>();</span><br><span class="line">                A[i]=<span class="built_in">tup</span>(p,W,opt);</span><br><span class="line">                <span class="keyword">if</span>(p&lt;=m)a[<span class="number">0</span>][p]=W;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(p&lt;=n+m)b[p-m][m]=W;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(p&lt;=n+m+m)a[n][m-(p-n-m)+<span class="number">1</span>]=W;</span><br><span class="line">                <span class="keyword">else</span> b[n-(p-n-m-m)+<span class="number">1</span>][<span class="number">0</span>]=W;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">sort</span>(A+<span class="number">1</span>,A+k+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=k;i++)&#123;</span><br><span class="line">                res j=(i==k)?<span class="number">1</span>:i+<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">auto</span> [p,W,opt]=A[i];</span><br><span class="line">                <span class="keyword">if</span>(opt!=get&lt;<span class="number">2</span>&gt;(A[j]))id[i]=++tot;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!tot)&#123;<span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);<span class="keyword">continue</span>;&#125;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=tot;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=tot;j++)w[i][j]=inf;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=k;i++)&#123;</span><br><span class="line">                res j=(i==k)?<span class="number">1</span>:(i+<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">auto</span> [p,W,opt]=A[i];</span><br><span class="line">                <span class="keyword">if</span>(opt!=get&lt;<span class="number">2</span>&gt;(A[j])&amp;&amp;opt)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(res x=<span class="number">0</span>;x&lt;=n;x++)<span class="keyword">for</span>(res y=<span class="number">0</span>;y&lt;=m;y++)dis[x][y]=inf;</span><br><span class="line">                    <span class="keyword">for</span>(res x=p;x!=get&lt;<span class="number">0</span>&gt;(A[j]);x=(x==n+n+m+m)?<span class="number">1</span>:x+<span class="number">1</span>) &#123;</span><br><span class="line">                        res px,py;</span><br><span class="line">                        <span class="keyword">if</span>(x&lt;=m)px=<span class="number">0</span>,py=x;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(x&lt;=n+m)px=x-m,py=m;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span>(x&lt;=n+m+m)px=n,py=m-(x-n-m);</span><br><span class="line">                        <span class="keyword">else</span> px=n-(x-n-m-m),py=<span class="number">0</span>;</span><br><span class="line">                        dis[px][py]=<span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="built_in">dij</span>(id[i]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=tot;i++)pos[i]=pos[i+tot]=i;</span><br><span class="line">            <span class="built_in">memset</span>(f,<span class="number">0x3f</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(f));</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=tot+tot;i++)f[i][i<span class="number">-1</span>]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res len=<span class="number">2</span>;len&lt;=tot;len++)<span class="keyword">for</span>(res l=<span class="number">1</span>,r=len;r&lt;=tot+tot;l++,r++)&#123;</span><br><span class="line">                f[l][r]=<span class="built_in">min</span>(f[l][r],f[l+<span class="number">1</span>][r<span class="number">-1</span>]+w[pos[l]][pos[r]]);</span><br><span class="line">                <span class="keyword">for</span>(res K=l;K&lt;r;K++)f[l][r]=<span class="built_in">min</span>(f[l][r],f[l][K]+f[K+<span class="number">1</span>][r]);</span><br><span class="line">            &#125;</span><br><span class="line">            res ans=inf;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=tot;i++)ans=<span class="built_in">min</span>(ans,f[i][i+tot<span class="number">-1</span>]);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=k;i++) &#123;</span><br><span class="line">                <span class="keyword">auto</span> [p,W,opt]=A[i];</span><br><span class="line">                <span class="keyword">if</span>(p&lt;=n)a[<span class="number">0</span>][p]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(p&lt;=n+m)b[p-m][m]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(p&lt;=n+m+m)a[n][m-(p-n-m)+<span class="number">1</span>]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">else</span> b[n-(p-n-m-m)+<span class="number">1</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj6086"><a href="#loj6086" class="headerlink" title="[loj6086]"></a>[loj6086]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 拆式子算贡献 | Difficulty: 三</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：可以先考虑二维，然后就会发现三维是差差不多的。</p>
<p>我们假设当前 $(a,b)$ 选择了 $L$ 和 $J$，那么满足的条件就是 $L_a-L_b\geq K_a-K_b\geq J_a-J_b$，而此时的贡献是 $(L_a-J_a)-(L_b-J_b)$。为了让条件与贡献式子长得差不多，我们不妨移个项，有 </p>
<script type="math/tex; mode=display">
\begin{align*}
&(L_a-K_a)-(L_b-K_b)\geq 0\\
&(K_a-J_a)-(K_b-J_b)\geq 0
&\end{align*}</script><p>注意到上面两个不等式一加，左边就是它们的贡献。于是我们就可以把一个数对的贡献拆成 $(L_a-K_a)+(K_a-J_a)-(L_b-K_b)-(K_b-J_b)$，那么一组 $L_a-K_a$ 的贡献次数就是多少个比它小的数对的个数，其余同理，于是只要拆完贡献，排个序即可。时间复杂度 $O(n\log n)$。</p>
<p>坑：注意要除以 $2$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.3.1 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">5e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> a[N],b[N],c[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>(),y=<span class="built_in">read</span>(),z=<span class="built_in">read</span>();</span><br><span class="line">            a[i]=x-y,b[i]=y-z,c[i]=z-x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(a+<span class="number">1</span>,a+n+<span class="number">1</span>),<span class="built_in">sort</span>(b+<span class="number">1</span>,b+n+<span class="number">1</span>),<span class="built_in">sort</span>(c+<span class="number">1</span>,c+n+<span class="number">1</span>);</span><br><span class="line">        res ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">add</span>(ans,<span class="built_in">mul</span>(a[i]+b[i]+c[i],<span class="built_in">Add</span>(<span class="number">2</span>*i<span class="number">-1</span>-n,<span class="number">0</span>)));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">mul</span>(ans,<span class="built_in">qpow</span>(<span class="number">2</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj3028"><a href="#loj3028" class="headerlink" title="[loj3028]"></a>[loj3028]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 贪心、树的直径 | Difficulty: 零点五</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：直径一定是两个叶子的路径，所以答案就是最深的点重复然后加上原来的直径即可。时间复杂度 $O(n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.3.2 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; G[N];</span><br><span class="line">    <span class="keyword">int</span> dep[N],mx;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(res x,res fax)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(dep[x]&gt;dep[mx])mx=x;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> tox:G[x])<span class="keyword">if</span>(tox!=fax)dep[tox]=dep[x]+<span class="number">1</span>,<span class="built_in">dfs</span>(tox,x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res u=<span class="built_in">read</span>();</span><br><span class="line">            G[u].<span class="built_in">pb</span>(i),G[i].<span class="built_in">pb</span>(u);</span><br><span class="line">        &#125;</span><br><span class="line">        dep[<span class="number">1</span>]=<span class="number">1</span>,<span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">0</span>);</span><br><span class="line">        res ret=dep[mx];</span><br><span class="line">        dep[mx]=<span class="number">1</span>,<span class="built_in">dfs</span>(mx,<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,(LL)ret*<span class="number">2</span>*(m<span class="number">-1</span>)+dep[mx]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj3239"><a href="#loj3239" class="headerlink" title="[loj3239*]"></a>[loj3239*]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 倍增、结论题 | Difficulty: 三</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：这种题似乎我都不会。</p>
<p>有一个非常重要的性质就是，若某个点在两条对边所夹出的另外一端时，则一定无解。这可以考虑反证法，然后利用凸包的斜率性质得证。有了这个结论，这题就可以宣告结束了。我们随意地找一组对边来判一下，那么最坏情况就是这个点在两条边的同侧，这说明有一条边已经满足夹住这个点的性质。剩余的那条边我们直接倍增，找找看中途有没有满足，因为凸包的斜率性质，所以这是对的。时间复杂度 $O(n\log n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.3.3 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    <span class="keyword">int</span> last;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair<span class="meta-string">&lt;LL,LL&gt;</span></span></span><br><span class="line">    pii a[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> LL <span class="title">cub</span><span class="params">(<span class="keyword">const</span> res &amp;x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (LL)x*x*x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">inline</span> pii <span class="keyword">operator</span> - (<span class="keyword">const</span> pii &amp;A,<span class="keyword">const</span> pii &amp;B)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mp</span>(A.fi-B.fi,A.se-B.se);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">inline</span> unl <span class="keyword">operator</span> ^ (<span class="keyword">const</span> pii &amp;A,<span class="keyword">const</span> pii &amp;B)&#123;</span><br><span class="line">        <span class="keyword">return</span> ((unl)A.fi*B.se)-((unl)A.se*B.fi);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">ck</span><span class="params">(<span class="keyword">const</span> res &amp;p,<span class="keyword">const</span> pii &amp;A)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ((a[p]-A)^(a[p%n+<span class="number">1</span>]-A))&gt;=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">const</span> res &amp;x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x&gt;n?x-n:x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        T=<span class="built_in">read</span>(),n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            LL x=<span class="built_in">Read</span>(),y=<span class="built_in">Read</span>();</span><br><span class="line">            a[i]=<span class="built_in">mp</span>(x,y);</span><br><span class="line">        &#125;</span><br><span class="line">        res q=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">            LL A=<span class="built_in">Read</span>()^(T*<span class="built_in">cub</span>(last)),B=<span class="built_in">Read</span>()^(T*<span class="built_in">cub</span>(last));</span><br><span class="line">            pii C=<span class="built_in">mp</span>(A,B);</span><br><span class="line">            res d1=<span class="built_in">ck</span>(<span class="number">1</span>,C),d2=<span class="built_in">ck</span>(n/<span class="number">2</span>+<span class="number">1</span>,C);</span><br><span class="line">            <span class="keyword">if</span>(d1&amp;&amp;d2)&#123;<span class="built_in">puts</span>(<span class="string">&quot;DA&quot;</span>),last++;<span class="keyword">continue</span>;&#125;</span><br><span class="line">            <span class="keyword">if</span>(!d1&amp;&amp;!d2)&#123;<span class="built_in">puts</span>(<span class="string">&quot;NE&quot;</span>);<span class="keyword">continue</span>;&#125;</span><br><span class="line">            res u=d1?<span class="number">1</span>:n/<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">            res s=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">20</span>;~i;i--)<span class="keyword">if</span>(s+(<span class="number">1</span>&lt;&lt;i)&lt;n/<span class="number">2</span>&amp;&amp;<span class="built_in">ck</span>(<span class="built_in">get</span>(u+(<span class="number">1</span>&lt;&lt;i)),C))u=<span class="built_in">get</span>(u+(<span class="number">1</span>&lt;&lt;i)),s+=<span class="number">1</span>&lt;&lt;i;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">ck</span>(<span class="built_in">get</span>(u+n/<span class="number">2</span>),C))<span class="built_in">puts</span>(<span class="string">&quot;DA&quot;</span>),last++;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">&quot;NE&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj6297"><a href="#loj6297" class="headerlink" title="[loj6297]"></a>[loj6297]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 排序 | Difficulty: 零</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：排序就做完了，零分。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.3.17 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    Pair b[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">sort</span>(a+<span class="number">1</span>,a+n+<span class="number">1</span>);</span><br><span class="line">        res m=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;)&#123;</span><br><span class="line">            res j=i;</span><br><span class="line">            <span class="keyword">while</span>(a[j]==a[i]&amp;&amp;j&lt;=n)j++;</span><br><span class="line">            b[++m]=<span class="built_in">mp</span>(j-i,a[i]),i=j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(b+<span class="number">1</span>,b+m+<span class="number">1</span>),<span class="built_in">reverse</span>(b+<span class="number">1</span>,b+m+<span class="number">1</span>);</span><br><span class="line">        res fl=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(b[i].fi!=b[<span class="number">1</span>].fi)&#123;m=i<span class="number">-1</span>,fl=<span class="number">1</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!fl)&#123;<span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,m);</span><br><span class="line">        <span class="keyword">for</span>(res i=m;i;i--)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,b[i].se);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj3684"><a href="#loj3684" class="headerlink" title="[loj3684]"></a>[loj3684]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 性质分析、贪心构造 | Difficulty: 三</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：首先分析答案是什么，容易发现是强连通分量个数，于是就是给边定向使得强连通分量个数最少。不妨让左边一列边都往下，右边一列边都往上，这样会直观一点。</p>
<p>容易分析出一个性质，我们总想让右边上面的点连向左边上面的点，左边下面的点连向右边下面的点。可以发现，这样两边的最高点和最低点之间就形成了一个强联通分量。于是贪心地在左边自上而下地定向，如果当前连的右边的点在之前所有点的上面，那就从右往左连，否则从左往右连。证明是容易的，因为后者一定更劣，而前者一定更不劣。建完图再跑个 tarjan 求强连通分量即可。时间复杂度 $O(m\log m)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.3.18 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">4e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> a,b,m;</span><br><span class="line">    vector&lt;Pair&gt; A[N];</span><br><span class="line">    <span class="keyword">int</span> ans[N];</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; G[N];</span><br><span class="line">    <span class="keyword">int</span> dfn[N],low[N],idx,st[N],top,vis[N];</span><br><span class="line">    <span class="keyword">int</span> cnt;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(res x)</span></span>&#123;</span><br><span class="line">        dfn[x]=low[x]=++idx;</span><br><span class="line">        vis[st[++top]=x]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> tox:G[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(!dfn[tox])<span class="built_in">tarjan</span>(tox),low[x]=<span class="built_in">min</span>(low[x],low[tox]);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(vis[tox])low[x]=<span class="built_in">min</span>(low[x],dfn[tox]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(dfn[x]==low[x])&#123;</span><br><span class="line">            cnt++;</span><br><span class="line">            <span class="keyword">do</span>&#123;</span><br><span class="line">                vis[st[top]]=<span class="number">0</span>;</span><br><span class="line">            &#125;<span class="keyword">while</span>(st[top--]!=x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        a=<span class="built_in">read</span>(),b=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            res u=<span class="built_in">read</span>(),v=<span class="built_in">read</span>();</span><br><span class="line">            A[u].<span class="built_in">pb</span>(<span class="built_in">mp</span>(v,i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=a;i++)<span class="built_in">sort</span>(A[i].<span class="built_in">begin</span>(),A[i].<span class="built_in">end</span>()),<span class="built_in">reverse</span>(A[i].<span class="built_in">begin</span>(),A[i].<span class="built_in">end</span>());</span><br><span class="line">        res mx=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=a;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> [x,id]:A[i])&#123;</span><br><span class="line">                <span class="keyword">if</span>(x&gt;mx)mx=x,ans[id]=<span class="number">1</span>,G[x+a].<span class="built_in">pb</span>(i);</span><br><span class="line">                <span class="keyword">else</span> G[i].<span class="built_in">pb</span>(x+a);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;a;i++)G[i].<span class="built_in">pb</span>(i+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;b;i++)G[i+a].<span class="built_in">pb</span>(i+a+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=a+b;i++)<span class="keyword">if</span>(!dfn[i])<span class="built_in">tarjan</span>(i);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,cnt);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj3683"><a href="#loj3683" class="headerlink" title="[loj3683]"></a>[loj3683]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 线段树、数论复杂度分析 | Difficulty: 三</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：考虑每个数在线段树上维护与它不互质的前驱，然后查询就是线段树上的区间 $\max$。考虑修改，发现每个数的不同质数个数是不多的，于是直接暴力枚举这个数的每个质数因子，然后把那些它是/将成为前驱的数暴力修改一下即可。复杂度只有 $O(7n\log n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.3.21 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,q;</span><br><span class="line">    set&lt;<span class="keyword">int</span>&gt; pre[N];</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; A[N];</span><br><span class="line">    set&lt;<span class="keyword">int</span>&gt; con[N];</span><br><span class="line">    <span class="keyword">int</span> vis[N];</span><br><span class="line">    <span class="keyword">int</span> mx[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;p)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!pre[l].<span class="built_in">empty</span>())mx[rt]=*(--pre[l].<span class="built_in">end</span>());</span><br><span class="line">            <span class="keyword">else</span> mx[rt]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(p&lt;=mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,p);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,p);</span><br><span class="line">        mx[rt]=<span class="built_in">max</span>(mx[rt&lt;&lt;<span class="number">1</span>],mx[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)<span class="keyword">return</span> mx[rt];</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>,ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)ret=<span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)ret=<span class="built_in">max</span>(ret,<span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R));</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">char</span> opt[<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),q=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)<span class="keyword">if</span>(!vis[i])<span class="keyword">for</span>(res j=i;j&lt;=n;j+=i)A[j].<span class="built_in">pb</span>(i),vis[j]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)vis[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,opt+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(opt[<span class="number">1</span>]==<span class="string">&#x27;S&#x27;</span>)&#123;</span><br><span class="line">                res x=<span class="built_in">read</span>();</span><br><span class="line">                <span class="keyword">if</span>(x==<span class="number">1</span>)<span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span>(!vis[x])&#123;</span><br><span class="line">                    vis[x]=<span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">auto</span> v:A[x])&#123;</span><br><span class="line">                        <span class="keyword">auto</span> it=con[v].<span class="built_in">lower_bound</span>(x);</span><br><span class="line">                        <span class="keyword">if</span>(it!=con[v].<span class="built_in">begin</span>())&#123;</span><br><span class="line">                            <span class="keyword">auto</span> y=*(--it);</span><br><span class="line">                            pre[x].<span class="built_in">insert</span>(y);</span><br><span class="line">                            it++;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span>(it!=con[v].<span class="built_in">end</span>())&#123;</span><br><span class="line">                            <span class="keyword">auto</span> y=*it;</span><br><span class="line">                            pre[y].<span class="built_in">insert</span>(x);</span><br><span class="line">                            <span class="keyword">if</span>(it!=con[v].<span class="built_in">begin</span>())pre[y].<span class="built_in">erase</span>(*(--it));</span><br><span class="line">                            <span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,y);</span><br><span class="line">                        &#125;</span><br><span class="line">                        con[v].<span class="built_in">insert</span>(x);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,x);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    vis[x]=<span class="number">0</span>;</span><br><span class="line">                    <span class="keyword">for</span>(<span class="keyword">auto</span> v:A[x])&#123;</span><br><span class="line">                        con[v].<span class="built_in">erase</span>(x);</span><br><span class="line">                        <span class="keyword">auto</span> it=con[v].<span class="built_in">lower_bound</span>(x);</span><br><span class="line">                        <span class="keyword">if</span>(it!=con[v].<span class="built_in">begin</span>())&#123;</span><br><span class="line">                            <span class="keyword">auto</span> y=*(--it);</span><br><span class="line">                            pre[x].<span class="built_in">erase</span>(y);</span><br><span class="line">                            it++;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span>(it!=con[v].<span class="built_in">end</span>())&#123;</span><br><span class="line">                            <span class="keyword">auto</span> y=*it;</span><br><span class="line">                            pre[y].<span class="built_in">erase</span>(x);</span><br><span class="line">                            <span class="keyword">if</span>(it!=con[v].<span class="built_in">begin</span>())pre[y].<span class="built_in">insert</span>(*(--it));</span><br><span class="line">                            <span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,y);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,x);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                res l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>();</span><br><span class="line">                <span class="built_in">puts</span>(<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">1</span>,n,l,r)&gt;=l?<span class="string">&quot;DA&quot;</span>:<span class="string">&quot;NE&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj3671"><a href="#loj3671" class="headerlink" title="[loj3671]"></a>[loj3671]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: Bitset、四毛子 | Difficulty: 三点五</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：容易注意到这题是个大拼凑题。考虑询问的答案是如何得出的，容易贪心地发现是对 $b&gt;a$ 的按 $a$ 升序，其余的按 $b$ 降序，然后前缀和的最大值的相反数就是答案。再观察一下，可以发现这等价于一维排序，其他三维都是前缀，是个四维偏序问题。经典的 CDQ 跑不过根号，根号跑不过 <code>bitset</code>，然后排序那一维再套个四毛子，这样复杂度是 $O(\frac{n^2}{\log n})$。</p>
<p>为啥我这个跑得这么慢啊。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.4.2 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">150000</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M=<span class="number">1</span>&lt;&lt;<span class="number">16</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> q;</span><br><span class="line">    <span class="keyword">char</span> opt[<span class="number">10</span>];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Que</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> op,a,b,c;</span><br><span class="line">    &#125;que[N];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">P</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> x,y,z,a,b,id;</span><br><span class="line">    &#125;p[N];</span><br><span class="line">    <span class="keyword">int</span> px;</span><br><span class="line">    <span class="keyword">int</span> id[N];</span><br><span class="line">    LL A[<span class="number">12</span>][M],B[<span class="number">12</span>][M];</span><br><span class="line">    <span class="keyword">int</span> ct[N];</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">short</span> now[<span class="number">12</span>],nx[<span class="number">12</span>][<span class="number">10000</span>+<span class="number">1</span>],ny[<span class="number">12</span>][<span class="number">10000</span>+<span class="number">1</span>],nz[<span class="number">12</span>][<span class="number">10000</span>+<span class="number">1</span>],L[<span class="number">12</span>];</span><br><span class="line">    LL ans[N],Now[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        q=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>,j=<span class="number">0</span>;i&lt;=N<span class="number">-10</span>;i&lt;&lt;=<span class="number">1</span>,j++)ct[i]=j;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=q;i++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,opt+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(opt[<span class="number">1</span>]==<span class="string">&#x27;+&#x27;</span>)&#123;</span><br><span class="line">                res x=<span class="built_in">read</span>(),y=<span class="built_in">read</span>(),z=<span class="built_in">read</span>(),a=<span class="built_in">read</span>(),b=<span class="built_in">read</span>();</span><br><span class="line">                que[i].op=<span class="number">0</span>,que[i].a=++px;</span><br><span class="line">                p[px]=&#123;x,y,z,a,b,px&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(opt[<span class="number">1</span>]==<span class="string">&#x27;-&#x27;</span>)&#123;</span><br><span class="line">                res k=<span class="built_in">read</span>();</span><br><span class="line">                que[i].op=<span class="number">0</span>,que[i].a=k;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                res g=<span class="built_in">read</span>(),l=<span class="built_in">read</span>(),d=<span class="built_in">read</span>();</span><br><span class="line">                que[i]=&#123;<span class="number">1</span>,g,l,d&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=px;i++)id[i]=i;</span><br><span class="line">        <span class="built_in">sort</span>(p+<span class="number">1</span>,p+px+<span class="number">1</span>,[&amp;](<span class="keyword">const</span> P &amp;A,<span class="keyword">const</span> P &amp;B)&#123;</span><br><span class="line">            res _=(A.b&gt;=A.a),__=(B.b&gt;=B.a);</span><br><span class="line">            <span class="keyword">if</span>(_!=__)<span class="keyword">return</span> _&gt;__;</span><br><span class="line">            <span class="keyword">if</span>(_==<span class="number">1</span>)<span class="keyword">return</span> A.a&lt;B.a;</span><br><span class="line">            <span class="keyword">return</span> A.b&gt;B.b;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=px;i++)id[p[i].id]=i,p[i].b-=p[i].a;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=q;i++)<span class="keyword">if</span>(!que[i].op)que[i].a=id[que[i].a];</span><br><span class="line">        <span class="keyword">for</span>(res l=<span class="number">1</span>,r;l&lt;=px;l=r+<span class="number">1</span>)&#123;</span><br><span class="line">            r=<span class="built_in">min</span>(px,l+<span class="number">16</span>*<span class="number">12</span><span class="number">-1</span>);</span><br><span class="line">            res num=<span class="number">16</span>;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;<span class="number">12</span>;j++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">10000</span>;i++)nx[j][i]=ny[j][i]=nz[j][i]=<span class="number">0</span>;</span><br><span class="line">                now[j]=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;<span class="number">12</span>;j++)</span><br><span class="line">                <span class="keyword">for</span>(res S=<span class="number">1</span>;S&lt;<span class="number">1</span>&lt;&lt;num;S++)A[j][S]=<span class="built_in">max</span>((LL)p[l+<span class="number">16</span>*j+ct[<span class="built_in">lowbit</span>(S)]].a,A[j][S^<span class="built_in">lowbit</span>(S)]-p[l+<span class="number">16</span>*j+ct[<span class="built_in">lowbit</span>(S)]].b),B[j][S]=p[l+<span class="number">16</span>*j+ct[<span class="built_in">lowbit</span>(S)]].b+B[j][S^<span class="built_in">lowbit</span>(S)];</span><br><span class="line">            vector&lt;P&gt; nP;</span><br><span class="line">            <span class="keyword">for</span>(res i=l;i&lt;=r;i++)p[i].id=i-l,nP.<span class="built_in">pb</span>(p[i]);</span><br><span class="line">            <span class="built_in">sort</span>(nP.<span class="built_in">begin</span>(),nP.<span class="built_in">end</span>(),[&amp;](<span class="keyword">const</span> P &amp;A,<span class="keyword">const</span> P &amp;B)&#123;<span class="keyword">return</span> A.x&lt;B.x;&#125;);</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;<span class="number">12</span>;i++)L[i]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>,j=<span class="number">0</span>,sz=(<span class="keyword">int</span>)nP.<span class="built_in">size</span>();i&lt;=<span class="number">10000</span>;i++)&#123;</span><br><span class="line">                <span class="keyword">while</span>(j&lt;sz&amp;&amp;nP[j].x==i)&#123;</span><br><span class="line">                    res I=nP[j].id;</span><br><span class="line">                    L[I/<span class="number">16</span>]|=<span class="number">1</span>&lt;&lt;(I-I/<span class="number">16</span>*<span class="number">16</span>),j++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span>(res k=<span class="number">0</span>;k&lt;<span class="number">12</span>;k++)nx[k][i]=L[k];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">sort</span>(nP.<span class="built_in">begin</span>(),nP.<span class="built_in">end</span>(),[&amp;](<span class="keyword">const</span> P &amp;A,<span class="keyword">const</span> P &amp;B)&#123;<span class="keyword">return</span> A.y&lt;B.y;&#125;);</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;<span class="number">12</span>;i++)L[i]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>,j=<span class="number">0</span>,sz=(<span class="keyword">int</span>)nP.<span class="built_in">size</span>();i&lt;=<span class="number">10000</span>;i++)&#123;</span><br><span class="line">                <span class="keyword">while</span>(j&lt;sz&amp;&amp;nP[j].y==i)&#123;</span><br><span class="line">                    res I=nP[j].id;</span><br><span class="line">                    L[I/<span class="number">16</span>]|=<span class="number">1</span>&lt;&lt;(I-I/<span class="number">16</span>*<span class="number">16</span>),j++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span>(res k=<span class="number">0</span>;k&lt;<span class="number">12</span>;k++)ny[k][i]=L[k];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">sort</span>(nP.<span class="built_in">begin</span>(),nP.<span class="built_in">end</span>(),[&amp;](<span class="keyword">const</span> P &amp;A,<span class="keyword">const</span> P &amp;B)&#123;<span class="keyword">return</span> A.z&lt;B.z;&#125;);</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;<span class="number">12</span>;i++)L[i]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>,j=<span class="number">0</span>,sz=(<span class="keyword">int</span>)nP.<span class="built_in">size</span>();i&lt;=<span class="number">10000</span>;i++)&#123;</span><br><span class="line">                <span class="keyword">while</span>(j&lt;sz&amp;&amp;nP[j].z==i)&#123;</span><br><span class="line">                    res I=nP[j].id;</span><br><span class="line">                    L[I/<span class="number">16</span>]|=<span class="number">1</span>&lt;&lt;(I-I/<span class="number">16</span>*<span class="number">16</span>),j++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">for</span>(res k=<span class="number">0</span>;k&lt;<span class="number">12</span>;k++)nz[k][i]=L[k];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=q;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(que[i].op)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;<span class="number">12</span>;j++)&#123;</span><br><span class="line">                        LL sA=<span class="number">0</span>,sB=<span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">auto</span> [op,x,y,z]=que[i];</span><br><span class="line">                        res sit=now[j]&amp;nx[j][x]&amp;ny[j][y]&amp;nz[j][z];</span><br><span class="line">                        sA=A[j][sit]-Now[i];</span><br><span class="line">                        sB=Now[i]+B[j][sit];</span><br><span class="line">                        ans[i]=<span class="built_in">max</span>(sA,ans[i]),Now[i]=sB;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(l&lt;=que[i].a&amp;&amp;que[i].a&lt;=r)&#123;</span><br><span class="line">                    res I=que[i].a-l;</span><br><span class="line">                    now[I/<span class="number">16</span>]^=<span class="number">1</span>&lt;&lt;(I-I/<span class="number">16</span>*<span class="number">16</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=q;i++)<span class="keyword">if</span>(que[i].op)<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj2037"><a href="#loj2037" class="headerlink" title="[loj2037]"></a>[loj2037]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: 线段树二分 | Difficulty: 二</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：发现三个操作都异常简单，询问操作是个类似最大子段和的东西，操作一是个区间覆盖，操作二我们可以二分出修改的右端点，然后也是个区间覆盖。注意到这个二分是可以放在线段树上，同时更加注意到这个二分和修改可以放在一起写，所以就很容易了。时间复杂度 $O(n\log n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.4.2 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">P</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> lm,rm,mx,len;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>&#123;</span><br><span class="line">            lm=rm=mx=<span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">cov</span><span class="params">()</span></span>&#123;</span><br><span class="line">            lm=rm=mx=len;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d %d\n&quot;</span>,lm,rm,mx,len);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;tr[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> sum[N&lt;&lt;<span class="number">2</span>],tag[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">inline</span> P <span class="keyword">operator</span> + (<span class="keyword">const</span> P &amp;A,<span class="keyword">const</span> P &amp;B)&#123;</span><br><span class="line">        P C&#123;&#125;;</span><br><span class="line">        <span class="keyword">if</span>(A.lm==A.len)C.lm=A.len+B.lm;</span><br><span class="line">        <span class="keyword">else</span> C.lm=A.lm;</span><br><span class="line">        <span class="keyword">if</span>(B.rm==B.len)C.rm=B.len+A.rm;</span><br><span class="line">        <span class="keyword">else</span> C.rm=B.rm;</span><br><span class="line">        C.len=A.len+B.len;</span><br><span class="line">        C.mx=<span class="built_in">max</span>(&#123;A.mx,B.mx,A.rm+B.lm&#125;);</span><br><span class="line">        <span class="keyword">return</span> C;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(res rt,res l,res r)</span></span>&#123;</span><br><span class="line">        tr[rt].len=sum[rt]=r-l+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(l==r)<span class="keyword">return</span>;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(rt&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">const</span> res &amp;rt,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        tag[rt]=v;</span><br><span class="line">        <span class="keyword">if</span>(v==<span class="number">1</span>)tr[rt].<span class="built_in">clear</span>(),sum[rt]=tr[rt].len;</span><br><span class="line">        <span class="keyword">else</span> tr[rt].<span class="built_in">cov</span>(),sum[rt]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">const</span> res &amp;rt)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!tag[rt])<span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">change</span>(rt&lt;&lt;<span class="number">1</span>,tag[rt]),<span class="built_in">change</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,tag[rt]),tag[rt]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;<span class="built_in">change</span>(rt,<span class="number">-1</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R);</span><br><span class="line">        tr[rt]=tr[rt&lt;&lt;<span class="number">1</span>]+tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>],sum[rt]=sum[rt&lt;&lt;<span class="number">1</span>]+sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> nowv;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Modify</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!nowv)<span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R&amp;&amp;nowv&gt;=tr[rt].len-sum[rt])&#123;nowv-=tr[rt].len-sum[rt],<span class="built_in">change</span>(rt,<span class="number">1</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="built_in">Modify</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)<span class="built_in">Modify</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R);</span><br><span class="line">        tr[rt]=tr[rt&lt;&lt;<span class="number">1</span>]+tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>],sum[rt]=sum[rt&lt;&lt;<span class="number">1</span>]+sum[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">P <span class="title">query</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)<span class="keyword">return</span> tr[rt];</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid&amp;&amp;R&gt;mid)<span class="keyword">return</span> <span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R)+<span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R);</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="keyword">return</span> <span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">querys</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)<span class="keyword">return</span> sum[rt];</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>,ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)ret=<span class="built_in">querys</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)ret+=<span class="built_in">querys</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>(),<span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">        <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">            res opt=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">if</span>(opt==<span class="number">0</span>)&#123;</span><br><span class="line">                res l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>();</span><br><span class="line">                <span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,l,r);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">1</span>)&#123;</span><br><span class="line">                res l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>(),L=<span class="built_in">read</span>(),R=<span class="built_in">read</span>();</span><br><span class="line">                res s=<span class="built_in">querys</span>(<span class="number">1</span>,<span class="number">1</span>,n,l,r);</span><br><span class="line">                <span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,l,r),nowv=s,<span class="built_in">Modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,L,R);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                res l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>();</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">1</span>,n,l,r).mx);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj3672"><a href="#loj3672" class="headerlink" title="[loj3672]"></a>[loj3672]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Tag & Difficulty</span></div>
    <div class="hide-content"><p>Tag: set | Difficulty: 二</p>
</div></div>
<div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>做法：这真的是 CTT 的题吗，这难度是不是有点。</p>
<p>uoj 有个简化题意，一看就懂了。考虑一个合法 $(x,y)$ 是咋样的，可以注意到是要求 $a_y$ 只在 $[x+1,n]$ 中出现一次，$a_x$ 只在 $[1,y-1]$ 中出现一次。这样表面上不太好维护，那我们再拆分下信息，即改成 $a_y$ 只在 $[x+1,n]$ 中出现一次，$a_x$ 只在 $[1,x]$ 中出现一次，且 $nxt_x&gt;y$，其中 $nxt_x$ 表示 $a_x$ 的下一次出现位置。全部换成 $pre,nxt$，就变成了 $pre_x=0,nxt_x&gt;y,nxt_y=0,pre_y&lt;x$。于是枚举 $x$，注意到第二个不等号的条件根据 $x$ 单调，查询就是个最小值。时间复杂度 $O(n\log n)$，瓶颈在于排序。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.4.3 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,L,R;</span><br><span class="line">    <span class="keyword">int</span> a[N],pre[N],pos[N],nxt[N];</span><br><span class="line">    Pair b[N];</span><br><span class="line">    <span class="keyword">int</span> bx;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),L=<span class="built_in">read</span>(),R=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>(),pre[i]=pos[a[i]],nxt[pos[a[i]]]=i,pos[a[i]]=i;</span><br><span class="line">        <span class="keyword">for</span>(res i=R+<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(!nxt[i])b[++bx]=<span class="built_in">mp</span>(pre[i],i);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(!nxt[i])nxt[i]=n+<span class="number">1</span>;</span><br><span class="line">        res ans=<span class="number">10</span>*n,y=<span class="number">10</span>*n;</span><br><span class="line">        <span class="built_in">sort</span>(b+<span class="number">1</span>,b+bx+<span class="number">1</span>);</span><br><span class="line">        res now=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res x=<span class="number">1</span>;x&lt;L;x++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(b[now].fi&lt;x&amp;&amp;now&lt;=bx)y=<span class="built_in">min</span>(y,b[now++].se);</span><br><span class="line">            <span class="keyword">if</span>(pre[x])<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(y&lt;nxt[x])ans=<span class="built_in">min</span>(ans,y-x+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans&gt;n?<span class="number">-1</span>:ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">foreverlasting</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://foreverlasting1202.github.io/2022/02/05/loj%E9%9A%8F%E6%9C%BA%E5%81%9A%E9%A2%98/">http://foreverlasting1202.github.io/2022/02/05/loj随机做题/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/OI/">OI</a></div><div class="post_share"><div class="social-share" data-image="https://pic.imgdb.cn/item/61fa04532ab3f51d91b74efc.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/02/22/CF1644/"><img class="prev-cover" src="https://pic.imgdb.cn/item/61fa03712ab3f51d91b693cc.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">CF1644</div></div></a></div><div class="next-post pull-right"><a href="/2022/02/03/2021%20Ptz,Summer%20Day3/"><img class="next-cover" src="https://pic.imgdb.cn/item/61f9368f2ab3f51d910e4f50.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">41st Petrozavodsk Programming Camp, Summer 2021 Day 3 IQ test</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/02/28/bijectivepr/" title="A few solutions of bijective proof problems"><img class="cover" src="https://pic.imgdb.cn/item/61fa2e5a2ab3f51d91ddd3cb.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-28</div><div class="title">A few solutions of bijective proof problems</div></div></a></div><div><a href="/2021/10/18/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/" title="做题记录"><img class="cover" src="https://pic.imgdb.cn/item/61fa03072ab3f51d91b63d74.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-18</div><div class="title">做题记录</div></div></a></div><div><a href="/2021/08/10/%E5%8F%A3%E8%83%A1%E8%AE%B0%E5%BD%95/" title="口胡记录"><img class="cover" src="https://s2.loli.net/2022/02/01/9BMbc35xJVwjUKr.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-10</div><div class="title">口胡记录</div></div></a></div><div><a href="/2021/07/06/%E8%AE%AD%E7%BB%83%E5%AE%9E%E5%BD%95/" title="训练实录"><img class="cover" src="https://pic.imgdb.cn/item/61fa03bd2ab3f51d91b6cfc6.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-06</div><div class="title">训练实录</div></div></a></div><div><a href="/2021/06/13/%E5%A4%8D%E5%81%A5%E8%AE%AD%E7%BB%83/" title="复 健 训 练"><img class="cover" src="https://pic.imgdb.cn/item/61fa03542ab3f51d91b678e0.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-13</div><div class="title">复 健 训 练</div></div></a></div><div><a href="/2021/06/13/tips/" title="一些需注意的点"><img class="cover" src="https://pic.imgdb.cn/item/61fa2e5a2ab3f51d91ddd3cb.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-13</div><div class="title">一些需注意的点</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/cute.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">foreverlasting</div><div class="author-info__description">呜呜呜。</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">141</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">3</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">40</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/foreverlasting1202" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/573902690@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">现在装了个大概，还有 tag、link 之类的东西没整好，同时文章部分预览也没完成，以后慢慢整吧。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#loj2250"><span class="toc-number">1.</span> <span class="toc-text">[loj2250]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj545"><span class="toc-number">2.</span> <span class="toc-text">[loj545]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj6073"><span class="toc-number">3.</span> <span class="toc-text">[loj6073]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj2655"><span class="toc-number">4.</span> <span class="toc-text">[loj2655]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj3082"><span class="toc-number">5.</span> <span class="toc-text">[loj3082*]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj2829"><span class="toc-number">6.</span> <span class="toc-text">[loj2829]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj2000"><span class="toc-number">7.</span> <span class="toc-text">[loj2000]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj6182"><span class="toc-number">8.</span> <span class="toc-text">[loj6182]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj3025"><span class="toc-number">9.</span> <span class="toc-text">[loj3025]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj2320"><span class="toc-number">10.</span> <span class="toc-text">[loj2320]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj2861"><span class="toc-number">11.</span> <span class="toc-text">[loj2861]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj2601"><span class="toc-number">12.</span> <span class="toc-text">[loj2601]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj3083"><span class="toc-number">13.</span> <span class="toc-text">[loj3083]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj6104"><span class="toc-number">14.</span> <span class="toc-text">[loj6104*]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj6432"><span class="toc-number">15.</span> <span class="toc-text">[loj6432]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj3274"><span class="toc-number">16.</span> <span class="toc-text">[loj3274*]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj3561"><span class="toc-number">17.</span> <span class="toc-text">[loj3561]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj3545"><span class="toc-number">18.</span> <span class="toc-text">[loj3545]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj6086"><span class="toc-number">19.</span> <span class="toc-text">[loj6086]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj3028"><span class="toc-number">20.</span> <span class="toc-text">[loj3028]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj3239"><span class="toc-number">21.</span> <span class="toc-text">[loj3239*]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj6297"><span class="toc-number">22.</span> <span class="toc-text">[loj6297]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj3684"><span class="toc-number">23.</span> <span class="toc-text">[loj3684]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj3683"><span class="toc-number">24.</span> <span class="toc-text">[loj3683]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj3671"><span class="toc-number">25.</span> <span class="toc-text">[loj3671]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj2037"><span class="toc-number">26.</span> <span class="toc-text">[loj2037]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj3672"><span class="toc-number">27.</span> <span class="toc-text">[loj3672]</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/9102/01/01/%E8%BF%91%E6%9C%9F%E6%9B%B4%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2/" title="近期更新的博客"><img src="https://pic.imgdb.cn/item/61fa03b12ab3f51d91b6c483.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="近期更新的博客"/></a><div class="content"><a class="title" href="/9102/01/01/%E8%BF%91%E6%9C%9F%E6%9B%B4%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2/" title="近期更新的博客">近期更新的博客</a><time datetime="9102-01-01T13:50:00.000Z" title="Created 9102-01-01 21:50:00">9102-01-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/20/CF1654/" title="CF1654"><img src="https://pic.imgdb.cn/item/61fa041f2ab3f51d91b72144.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CF1654"/></a><div class="content"><a class="title" href="/2022/03/20/CF1654/" title="CF1654">CF1654</a><time datetime="2022-03-20T15:30:00.000Z" title="Created 2022-03-20 23:30:00">2022-03-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/16/CF1483/" title="CF1483"><img src="https://pic.imgdb.cn/item/61fa02f92ab3f51d91b62fce.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CF1483"/></a><div class="content"><a class="title" href="/2022/03/16/CF1483/" title="CF1483">CF1483</a><time datetime="2022-03-16T15:30:00.000Z" title="Created 2022-03-16 23:30:00">2022-03-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/14/CF1647/" title="CF1647"><img src="https://s2.loli.net/2022/02/01/gGXzMx9q43OfoId.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CF1647"/></a><div class="content"><a class="title" href="/2022/03/14/CF1647/" title="CF1647">CF1647</a><time datetime="2022-03-14T15:30:00.000Z" title="Created 2022-03-14 23:30:00">2022-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/12/2022.3.12/" title="2022.3.12"><img src="https://s2.loli.net/2022/02/01/wx5uN2Uv4EQ6edW.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022.3.12"/></a><div class="content"><a class="title" href="/2022/03/12/2022.3.12/" title="2022.3.12">2022.3.12</a><time datetime="2022-03-11T16:30:00.000Z" title="Created 2022-03-12 00:30:00">2022-03-12</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By foreverlasting</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Local search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'vBIv3E8Y4e1znLKVs85Y0uSh-gzGzoHsz',
      appKey: 'Dpqs6OR87Ev6XoG6XcSPjToh',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>