<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>复 健 训 练 | foreverlasting's blog</title><meta name="keywords" content="OI"><meta name="author" content="foreverlasting"><meta name="copyright" content="foreverlasting"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="感觉高考考得一般般，估计要打 ACM 了，提前开始复健，大致在这里记录一些或许有意义的题。">
<meta property="og:type" content="article">
<meta property="og:title" content="复 健 训 练">
<meta property="og:url" content="http://foreverlasting1202.github.io/2021/06/13/%E5%A4%8D%E5%81%A5%E8%AE%AD%E7%BB%83/index.html">
<meta property="og:site_name" content="foreverlasting&#39;s blog">
<meta property="og:description" content="感觉高考考得一般般，估计要打 ACM 了，提前开始复健，大致在这里记录一些或许有意义的题。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://s2.loli.net/2022/02/01/gGXzMx9q43OfoId.jpg">
<meta property="article:published_time" content="2021-06-13T15:30:00.000Z">
<meta property="article:modified_time" content="2022-05-11T05:06:58.077Z">
<meta property="article:author" content="foreverlasting">
<meta property="article:tag" content="OI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/02/01/gGXzMx9q43OfoId.jpg"><link rel="shortcut icon" href="/img/1.jpg"><link rel="canonical" href="http://foreverlasting1202.github.io/2021/06/13/%E5%A4%8D%E5%81%A5%E8%AE%AD%E7%BB%83/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '复 健 训 练',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2022-05-11 13:06:58'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/cccute.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">147</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">4</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">40</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> Messageboard</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> myself</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://s2.loli.net/2022/02/01/gGXzMx9q43OfoId.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">foreverlasting's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> Messageboard</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> myself</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">复 健 训 练</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-06-13T15:30:00.000Z" title="Created 2021-06-13 23:30:00">2021-06-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-05-11T05:06:58.077Z" title="Updated 2022-05-11 13:06:58">2022-05-11</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/">做题记录</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="复 健 训 练"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>感觉高考考得一般般，估计要打 ACM 了，提前开始复健，大致在这里记录一些或许有意义的题。</p>
<p>估计接下来题解风格都会焕然一新。（大概）<br><span id="more"></span></p>
<h3 id="ARC122"><a href="#ARC122" class="headerlink" title="[ARC122]"></a>[ARC122]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>summary</span></div>
    <div class="hide-content"><p>实况：题不会想，代码也不会写了，真的爬了。</p>
</div></div>
<h4 id="ARC122-A"><a href="#ARC122-A" class="headerlink" title="[ARC122 A]"></a>[ARC122 A]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：一行有 $n$ 个数，相邻两个数可以添加 $+$ 或者 $-$，其中两个 $-$ 不能相邻，求所有方案的和。</p>
<p>做法：考虑算 $-$ 的贡献。$f(i,0/1)$ 表示长度为 $i$ 末尾为 $+/-$ 的方案数，于是就可以对每个位置的 $-$ 号算贡献了。</p>
<p>复杂度 $O(n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.6.12 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,a[N],f[N][<span class="number">2</span>],g[N][<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>();</span><br><span class="line">        res ans=<span class="number">0</span>,sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">add</span>(sum,a[i]);</span><br><span class="line">        <span class="comment">//0 + 1 - f pre g suf</span></span><br><span class="line">        f[<span class="number">1</span>][<span class="number">0</span>]=<span class="number">1</span>,g[<span class="number">1</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)f[i][<span class="number">0</span>]=<span class="built_in">Add</span>(f[i<span class="number">-1</span>][<span class="number">0</span>],f[i<span class="number">-1</span>][<span class="number">1</span>]),f[i][<span class="number">1</span>]=f[i<span class="number">-1</span>][<span class="number">0</span>];</span><br><span class="line">        ans=<span class="built_in">mul</span>(sum,<span class="built_in">Add</span>(f[n][<span class="number">0</span>],f[n][<span class="number">1</span>]));</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)<span class="built_in">add</span>(ans,<span class="built_in">mul</span>(<span class="built_in">Add</span>(kcz-a[i],kcz-a[i]),<span class="built_in">mul</span>(f[n-i+<span class="number">1</span>][<span class="number">0</span>],f[i<span class="number">-1</span>][<span class="number">0</span>])));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h4 id="ARC122-B"><a href="#ARC122-B" class="headerlink" title="[ARC122 B]"></a>[ARC122 B]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给定 $n$ 个正整数 $A_i$，需确定一个正整数 $x$ 使得 $\dfrac{\sum_{i=1}^n x+A_i-min(2x,A_i)}{n}$ 最小。</p>
<p>做法：对 $A$ 排序后，考虑 $2x \geq A_m$ 且 $2x &lt; A_{m+1}$，直接预处理前缀和算出当前答案。于是枚举 $m$ 即可。</p>
<p>复杂度 $O(n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.6.12 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,a[N];</span><br><span class="line">    LL sum[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">sort</span>(a+<span class="number">1</span>,a+n+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)sum[i]=sum[i<span class="number">-1</span>]+a[i];</span><br><span class="line">        RG LL ans=INF;</span><br><span class="line">        <span class="keyword">for</span>(res m=<span class="number">0</span>;m&lt;=n;m++)&#123;</span><br><span class="line">            ans=<span class="built_in">min</span>(ans,sum[n]*<span class="number">2</span>+<span class="number">1LL</span>*n*a[m]<span class="number">-2LL</span>*a[m]*(n-m)<span class="number">-2LL</span>*sum[m]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%.10Lf\n&quot;</span>,(<span class="keyword">long</span> <span class="keyword">double</span>)ans/(<span class="number">2.0</span>*n));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h4 id="ARC122-C"><a href="#ARC122-C" class="headerlink" title="[ARC122 C]"></a>[ARC122 C]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：输入一个小于等于 $10^{18}$ 的正整数数 $N$，初始 $x,y$ 为零，现有四种操作：</p>
<ol>
<li>$x \gets x+1$</li>
<li>$y \gets y+1$</li>
<li>$x \gets x+y$</li>
<li>$y \gets x+y$</li>
</ol>
<p>求构造一种方案使得 $x=N$，操作次数不超过 $130$ 次。</p>
<p>做法：考虑每次 $+1$ 在后序的贡献。如果后续总是 $4,3,4,3$ 的循环，则显然这个 $1$ 的贡献系数是与 Fib 的某一项。大胆猜想这样的操作次数小于等于 $130$。于是将 $N$ 拆成若干个 Fib 的和即可。</p>
<p>复杂度 $O(130)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.6.14 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    LL N;</span><br><span class="line">    LL f[<span class="number">100</span>+<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> cnt[<span class="number">150</span>+<span class="number">10</span>],cntx;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        f[<span class="number">0</span>]=f[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=<span class="number">100</span>;i++)&#123;f[i]=f[i<span class="number">-1</span>]+f[i<span class="number">-2</span>],n=i;<span class="keyword">if</span>(f[i]&gt;=<span class="number">1e18</span>)<span class="keyword">break</span>;&#125;</span><br><span class="line">        N=<span class="built_in">Read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=n<span class="number">-1</span>;~i;i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(N&gt;=f[i])&#123;</span><br><span class="line">                N-=f[i];</span><br><span class="line">                <span class="keyword">if</span>(i&amp;<span class="number">1</span>)cnt[++cntx]=<span class="number">2</span>;</span><br><span class="line">                <span class="keyword">else</span> cnt[++cntx]=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            cnt[++cntx]=<span class="number">3</span>+(i&amp;<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(cntx&gt;=<span class="number">130</span>)cntx=<span class="number">200</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,cntx);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=cntx;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,cnt[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h4 id="ARC122-D"><a href="#ARC122-D" class="headerlink" title="[ARC122 D]"></a>[ARC122 D]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：A 和 B 在博弈，两个人分别从 $2n$ 个数各抽出一个数取异或，每次异或取大为最终答案。A 希望最终结果最大，B 希望最终结果最小，A 先手，求最终答案。</p>
<p>做法：对 $2n$ 个数建立 Trie 树后，考虑递归 Trie 树。</p>
<p>若当前节点的左儿子内有奇数个数，说明右儿子也有奇数个数，则无论 B 如何取，总有一对分别来自两个儿子，于是暴力递归如两个儿子计算答案，这样的话，B每次可以狙击 A，即尽量保证 A 最小。</p>
<p>若当前节点的左儿子内有偶数个数，说明右儿子也有偶数个数，那么继续递归入两个儿子。</p>
<p>总复杂度 $O(n\log n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.6.18 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">4e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    LL a[N];</span><br><span class="line">    <span class="keyword">int</span> tr[N*<span class="number">31</span>][<span class="number">2</span>],sz[N*<span class="number">31</span>];</span><br><span class="line">    <span class="keyword">int</span> tot,rt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> RG LL &amp;x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!rt)rt=++tot;</span><br><span class="line">        res now=rt;</span><br><span class="line">        sz[now]++;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">30</span>;~i;i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(x&amp;(<span class="number">1ll</span>&lt;&lt;i))&#123;</span><br><span class="line">                <span class="keyword">if</span>(!tr[now][<span class="number">1</span>])tr[now][<span class="number">1</span>]=++tot;</span><br><span class="line">                now=tr[now][<span class="number">1</span>],sz[now]++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(!tr[now][<span class="number">0</span>])tr[now][<span class="number">0</span>]=++tot;</span><br><span class="line">                now=tr[now][<span class="number">0</span>],sz[now]++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    LL ans;</span><br><span class="line">    <span class="function">LL <span class="title">dfs</span><span class="params">(res n1,res n2,RG LL ret,res dep)</span></span>&#123;</span><br><span class="line">        RG LL qaq=INF;</span><br><span class="line">        <span class="keyword">if</span>(dep==<span class="number">-1</span>)<span class="keyword">return</span> ret;</span><br><span class="line">        <span class="keyword">if</span>(tr[n1][<span class="number">0</span>])&#123;</span><br><span class="line">            <span class="keyword">if</span>(tr[n2][<span class="number">0</span>])qaq=<span class="built_in">dfs</span>(tr[n1][<span class="number">0</span>],tr[n2][<span class="number">0</span>],ret,dep<span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(tr[n2][<span class="number">1</span>])qaq=<span class="built_in">dfs</span>(tr[n1][<span class="number">0</span>],tr[n2][<span class="number">1</span>],ret|(<span class="number">1ll</span>&lt;&lt;dep),dep<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(tr[n1][<span class="number">1</span>])&#123;</span><br><span class="line">            <span class="keyword">if</span>(tr[n2][<span class="number">1</span>])qaq=<span class="built_in">min</span>(qaq,<span class="built_in">dfs</span>(tr[n1][<span class="number">1</span>],tr[n2][<span class="number">1</span>],ret,dep<span class="number">-1</span>));</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(tr[n2][<span class="number">0</span>])qaq=<span class="built_in">min</span>(qaq,<span class="built_in">dfs</span>(tr[n1][<span class="number">1</span>],tr[n2][<span class="number">0</span>],ret|(<span class="number">1ll</span>&lt;&lt;dep),dep<span class="number">-1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> qaq;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">solve</span><span class="params">(res now,res dep)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(sz[tr[now][<span class="number">0</span>]]&amp;<span class="number">1</span>)ans=<span class="built_in">max</span>(ans,<span class="built_in">dfs</span>(tr[now][<span class="number">0</span>],tr[now][<span class="number">1</span>],<span class="number">1ll</span>&lt;&lt;(dep<span class="number">-1</span>),dep<span class="number">-2</span>));</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(tr[now][<span class="number">0</span>])<span class="built_in">solve</span>(tr[now][<span class="number">0</span>],dep<span class="number">-1</span>);</span><br><span class="line">            <span class="keyword">if</span>(tr[now][<span class="number">1</span>])<span class="built_in">solve</span>(tr[now][<span class="number">1</span>],dep<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*n;i++)a[i]=<span class="built_in">Read</span>(),<span class="built_in">insert</span>(a[i]);</span><br><span class="line">        <span class="built_in">solve</span>(rt,<span class="number">31</span>),<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h4 id="ARC122-E"><a href="#ARC122-E" class="headerlink" title="[ARC122 E]"></a>[ARC122 E]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有 $n$ 个互不相同的正整数，现要求你找出一组这 $n$ 个数的排列，使得前缀 $\operatorname{lcm}$ 递增。</p>
<p>做法：考虑从后往前构造，下证明后面的选取不会影响前面。</p>
<p>假设前面的 $\operatorname{lcm}$ 为 $A$，后两个数为 $a,b$，若后面的选取会影响前面，则要满足（假定顺序为 $A,a,b$）</p>
<script type="math/tex; mode=display">
\begin{cases}
\operatorname{lcm} (A,a) < \operatorname{lcm} (A,a,b) \\\\
A = \operatorname{lcm} (A,a) \\\\
\operatorname{lcm} (A,b) < \operatorname{lcm} (A,a,b) \\\\
A < \operatorname{lcm} (A,b)
\end{cases}</script><p>即</p>
<script type="math/tex; mode=display">
\begin{cases}
\gcd(\operatorname{lcm} (A,a),b) < b \\\\
\gcd(A,a) = a \\\\
\gcd(\operatorname{lcm} (A,b),a) < a \\\\
\gcd(A,b) < b
\end{cases}</script><p>根据第二条，可得 $A=ka$ （$k$ 为一正整数）。但根据第三条， $\operatorname{lcm} (A,b)$ 显然被 $a$ 整除，但与 $a$ 的 $\gcd$ 却小于 $a$，矛盾。</p>
<p>于是证出了后面的选取不会影响前面，因此暴力从后往前即可，时间复杂度 $O(n^3 \log a)$。</p>
<p>具体实现上，需小心爆<code>long long</code>，稍微注意一些细节即可。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.6.24 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">100</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    LL a[N];</span><br><span class="line">    <span class="keyword">bool</span> vis[N];</span><br><span class="line">    LL b[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">Read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res T=<span class="number">1</span>;T&lt;n;T++)&#123;</span><br><span class="line">            <span class="keyword">bool</span> Fl=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(vis[i])<span class="keyword">continue</span>;</span><br><span class="line">                RG LL ret=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">bool</span> fl=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(vis[j]||i==j)<span class="keyword">continue</span>;</span><br><span class="line">                    RG LL p=__gcd(a[j],a[i]);</span><br><span class="line">                    <span class="keyword">if</span>((<span class="keyword">long</span> <span class="keyword">double</span>)ret/__gcd(ret,p)&gt;=(<span class="keyword">long</span> <span class="keyword">double</span>)a[i]/p)&#123;fl=<span class="number">1</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">                    ret=(<span class="keyword">long</span> <span class="keyword">long</span>)((__int128)ret*p/__gcd(ret,p));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(fl)<span class="keyword">continue</span>;</span><br><span class="line">                b[n-T+<span class="number">1</span>]=a[i],Fl=<span class="number">1</span>,vis[i]=<span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!Fl)&#123;<span class="built_in">puts</span>(<span class="string">&quot;No&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(!vis[i])b[<span class="number">1</span>]=a[i];</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Yes&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">printf</span>(<span class="string">&quot;%lld &quot;</span>,b[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h4 id="ARC122-F"><a href="#ARC122-F" class="headerlink" title="[ARC122 F]"></a>[ARC122 F]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有 $n$ 个红石，$m$ 个蓝石。你可以任意移动石子，代价是曼哈顿距离。你的目标是，用最小的代价，使得每个红石右上方都至少有 $k$ 个蓝石。</p>
<p>做法：先把绝对无意义的红石去掉，即 $x\leq x’,y\leq y’$。</p>
<p>每个红石头右上角有 $k$ 个蓝石头，等价于蓝石头可以分为 $k$ 组，其中每一组都是一个$ k=1$时的答案。</p>
<p>然后我们考虑 $k=1$。注意到一个蓝石头支配的红石头一定是一个连续的区间，于是考虑怎么计算答案。</p>
<p>画一个坐标系，其中只有 $x$ 轴和 $y$ 轴上有点，规定在 $y$ 轴向上代价为 $0$，向下代价为 $1$，$x$ 轴向左代价为 $0$，向右代价为 $1$。</p>
<p>对于每个蓝石头，从 $(0,y)$ 向 $(x,0)$ 连一条代价为 $0$ 的边。</p>
<p>容易证明此时从 $(0,y)$ 到 $(x,0)$ 的最短路就是使得 $(x,y)$ 的右上角有蓝石头的最小代价。（因为越往右上一直越有意义）</p>
<p>然后我们再对于每个红石头，从 $(RX_i,0)$ 到 $(0,RY_{i+1})$ 连一条代价为 $0$ 的边。</p>
<p>这样就可以使从起点到终点的路程被切成若干个区间，然后从 $(0,RY_1)$ 到 $(RX_n,0)$ 跑个最短路就行了。</p>
<p>至于 $k&gt;1$ 的话，等价于起点往 $(0,RY_1)$ 连一条容量为 $k$ 的边即可。</p>
<p>复杂度 $O(k(n+m)\log(n+m))$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.6.27 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m,k;</span><br><span class="line">    Pair r[N],b[N];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">E</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> next,to,val,cap;</span><br><span class="line">        <span class="built_in">E</span>() &#123;&#125;</span><br><span class="line">        <span class="built_in">E</span>(res next,res to,res val,res cap):<span class="built_in">next</span>(next),<span class="built_in">to</span>(to),<span class="built_in">val</span>(val),<span class="built_in">cap</span>(cap) &#123;&#125;</span><br><span class="line">    &#125;edge[N*<span class="number">6</span>];</span><br><span class="line">    <span class="keyword">int</span> head[N],cnt;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">const</span> res &amp;u,<span class="keyword">const</span> res &amp;v,<span class="keyword">const</span> res &amp;w,<span class="keyword">const</span> res &amp;c)</span></span>&#123;</span><br><span class="line">        edge[++cnt]=<span class="built_in">E</span>(head[u],v,w,c),head[u]=cnt;</span><br><span class="line">        edge[++cnt]=<span class="built_in">E</span>(head[v],u,-w,<span class="number">0</span>),head[v]=cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line">    LL dis[N],h[N];</span><br><span class="line">    <span class="keyword">int</span> lim[N],pre[N],las[N];</span><br><span class="line">    <span class="keyword">int</span> S,T;</span><br><span class="line">    priority_queue&lt;pair&lt;LL,<span class="keyword">int</span>&gt;,vector&lt;pair&lt;LL,<span class="keyword">int</span>&gt; &gt;,greater&lt;pair&lt;LL,<span class="keyword">int</span>&gt; &gt; &gt; Q;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">spfa</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=id;i++)dis[i]=INF,lim[i]=inf;</span><br><span class="line">        Q.<span class="built_in">push</span>(<span class="built_in">mp</span>(dis[S]=<span class="number">0</span>,S)),pre[T]=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span>(!Q.<span class="built_in">empty</span>())&#123;</span><br><span class="line">            res x=Q.<span class="built_in">top</span>().se;</span><br><span class="line">            RG LL d=Q.<span class="built_in">top</span>().fi;</span><br><span class="line">            Q.<span class="built_in">pop</span>();</span><br><span class="line">            <span class="keyword">if</span>(dis[x]!=d)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=head[x];~i;i=edge[i].next)&#123;</span><br><span class="line">                res tox=edge[i].to;</span><br><span class="line">                <span class="keyword">if</span>(dis[tox]&gt;dis[x]+edge[i].val+h[x]-h[tox]&amp;&amp;edge[i].cap)&#123;</span><br><span class="line">                    dis[tox]=dis[x]+edge[i].val+h[x]-h[tox],lim[tox]=<span class="built_in">min</span>(lim[x],edge[i].cap),pre[tox]=x,las[tox]=i;</span><br><span class="line">                    Q.<span class="built_in">push</span>(<span class="built_in">mp</span>(dis[tox],tox));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pre[T]!=<span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> LL <span class="title">mcmf</span><span class="params">()</span></span>&#123;</span><br><span class="line">        RG LL mincost=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">spfa</span>())&#123;</span><br><span class="line">            res now=T;</span><br><span class="line">            mincost+=<span class="number">1ll</span>*lim[T]*(dis[T]+h[T]-h[S]);</span><br><span class="line">            <span class="keyword">while</span>(now!=S)edge[las[now]].cap-=lim[T],edge[las[now]^<span class="number">1</span>].cap+=lim[T],now=pre[now];</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=id;i++)h[i]+=dis[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mincost;</span><br><span class="line">    &#125;</span><br><span class="line">    map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; Mx,My;</span><br><span class="line">    <span class="keyword">int</span> x[N],y[N],xx,yx;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>(),k=<span class="built_in">read</span>(),cnt=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)r[i].fi=<span class="built_in">read</span>(),r[i].se=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)b[i].fi=<span class="built_in">read</span>(),b[i].se=<span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">sort</span>(r+<span class="number">1</span>,r+n+<span class="number">1</span>);</span><br><span class="line">        res nx=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(nx&amp;&amp;r[nx].se&lt;=r[i].se)nx--;</span><br><span class="line">            r[++nx]=r[i];</span><br><span class="line">        &#125;</span><br><span class="line">        n=nx;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!Mx.<span class="built_in">count</span>(r[i].fi))Mx[r[i].fi]=++id,x[++xx]=r[i].fi;</span><br><span class="line">            <span class="keyword">if</span>(!My.<span class="built_in">count</span>(r[i].se))My[r[i].se]=++id,y[++yx]=r[i].se;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!Mx.<span class="built_in">count</span>(b[i].fi))Mx[b[i].fi]=++id,x[++xx]=b[i].fi;</span><br><span class="line">            <span class="keyword">if</span>(!My.<span class="built_in">count</span>(b[i].se))My[b[i].se]=++id,y[++yx]=b[i].se;</span><br><span class="line">        &#125;</span><br><span class="line">        T=Mx[r[n].fi],S=++id;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=id;i++)head[i]=<span class="number">-1</span>;</span><br><span class="line">        <span class="built_in">sort</span>(x+<span class="number">1</span>,x+xx+<span class="number">1</span>),<span class="built_in">sort</span>(y+<span class="number">1</span>,y+yx+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;xx;i++)<span class="built_in">addedge</span>(Mx[x[i]],Mx[x[i+<span class="number">1</span>]],x[i+<span class="number">1</span>]-x[i],inf),<span class="built_in">addedge</span>(Mx[x[i+<span class="number">1</span>]],Mx[x[i]],<span class="number">0</span>,inf);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;yx;i++)<span class="built_in">addedge</span>(My[y[i]],My[y[i+<span class="number">1</span>]],<span class="number">0</span>,inf),<span class="built_in">addedge</span>(My[y[i+<span class="number">1</span>]],My[y[i]],y[i+<span class="number">1</span>]-y[i],inf);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)<span class="built_in">addedge</span>(My[b[i].se],Mx[b[i].fi],<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;n;i++)<span class="built_in">addedge</span>(Mx[r[i].fi],My[r[i+<span class="number">1</span>].se],<span class="number">0</span>,inf);</span><br><span class="line">        <span class="built_in">addedge</span>(S,My[r[<span class="number">1</span>].se],<span class="number">0</span>,k),<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,<span class="built_in">mcmf</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF1534"><a href="#CF1534" class="headerlink" title="[CF1534]"></a>[CF1534]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>summary</span></div>
    <div class="hide-content"><p>实况：时间太迟了，脑子差到了极点。</p>
</div></div>
<h4 id="CF1534-F"><a href="#CF1534-F" class="headerlink" title="[CF1534 F]"></a>[CF1534 F]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给你一个 $n$  行 $m$ 列的网格和一个长度为 $m$ 的序列 $a$。每个位置要么是空的，要么有一块沙子。<strong>我们保证  $a_i$ 的值小于等于网格第 $i$ 列的沙子块数。</strong><br>你可以选择任意一块仍然在网格中的沙子并“干扰”这块沙子。当一块沙子被“干扰”后，它会从当前位置竖直下落，并最终掉出网格。另外，所有与一块下落的沙子经过的任意位置相邻的沙子也会开始竖直下落，<strong>任意下落的沙子都会使相邻的沙子下落</strong>（如果这一段看不懂，可以阅读样例，样例中用黑色方框标记的是被“干扰”的沙子，用叉标记的是自动下落的沙子）。<br>你的目标是使第  $i$ 列至少有 $a_i$ 块沙子掉出网格。<br>求你最少需要“干扰”多少块沙子。</p>
<p>做法：每一块沙对有影响的沙连边后（只连有直接影响的沙），缩点重新看这张图。$a_i$ 的限制可以转化成每列自下往上数的第 $a_i$ 块沙，只要这块特殊沙掉落了就满足了 $a_i$ 的条件。当 $i$ 特殊沙可以影响 $j$ 特殊沙时，则 $j$ 特殊沙的存在显得毫无意义，可以将其删除。在删去无意义沙之后，我们才可以证明每一块沙影响的特殊沙是一段连续的区间（若不连续，则存在第 $A$ 列的 $i$ 特殊沙阻隔了两端区间，由于 $A$ 列必须有一块普通沙连接两段区间，发现这块普通沙若在特殊沙上方时，会影响到特殊沙；在下方时，$i$ 特殊沙会影响相邻区间里的一块特殊沙，而这种特殊沙已经删除了，所以矛盾）。有了这样的性质，求出每一块入度为零的沙所影响的区间，做一个贪心就行了。时间复杂度 $O(nm)$。</p>
<p>代码实现感觉挺麻烦的。下面代码已去掉调试，还是可以看看的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.7.7 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">4e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">char</span> str[N];</span><br><span class="line">    vector&lt;<span class="keyword">char</span>&gt; v[N];</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; G[N];</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; E[N];</span><br><span class="line">    <span class="keyword">int</span> dfn[N],low[N],idx,vis[N],st[N],top,sig[N],nw;</span><br><span class="line">    <span class="keyword">int</span> Fl[N];</span><br><span class="line">    <span class="keyword">int</span> mn[N],mx[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(res x)</span></span>&#123;</span><br><span class="line">        dfn[x]=low[x]=++idx,vis[st[++top]=x]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> tox:G[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(!dfn[tox])<span class="built_in">tarjan</span>(tox),low[x]=<span class="built_in">min</span>(low[x],low[tox]);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(vis[tox])low[x]=<span class="built_in">min</span>(low[x],dfn[tox]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(low[x]==dfn[x])&#123;</span><br><span class="line">            res y=<span class="number">0</span>;</span><br><span class="line">            nw++;</span><br><span class="line">            <span class="keyword">do</span>&#123;</span><br><span class="line">                vis[y=st[top--]]=<span class="number">0</span>,sig[y]=nw;</span><br><span class="line">            &#125;<span class="keyword">while</span>(x!=y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> las[N];</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    <span class="keyword">int</span> fl[N],du[N];</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; B;</span><br><span class="line">    <span class="keyword">int</span> Vis[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(res x)</span></span>&#123;</span><br><span class="line">        Vis[x]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> tox:E[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(Vis[tox])&#123;mn[x]=<span class="built_in">min</span>(mn[x],mn[tox]),mx[x]=<span class="built_in">max</span>(mx[x],mx[tox]);<span class="keyword">continue</span>;&#125;</span><br><span class="line">            <span class="built_in">dfs</span>(tox),mn[x]=<span class="built_in">min</span>(mn[x],mn[tox]),mx[x]=<span class="built_in">max</span>(mx[x],mx[tox]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> jud[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Dfs</span><span class="params">(res x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> tox:E[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(jud[tox])<span class="keyword">continue</span>;</span><br><span class="line">            jud[tox]=<span class="number">1</span>,<span class="built_in">Dfs</span>(tox);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Pair seg[N];</span><br><span class="line">    <span class="keyword">int</span> tot;</span><br><span class="line">    <span class="keyword">int</span> A[N];</span><br><span class="line">    <span class="keyword">int</span> Mpx;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n*m;i++)mn[i]=n*m+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str+<span class="number">1</span>);</span><br><span class="line">            v[i].<span class="built_in">pb</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=m;j++)v[i].<span class="built_in">pb</span>(str[j]);</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=m;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(str[j]==<span class="string">&#x27;#&#x27;</span>)&#123;</span><br><span class="line">                    res id=(i<span class="number">-1</span>)*m+j;</span><br><span class="line">                    <span class="keyword">if</span>(!las[j])B.<span class="built_in">pb</span>(id);</span><br><span class="line">                    fl[id]=<span class="number">1</span>;</span><br><span class="line">                    <span class="keyword">if</span>(j&gt;<span class="number">1</span>&amp;&amp;las[j<span class="number">-1</span>])&#123;</span><br><span class="line">                        G[las[j<span class="number">-1</span>]].<span class="built_in">pb</span>(id);</span><br><span class="line">                        <span class="keyword">if</span>(str[j<span class="number">-1</span>]==<span class="string">&#x27;#&#x27;</span>)G[id].<span class="built_in">pb</span>(las[j<span class="number">-1</span>]);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(j&lt;m&amp;&amp;las[j+<span class="number">1</span>])G[las[j+<span class="number">1</span>]].<span class="built_in">pb</span>(id);</span><br><span class="line">                    <span class="keyword">if</span>(las[j])&#123;</span><br><span class="line">                        G[las[j]].<span class="built_in">pb</span>(id);</span><br><span class="line">                        <span class="keyword">if</span>(v[i<span class="number">-1</span>][j]==<span class="string">&#x27;#&#x27;</span>)G[id].<span class="built_in">pb</span>(las[j]);</span><br><span class="line">                    &#125;</span><br><span class="line">                    las[j]=id;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)a[i]=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=m;j++)&#123;</span><br><span class="line">            res now=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=n;i;i--)&#123;</span><br><span class="line">                <span class="keyword">if</span>(v[i][j]==<span class="string">&#x27;#&#x27;</span>)now++;</span><br><span class="line">                <span class="keyword">if</span>(now==a[j])&#123;Fl[(i<span class="number">-1</span>)*m+j]=j,A[j]=(i<span class="number">-1</span>)*m+j;<span class="keyword">break</span>;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n*m;i++)<span class="keyword">if</span>(!dfn[i]&amp;&amp;fl[i])<span class="built_in">tarjan</span>(i);</span><br><span class="line">        <span class="keyword">for</span>(res x=<span class="number">1</span>;x&lt;=n*m;x++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!fl[x])<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> tox:G[x])&#123;</span><br><span class="line">                <span class="keyword">if</span>(sig[tox]==sig[x])<span class="keyword">continue</span>;</span><br><span class="line">                E[sig[x]].<span class="built_in">pb</span>(sig[tox]),du[sig[tox]]++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)<span class="keyword">if</span>(a[i])<span class="built_in">Dfs</span>(sig[A[i]]);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(jud[sig[A[i]]]||!a[i]||mx[sig[A[i]]])<span class="keyword">continue</span>;</span><br><span class="line">            mn[sig[A[i]]]=mx[sig[A[i]]]=++Mpx;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=nw;i++)<span class="keyword">if</span>(!du[i])<span class="built_in">dfs</span>(i),seg[++tot]=<span class="built_in">mp</span>(mn[i],mx[i]);</span><br><span class="line">        <span class="built_in">sort</span>(seg+<span class="number">1</span>,seg+tot+<span class="number">1</span>);</span><br><span class="line">        res ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>,rm=<span class="number">0</span>,rf=<span class="number">0</span>,j=<span class="number">1</span>;i&lt;=Mpx;i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(j&lt;=tot&amp;&amp;seg[j].fi&lt;=i)rf=<span class="built_in">max</span>(rf,seg[j].se),j++;</span><br><span class="line">            <span class="keyword">if</span>(i&gt;rm)ans++,rm=rf;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h4 id="CF1534-G"><a href="#CF1534-G" class="headerlink" title="[CF1534 G]"></a>[CF1534 G]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：你在一个二维平面直角坐标系的原点 $(0,0)$ 上，你可以向上或向右移动 $1$ 单位长度任意次。<br>现在给你 $n$ 个点，第 $i$ 个点为 $(x_i,y_i)$。你需要对这 $n$ 个点都打上标记。具体的，在任意时刻，如果你在点 $(X,Y)$ 并希望对点 $(x,y)$ 打标记，你需要花费 $\max(|X-x|,|Y-y|)$ 单位能量。<br>求最少花费多少单位能量。</p>
<p>做法：一种叫 Slope trick 的做法。</p>
<p>先考虑一个简单的事实，一个点到一条路径的切比雪夫距离最小肯定是经过这个点的斜率为 $-1$ 的直线与路径的交点间的距离。这个性质过于显然，就不证了。</p>
<p>有这样的事实后，考虑将点以 $x+y$ 为序排列好。这样的话，一条路径总会按序经过每个点所在的斜率为 $-1$ 的直线。于是做一个暴力的 dp，即设 $f_{i,x}$ 为当前 dp到第 $i$ 个点，当前横坐标为 $x$ 的最小代价。转移式容易写出 $f_{i,x}=|x-x_i|+\min_{x’\in [x-(x_i+y_i-x_{i-1}-y_{i-1}),x]}f_{i-1,x’}$。接下来我们考虑 $f_i$  以第二维作为横坐标时的图像。我们可以有一个结论：已知 $f(x)$ 为定义域为 $R$ 且连续的函数，令 $g(x)=\min_{x’\in [x-x_0,x+x_0]} f(x’)$，其中 $x_0$ 为一定值，则 $g(x)$ 为连续函数。这个证明省略，感兴趣可以咨询笔者 QQ。又因为 $|x-x_i|$是下凸函数，而下凸函数与下凸函数的和还是下凸函数（因为 $(f’’(x)&lt;0)+(g’’(x)&lt;0)&lt;0)$），所以可以归纳证明 $f_i$ 也为下凸函数。接下来我们考虑维护这个下凸壳。取 $\min$ 操作等于将 $f_i$ 的最低点向右拉长 $x_i+y_i-x_{i-1}-y_{i-1}$ 的距离，右部分同时平移，其余不变。至于加入一个 $|x-x_i|$ 我们可以做这样一件事，定义一个有序可重集中的一个元素表示当前凸壳在此处斜率减少了 $1$。于是我们只需维护这个可重集，就可以维护好 $|x-x_i|$ 了。</p>
<p>具体实现上，我们每次加入一个点分三类讨论，若当前 $x_i$ 在最低点左边/最低点/最低点右边。在其左时，$x_i$ 的左边斜率都减一，而右边都加一，等于在 $x_i$ 的位置减少了 $2$，所以我们朝左部分可重集加入两个 $x_i$，同时最左边的最低点此时已经不再是最低点，所以将其放入右部分可重集里。放入右部分可重集时要注意我们打了全局的右部分平移量标记，可以放入前要先减去此标记，不然拿出来时就不是真实值了。其余情况同理维护一下。此时 $i$ 的贡献就是离它最近的最低点的贡献。</p>
<p>时间复杂度 $O(n\log n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.7.10 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">8e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    Pair a[N];</span><br><span class="line">    LL ans;</span><br><span class="line">    priority_queue&lt;<span class="keyword">int</span>&gt; L;</span><br><span class="line">    priority_queue&lt;<span class="keyword">int</span>,vector&lt;<span class="keyword">int</span>&gt;,greater&lt;<span class="keyword">int</span>&gt; &gt; R;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>(),y=<span class="built_in">read</span>();</span><br><span class="line">            a[i].fi=x+y,a[i].se=x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(a+<span class="number">1</span>,a+n+<span class="number">1</span>),L.<span class="built_in">push</span>(a[<span class="number">1</span>].se),R.<span class="built_in">push</span>(a[<span class="number">1</span>].se);</span><br><span class="line">        res tagr=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            tagr+=a[i].fi-a[i<span class="number">-1</span>].fi;</span><br><span class="line">            res l=L.<span class="built_in">top</span>(),r=R.<span class="built_in">top</span>()+tagr,x=a[i].se;</span><br><span class="line">            <span class="keyword">if</span>(x&lt;l)L.<span class="built_in">pop</span>(),R.<span class="built_in">push</span>(l-tagr),L.<span class="built_in">push</span>(x),L.<span class="built_in">push</span>(x),ans+=l-x;</span><br><span class="line">            <span class="keyword">if</span>(x&gt;r)R.<span class="built_in">pop</span>(),L.<span class="built_in">push</span>(r),R.<span class="built_in">push</span>(x-tagr),R.<span class="built_in">push</span>(x-tagr),ans+=x-r;</span><br><span class="line">            <span class="keyword">if</span>(l&lt;=x&amp;&amp;x&lt;=r)L.<span class="built_in">push</span>(x),R.<span class="built_in">push</span>(x-tagr);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h4 id="CF1534-H"><a href="#CF1534-H" class="headerlink" title="[CF1534 H]"></a>[CF1534 H]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：交互。$n$ 个点的树，需要你猜出这棵树上的两个特殊节点 $a,b$。首先，会告诉你一个整数 $f$，满足 $f$ 在 $a,b$ 的路径上。接下来你可以进行询问，具体的，每次给定整数 $r$，交互器会给你当树的根节点为 $r$ 时，节点 $a,b$ 的最近公共祖先是哪个节点。特别地，在给定树的形态之后，你需要先给出在所有 $a,b,f$ 的可能的取值中，至少需要多少次询问才能保证得出特殊节点的编号。</p>
<p>做法：经典两个相似名称的函数调用了，在 <code>split_sz</code> 中调用了 <code>split</code>，调了我两个小时。</p>
<p>先思考它交互器返回的是什么，其实就是点 $r$ 到 $a,b$ 路径上的最近点。那以它为根就不重要了，我们考虑以 $f$ 为根。</p>
<p>我们询问 $x$ 的一个儿子 $y$，若返回的是 $x$，说明 $x$ 在 $a,b$ 的路径上，而 $y$ 不在；若返回的是 $y$，那么 $x,y$ 在 $a,b$ 的路径上；若返回的是 $x$ 的祖先，说明 $x,y$ 都不在路径上，而返回的那个点在。于是我们可以设计出一个交互步骤，递归入树，先询问叶子，如果叶子在路径上那它一定是一个端点，否则一直到叶子返回的那个点前都不是路径上点，而在叶子返回的那个点再往另一边递归，如果都返回它那它就是端点，否则在另外一边递归时就会找到（类似第一次的情况），于是我们就能找到两个端点了。</p>
<p>但这存在一个问题，交互次数的问题，它要求我们按最小交互次数输出，这该怎么办呢？</p>
<p>我们再重新考虑最小次数是多少。设 $f_x$ 为知道 $x$ 的子树中有无端点（若有，需要知道位置）的最少询问次数。根据上述思考，我们每次询问只会是叶子，于是考虑当前询问了 $x$ 的儿子 $y$ 子树中的一个叶子 $r$。若它返回是 $x$，除非它是 $x$ 的分支中最后一次询问的了，不然这次操作不能确定端点位置，而这次询问就不会被 $f_y$ 涵盖。若它返回的不是 $x$，那么意味着端点在 $y$ 的子树内，说明通过对 $y$ 子树的询问就可以让我们知道端点的位置，与 $x$ 已经无关了，而且这次询问已经被 $f_y$ 所涵盖。</p>
<p>我们利用这东西转移，最坏情况肯定是想要前面若干次询问都是无效的（无效就不会让我们递归入子树），直到当前有效是最大的才好。数字化表示，就是 $f_x=\max_{i=0}^{t-1} f_y+i$。而我们想要 $f_x$ 最小，那么贪心地想，肯定要 $f_y$ 从大到小排好，这样转移肯定是最优的。维护这个转移我们使用平衡树，每次插入一个新的数就让比小的数的权值加一，那么维护的就是权值最大了。</p>
<p>它题目要求我们输出所有的 $f$ 的情况，发现这个东西可以做换根 $\mathrm{dp}$，于是就可以做了。时间复杂度 $O(n\log n)$。</p>
<p>最终要求出两个端点，那我们考虑枚举 $f$ 的两个儿子，分别计算它们确定端点的最小次数，即 $\max_{0\leq i&lt;j&lt;t} j-1+f_{y}+f_{y’}$。</p>
<p>这个东西也是可以贪心地，想要最小，可以发现也是按 $f_y$ 从大到小的顺序，$f_x$ 换根 $\mathrm{dp}$ 可以维护，于是就求出了答案。</p>
<p>而如何交互的问题也迎刃而解了，是从最大的 $f_y$ 开始交互即可。</p>
<p>坑：1. 因为有两个 <code>split</code>，我一手贱就混用了，调了好久。</p>
<ol>
<li>大小顺序容易写错，注意一下。</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.9.6 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; G[N];</span><br><span class="line">    <span class="keyword">int</span> f[N];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Treap</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> mx,son[<span class="number">2</span>],val,laz,sz,va,pri;</span><br><span class="line">    &#125;tr[N*<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">int</span> rt[N],tot,st[N*<span class="number">3</span>],top;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">const</span> res &amp;va,<span class="keyword">const</span> res &amp;val)</span></span>&#123;</span><br><span class="line">        res cur=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(top)cur=st[top--];</span><br><span class="line">        <span class="keyword">else</span> cur=++tot;</span><br><span class="line">        tr[cur].va=va,tr[cur].mx=tr[cur].val=val,tr[cur].sz=<span class="number">1</span>,tr[cur].pri=<span class="built_in">rng</span>(),tr[cur].son[<span class="number">0</span>]=tr[cur].son[<span class="number">1</span>]=tr[cur].laz=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> cur;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">const</span> res &amp;x,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!x)<span class="keyword">return</span>;</span><br><span class="line">        tr[x].mx+=v,tr[x].val+=v,tr[x].laz+=v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">const</span> res &amp;x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!tr[x].laz||!x)<span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">change</span>(tr[x].son[<span class="number">0</span>],tr[x].laz),<span class="built_in">change</span>(tr[x].son[<span class="number">1</span>],tr[x].laz),tr[x].laz=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">const</span> res &amp;x)</span></span>&#123;</span><br><span class="line">        tr[x].mx=<span class="built_in">max</span>(&#123;tr[tr[x].son[<span class="number">0</span>]].mx,tr[tr[x].son[<span class="number">1</span>]].mx,tr[x].val&#125;);</span><br><span class="line">        tr[x].sz=tr[tr[x].son[<span class="number">0</span>]].sz+tr[tr[x].son[<span class="number">1</span>]].sz+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">merge</span><span class="params">(res x,res y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!x||!y)<span class="keyword">return</span> x|y;</span><br><span class="line">        <span class="built_in">pushdown</span>(x),<span class="built_in">pushdown</span>(y);</span><br><span class="line">        <span class="keyword">if</span>(tr[x].pri&lt;tr[y].pri)&#123;</span><br><span class="line">            tr[x].son[<span class="number">1</span>]=<span class="built_in">merge</span>(tr[x].son[<span class="number">1</span>],y);</span><br><span class="line">            <span class="built_in">pushup</span>(x);</span><br><span class="line">            <span class="keyword">return</span> x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            tr[y].son[<span class="number">0</span>]=<span class="built_in">merge</span>(x,tr[y].son[<span class="number">0</span>]);</span><br><span class="line">            <span class="built_in">pushup</span>(y);</span><br><span class="line">            <span class="keyword">return</span> y;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">split</span><span class="params">(res now,res k,res &amp;x,res &amp;y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!now)&#123;x=y=<span class="number">0</span>;<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="built_in">pushdown</span>(now);</span><br><span class="line">        <span class="keyword">if</span>(tr[now].va&lt;=k)x=now,<span class="built_in">split</span>(tr[now].son[<span class="number">1</span>],k,tr[now].son[<span class="number">1</span>],y);</span><br><span class="line">        <span class="keyword">else</span> y=now,<span class="built_in">split</span>(tr[now].son[<span class="number">0</span>],k,x,tr[now].son[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">pushup</span>(now);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">split_sz</span><span class="params">(res now,res k,res &amp;x,res &amp;y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!now)&#123;x=y=<span class="number">0</span>;<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="built_in">pushdown</span>(now);</span><br><span class="line">        <span class="keyword">if</span>(tr[tr[now].son[<span class="number">0</span>]].sz&lt;k)x=now,<span class="built_in">split_sz</span>(tr[now].son[<span class="number">1</span>],k-tr[tr[now].son[<span class="number">0</span>]].sz<span class="number">-1</span>,tr[now].son[<span class="number">1</span>],y);</span><br><span class="line">        <span class="keyword">else</span> y=now,<span class="built_in">split_sz</span>(tr[now].son[<span class="number">0</span>],k,x,tr[now].son[<span class="number">0</span>]);</span><br><span class="line">        <span class="built_in">pushup</span>(now);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(res &amp;RT,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        res a,b;</span><br><span class="line">        <span class="built_in">split</span>(RT,v,a,b),<span class="built_in">change</span>(a,<span class="number">1</span>),RT=<span class="built_in">merge</span>(<span class="built_in">merge</span>(a,<span class="built_in">newnode</span>(v,v+tr[b].sz)),b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(res x,res fax)</span></span>&#123;</span><br><span class="line">        rt[x]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> tox:G[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(tox==fax)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="built_in">dfs</span>(tox,x),<span class="built_in">insert</span>(rt[x],f[tox]);</span><br><span class="line">        &#125;</span><br><span class="line">        f[x]=<span class="built_in">max</span>(<span class="number">1</span>,tr[rt[x]].mx);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">erase</span><span class="params">(res &amp;RT,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        res a,b,c,d;</span><br><span class="line">        <span class="built_in">split</span>(RT,v,a,b),<span class="built_in">split_sz</span>(a,tr[a].sz<span class="number">-1</span>,c,d);</span><br><span class="line">        <span class="keyword">if</span>(d)st[++top]=d;</span><br><span class="line">        <span class="built_in">change</span>(c,<span class="number">-1</span>),RT=<span class="built_in">merge</span>(c,b);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">(res &amp;RT)</span></span>&#123;</span><br><span class="line">        res a,b,ret=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">split_sz</span>(RT,tr[RT].sz<span class="number">-1</span>,a,b),ret=tr[b].va<span class="number">-1</span>+<span class="built_in">max</span>(<span class="number">1</span>,tr[a].mx);</span><br><span class="line">        RT=<span class="built_in">merge</span>(a,b);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Dfs</span><span class="params">(res x,res fax)</span></span>&#123;</span><br><span class="line">        ans=<span class="built_in">max</span>(ans,<span class="built_in">get</span>(rt[x]));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> tox:G[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(tox==fax)<span class="keyword">continue</span>;</span><br><span class="line">            res F=f[x],G=f[tox];</span><br><span class="line">            <span class="built_in">erase</span>(rt[x],f[tox]),f[x]=<span class="built_in">max</span>(<span class="number">1</span>,tr[rt[x]].mx);</span><br><span class="line">            <span class="built_in">insert</span>(rt[tox],f[x]),f[tox]=<span class="built_in">max</span>(<span class="number">1</span>,tr[rt[tox]].mx);</span><br><span class="line">            <span class="built_in">Dfs</span>(tox,x),f[x]=F,f[tox]=G,<span class="built_in">insert</span>(rt[x],f[tox]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> res &amp;x,<span class="keyword">const</span> res &amp;y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> f[x]&gt;f[y];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> Ans[<span class="number">2</span>],Ansx;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">ask</span><span class="params">(<span class="keyword">const</span> res &amp;x)</span></span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;? %d\n&quot;</span>,x),<span class="built_in">fflush</span>(stdout);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">read</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(res x,res fax)</span></span>&#123;</span><br><span class="line">        <span class="built_in">sort</span>(G[x].<span class="built_in">begin</span>(),G[x].<span class="built_in">end</span>(),cmp);</span><br><span class="line">        res r=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> tox:G[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(tox==fax)<span class="keyword">continue</span>;</span><br><span class="line">            res ret=<span class="built_in">get</span>(tox,x);</span><br><span class="line">            <span class="keyword">if</span>(x!=ret)<span class="keyword">return</span> ret;</span><br><span class="line">            r=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!r)<span class="keyword">return</span> <span class="built_in">ask</span>(x);</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">            res u=<span class="built_in">read</span>(),v=<span class="built_in">read</span>();</span><br><span class="line">            G[u].<span class="built_in">pb</span>(v),G[v].<span class="built_in">pb</span>(u);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">0</span>),<span class="built_in">Dfs</span>(<span class="number">1</span>,<span class="number">0</span>),<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans),<span class="built_in">fflush</span>(stdout),tot=top=<span class="number">0</span>;</span><br><span class="line">        res f=<span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">dfs</span>(f,<span class="number">0</span>),<span class="built_in">sort</span>(G[f].<span class="built_in">begin</span>(),G[f].<span class="built_in">end</span>(),cmp);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> tox:G[f])&#123;</span><br><span class="line">            res tmp=<span class="built_in">get</span>(tox,f);</span><br><span class="line">            <span class="keyword">if</span>(tmp==f)<span class="keyword">continue</span>;</span><br><span class="line">            Ans[Ansx++]=tmp;</span><br><span class="line">            <span class="keyword">if</span>(Ansx==<span class="number">2</span>)<span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!Ans[<span class="number">0</span>])Ans[<span class="number">0</span>]=f;</span><br><span class="line">        <span class="keyword">if</span>(!Ans[<span class="number">1</span>])Ans[<span class="number">1</span>]=f;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;! %d %d\n&quot;</span>,Ans[<span class="number">0</span>],Ans[<span class="number">1</span>]),<span class="built_in">fflush</span>(stdout);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF1537"><a href="#CF1537" class="headerlink" title="[CF1537]"></a>[CF1537]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>summary</span></div>
    <div class="hide-content"><p>实况：C 都想歪了，构造半天搞出怪的东西，导致 D 开始梦游。幸亏最后看眼 E2 发现后缀数组可以艹过去，不然就无了。</p>
</div></div>
<h4 id="CF1537-D"><a href="#CF1537-D" class="headerlink" title="[CF1537 D]"></a>[CF1537 D]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有一个正整数 $n$ ，现 A 和 B 每次可以让 $n$ 减去它当前的一个因数，不能减去 $1$ 和 $n$ ，谁先不能减谁输。问最后谁赢。</p>
<p>做法：先利用 sg​ 函数打个表，容易发现当 $n$ 是奇数以及 $n=2^w$ 且 $w$ 为奇数时，先手必输。下面证明这个结论正确。</p>
<ol>
<li>当 $n$ 不是 $2^w$ 时，</li>
</ol>
<p>当 $n$ 是偶数但不是 $2^w$ 时，此时 $n$ 必然存在一个奇数因数，因此可让 $n$ 变成一个奇数。</p>
<p>当 $n$ 是奇数时，此时 $n$ 只有奇数因数，于是只能让 $n$ 变成一个偶数。</p>
<p>又因为最终停止只能是质数，而除了 $2$ 以外的质数都是奇数，同时 $n$ 不可能减到 $2$（因为 $n-2 \nmid n$），于是只能减到一个奇质数。而减到奇质数时，$n$ 显然是个偶数，因此 $n$ 是奇数时先手必输。</p>
<ol>
<li>当 $n$ 是 $2^w$ 时，</li>
</ol>
<p>若减去的数不是 $2^{w-1}$，则会转换为 $1$ 中情况，则先手必输。</p>
<p>若减去的数是 $2^{w-1}$，则对手也只能减去 $2^{w-2}$，以此类推，则 $w$ 为奇数时先手必输。</p>
<p>综上，得证。</p>
<p>复杂度 $O(\log n)$。</p>
<p>代码有带打表的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.6.21 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> pw[<span class="number">30</span>+<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">int</span> sg[<span class="number">100</span>+<span class="number">10</span>];</span><br><span class="line">    <span class="keyword">bool</span> vis[<span class="number">100</span>+<span class="number">10</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res T=<span class="built_in">read</span>();</span><br><span class="line">        pw[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">30</span>;i++)pw[i]=pw[i<span class="number">-1</span>]&lt;&lt;<span class="number">1</span>;</span><br><span class="line">        sg[<span class="number">1</span>]=sg[<span class="number">2</span>]=sg[<span class="number">3</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">4</span>;i&lt;=<span class="number">100</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=<span class="number">100</span>;j++)vis[j]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">2</span>,sz=<span class="built_in"><span class="keyword">int</span></span>(<span class="built_in">sqrt</span>(i));j&lt;=sz;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i%j==<span class="number">0</span>)vis[sg[i-j]]=vis[sg[i-(i/j)]]=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=<span class="number">100</span>;j++)<span class="keyword">if</span>(!vis[j])&#123;sg[i]=j;<span class="keyword">break</span>;&#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//        for(res i=1;i&lt;=20;i++)printf(&quot;%d %d\n&quot;,sg[i],i);</span></span><br><span class="line">        <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">            res n=<span class="built_in">read</span>();</span><br><span class="line">            RG <span class="keyword">bool</span> fl=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">30</span>;i++)<span class="keyword">if</span>(n==pw[i])&#123;<span class="built_in">puts</span>(i&amp;<span class="number">1</span>?<span class="string">&quot;Bob&quot;</span>:<span class="string">&quot;Alice&quot;</span>),fl=<span class="number">1</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">            <span class="keyword">if</span>(fl)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(n&amp;<span class="number">1</span>)<span class="built_in">puts</span>(<span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h4 id="CF1537-E"><a href="#CF1537-E" class="headerlink" title="[CF1537 E]"></a>[CF1537 E]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给出一个字符串 $s$，现有两种操作：</p>
<ol>
<li>删去字符串的最后一位</li>
<li>循环倍长字符串</li>
</ol>
<p>现想将 $s$ 变成字典序最小的长度为 $k$ 的字符串，输出最终串。</p>
<p>做法：先倍长 $s$ 以去掉不当情况，那么最终串一定是从前往后找一个位置使得当前位置的后缀大于开头位置的后缀即可，从这个位置开始删除容易证明是最优的。这里可以用 kmp 或者后缀数组等实现。</p>
<p>复杂度 $O(n)$ 或 $O(n\log n)$。</p>
<p>代码是后缀数组的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.6.18 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">char</span> str[N],s[N];</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> rnk[N],buc[N],sa[N],hei[N],fi[N],se[N],m;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">get_SA</span><span class="params">()</span></span>&#123;</span><br><span class="line">        m=<span class="number">10000</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)buc[fi[i]=str[i]]++;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=m;i++)buc[i]+=buc[i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span>(res i=n;i;i--)sa[buc[fi[i]]--]=i;</span><br><span class="line">        <span class="keyword">for</span>(res k=<span class="number">1</span>;k&lt;=n;k&lt;&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">            res num=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=n-k+<span class="number">1</span>;i&lt;=n;i++)se[++num]=i;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(sa[i]&gt;k)se[++num]=sa[i]-k;</span><br><span class="line">            <span class="built_in">memset</span>(buc,<span class="number">0</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(buc));</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)buc[fi[i]]++;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=m;i++)buc[i]+=buc[i<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">for</span>(res i=n;i;i--)sa[buc[fi[se[i]]]--]=se[i],se[i]=<span class="number">0</span>;</span><br><span class="line">            <span class="built_in">swap</span>(fi,se);</span><br><span class="line">            fi[sa[<span class="number">1</span>]]=<span class="number">1</span>;</span><br><span class="line">            num=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)fi[sa[i]]=(se[sa[i]]==se[sa[i<span class="number">-1</span>]]&amp;&amp;se[sa[i]+k]==se[sa[i<span class="number">-1</span>]+k])?num:++num;</span><br><span class="line">            <span class="keyword">if</span>(num==n)<span class="keyword">break</span>;</span><br><span class="line">            m=num;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">get_hei</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res k=<span class="number">0</span>;</span><br><span class="line">        rnk[sa[<span class="number">1</span>]]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)rnk[sa[i]]=rnk[sa[i<span class="number">-1</span>]]+(fi[sa[i]]!=fi[sa[i<span class="number">-1</span>]]||se[sa[i]]!=se[sa[i<span class="number">-1</span>]]);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(rnk[i]==<span class="number">1</span>)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(k)k--;</span><br><span class="line">            res j=sa[rnk[i]<span class="number">-1</span>];</span><br><span class="line">            <span class="keyword">while</span>(j+k&lt;=n&amp;&amp;i+k&lt;=n&amp;&amp;str[i+k]==str[j+k])k++;</span><br><span class="line">            hei[rnk[i]]=k;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> st[N][<span class="number">21</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">PRE</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)st[i][<span class="number">0</span>]=hei[i];</span><br><span class="line">        <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=<span class="number">20</span>;j++)</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i+(<span class="number">1</span>&lt;&lt;j)<span class="number">-1</span>&lt;=n;i++)</span><br><span class="line">                st[i][j]=<span class="built_in">min</span>(st[i][j<span class="number">-1</span>],st[i+(<span class="number">1</span>&lt;&lt;(j<span class="number">-1</span>))][j<span class="number">-1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> Lg[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query_min</span><span class="params">(res l,res r)</span></span>&#123;</span><br><span class="line">        res k=Lg[r-l];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(st[l][k],st[r-(<span class="number">1</span>&lt;&lt;k)+<span class="number">1</span>][k]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">LCP</span><span class="params">(<span class="keyword">const</span> res &amp;l,<span class="keyword">const</span> res &amp;r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l==r)<span class="keyword">return</span> n-l+<span class="number">1</span>;</span><br><span class="line">        res x=rnk[l],y=rnk[r];</span><br><span class="line">        <span class="keyword">if</span>(x&gt;y)<span class="built_in">swap</span>(x,y);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query_min</span>(x+<span class="number">1</span>,y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pre</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">get_SA</span>(),<span class="built_in">get_hei</span>(),<span class="built_in">PRE</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> k;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),k=<span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(res i=n+<span class="number">1</span>;i&lt;=<span class="number">2</span>*n;i++)str[i]=str[i-n];</span><br><span class="line">        n=<span class="number">2</span>*n;</span><br><span class="line">        str[n+<span class="number">1</span>]=<span class="number">26</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)Lg[i]=Lg[i&gt;&gt;<span class="number">1</span>]+<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">pre</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(str[i]&gt;str[<span class="number">1</span>])&#123;</span><br><span class="line">                n=i<span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            RG <span class="keyword">int</span> fl=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(str[i]==str[<span class="number">1</span>])&#123;</span><br><span class="line">                res t=<span class="built_in">LCP</span>(<span class="number">1</span>,i);</span><br><span class="line">                <span class="keyword">if</span>(t&gt;=i<span class="number">-1</span>);</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(str[t+<span class="number">1</span>]&lt;str[t+i])&#123;n=i<span class="number">-1</span>;fl=<span class="number">1</span>;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(fl)<span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res j=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=k;i++)&#123;</span><br><span class="line">            <span class="built_in">putchar</span>(str[j]);</span><br><span class="line">            j=j+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(j==n+<span class="number">1</span>)j=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h4 id="CF1537-F"><a href="#CF1537-F" class="headerlink" title="[CF1537 F]"></a>[CF1537 F]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有一张无向连通图，每个点具有一个点权。现可将一条边连接的两个点的点权同时加或减 $1$，问能否让所有点的点权都变为 $0$？</p>
<p>做法：</p>
<p>性质：若两点距离为偶数，则可一加一减同样的数；若两点距离为奇数，则可同时加减一个数。</p>
<ol>
<li>有奇环。</li>
</ol>
<p>当一张连通图有奇环，可以证明每个点要么在一个奇环上，要么不在环上（因为若一个点在偶环上，必然可以连接至一个奇环使得这个点在这个大奇环上）。</p>
<p>因此考虑将非环上的点按照拓扑序改变点权至 $0$，这样的改变是唯一的。于是只剩下一堆环上以及连接环和环的点了。</p>
<p>容易发现对一个奇环绕一圈加减相同的数时，最终的结果是可以使一个点加减 $2$。经过这样多次操作，可以使每个点的点权为 $1$ 或 $0$ 或 $-1$。现考虑将点权不为 $0$ 的点两两匹配，根据性质，则当不为 $0$ 的点个数为偶数时，必然可使所有点点权为 $0$。若不为偶数，由于每次改变点权不会改变总和的奇偶，于是显然无解。</p>
<ol>
<li>无奇环。</li>
</ol>
<p>当一张连通图无奇环上，这张图则为二分图。</p>
<p>我们先考虑一个基础的四元环，容易发现此时有解是对角线之和相同的充要条件。放在二分图上，则是两部分分别的和相同。</p>
<p>现考虑一张二分图，同上般的去除一些点，剩下的只是一堆环上以及连接环和环的点了。通过改变连接环和环的点的点权，容易证明这可以让每个环两边的点权和都相同（因为在二分图上的改变并不影响两边点权和之差）。再根据四元环时的构造，则可以轻松证明二分图两部分分别的和相同是有解的充要条件了。</p>
<p>时间复杂度 $O(n+m)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.6.22 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    <span class="keyword">int</span> col[N];</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; G[N];</span><br><span class="line">    <span class="keyword">bool</span> vis[N];</span><br><span class="line">    <span class="keyword">bool</span> ok;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(res x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> tox:G[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(ok)<span class="keyword">return</span>;</span><br><span class="line">            <span class="keyword">if</span>(vis[tox])&#123;</span><br><span class="line">                <span class="keyword">if</span>(col[tox]==col[x])&#123;ok=<span class="number">1</span>;<span class="keyword">return</span>;&#125;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            vis[tox]=<span class="number">1</span>,col[tox]=col[x]^<span class="number">1</span>,<span class="built_in">dfs</span>(tox);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res T=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">            n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>(),ok=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>(),vis[i]=col[i]=<span class="number">0</span>,G[i].<span class="built_in">clear</span>();</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]-=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">                res u=<span class="built_in">read</span>(),v=<span class="built_in">read</span>();</span><br><span class="line">                G[u].<span class="built_in">pb</span>(v),G[v].<span class="built_in">pb</span>(u);</span><br><span class="line">            &#125;</span><br><span class="line">            vis[<span class="number">1</span>]=<span class="number">1</span>,<span class="built_in">dfs</span>(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">if</span>(ok)&#123;</span><br><span class="line">                RG LL sum=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)sum+=a[i];</span><br><span class="line">                <span class="keyword">if</span>(sum&amp;<span class="number">1</span>)<span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">                <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                RG LL s0=<span class="number">0</span>,s1=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(!col[i])s0+=a[i];<span class="keyword">else</span> s1+=a[i];</span><br><span class="line">                <span class="keyword">if</span>(s0==s1)<span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">                <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="牛客挑战赛51"><a href="#牛客挑战赛51" class="headerlink" title="[牛客挑战赛51]"></a>[牛客挑战赛51]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>summary</span></div>
    <div class="hide-content"><p>实况：我是 口 胡 王！（并查集写错，LCT 写不动，瘫痪了）（随机开题也挺怪的）</p>
</div></div>
<h4 id="牛客挑战赛51-C"><a href="#牛客挑战赛51-C" class="headerlink" title="[牛客挑战赛51 C]"></a>[牛客挑战赛51 C]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给你一个正整数 $x$ ，求第 $k$ 小的正整数 $y$ 满足 $x \leq y$ 且 $y$ 是一个回文数。</p>
<p>做法：考虑求 $0$ 到 $n$ 之间的回文数的个数，直接数位 dp。$f(i,j,0/1)$ 表示总长为 $i$，当前到了第 $j$ 位，有无上界限制的回文数个数。每次二分 $n$，暴力转移一下即可。总时间复杂度 $O(18\ast 18\ast 2\ast 10\ast \log n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.7.13 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    LL x;</span><br><span class="line">    <span class="keyword">int</span> k;</span><br><span class="line">    <span class="keyword">int</span> a[<span class="number">20</span>];</span><br><span class="line">    <span class="keyword">int</span> f[<span class="number">20</span>][<span class="number">20</span>][<span class="number">2</span>],now[<span class="number">20</span>];</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">dp</span><span class="params">(res len,res cur,res lim)</span></span>&#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> g f[len][cur][lim]</span></span><br><span class="line">        <span class="keyword">if</span>(!cur)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(~g)<span class="keyword">return</span> g;</span><br><span class="line">        res ret=<span class="number">0</span>,lm=lim?<span class="number">9</span>:a[cur];</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=lm;i++)&#123;</span><br><span class="line">            now[cur]=i;</span><br><span class="line">            <span class="keyword">if</span>(len==cur&amp;&amp;!i)ret+=<span class="built_in">dp</span>(len<span class="number">-1</span>,cur<span class="number">-1</span>,lim|(i!=lm));</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(cur&lt;=(len+<span class="number">1</span>)/<span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(now[len-cur+<span class="number">1</span>]==i)ret+=<span class="built_in">dp</span>(len,cur<span class="number">-1</span>,lim|(i!=lm));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> ret+=<span class="built_in">dp</span>(len,cur<span class="number">-1</span>,lim|(i!=lm));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> g=ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">solve</span><span class="params">(RG LL n)</span></span>&#123;</span><br><span class="line">        <span class="built_in">memset</span>(f,<span class="number">-1</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(f));</span><br><span class="line">        res ax=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(n)a[++ax]=<span class="built_in"><span class="keyword">int</span></span>(n%<span class="number">10</span>),n/=<span class="number">10</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">dp</span>(ax,ax,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        x=<span class="built_in">Read</span>(),k=<span class="built_in">read</span>();</span><br><span class="line">        RG LL o=<span class="built_in">solve</span>(x<span class="number">-1</span>);</span><br><span class="line">        RG LL l=<span class="number">0</span>,r=(LL)<span class="number">1e18</span>,ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;=r)&#123;</span><br><span class="line">            RG LL mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">solve</span>(mid)-o&gt;=k)r=mid<span class="number">-1</span>,ret=mid;</span><br><span class="line">            <span class="keyword">else</span> l=mid+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ret);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h4 id="牛客挑战赛51-D"><a href="#牛客挑战赛51-D" class="headerlink" title="[牛客挑战赛51 D]"></a>[牛客挑战赛51 D]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：中文题面建议自己看。</p>
<p>做法：注意到贡献是独立的，所以没必要纠结长度为 $m$ 中有多少个模式串，而只用算模式串总共出现了多少次。考虑枚举模式串头的位置，那么接下来 $n$ 个位置被固定，其他位置看限制任意填。发现这些都可以直接维护。没啥细节，比标算的矩阵快速幂正常了一万倍。时间复杂度 $O(nk\sigma\log)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.12.27 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">500</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m,k;</span><br><span class="line">    <span class="keyword">char</span> str[N];</span><br><span class="line">    map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; fl;</span><br><span class="line">    map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; F;</span><br><span class="line">    map&lt;Pair,<span class="keyword">int</span>&gt; ban;</span><br><span class="line">    map&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; G;</span><br><span class="line">    <span class="keyword">int</span> q[N];</span><br><span class="line">    <span class="keyword">int</span> inv[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>(),k=<span class="built_in">read</span>(),<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str+<span class="number">1</span>),inv[<span class="number">0</span>]=inv[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=<span class="number">26</span>;i++)inv[i]=<span class="built_in">mul</span>(inv[kcz%i],kcz-kcz/i);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=k;i++)&#123;</span><br><span class="line">            res op=<span class="built_in">read</span>(),x=<span class="built_in">read</span>(),ch=<span class="built_in">gc</span>();</span><br><span class="line">            <span class="keyword">while</span>(ch&lt;<span class="string">&#x27;a&#x27;</span>||ch&gt;<span class="string">&#x27;z&#x27;</span>)ch=<span class="built_in">gc</span>();</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n&amp;&amp;x-j+<span class="number">1</span>&gt;=<span class="number">1</span>;j++)<span class="keyword">if</span>(x+n-j&lt;=m)F[x-j+<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(!op)&#123;</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n&amp;&amp;x-j+<span class="number">1</span>&gt;=<span class="number">1</span>;j++)<span class="keyword">if</span>(str[j]==ch&amp;&amp;x+n-j&lt;=m)fl[x-j+<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(ban[<span class="built_in">mp</span>(x,ch-<span class="string">&#x27;a&#x27;</span>)]==<span class="number">2</span>)&#123;<span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">                ban[<span class="built_in">mp</span>(x,ch-<span class="string">&#x27;a&#x27;</span>)]=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n&amp;&amp;x-j+<span class="number">1</span>&gt;=<span class="number">1</span>;j++)<span class="keyword">if</span>(str[j]!=ch&amp;&amp;x+n-j&lt;=m)fl[x-j+<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(ban[<span class="built_in">mp</span>(x,ch-<span class="string">&#x27;a&#x27;</span>)]==<span class="number">1</span>)&#123;<span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(j==ch-<span class="string">&#x27;a&#x27;</span>)<span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span>(ban[<span class="built_in">mp</span>(x,j)]==<span class="number">2</span>)&#123;<span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">                &#125;</span><br><span class="line">                ban[<span class="built_in">mp</span>(x,ch-<span class="string">&#x27;a&#x27;</span>)]=<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            q[i]=x;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(q+<span class="number">1</span>,q+k+<span class="number">1</span>),k=<span class="built_in"><span class="keyword">int</span></span>(<span class="built_in">unique</span>(q+<span class="number">1</span>,q+k+<span class="number">1</span>)-q<span class="number">-1</span>);</span><br><span class="line">        res ans=<span class="number">0</span>,sum=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=k;i++)&#123;</span><br><span class="line">            res o=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;<span class="number">26</span>;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(!ban[<span class="built_in">mp</span>(q[i],j)])o++;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(ban[<span class="built_in">mp</span>(q[i],j)]==<span class="number">2</span>)&#123;o=<span class="number">1</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(!o)&#123;<span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">            G[q[i]]=o;</span><br><span class="line">            sum=<span class="built_in">mul</span>(sum,o);</span><br><span class="line">        &#125;</span><br><span class="line">        sum=<span class="built_in">mul</span>(sum,<span class="built_in">qpow</span>(<span class="number">26</span>,m-k));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x:F)&#123;</span><br><span class="line">            <span class="keyword">if</span>(fl[x.fi])<span class="keyword">continue</span>;</span><br><span class="line">            res ret=sum;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">                res p=x.fi+i<span class="number">-1</span>;</span><br><span class="line">                <span class="keyword">if</span>(!G[p])ret=<span class="built_in">mul</span>(ret,inv[<span class="number">26</span>]);</span><br><span class="line">                <span class="keyword">else</span> ret=<span class="built_in">mul</span>(ret,inv[G[p]]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">add</span>(ans,ret);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">add</span>(ans,<span class="built_in">mul</span>(m-n+<span class="number">1</span>-<span class="built_in"><span class="keyword">int</span></span>(F.<span class="built_in">size</span>()),<span class="built_in">mul</span>(sum,<span class="built_in">qpow</span>(inv[<span class="number">26</span>],n))));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">mul</span>(ans,<span class="built_in">qpow</span>(sum)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h4 id="牛客挑战赛51-E-loj-2476"><a href="#牛客挑战赛51-E-loj-2476" class="headerlink" title="[牛客挑战赛51 E] [loj 2476]"></a>[牛客挑战赛51 E] [loj 2476]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给出 $A,B,C,D,E,F$ 数组，求 </p>
<script type="math/tex; mode=display">
\sum_{i=1}^n\sum_{j=1}^n\sum_{k=1}^nA_iB_jC_kD_{\gcd(i,j)}E_{\gcd(i,k)}F_{\gcd(k,j)}.</script><p>做法：</p>
<script type="math/tex; mode=display">
\sum_{i=1}^n\sum_{j=1}^n\sum_{k=1}^nA_iB_jC_kD_{\gcd(i,j)}E_{\gcd(i,k)}F_{\gcd(k,j)}\\\\
=\sum_{k=1}^n C_k\sum_{i=1}^n\sum_{j=1}^n A_iB_jD_{(i,j)} \sum_{p|(i,k)} (E\ast \mu)(p)\sum_{q|(k,j)} (F\ast \mu) (q)\\\\
=\sum_{\operatorname{lcm}(p,q)\leq n} (E\ast \mu)(p)(F\ast \mu)(q)(\sum_{k=1}^{\lfloor\frac{n}{\operatorname{lcm}(p,q)}\rfloor}C_k)\sum_{i=1}^{\lfloor\frac{n}{p}\rfloor}\sum_{j=1}^{\lfloor\frac{n}{q}\rfloor}A_{ip}B_{jq}D_{(ip,jq)}\\\\
=\sum_d \sum_{xyd\leq n,(x,y)=1} (E\ast \mu)(xd)(F\ast \mu)(yd) (\sum_{k=1}^{\lfloor\frac{n}{xyd}\rfloor}C_k)\sum_{i=1}^{\lfloor\frac{n}{xd}\rfloor}\sum_{j=1}^{\lfloor\frac{n}{yd}\rfloor} A_{ixd}B_{jyd}D_{d\cdot (ix,jy)}\\\\
而 \sum_{i=1}^{\lfloor\frac{n}{xd}\rfloor}\sum_{j=1}^{\lfloor\frac{n}{yd}\rfloor} A'_{ix}B'_{jy}D'_{(ix,jy)}\\\\
=\sum_{i=1}^{\lfloor\frac{n}{x}\rfloor}A'_{ix}\sum_{d'|ix} (D'\ast \mu) (d')\sum_{d'|jy,jy\leq n}B'_{jy}\\\\
=\sum_{x|z}A'_z\sum_{d'|z}(D'\ast \mu)(d')\sum_{d'|r}B'_r[y|r]</script><p>冷静一下，最后一条式子取 $x,y$ 较小值去做，而最后一条式子是 $\mathrm{Dirichlet}$ 前缀和，并且前面枚举 $(x,y,d)$ 实际并不高，于是总复杂度经过积分分析就是 $O(n\sqrt{n}\log\log n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.9.25 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">bool</span> vis[N];</span><br><span class="line">    <span class="keyword">int</span> prim[N],tot;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">F</span><span class="params">(RG ull *a,<span class="keyword">const</span> res &amp;n)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=i+i;j&lt;=n;j+=i)a[j]-=a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">G</span><span class="params">(RG ull *a,<span class="keyword">const</span> res &amp;n)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;prim[i]&lt;=n&amp;&amp;i&lt;=tot;i++)<span class="keyword">for</span>(res j=n/prim[i];j;j--)a[j]+=a[j*prim[i]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">H</span><span class="params">(RG ull *a,<span class="keyword">const</span> res &amp;n)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;prim[i]&lt;=n&amp;&amp;i&lt;=tot;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j*prim[i]&lt;=n;j++)a[j*prim[i]]+=a[j];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    ull a[N],b[N],c[N],d[N],e[N],f[N],p[N],q[N],r[N],s[N],t[N],w[N],u[N],v[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!vis[i])prim[++tot]=i;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=tot&amp;&amp;prim[j]*i&lt;=n;j++)&#123;</span><br><span class="line">                vis[prim[j]*i]=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">if</span>(i%prim[j]==<span class="number">0</span>)<span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">Read</span>(a[i]);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">Read</span>(b[i]);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">Read</span>(c[i]);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">Read</span>(d[i]);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">Read</span>(e[i]);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">Read</span>(f[i]);</span><br><span class="line">        RG ull ans=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">G</span>(c,n),<span class="built_in">F</span>(e,n),<span class="built_in">F</span>(f,n);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res m=n/i;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>,k=i;j&lt;=m;j++,k+=i)p[j]=e[k],q[j]=f[k],r[j]=c[k],s[j]=a[k],t[j]=b[k],w[j]=d[k];</span><br><span class="line">            <span class="built_in">F</span>(w,m);</span><br><span class="line">            <span class="keyword">for</span>(res x=<span class="number">1</span>;x*x&lt;=m;x++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=m;j++)u[j]=v[j]=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(res j=x;j&lt;=m;j+=x)u[j]=s[j],v[j]=t[j];</span><br><span class="line">                <span class="built_in">G</span>(u,m),<span class="built_in">G</span>(v,m);</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=m;j++)u[j]*=w[j],v[j]*=w[j];</span><br><span class="line">                <span class="built_in">H</span>(u,m),<span class="built_in">H</span>(v,m);</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=m;j++)u[j]*=t[j],v[j]*=s[j];</span><br><span class="line">                <span class="keyword">for</span>(res y=x;x*y&lt;=m;y++)</span><br><span class="line">                    <span class="keyword">if</span>(__gcd(x,y)==<span class="number">1</span>)&#123;</span><br><span class="line">                        RG ull g=<span class="number">0</span>,h=<span class="number">0</span>;</span><br><span class="line">                        <span class="keyword">for</span>(res j=y;j&lt;=m;j+=y)g+=u[j],h+=v[j];</span><br><span class="line">                        ans+=p[x]*q[y]*r[x*y]*g;</span><br><span class="line">                        <span class="keyword">if</span>(x!=y)ans+=p[y]*q[x]*r[x*y]*h;</span><br><span class="line">                    &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%llu\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h4 id="牛客挑战赛51-F"><a href="#牛客挑战赛51-F" class="headerlink" title="[牛客挑战赛51 F]"></a>[牛客挑战赛51 F]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：所有 $n$ 个点的有标号有根树的每个点深度的 $m$ 次方的和，令根的深度为 $1$ 。</p>
<p>做法：注意到贡献是独立的，所以没必要考虑一棵树的贡献量，可以选择按深度来分开来考虑。</p>
<p>考虑深度为 $x$ 的点的贡献，那我们就要算有这个点的树的数量。首先它深度为 $x$，所以存在一条从根到这个点的链，然后其它点随意插入到这条链上。似乎不太好算，我们强制根到这个点的点是 $n,…,n-x+1$，最后乘上 $\binom{n}{x}x!$。那么利用 $\mathrm{prufer}$ 序列，就等价于后 $x-2$ 个是固定的，前 $n-x-1$ 个数是任意的 $[1,n]$ 内的数，第 $n-x$ 个数是 $[n-x+1,n]$ 的数。那么方案数直接就写出来了，总答案也写出来了，就是 $\sum_{x=1}^n n^{n-x-1}x\binom{n}{x}x!x^m$。直接算是 $O(n\log m)$，但可以线性筛下变成 $O(\frac{n\log m}{\log n})$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.12.27 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e7</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="keyword">int</span> inv[N],pw[N],Pw[N];</span><br><span class="line">    <span class="keyword">int</span> prim[N/<span class="number">10</span>],tot;</span><br><span class="line">    <span class="keyword">bool</span> vis[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in"><span class="keyword">int</span></span>(<span class="built_in">Read</span>()%(kcz<span class="number">-1</span>)),inv[<span class="number">0</span>]=inv[<span class="number">1</span>]=Pw[<span class="number">0</span>]=<span class="number">1</span>,Pw[<span class="number">1</span>]=n;</span><br><span class="line">        res fac=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)inv[i]=<span class="built_in">mul</span>(inv[kcz%i],kcz-kcz/i),fac=<span class="built_in">mul</span>(fac,i),Pw[i]=<span class="built_in">mul</span>(Pw[i<span class="number">-1</span>],n);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)inv[i]=<span class="built_in">mul</span>(inv[i],inv[i<span class="number">-1</span>]);</span><br><span class="line">        pw[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!vis[i])prim[++tot]=i,pw[i]=<span class="built_in">qpow</span>(i,m+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=tot&amp;&amp;prim[j]*i&lt;=n;j++)&#123;</span><br><span class="line">                vis[prim[j]*i]=<span class="number">1</span>,pw[prim[j]*i]=<span class="built_in">mul</span>(pw[prim[j]],pw[i]);</span><br><span class="line">                <span class="keyword">if</span>(i%prim[j]==<span class="number">0</span>)<span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res x=<span class="number">1</span>;x&lt;n;x++)<span class="built_in">add</span>(ans,<span class="built_in">mul</span>(<span class="built_in">mul</span>(Pw[n-x<span class="number">-1</span>],pw[x]),inv[n-x]));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">mul</span>(<span class="built_in">Add</span>(ans,<span class="built_in">qpow</span>(n,m)),fac));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h4 id="牛客挑战赛51-G"><a href="#牛客挑战赛51-G" class="headerlink" title="[牛客挑战赛51 G]"></a>[牛客挑战赛51 G]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>口胡：区间加区间求和用权值线段树，加区间则用个 <code>set</code> 以区间左端点排序然后二分进去找到它应在的位置在 LCT 上加边删边，删区间同理。时间复杂度 $O(n\log n)$？</p>
<p>题面：中文题面不会自己看？</p>
<p>做法：首先简化一下题意，它这个题面跟个鬼一样，还要倒腾半天。</p>
<p>操作一实际上就是对 $[l,r]$ 区间内没被比它更小的区间覆盖到的位置加一个值，操作二则是被覆盖到的加值。其他操作倒是简单了。</p>
<p>题解做法我暂时还没看，不过 wxw 的做法应该暴打了标算。</p>
<p>注意操作一中修改位置的特征，以及区间互不交的特征。可以发现操作一修改的位置实际上就是在 $[l,r]$ 中区间覆盖次数最少的地方。 一旦注意到这个性质，就直接做完了。等价于我们只要维护个区间覆盖次数的最小值以及总和还有一堆标记就好了，这些东西都是平凡的，用权值线段树维护下就好了，时间复杂度 $O(m\log m)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.12.30 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,Q;</span><br><span class="line">    <span class="keyword">int</span> ls[N*<span class="number">100</span>],rs[N*<span class="number">100</span>],sum[N*<span class="number">100</span>],mn[N*<span class="number">100</span>],cnt[N*<span class="number">100</span>],len[N*<span class="number">100</span>];</span><br><span class="line">    <span class="keyword">int</span> tag_sum[N*<span class="number">100</span>],tag_mn[N*<span class="number">100</span>],tot,tag_all_sum[N*<span class="number">100</span>];</span><br><span class="line">    <span class="keyword">int</span> lastans;</span><br><span class="line">    Pair a[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">change_sum</span><span class="params">(<span class="keyword">const</span> res &amp;rt,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        <span class="built_in">add</span>(sum[rt],<span class="built_in">mul</span>(v,cnt[rt])),<span class="built_in">add</span>(tag_sum[rt],v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">change_mn</span><span class="params">(<span class="keyword">const</span> res &amp;rt,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        mn[rt]+=v,tag_mn[rt]+=v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">change_all_sum</span><span class="params">(<span class="keyword">const</span> res &amp;rt,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        <span class="built_in">add</span>(sum[rt],<span class="built_in">mul</span>(v,len[rt])),<span class="built_in">add</span>(tag_all_sum[rt],v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">const</span> res &amp;rt)</span></span>&#123;</span><br><span class="line">        <span class="built_in">change_mn</span>(ls[rt],tag_mn[rt]),<span class="built_in">change_all_sum</span>(ls[rt],tag_all_sum[rt]);</span><br><span class="line">        <span class="built_in">change_mn</span>(rs[rt],tag_mn[rt]),<span class="built_in">change_all_sum</span>(rs[rt],tag_all_sum[rt]);</span><br><span class="line">        <span class="keyword">if</span>(mn[ls[rt]]==mn[rt])<span class="built_in">change_sum</span>(ls[rt],tag_sum[rt]);</span><br><span class="line">        <span class="keyword">if</span>(mn[rs[rt]]==mn[rt])<span class="built_in">change_sum</span>(rs[rt],tag_sum[rt]);</span><br><span class="line">        tag_mn[rt]=tag_sum[rt]=tag_all_sum[rt]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">const</span> res &amp;rt)</span></span>&#123;</span><br><span class="line">        sum[rt]=<span class="built_in">Add</span>(sum[ls[rt]],sum[rs[rt]]);</span><br><span class="line">        mn[rt]=<span class="built_in">min</span>(mn[ls[rt]],mn[rs[rt]]);</span><br><span class="line">        cnt[rt]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(mn[rt]==mn[ls[rt]])cnt[rt]=cnt[ls[rt]];</span><br><span class="line">        <span class="keyword">if</span>(mn[rt]==mn[rs[rt]])cnt[rt]+=cnt[rs[rt]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query_mn</span><span class="params">(res &amp;rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!rt)rt=++tot,len[rt]=cnt[rt]=r-l+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)<span class="keyword">return</span> mn[rt];</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>,ret=n;</span><br><span class="line">        <span class="keyword">if</span>(!ls[rt])ls[rt]=++tot,len[ls[rt]]=cnt[ls[rt]]=mid-l+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(!rs[rt])rs[rt]=++tot,len[rs[rt]]=cnt[rs[rt]]=r-mid;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)ret=<span class="built_in">query_mn</span>(ls[rt],l,mid,L,R);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)ret=<span class="built_in">min</span>(ret,<span class="built_in">query_mn</span>(rs[rt],mid+<span class="number">1</span>,r,L,R));</span><br><span class="line">        <span class="built_in">pushup</span>(rt);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify_sum</span><span class="params">(res &amp;rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R,<span class="keyword">const</span> res &amp;v,<span class="keyword">const</span> res &amp;lim)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!rt)rt=++tot,len[rt]=cnt[rt]=r-l+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;</span><br><span class="line">            <span class="keyword">if</span>(mn[rt]==lim)<span class="built_in">change_sum</span>(rt,v);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(!ls[rt])ls[rt]=++tot,len[ls[rt]]=cnt[ls[rt]]=mid-l+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(!rs[rt])rs[rt]=++tot,len[rs[rt]]=cnt[rs[rt]]=r-mid;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="built_in">modify_sum</span>(ls[rt],l,mid,L,R,v,lim);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)<span class="built_in">modify_sum</span>(rs[rt],mid+<span class="number">1</span>,r,L,R,v,lim);</span><br><span class="line">        <span class="built_in">pushup</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify_mn</span><span class="params">(res &amp;rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!rt)rt=++tot,len[rt]=cnt[rt]=r-l+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;</span><br><span class="line">            <span class="built_in">change_mn</span>(rt,v);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(!ls[rt])ls[rt]=++tot,len[ls[rt]]=cnt[ls[rt]]=mid-l+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(!rs[rt])rs[rt]=++tot,len[rs[rt]]=cnt[rs[rt]]=r-mid;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="built_in">modify_mn</span>(ls[rt],l,mid,L,R,v);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)<span class="built_in">modify_mn</span>(rs[rt],mid+<span class="number">1</span>,r,L,R,v);</span><br><span class="line">        <span class="built_in">pushup</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify_all_sum</span><span class="params">(res &amp;rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!rt)rt=++tot,len[rt]=cnt[rt]=r-l+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;</span><br><span class="line">            <span class="built_in">change_all_sum</span>(rt,v);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(!ls[rt])ls[rt]=++tot,len[ls[rt]]=cnt[ls[rt]]=mid-l+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(!rs[rt])rs[rt]=++tot,len[rs[rt]]=cnt[rs[rt]]=r-mid;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="built_in">modify_all_sum</span>(ls[rt],l,mid,L,R,v);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)<span class="built_in">modify_all_sum</span>(rs[rt],mid+<span class="number">1</span>,r,L,R,v);</span><br><span class="line">        <span class="built_in">pushup</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query_sum</span><span class="params">(res &amp;rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!rt)rt=++tot,len[rt]=cnt[rt]=r-l+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)<span class="keyword">return</span> sum[rt];</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>,ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(!ls[rt])ls[rt]=++tot,len[ls[rt]]=cnt[ls[rt]]=mid-l+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(!rs[rt])rs[rt]=++tot,len[rs[rt]]=cnt[rs[rt]]=r-mid;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)ret=<span class="built_in">query_sum</span>(ls[rt],l,mid,L,R);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)<span class="built_in">add</span>(ret,<span class="built_in">query_sum</span>(rs[rt],mid+<span class="number">1</span>,r,L,R));</span><br><span class="line">        <span class="built_in">pushup</span>(rt);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> RT;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),Q=<span class="built_in">read</span>();</span><br><span class="line">        a[<span class="number">1</span>]=<span class="built_in">mp</span>(<span class="number">1</span>,n),<span class="built_in">modify_mn</span>(RT,<span class="number">1</span>,n,<span class="number">1</span>,n,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">while</span>(Q--)&#123;</span><br><span class="line">            res opt=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">if</span>(opt==<span class="number">1</span>)&#123;</span><br><span class="line">                res k=<span class="built_in">read</span>(),val=<span class="built_in">read</span>();</span><br><span class="line">                res lim=<span class="built_in">query_mn</span>(RT,<span class="number">1</span>,n,a[k].fi,a[k].se);</span><br><span class="line">                <span class="built_in">modify_sum</span>(RT,<span class="number">1</span>,n,a[k].fi,a[k].se,val,lim);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">2</span>)&#123;</span><br><span class="line">                res k=<span class="built_in">read</span>(),val=<span class="built_in">read</span>();</span><br><span class="line">                res lim=<span class="built_in">query_mn</span>(RT,<span class="number">1</span>,n,a[k].fi,a[k].se);</span><br><span class="line">                <span class="built_in">modify_sum</span>(RT,<span class="number">1</span>,n,a[k].fi,a[k].se,kcz-val,lim);</span><br><span class="line">                <span class="built_in">modify_all_sum</span>(RT,<span class="number">1</span>,n,a[k].fi,a[k].se,val);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">3</span>)&#123;</span><br><span class="line">                res l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>();</span><br><span class="line">                <span class="built_in">print</span>(lastans=<span class="built_in">query_sum</span>(RT,<span class="number">1</span>,n,l,r)),sr[++C]=<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">4</span>)&#123;</span><br><span class="line">                res l=<span class="built_in">read</span>()^lastans,r=<span class="built_in">read</span>()^lastans,k=<span class="built_in">read</span>();</span><br><span class="line">                a[k]=<span class="built_in">mp</span>(l,r),<span class="built_in">modify_mn</span>(RT,<span class="number">1</span>,n,l,r,<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                res k=<span class="built_in">read</span>();</span><br><span class="line">                <span class="built_in">modify_mn</span>(RT,<span class="number">1</span>,n,a[k].fi,a[k].se,<span class="number">-1</span>),a[k]=<span class="built_in">mp</span>(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="ABC206-F"><a href="#ABC206-F" class="headerlink" title="[ABC206 F]"></a>[ABC206 F]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有 $n$ 段区间 $[l_i,r_i)$。A 和 B 两人每次可以选择一个区间，A 先手。要求选择的区间不能相交，谁先不能选谁输。问最后谁赢。</p>
<p>做法：复习下博弈论。</p>
<p>令 $sg(L,R)$ 为 $[L,R)$ 游戏局面下的 sg​ 函数，那么转移就是从 $[L,l_i)$ 和 $[r_i,R)$ 两个局面过来，即 $mex \lbrace    sg(L,l_i)\bigoplus sg(r_i,R) \rbrace $，记忆化搜索下即可。时间复杂度 $O(n^3)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.6.20 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">128</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    Pair a[N];</span><br><span class="line">    <span class="keyword">int</span> S[N][N];</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">sg</span><span class="params">(res l,res r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l==r)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(S[l][r]!=<span class="number">-1</span>)<span class="keyword">return</span> S[l][r];</span><br><span class="line">        <span class="keyword">bool</span> vis[N];</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=<span class="number">127</span>;i++)vis[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(l&lt;=a[i].fi&amp;&amp;a[i].se&lt;=r)vis[<span class="built_in">sg</span>(l,a[i].fi)^<span class="built_in">sg</span>(a[i].se,r)]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;;i++)<span class="keyword">if</span>(!vis[i])<span class="keyword">return</span> S[l][r]=i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res T=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">            n=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i].fi=<span class="built_in">read</span>(),a[i].se=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">100</span>;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=<span class="number">100</span>;j++)S[i][j]=<span class="number">-1</span>;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="built_in">sg</span>(<span class="number">1</span>,<span class="number">100</span>)?<span class="string">&quot;Alice&quot;</span>:<span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>
<h3 id="CF1539-E"><a href="#CF1539-E" class="headerlink" title="[CF1539 E]"></a>[CF1539 E]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有两个数 $x,y$，初始为 $0$。每次给你一个限制：必须将其中一个数变为 $k_i$，而且要满足 $a_{l,i} \leq x \leq b_{l,i},a_{r,i} \leq y \leq b_{r,i}$，问是否存在一组解。</p>
<p>做法：容易写出一个 $O(n^2)$ 的暴力，即 $dp(i,j)$ 为第 $i$ 次选择变了 $x$，第 $j$ 次选择变了 $y$，转移显然。</p>
<p>考虑优化这个暴力。发现每次能转移到 $dp(i,i+1)$（或 $dp(i+1,i)$）就尽量转移，这样的贪心是正确的（这是因为从后往前转移时，若可以换到 $dp(i,i+1)$ 的话，则后续转移不用再考虑后面对 $y$ 的限制，所以这样转移肯定不劣）。于是就将复杂度优化到 $O(n)$ 了。</p>
<p>构造答案的话，按照上面贪心的思路逆着来即可。</p>
<p>复杂度 $O(n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.6.23 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="keyword">int</span> k[N],al[N],ar[N],bl[N],br[N];</span><br><span class="line">    <span class="keyword">int</span> L[N][<span class="number">2</span>],R[N][<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">ck</span><span class="params">(<span class="keyword">const</span> res &amp;i,<span class="keyword">const</span> res &amp;x,<span class="keyword">const</span> res &amp;y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> al[i]&lt;=x&amp;&amp;x&lt;=bl[i]&amp;&amp;ar[i]&lt;=y&amp;&amp;y&lt;=br[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">Ck</span><span class="params">(<span class="keyword">const</span> res &amp;i,<span class="keyword">const</span> res &amp;x,<span class="keyword">const</span> res &amp;y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (L[i][<span class="number">0</span>]&lt;=x&amp;&amp;x&lt;=L[i][<span class="number">1</span>])||(R[i][<span class="number">0</span>]&lt;=y&amp;&amp;y&lt;=R[i][<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)k[i]=<span class="built_in">read</span>(),al[i]=<span class="built_in">read</span>(),bl[i]=<span class="built_in">read</span>(),ar[i]=<span class="built_in">read</span>(),br[i]=<span class="built_in">read</span>();</span><br><span class="line">        L[n+<span class="number">1</span>][<span class="number">0</span>]=<span class="number">0</span>,L[n+<span class="number">1</span>][<span class="number">1</span>]=m,R[n+<span class="number">1</span>][<span class="number">0</span>]=<span class="number">0</span>,R[n+<span class="number">1</span>][<span class="number">1</span>]=m;</span><br><span class="line">        <span class="keyword">for</span>(res i=n;i&gt;=<span class="number">1</span>;i--)&#123;</span><br><span class="line">            L[i][<span class="number">0</span>]=m+<span class="number">1</span>,L[i][<span class="number">1</span>]=<span class="number">-1</span>,R[i][<span class="number">0</span>]=m+<span class="number">1</span>,R[i][<span class="number">1</span>]=<span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">if</span>(al[i]&lt;=k[i]&amp;&amp;k[i]&lt;=bl[i])&#123;</span><br><span class="line">                <span class="keyword">if</span>(L[i+<span class="number">1</span>][<span class="number">0</span>]&lt;=k[i]&amp;&amp;k[i]&lt;=L[i+<span class="number">1</span>][<span class="number">1</span>])R[i][<span class="number">0</span>]=ar[i],R[i][<span class="number">1</span>]=br[i];</span><br><span class="line">                <span class="keyword">else</span> R[i][<span class="number">0</span>]=<span class="built_in">max</span>(R[i+<span class="number">1</span>][<span class="number">0</span>],ar[i]),R[i][<span class="number">1</span>]=<span class="built_in">min</span>(R[i+<span class="number">1</span>][<span class="number">1</span>],br[i]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(ar[i]&lt;=k[i]&amp;&amp;k[i]&lt;=br[i])&#123;</span><br><span class="line">                <span class="keyword">if</span>(R[i+<span class="number">1</span>][<span class="number">0</span>]&lt;=k[i]&amp;&amp;k[i]&lt;=R[i+<span class="number">1</span>][<span class="number">1</span>])L[i][<span class="number">0</span>]=al[i],L[i][<span class="number">1</span>]=bl[i];</span><br><span class="line">                <span class="keyword">else</span> L[i][<span class="number">0</span>]=<span class="built_in">max</span>(L[i+<span class="number">1</span>][<span class="number">0</span>],al[i]),L[i][<span class="number">1</span>]=<span class="built_in">min</span>(L[i+<span class="number">1</span>][<span class="number">1</span>],bl[i]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">Ck</span>(<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>))&#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;Yes&quot;</span>);</span><br><span class="line">            res y=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">ck</span>(i,k[i],y)&amp;&amp;<span class="built_in">Ck</span>(i+<span class="number">1</span>,k[i],y))<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">else</span> y=k[i],<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">puts</span>(<span class="string">&quot;No&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF1539-F"><a href="#CF1539-F" class="headerlink" title="[CF1539 F]"></a>[CF1539 F]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有 $n$ 个正整数数 $a_i$。当 $k \in [l,r]$ 时，定义 $a_k$ 在 $[l,r]$ 中的距离为 $rank(a_k)-(l+r+1)/2$，其中 $rank(a_k)$ 为 $a_k$ 在 $[l,r]$ 排第几大（若有相同统一当最大），求 $a_i$ 在所有区间中的最大距离。</p>
<p>做法：设 $[l,r]$ 中小于 $a_k$ 的数有 $x$，等于的有 $y$ 个，大于有 $z$ 个，那么此时 $a_k$ 的距离为 $\max((x+y-z)/2,(y+z-x-1)/2)$。于是可将 $i$ 从小到大（以及从大到小）枚举，使所有小于 $i$ 的数（以及大于）变为 $1$，其余为 $-1$。因此，原命题等价于维护最大子段和。由于必须包含 $k$ 这个位置，因此用线段树维护最大最小前缀和即可。</p>
<p>时间复杂度 $O(n\log n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.6.24 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; vec[N];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">P</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> mx,mn;</span><br><span class="line">        <span class="built_in">P</span>() &#123;&#125;</span><br><span class="line">        <span class="built_in">P</span>(res a,res b) &#123;mx=a,mn=b;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> res &amp;p)</span></span>&#123;</span><br><span class="line">            mx=mn=-p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">inline</span> P <span class="keyword">operator</span> + (<span class="keyword">const</span> RG P &amp;x)&#123;</span><br><span class="line">            RG P y;</span><br><span class="line">            y.mx=<span class="built_in">max</span>(mx,x.mx),y.mn=<span class="built_in">min</span>(mn,x.mn);</span><br><span class="line">            <span class="keyword">return</span> y;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">const</span> res &amp;val)</span></span>&#123;</span><br><span class="line">            mx+=val,mn+=val;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;tr[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> laz[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">const</span> res &amp;rt)</span></span>&#123;</span><br><span class="line">        tr[rt]=tr[rt&lt;&lt;<span class="number">1</span>]+tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(res rt,res l,res r)</span></span>&#123;</span><br><span class="line">        laz[rt]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;tr[rt].<span class="built_in">init</span>(l);<span class="keyword">return</span>;&#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(rt&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r),<span class="built_in">pushup</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">const</span> res &amp;rt)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(laz[rt])tr[rt&lt;&lt;<span class="number">1</span>].<span class="built_in">change</span>(laz[rt]),laz[rt&lt;&lt;<span class="number">1</span>]+=laz[rt],tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].<span class="built_in">change</span>(laz[rt]),laz[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+=laz[rt],laz[rt]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;tr[rt].<span class="built_in">change</span>(<span class="number">2</span>),laz[rt]+=<span class="number">2</span>;<span class="keyword">return</span>;&#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R);</span><br><span class="line">        <span class="built_in">pushup</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">P <span class="title">query</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)<span class="keyword">return</span> tr[rt];</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        RG P ret=<span class="built_in">P</span>(-inf,inf);</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)ret=<span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)ret=ret+<span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R);</span><br><span class="line">        <span class="built_in">pushup</span>(rt);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> ans[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>(),vec[a[i]].<span class="built_in">pb</span>(i);</span><br><span class="line">        <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">0</span>,n);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> x:vec[i])<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">0</span>,n,x,n);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> x:vec[i])ans[x]=(<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">0</span>,n,x,n).mx-<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">0</span>,n,<span class="number">0</span>,x<span class="number">-1</span>).mn<span class="number">-1</span>)/<span class="number">2</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">build</span>(<span class="number">1</span>,<span class="number">0</span>,n);</span><br><span class="line">        <span class="keyword">for</span>(res i=n;i;i--)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> x:vec[i])<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">0</span>,n,x,n);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> x:vec[i])ans[x]=<span class="built_in">max</span>(ans[x],(<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">0</span>,n,x,n).mx-<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">0</span>,n,<span class="number">0</span>,x<span class="number">-1</span>).mn)/<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>
<h3 id="ULR-2"><a href="#ULR-2" class="headerlink" title="[ULR #2]"></a>[ULR #2]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>summary</span></div>
    <div class="hide-content"><p>实况：一题都不会，精彩。</p>
</div></div>
<h4 id="ULR-2-A"><a href="#ULR-2-A" class="headerlink" title="[ULR #2 A]"></a>[ULR #2 A]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：中文题面不会还要写吧，不会吧不会吧。</p>
<p>做法：考虑一种其他做法：设 $S_{i,j}$ 表示当前总长为 $i$ 第 $j$ 位的贡献次数，转移是枚举 $d$ ，$S_{i,j}=\sum_{d=2}^i S_{\frac{i-1}{d}+[(i-1)\mod d\geq j\mod d], j\mod d}$，打表可发现需用的状态数在合理的范围内，于是差分后就可以做了。</p>
<p>不过这个做法有点不好实现，建议使用官方题解。</p>
<p>标准做法是考虑将每次操作合并成一个大操作，使得最后只剩下一个数，然后考虑这种操作序列的个数。推出式子后，注意到 $g(n)= \sum_i f(i)\ast \frac{n}{i}$ 可以利用差分快速求出，于是就可以做到 $O(n\log n)$ 或 $O(n)$ 了。</p>
<p>代码是 $O(n\log n)$ 的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.6.28 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">namespace</span> GenHelper&#123;</span><br><span class="line">        <span class="keyword">unsigned</span> z1,z2,z3,z4,b;</span><br><span class="line">        <span class="function"><span class="keyword">unsigned</span> <span class="title">read</span><span class="params">()</span></span>&#123;</span><br><span class="line">            b=((z1&lt;&lt;<span class="number">6</span>)^z1)&gt;&gt;<span class="number">13</span>;</span><br><span class="line">            z1=((z1&amp;<span class="number">4294967294U</span>)&lt;&lt;<span class="number">18</span>)^b;</span><br><span class="line">            b=((z2&lt;&lt;<span class="number">2</span>)^z2)&gt;&gt;<span class="number">27</span>;</span><br><span class="line">            z2=((z2&amp;<span class="number">4294967288U</span>)&lt;&lt;<span class="number">2</span>)^b;</span><br><span class="line">            b=((z3&lt;&lt;<span class="number">13</span>)^z3)&gt;&gt;<span class="number">21</span>;</span><br><span class="line">            z3=((z3&amp;<span class="number">4294967280U</span>)&lt;&lt;<span class="number">7</span>)^b;</span><br><span class="line">            b=((z4&lt;&lt;<span class="number">3</span>)^z4)&gt;&gt;<span class="number">12</span>;</span><br><span class="line">            z4=((z4&amp;<span class="number">4294967168U</span>)&lt;&lt;<span class="number">13</span>)^b;</span><br><span class="line">            <span class="keyword">return</span> (z1^z2^z3^z4);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">srand</span><span class="params">(<span class="keyword">int</span> x)</span></span>&#123;</span><br><span class="line">            z1=x;</span><br><span class="line">            z2=(~x)^<span class="number">0x233333333</span>U;</span><br><span class="line">            z3=x^<span class="number">0x1234598766</span>U;</span><br><span class="line">            z4=(~x)+<span class="number">51</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> n,seed;</span><br><span class="line">    <span class="keyword">unsigned</span> H[N],sumH[N],D[N],S[N],ans;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),seed=<span class="built_in">read</span>(),GenHelper::<span class="built_in">srand</span>(seed),H[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=i+i;j&lt;=n;j+=i)H[j]+=H[i];</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)sumH[i]=sumH[i<span class="number">-1</span>]+H[i];</span><br><span class="line"><span class="comment">//        for(res i=0;i&lt;=n;i++)printf(&quot;%d\n&quot;,sumH[i]);</span></span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=n;i++)D[i]=sumH[i]*<span class="number">2</span><span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;n;i++)S[i]=D[<span class="built_in">min</span>(i,n-i<span class="number">-1</span>)]+sumH[<span class="built_in">max</span>(i,n-i<span class="number">-1</span>)]+(i==<span class="number">0</span>)+(i==n<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;n;i++)ans+=GenHelper::<span class="built_in">read</span>()*S[i];</span><br><span class="line">        cout&lt;&lt;ans&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h4 id="ULR-2-B"><a href="#ULR-2-B" class="headerlink" title="[ULR #2 B]"></a>[ULR #2 B]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：中文题面不会还要写吧，不会吧不会吧。</p>
<p>做法：由于 $\operatorname{det}(A+E_{i,j})=\det(A)+e_{i,j}M_{i,j}$，其中 $A=(a_{i,j})$,$E_{p,q}=(e_{i,j})$,$e_{i,j}\neq 0$ 当且仅当 $(i,j)=(p,q)$，$M_{i,j}$ 为 $A$ 删去第 $i$ 行第 $j$ 列的代数余子式。以及 $A^{\ast}=\det(A)\ast A^{-1}$，其中 $A^{\ast}$ 为 $A$ 的古典伴随方阵，而 $A^{\ast}=(M_{j,i})$，于是我们可以选择求出 $A^{\ast}$ 和 $\det(A)$ 来求出 $A^{-1}$，顺便求逆求出 $A$。</p>
<p>这里有两个问题。</p>
<p>一是 $A$ 未必有逆。为了尽量保证它有逆，我们选择随机一个矩阵 $C$，变成求 $A+C$，最后再把 $C$ 减回去。可以证明这样有逆的概率很高，若随机模数为 $p$，则这样有逆的概率是大于 $1-\frac{1}{p-1}$ 的。</p>
<p>二是询问次数。根据第一个性质，我们需要 $n^2+1$ 次询问才能求出我们需要的数。但事实上，我们可以先不求 $M_{n,n}$，然后利用 $\det(A^{\ast}-E_{n,n})=\det(A^{\ast})-M_{n,n}\ast M’$，其中 $E$ 的定义如上，而 $e_{n,n}=M_{n,n}$。$\det(A^{\ast})=\det(A)^{n-1}$。至于 $M’$，则是 $A^{\ast}$ 删去第 $n$ 行第 $n$ 列的代数余子式，这可以直接求出它的余子式再加上符号（因为前 $n-1$ 行列的 $M_{i,j}$ 都已经已知了）。此时我们要求 $M_{n,n}$ 不为 $0$，根据一处的随机矩阵，可以证明总的正确率大于 $1-\frac{2}{p-1}$。</p>
<p>于是根据上述，我们就在询问次数为 $n^2$ 次，时间复杂度为 $O(n^3)$ 下解决了这个问题。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.6.30 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">50</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> M[N][N];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> a[N][N],n;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">ide</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i][i]=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">int</span>* <span class="keyword">operator</span> [](<span class="keyword">const</span> res &amp;x)&#123;<span class="keyword">return</span> a[x];&#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">re</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)a[i][j]=<span class="built_in">read</span>()%kcz;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)a[i][j]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">sw</span><span class="params">(<span class="keyword">const</span> res &amp;i,<span class="keyword">const</span> res &amp;j)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res o=<span class="number">1</span>;o&lt;=n;o++)<span class="built_in">swap</span>(a[i][o],a[j][o]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">ast</span><span class="params">(<span class="keyword">const</span> res &amp;i,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res k=<span class="number">1</span>;k&lt;=n;k++)a[i][k]=<span class="built_in">mul</span>(a[i][k],v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">dec</span><span class="params">(<span class="keyword">const</span> res &amp;i,<span class="keyword">const</span> res &amp;j,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res k=<span class="number">1</span>;k&lt;=n;k++)<span class="built_in">add</span>(a[i][k],<span class="built_in">mul</span>(kcz-v,a[j][k]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,a[i][j]);<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">det</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res ans=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res k=i;</span><br><span class="line">            <span class="keyword">for</span>(res j=i;j&lt;=n;j++)<span class="keyword">if</span>(a[j][i])&#123;k=j;<span class="keyword">break</span>;&#125;</span><br><span class="line">            <span class="keyword">if</span>(a[k][i]==<span class="number">0</span>)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res j=k+<span class="number">1</span>;j&lt;=n;j++)<span class="keyword">if</span>(a[j][i]&amp;&amp;a[j][i]&lt;a[k][i])k=j;</span><br><span class="line">            <span class="keyword">if</span>(i!=k)<span class="built_in">sw</span>(i,k),ans=kcz-ans;</span><br><span class="line">            <span class="keyword">for</span>(res j=i+<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(a[j][i]&gt;a[i][i])<span class="built_in">sw</span>(i,j),ans=kcz-ans;</span><br><span class="line">                <span class="keyword">while</span>(a[j][i])<span class="built_in">dec</span>(i,j,a[i][i]/a[j][i]),<span class="built_in">sw</span>(i,j),ans=kcz-ans;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)ans=<span class="built_in">mul</span>(ans,a[i][i]);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;A,B;</span><br><span class="line"><span class="function">std::vector&lt;<span class="keyword">int</span>&gt; <span class="title">solve</span><span class="params">(<span class="keyword">int</span> n,<span class="keyword">int</span> T)</span></span>&#123;</span><br><span class="line">    <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">a</span><span class="params">(n*n)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;n*n;i++)a[i]=<span class="built_in">rng</span>()%kcz;</span><br><span class="line">    res deta=<span class="built_in">query</span>(a);</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)</span><br><span class="line">        <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i==n&amp;&amp;j==n) <span class="keyword">continue</span>;</span><br><span class="line">            res id=(i<span class="number">-1</span>)*n+j<span class="number">-1</span>;</span><br><span class="line">            <span class="built_in">add</span>(a[id],<span class="number">1</span>),M[i][j]=<span class="built_in">Add</span>(<span class="built_in">query</span>(a),kcz-deta),<span class="built_in">add</span>(a[id],kcz<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    A.n=n;</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)A[i][j]=M[i][j];</span><br><span class="line">    res x=A.<span class="built_in">det</span>();</span><br><span class="line">    A.n=n<span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)A[i][j]=M[i][j];</span><br><span class="line">    res y=A.<span class="built_in">det</span>();</span><br><span class="line">    M[n][n]=<span class="built_in">mul</span>(<span class="built_in">Add</span>(<span class="built_in">qpow</span>(deta,n<span class="number">-1</span>),kcz-x),<span class="built_in">qpow</span>(y));</span><br><span class="line">    res INV=<span class="built_in">qpow</span>(deta);</span><br><span class="line">    A.n=n;</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)A[i][j]=<span class="built_in">mul</span>(M[i][j],INV);</span><br><span class="line">    B.n=n,B.<span class="built_in">ide</span>();</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        res k=i;</span><br><span class="line">        <span class="keyword">for</span>(res j=i+<span class="number">1</span>;j&lt;=n;j++)<span class="keyword">if</span>(A[j][i]&gt;A[k][i])k=j;</span><br><span class="line">        <span class="keyword">if</span>(i!=k)A.<span class="built_in">sw</span>(i,k),B.<span class="built_in">sw</span>(i,k);</span><br><span class="line">        <span class="keyword">if</span>(A[i][i]==<span class="number">0</span>)&#123;<span class="built_in">puts</span>(<span class="string">&quot;No Solution&quot;</span>);&#125;</span><br><span class="line">        res inv=<span class="built_in">qpow</span>(A[i][i]);</span><br><span class="line">        <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i!=j)&#123;</span><br><span class="line">                res t=<span class="built_in">mul</span>(A[j][i],inv);</span><br><span class="line">                A.<span class="built_in">dec</span>(j,i,t),B.<span class="built_in">dec</span>(j,i,t);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        A.<span class="built_in">ast</span>(i,inv),B.<span class="built_in">ast</span>(i,inv);</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">Aqua</span><span class="params">(n*n)</span></span>;</span><br><span class="line">    <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)Aqua[(i<span class="number">-1</span>)*n+j<span class="number">-1</span>]=<span class="built_in">Add</span>(kcz-a[(i<span class="number">-1</span>)*n+j<span class="number">-1</span>],B[j][i]);</span><br><span class="line">    <span class="keyword">return</span> Aqua;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div>
<h4 id="ULR-2-C"><a href="#ULR-2-C" class="headerlink" title="[ULR #2 C]"></a>[ULR #2 C]</h4><p>remain to be done.</p>
<h4 id="ULR-2-D"><a href="#ULR-2-D" class="headerlink" title="[ULR #2 D]"></a>[ULR #2 D]</h4><p>remain to be done.</p>
<h4 id="ULR-2-E"><a href="#ULR-2-E" class="headerlink" title="[ULR #2 E]"></a>[ULR #2 E]</h4><p>remain to be done.</p>
<h4 id="ULR-2-F"><a href="#ULR-2-F" class="headerlink" title="[ULR #2 F]"></a>[ULR #2 F]</h4><p>remain to be done.</p>
<h3 id="AGC054"><a href="#AGC054" class="headerlink" title="[AGC054]"></a>[AGC054]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>summary</span></div>
    <div class="hide-content"><p>实况：罚时逆天。</p>
</div></div>
<h4 id="AGC054-D"><a href="#AGC054-D" class="headerlink" title="[AGC054 D]"></a>[AGC054 D]</h4><p>remain to be done.</p>
<h4 id="AGC054-E"><a href="#AGC054-E" class="headerlink" title="[AGC054 E]"></a>[AGC054 E]</h4><p>remain to be done.</p>
<h4 id="AGC054-F"><a href="#AGC054-F" class="headerlink" title="[AGC054 F]"></a>[AGC054 F]</h4><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有两个长度分别为 $n$ 和 $n−1$ 的数组 $A,B$。</p>
<p>每次可以选择 $l&lt;r$，操作 $A_l,A_r$ 和 $B_l,B_{l+1},…,B_{r−1}$，将其减一。要求操作之后不能出现负数。</p>
<p>问在操作次数最多（ 不能再操作 ）的前提下，操作之后不同的数组 $A$ 的方案数。</p>
<p>做法：还不会，再说。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF1025-G"><a href="#CF1025-G" class="headerlink" title="[CF1025 G]"></a>[CF1025 G]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有 $n$ 个节点，每个节点有两种状态：选中和未选中。</p>
<p>每个选中的点后面都跟着若干个（可能是 $0$ 个）未选中的点。</p>
<p>每个未选中的点都一定跟在某个选中的点后面。</p>
<p>每次操作随机选择两个被选中的点，随机将其中一个变成未选中，且跟在另一个后面，同时将跟在他后面的节点全部改为选中。</p>
<p>求这样操作下去，直到最后只剩一个选中的点的期望步数。</p>
<p>做法：考虑一个离散时间鞅为 $A_0,A_1,…$，设其停时为 $t$，终止状态为 $A_t$，则我们要求的是 $E(t)$。</p>
<p>设 $A_p=\lbrace a_{p,1},a_{p,2},…,a_{p,m_p} \rbrace$。其中 $a_{p,i}$ 表示第 $p$ 个局面下第 $i$ 个被选中的点的孩子们个数，于是有$\sum_{i=1}^{m_p} a_{p,i}=n-m_p$。构造 $A_p$ 局面的势能函数为 $\Phi(A_p)=\sum f(a_{p,i})$。</p>
<p>考虑第 $p+1$ 次选出了 $i$ 跟到 $j$ 后面，则有</p>
<script type="math/tex; mode=display">
\begin{align*}
&E(\Phi(A_{p+1})|A_0,...,A_p)=E(\Phi(A_{p+1})|A_p)\\\\
&=\sum_i \sum_{j\neq i}\frac{1}{m_p(m_p-1)}[f(a_{p,j}+1)+a_{p,i}f(0)+\sum_{k\neq i,j}f(a_{p,k})]\\\\
&=\sum_i \frac{1}{m_p}[f(a_{p,i}+1)+a_{p,i}f(0)+(m_p-2)f(a_{p,i})]
&\end{align*}</script><p>考虑势能函数的性质，则要求 </p>
<script type="math/tex; mode=display">
\begin{cases}
E(\Phi(A_{n+1})-\Phi(A_n)|A_0,A_1,...,A_n)=-1  \\\\
\Phi(A_t)\ \mbox{为常数} \\\\
\Phi(A_t)\neq \Phi(A_i)\ \mbox{当且仅当}\ i\neq t
\end{cases}</script><p>根据性质一，我们要求</p>
<script type="math/tex; mode=display">
\begin{align*}
&\sum_i f(a_{p,i})-1=\sum_i \frac{1}{m_p}[f(a_{p,i}+1)+a_{p,i}f(0)+(m_p-2)f(a_{p,i})] \\\\
&\mbox{即}\ \sum_i f(a_{p,i})=\sum_i \frac{1}{m_p}[f(a_{p,i}+1)+a_{p,i}f(0)+(m_p-2)f(a_{p,i})+1]
&\end{align*}</script><p>由于对任意的局面都要满足，则我们可以令</p>
<script type="math/tex; mode=display">
\begin{align*}
&f(a_{p,i})=\frac{1}{m_p}[f(a_{p,i}+1)+a_{p,i}f(0)+(m_p-2)f(a_{p,i})+1]\\\\
&\mbox{即}\ f(a)=\frac{1}{m}[f(a+1)+af(0)+(m-2)f(a)+1]\\\\
&\mbox{即}\ f(a+1)+af(0)=2f(a)-1\\\\
&\mbox{不妨设}\ f(0)=0\\\\
&\mbox{有}\ f(a+1)-1=2(f(a)-1)=-2^{a+1}\\\\
&\mbox{所以}\ f(a)=1-2^a
&\end{align*}</script><p>此时又发现 $\Phi(A_t)=f(n-1)=1-2^{n-1}$，而其余局面也不可能得到这个值，于是该函数满足势能函数的要求。</p>
<p>又根据势能函数的性质，有 $E(t)=\Phi(A_0)-\Phi(A_t)$，就在 $O(n)$ 或 $O(n\log n)$ 复杂度内完成了此题。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.7.10 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">500</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    <span class="keyword">int</span> b[N];</span><br><span class="line">    <span class="keyword">int</span> ans;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>();</span><br><span class="line">        <span class="comment">//f(n)=1-2^n</span></span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(a[i]&gt;<span class="number">0</span>)b[a[i]]++;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(a[i]==<span class="number">-1</span>)<span class="built_in">add</span>(ans,<span class="built_in">Add</span>(<span class="number">1</span>,kcz-<span class="built_in">qpow</span>(<span class="number">2</span>,b[i])));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">Add</span>(ans,<span class="built_in">Add</span>(kcz<span class="number">-1</span>,<span class="built_in">qpow</span>(<span class="number">2</span>,n<span class="number">-1</span>))));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF850-F"><a href="#CF850-F" class="headerlink" title="[CF850 F]"></a>[CF850 F]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给定 $n$ 种颜色的球，每种球有 $a_i$ 个，$\sum_i a_i=m$，对这些球执行以下操作：</p>
<ul>
<li>有顺序地任意取两个球，将第二个球涂上第一个球的颜色，重复该操作至所有球颜色相同。</li>
</ul>
<p>求期望操作次数，对 $10^9+7$ 取模。</p>
<p>做法：考虑一个离散时间鞅为 $A_0,A_1,…$，设其停时为 $t$，终止状态为 $A_t$，则我们要求的是 $E(t)$。</p>
<p>设 $A_p=\lbrace a_{p,1},a_{p,2},…,a_{p,n} \rbrace$。其中 $a_{p,i}$ 表示第 $p$ 个局面下第 $i$ 种颜色的球的个数，于是有$\sum_{i=1}^{n} a_{p,i}=m$。构造 $A_p$ 局面的势能函数为 $\Phi(A_p)=\sum f(a_{p,i})$。</p>
<p>为了方便地书（tou）写（gong）式（jian）子（liao），我们直接书写</p>
<script type="math/tex; mode=display">
E(\Phi(A_{n+1})-\Phi(A_n)|A_0,A_1,...,A_n)=-1</script><p>不妨设 $A=\lbrace a_{1},a_{2},…,a_{n} \rbrace$，我们简单地书写下一轮的情况。</p>
<p>一方面，可能选择两种颜色相同的球，即 $\sum_i \frac{a_i(a_i-1)}{m(m-1)} \Phi(A)$。</p>
<p>另一方面，若选择的球颜色不同，则为 </p>
<script type="math/tex; mode=display">
\begin{align*}
&\sum_i \sum_{j\neq i} \frac{a_ia_j}{m(m-1)}(\Phi(A)+f(a_i+1)+f(a_j-1)-f(a_i)-f(a_j))\\\\
&=\sum_i \frac{a_i}{m(m-1)} (\Phi(A)(m-a_i)+f(a_i+1)(m-a_i)-f(a_i)(m-a_i)+\sum_{j\neq i}a_j(f(a_j-1)-f(a_j)))
&\end{align*}</script><p>而</p>
<script type="math/tex; mode=display">
\begin{align*}
&\sum_i \frac{a_i}{m(m-1)}\sum_{j\neq i}a_j(f(a_j-1)-f(a_j)))\\\\
&=\sum_ja_j(f(a_j-1)-f(a_j))) \sum_{i\neq j} \frac{a_i}{m(m-1)}\\\\
&=\sum_i a_i(f(a_i-1)-f(a_i))\frac{m-a_i}{m(m-1)}
&\end{align*}</script><p>两部分相加，有</p>
<script type="math/tex; mode=display">
\begin{align*}
&\sum_i \Phi(A)\frac{a_i}{m(m-1)}(a_i-1+m-a_i)+\frac{a_i(m-a_i)}{m(m-1)}(f(a_i+1)+f(a_i-1)-2f(a_i))\\\\
&=\frac{\Phi(A)}{m} \sum_i a_i+\sum_i \frac{a_i(m-a_i)}{m(m-1)}(f(a_i+1)+f(a_i-1)-2f(a_i))\\\\
&=\Phi(A)+\sum_i \frac{a_i(m-a_i)}{m(m-1)}(f(a_i+1)+f(a_i-1)-2f(a_i))\\\\
&\mbox{要等于}\ \Phi(A)-1\\\\
&\mbox{即}\ 1+\sum_i \frac{a_i(m-a_i)}{m(m-1)}(f(a_i+1)+f(a_i-1)-2f(a_i))=0
&\end{align*}</script><p>这里分出了两条路，事关 $1$ 的拆法选择。一方面，$1$ 可以拆成 $n\cdot \frac{1}{n}$，但我这样拆下去后，发现最后在计算 $f(m)$ 会遇到比较大的阻力，我们是需要求 $\sum_{i=1}^m \frac{1}{i}$，而这个虽然可以 $O(\sqrt{m}\log m)$ 求出，但首先模数很丑陋，其次写这个也很麻烦，所以我们尝试另外一种拆法：$\sum_i \frac{a_i}{m}$。这样我们可以得到一条式子</p>
<script type="math/tex; mode=display">
f(a_i+1)+f(a_i-1)-2f(a_i)=-\frac{m-1}{m-a_i}</script><p>接下来的求和就是些基本套路了，设差分，再求和，会得到 $f(x)=f(0)+xg(0)-x(m-1)+(m-1)(m-x)\sum_{i=0}^{x-1} \frac{1}{m-i}$。</p>
<p>很开心地发现 $f(m)$ 为一容易求出的数，因为后面那一串有个系数 $(m-x)$，于是很轻松地完成这里的求值。</p>
<p>同时 $\Phi(A_t)=f(m)+(n-1)f(0)$也为一定值，那么现在的问题就是证明</p>
<script type="math/tex; mode=display">
\Phi(A_t)\neq \Phi(A_i)\ \mbox{当且仅当}\ i\neq t</script><p>而当 $x&lt;m$​ 时，$0&lt;(m-1)(m-x)\sum_{i=0}^{x-1} \frac{1}{m-i}$​，不妨令 $g(0)=0$​，则  $f(m)&lt;f(i),i=0,1,…,m-1$​，再令 $f(0)=0$​，则 $\Phi(A_t)&lt;\Phi(A_i),i=0,1,…,t-1$​，就证明了上述条件。</p>
<p>事实上，令 $g(0)=m-1,f(0)=0$ 可以得到更好的效果。</p>
<p>最后，根据 $E(t)=\Phi(A_0)-\Phi(A_t)$，我们就解决了这道题。</p>
<p>时间复杂度 $O(n\log n)$ 或者 $O(n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.7.12 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    <span class="keyword">int</span> m;</span><br><span class="line">    <span class="keyword">int</span> f[N],sinv[N],mxa;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>(),<span class="built_in">add</span>(m,a[i]),mxa=<span class="built_in">max</span>(mxa,a[i]);</span><br><span class="line">        <span class="comment">//f(0)=0,f(x)=-x(m-1)+(m-1)(m-x)\sum_&#123;i=m-x+1&#125;^m 1/i</span></span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=mxa;i++)sinv[i]=<span class="built_in">Add</span>(sinv[i<span class="number">-1</span>],<span class="built_in">qpow</span>(<span class="built_in">Add</span>(m+<span class="number">1</span>,kcz-i)));</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=mxa;i++)f[i]=<span class="built_in">mul</span>(<span class="built_in">Add</span>(m,kcz<span class="number">-1</span>),<span class="built_in">Add</span>(<span class="built_in">mul</span>(<span class="built_in">Add</span>(m,kcz-i),sinv[i]),kcz-i));</span><br><span class="line">        res ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">add</span>(ans,f[a[i]]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">Add</span>(ans,<span class="built_in">mul</span>(m,<span class="built_in">Add</span>(m,kcz<span class="number">-1</span>))));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF1349-D"><a href="#CF1349-D" class="headerlink" title="[CF1349 D]"></a>[CF1349 D]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有 $n$ 个人, 第 $i$ 个人有 $a_i$个饼干，$\sum_i a_i=m$。<br>每次随机选择一个饼干, 将其随机分配给除了它现在所有者的其他 $n-1$ 个人。<br>求使得一个人拥有所有饼干的期望步数, 对 $998244353$ 取模。</p>
<p>做法：考虑一个离散时间鞅为 $A_0,A_1,…$，设其停时为 $t$，终止状态为 $A_t$，则我们要求的是 $E(t)$。</p>
<p>设 $A_p=\lbrace a_{p,1},a_{p,2},…,a_{p,m_p} \rbrace$。其中 $a_{p,i}$ 表示第 $p$ 个局面下第 $i$ 个人拥有的饼干数，于是有$\sum_{i=1}^{n} a_{p,i}=m$。构造 $A_p$ 局面的势能函数为 $\Phi(A_p)=\sum f(a_{p,i})$。</p>
<p>同上的做法，利用</p>
<script type="math/tex; mode=display">
E(\Phi(A_{n+1})-\Phi(A_n)|A_0,A_1,...,A_n)=-1</script><p>我们快速写出 $f$ 的关系式：</p>
<script type="math/tex; mode=display">
\begin{align*}
&\Phi(A)-1=\\\\
&\sum_i \sum_{j\neq i} \frac{a_i}{m(n-1)} (f(a_i-1)+f(a_j+1)+\Phi(A)-f(a_i)-f(a_j))\\\\
&\mbox{经过一定的化简，很容易得到}\\\\
&(n-1)x[f(x)-f(x-1)]-(n-1)x=(m-x)[f(x+1)-f(x)]
&\end{align*}</script><p>接下来就能随意暴力递推 $f$ 了。</p>
<p>但这里依然存在一些问题，我们并没有证明 $\Phi(A_t)=f(m)+(n-1)f(0)$ 的唯一性。</p>
<p>即 $f(m)+(n-1)f(0)=\sum_{i=1}^n f(a_i),\sum_i a_i=m$ 当且仅当 $a_1=m,a_2,…,a_n=0$。</p>
<p><del>我现在仍然不会证明，网上似乎也没找到，而代码中用 $f(0)=0$ 是可以过的，这里留个坑，等以后证出来再来补好了。（有人证出或证伪的话来教教我呀</del></p>
<p>已经被别人教会了。</p>
<p>当我们设 $f(0)=0,g(0)=0$ 时，有 $f(1)=0,g(x)&lt;0,x\neq 0$。而 $f(x+1)-f(x)=g(x+1)&lt; 0$ ，即 $f(x+1)&lt;f(x)$，通过这个可以得到 $f(m)$ 为最小值，于是我们证明了 $\Phi(A_t)$ 的唯一性。 </p>
<p>最后 $E(t)=\Phi(A_0)-\Phi(A_t)$。</p>
<p>时间复杂度 $O(m)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.7.12 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">3e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    <span class="keyword">int</span> m;</span><br><span class="line">    <span class="keyword">int</span> f[N],inv[N],g[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//g(x)=f(x)-f(x-1)</span></span><br><span class="line">        <span class="comment">//(m-x)g(x+1)=(n-1)xg(x)-(n-1)x</span></span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>(),m+=a[i];</span><br><span class="line">        inv[<span class="number">0</span>]=inv[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=m;i++)inv[i]=<span class="built_in">mul</span>(inv[kcz%i],kcz-kcz/i);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)g[i+<span class="number">1</span>]=<span class="built_in">mul</span>(inv[m-i],<span class="built_in">mul</span>(<span class="built_in">mul</span>(n<span class="number">-1</span>,i),<span class="built_in">Add</span>(g[i],kcz<span class="number">-1</span>)));</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)f[i]=<span class="built_in">Add</span>(f[i<span class="number">-1</span>],g[i]);</span><br><span class="line">        res ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">add</span>(ans,f[a[i]]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">Add</span>(ans,kcz-f[m]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">foreverlasting</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://foreverlasting1202.github.io/2021/06/13/%E5%A4%8D%E5%81%A5%E8%AE%AD%E7%BB%83/">http://foreverlasting1202.github.io/2021/06/13/复健训练/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/OI/">OI</a></div><div class="post_share"><div class="social-share" data-image="https://s2.loli.net/2022/02/01/gGXzMx9q43OfoId.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/06/13/tips/"><img class="prev-cover" src="https://s2.loli.net/2022/02/01/wx5uN2Uv4EQ6edW.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">一些需注意的点</div></div></a></div><div class="next-post pull-right"><a href="/2021/05/29/2021.5.29/"><img class="next-cover" src="https://pic.imgdb.cn/item/61fa04662ab3f51d91b75d86.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">2021.5.29高考前最后的寄望</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/02/05/loj%E9%9A%8F%E6%9C%BA%E5%81%9A%E9%A2%98/" title="loj 随机做题"><img class="cover" src="https://pic.imgdb.cn/item/61fa2df32ab3f51d91dd7301.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-05</div><div class="title">loj 随机做题</div></div></a></div><div><a href="/2021/10/18/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/" title="做题记录"><img class="cover" src="https://pic.imgdb.cn/item/61fa032b2ab3f51d91b65997.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-10-18</div><div class="title">做题记录</div></div></a></div><div><a href="/2021/08/10/%E5%8F%A3%E8%83%A1%E8%AE%B0%E5%BD%95/" title="口胡记录"><img class="cover" src="https://pic.imgdb.cn/item/61fa039f2ab3f51d91b6b75b.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-10</div><div class="title">口胡记录</div></div></a></div><div><a href="/2021/07/06/%E8%AE%AD%E7%BB%83%E5%AE%9E%E5%BD%95/" title="训练实录"><img class="cover" src="https://pic.imgdb.cn/item/61fa02cf2ab3f51d91b60ec0.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-06</div><div class="title">训练实录</div></div></a></div><div><a href="/2021/06/13/tips/" title="一些需注意的点"><img class="cover" src="https://s2.loli.net/2022/02/01/wx5uN2Uv4EQ6edW.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-13</div><div class="title">一些需注意的点</div></div></a></div><div><a href="/2022/05/10/AHOI2022/" title="AHOI2022"><img class="cover" src="https://pic.imgdb.cn/item/61fa051f2ab3f51d91b7edfb.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-10</div><div class="title">AHOI2022</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/cccute.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">foreverlasting</div><div class="author-info__description">呜呜呜。</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">147</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">4</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">40</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/foreverlasting1202" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/573902690@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">为啥仍然是个没脑子人呢？</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#ARC122"><span class="toc-number">1.</span> <span class="toc-text">[ARC122]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ARC122-A"><span class="toc-number">1.1.</span> <span class="toc-text">[ARC122 A]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ARC122-B"><span class="toc-number">1.2.</span> <span class="toc-text">[ARC122 B]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ARC122-C"><span class="toc-number">1.3.</span> <span class="toc-text">[ARC122 C]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ARC122-D"><span class="toc-number">1.4.</span> <span class="toc-text">[ARC122 D]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ARC122-E"><span class="toc-number">1.5.</span> <span class="toc-text">[ARC122 E]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ARC122-F"><span class="toc-number">1.6.</span> <span class="toc-text">[ARC122 F]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF1534"><span class="toc-number">2.</span> <span class="toc-text">[CF1534]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CF1534-F"><span class="toc-number">2.1.</span> <span class="toc-text">[CF1534 F]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CF1534-G"><span class="toc-number">2.2.</span> <span class="toc-text">[CF1534 G]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CF1534-H"><span class="toc-number">2.3.</span> <span class="toc-text">[CF1534 H]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF1537"><span class="toc-number">3.</span> <span class="toc-text">[CF1537]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CF1537-D"><span class="toc-number">3.1.</span> <span class="toc-text">[CF1537 D]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CF1537-E"><span class="toc-number">3.2.</span> <span class="toc-text">[CF1537 E]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CF1537-F"><span class="toc-number">3.3.</span> <span class="toc-text">[CF1537 F]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%9B%E5%AE%A2%E6%8C%91%E6%88%98%E8%B5%9B51"><span class="toc-number">4.</span> <span class="toc-text">[牛客挑战赛51]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%9B%E5%AE%A2%E6%8C%91%E6%88%98%E8%B5%9B51-C"><span class="toc-number">4.1.</span> <span class="toc-text">[牛客挑战赛51 C]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%9B%E5%AE%A2%E6%8C%91%E6%88%98%E8%B5%9B51-D"><span class="toc-number">4.2.</span> <span class="toc-text">[牛客挑战赛51 D]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%9B%E5%AE%A2%E6%8C%91%E6%88%98%E8%B5%9B51-E-loj-2476"><span class="toc-number">4.3.</span> <span class="toc-text">[牛客挑战赛51 E] [loj 2476]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%9B%E5%AE%A2%E6%8C%91%E6%88%98%E8%B5%9B51-F"><span class="toc-number">4.4.</span> <span class="toc-text">[牛客挑战赛51 F]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%89%9B%E5%AE%A2%E6%8C%91%E6%88%98%E8%B5%9B51-G"><span class="toc-number">4.5.</span> <span class="toc-text">[牛客挑战赛51 G]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ABC206-F"><span class="toc-number">5.</span> <span class="toc-text">[ABC206 F]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF1539-E"><span class="toc-number">6.</span> <span class="toc-text">[CF1539 E]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF1539-F"><span class="toc-number">7.</span> <span class="toc-text">[CF1539 F]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ULR-2"><span class="toc-number">8.</span> <span class="toc-text">[ULR #2]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ULR-2-A"><span class="toc-number">8.1.</span> <span class="toc-text">[ULR #2 A]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ULR-2-B"><span class="toc-number">8.2.</span> <span class="toc-text">[ULR #2 B]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ULR-2-C"><span class="toc-number">8.3.</span> <span class="toc-text">[ULR #2 C]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ULR-2-D"><span class="toc-number">8.4.</span> <span class="toc-text">[ULR #2 D]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ULR-2-E"><span class="toc-number">8.5.</span> <span class="toc-text">[ULR #2 E]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ULR-2-F"><span class="toc-number">8.6.</span> <span class="toc-text">[ULR #2 F]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AGC054"><span class="toc-number">9.</span> <span class="toc-text">[AGC054]</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#AGC054-D"><span class="toc-number">9.1.</span> <span class="toc-text">[AGC054 D]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AGC054-E"><span class="toc-number">9.2.</span> <span class="toc-text">[AGC054 E]</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#AGC054-F"><span class="toc-number">9.3.</span> <span class="toc-text">[AGC054 F]</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF1025-G"><span class="toc-number">10.</span> <span class="toc-text">[CF1025 G]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF850-F"><span class="toc-number">11.</span> <span class="toc-text">[CF850 F]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF1349-D"><span class="toc-number">12.</span> <span class="toc-text">[CF1349 D]</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/9102/01/01/%E8%BF%91%E6%9C%9F%E6%9B%B4%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2/" title="近期更新的博客"><img src="https://s2.loli.net/2022/02/01/ZGLrd376Kyx9wvE.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="近期更新的博客"/></a><div class="content"><a class="title" href="/9102/01/01/%E8%BF%91%E6%9C%9F%E6%9B%B4%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2/" title="近期更新的博客">近期更新的博客</a><time datetime="9102-01-01T13:50:00.000Z" title="Created 9102-01-01 21:50:00">9102-01-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/11/Cards,Hands,Decks/" title="Cards,Hands,Decks"><img src="https://pic.imgdb.cn/item/61fa03cf2ab3f51d91b6df0b.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Cards,Hands,Decks"/></a><div class="content"><a class="title" href="/2022/05/11/Cards,Hands,Decks/" title="Cards,Hands,Decks">Cards,Hands,Decks</a><time datetime="2022-05-11T15:30:00.000Z" title="Created 2022-05-11 23:30:00">2022-05-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/10/AHOI2022/" title="AHOI2022"><img src="https://pic.imgdb.cn/item/61fa051f2ab3f51d91b7edfb.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AHOI2022"/></a><div class="content"><a class="title" href="/2022/05/10/AHOI2022/" title="AHOI2022">AHOI2022</a><time datetime="2022-05-10T15:30:00.000Z" title="Created 2022-05-10 23:30:00">2022-05-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/06/ZJOI2022/" title="ZJOI2022"><img src="https://pic.imgdb.cn/item/61fa04402ab3f51d91b740a8.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ZJOI2022"/></a><div class="content"><a class="title" href="/2022/05/06/ZJOI2022/" title="ZJOI2022">ZJOI2022</a><time datetime="2022-05-06T15:30:00.000Z" title="Created 2022-05-06 23:30:00">2022-05-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/05/05/AT/" title="AT 板刷"><img src="https://pic.imgdb.cn/item/61fa2e5a2ab3f51d91ddd3cb.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="AT 板刷"/></a><div class="content"><a class="title" href="/2022/05/05/AT/" title="AT 板刷">AT 板刷</a><time datetime="2022-05-05T15:30:00.000Z" title="Created 2022-05-05 23:30:00">2022-05-05</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By foreverlasting</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Local search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'vBIv3E8Y4e1znLKVs85Y0uSh-gzGzoHsz',
      appKey: 'Dpqs6OR87Ev6XoG6XcSPjToh',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>