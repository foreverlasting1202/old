<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>做题记录 | foreverlasting's blog</title><meta name="keywords" content="OI"><meta name="author" content="foreverlasting"><meta name="copyright" content="foreverlasting"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="感觉一直把一些做的其他题放在复健里也不太对，所以新开了一篇。">
<meta property="og:type" content="article">
<meta property="og:title" content="做题记录">
<meta property="og:url" content="http://foreverlasting1202.github.io/2021/10/18/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/index.html">
<meta property="og:site_name" content="foreverlasting&#39;s blog">
<meta property="og:description" content="感觉一直把一些做的其他题放在复健里也不太对，所以新开了一篇。">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://pic.imgdb.cn/item/61fa049e2ab3f51d91b7852f.jpg">
<meta property="article:published_time" content="2021-10-18T15:30:00.000Z">
<meta property="article:modified_time" content="2022-03-30T12:24:54.776Z">
<meta property="article:author" content="foreverlasting">
<meta property="article:tag" content="OI">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://pic.imgdb.cn/item/61fa049e2ab3f51d91b7852f.jpg"><link rel="shortcut icon" href="/img/1.jpg"><link rel="canonical" href="http://foreverlasting1202.github.io/2021/10/18/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '做题记录',
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isToc: true,
  postUpdate: '2022-03-30 20:24:54'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/cute.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">141</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">3</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">40</div></a></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> Messageboard</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> myself</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://pic.imgdb.cn/item/61fa049e2ab3f51d91b7852f.jpg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">foreverlasting's blog</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> Messageboard</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fa fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/timeline/"><i class="fa-fw fa fa-bell"></i><span> Timeline</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-sitemap"></i><span> About</span></a></div><div class="menus_item"><a class="site-page" href="/myself/"><i class="fa-fw fa fa-id-card"></i><span> myself</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">做题记录</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-10-18T15:30:00.000Z" title="Created 2021-10-18 23:30:00">2021-10-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2022-03-30T12:24:54.776Z" title="Updated 2022-03-30 20:24:54">2022-03-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/">做题记录</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="做题记录"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>感觉一直把一些做的其他题放在复健里也不太对，所以新开了一篇。<br><span id="more"></span></p>
<h3 id="CF1368-F"><a href="#CF1368-F" class="headerlink" title="[CF1368 F]"></a>[CF1368 F]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：<em>这是一道交互题</em>。</p>
<p>Alice 和 Bob 正在玩游戏，有 $n$ 盏灯排成一圈，顺时针标号为 $1\backsim n$。起初所有的灯都处于关闭状态。</p>
<p>游戏由 Alice 先手，她每次可以选定任意一个正整数 $k\in [1,n]$ 并指定任意 $k$ 盏灯，并将其打开 ( 如果原来就是开着的那么仍然是开着的 )，然后 Bob 可以选定任意连续 $k$ 盏灯，并将其关闭 ( 如果原来就是关闭的那么仍然是关闭的 )，他需要保证他选择的 $k$ 值和 Alice 的相同。</p>
<p>每一轮 Alice 操作后 Bob 再操作，被称为一个回合。Alice 想要在若干回合后让开着的灯的数量尽可能多，而 Bob 希望这个数尽可能少。</p>
<p>你需要写一个程序模拟 Alice，以帮助她完成最优策略，Bob 则由交互库来模拟。</p>
<p>设在最优策略下，若干个回合后开着的灯的数量的最大可能值为 $R(n)$，你需要在不超过 $10^4$ 回合内将开着的灯的数量达到这个值。</p>
<p>做法：发现 Alice 为了尽可能多，肯定要打开一些不连续的灯。打开到一定程度，使得灯被迫有 $k$ 个相连时，接下来的操作就都是无效的了。</p>
<p>假设间隔是 $k$，可以算得答案最多是 $n-k-\lceil\frac{n}{k}\rceil+1$，这可以通过鸽巢原理证明。而取到这个的方法就像我前面所说的，以 $k$ 个为一组了。</p>
<p>对答案式子进行上取整和根号的分类讨论，可得 $k=\lfloor\sqrt{n}\rfloor$ 时取到最大值 $n-2\lceil\sqrt{n}\rceil+1$。</p>
<p>时间复杂度 $O(n^2)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.10.19 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> a[N],swt[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res n=<span class="built_in">read</span>();</span><br><span class="line">        res k=<span class="built_in"><span class="keyword">int</span></span>(<span class="built_in">sqrt</span>(n));</span><br><span class="line">        <span class="keyword">for</span>(res i=k;i&lt;=n;i+=k)a[i]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res T=<span class="number">1</span>;T&lt;=<span class="number">10000</span>;T++)&#123;</span><br><span class="line">            res ax=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)ax+=((swt[i]==<span class="number">0</span>)&amp;&amp;(a[i]==<span class="number">0</span>));</span><br><span class="line">            <span class="keyword">if</span>(ax&lt;k)&#123;<span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);<span class="built_in">fflush</span>(stdout);<span class="keyword">return</span>;&#125;</span><br><span class="line">            ax=<span class="number">0</span>,<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,k);</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n&amp;&amp;ax&lt;k;i++)<span class="keyword">if</span>(!a[i]&amp;&amp;!swt[i])swt[i]=<span class="number">1</span>,<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i),ax++;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>),<span class="built_in">fflush</span>(stdout),ax=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=k;i++)swt[ax]=<span class="number">0</span>,ax=ax%n+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);<span class="built_in">fflush</span>(stdout);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CEOI-2016-kangaroo"><a href="#CEOI-2016-kangaroo" class="headerlink" title="[CEOI 2016] kangaroo"></a>[CEOI 2016] kangaroo</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：固定第一个数和最后一个数的长度为 $n$ 的排列，满足每个数要么是波谷，要么是波峰，问排列个数。</p>
<p>做法：考虑从每一个合法排列往前构造。假设现在有一个合法排列了，我们删去它的最大值，发现整个排列被分成两段，且端点要么是起点或终点，要么是波谷。不断进行这个操作，发现删去的顺序一定是唯一的，同时每一段的端点要么是起点或终点，要么是波谷，要么就是自己一个数。我们拿这个做 $\mathrm{dp}$，考虑从最小的数开始塞入排列，设 $f_{i,j}$ 表示已经塞到了 $i$，同时有 $j$ 个连续段的方案数。注意到这里的连续段是类似上述删除时那样构造的，即我们不管连续段之间的空格数。转移就是考虑删除的过程中，我们将 $i+1$ 删除时怎么才会变到 $(i,j)$ 这个状态。要么 $i+1$ 是单独的一个连续段，即从 $(i+1,j+1)$ 转移而来，那么要求 $i+1$ 塞在了任意两段连续段之间，即 $f_{i+1,j+1}\leftarrow^+ f_{i,j}$。要么它是两个连续段之间夹的波谷，即 $f_{i+1,j-1}\leftarrow^+ f_{i,j}$。$i+1$ 是起点和终点特殊讨论，最终一定被塞成一段，即 $f_{n,1}$。而这个 $\mathrm{dp}$ 的正确性已经在删除的过程中被证明了。</p>
<p>时间复杂度 $O(n^2)$。</p>
<p>听说这被称作水淹笛卡尔树？不太懂。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.10.28 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,s,t;</span><br><span class="line">    <span class="keyword">int</span> f[N][N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        f[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>,n=<span class="built_in">read</span>(),s=<span class="built_in">read</span>(),t=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;i;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i==s||i==t)<span class="built_in">add</span>(f[i][j],f[i<span class="number">-1</span>][j]),<span class="built_in">add</span>(f[i][j+<span class="number">1</span>],f[i<span class="number">-1</span>][j]);</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    res c=(i&gt;s)+(i&gt;t);</span><br><span class="line">                    <span class="built_in">add</span>(f[i][j+<span class="number">1</span>],<span class="built_in">mul</span>(f[i<span class="number">-1</span>][j],j+<span class="number">1</span>-c));</span><br><span class="line">                    <span class="keyword">if</span>(j)<span class="built_in">add</span>(f[i][j<span class="number">-1</span>],<span class="built_in">mul</span>(f[i<span class="number">-1</span>][j],j<span class="number">-1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,f[n][<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="SNOI-2020-区间和"><a href="#SNOI-2020-区间和" class="headerlink" title="[SNOI 2020] 区间和"></a>[SNOI 2020] 区间和</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有一个长度为 $n$ 的整数数列 $a_1, a_2, \dots, a_n$（可能含有负数）。现在对其进行 $q$ 次操作，每次操作是以下二者之一：</p>
<ul>
<li><code>0 l r x</code> 表示对于 $i = l, l+1, \dots, r$，将 $a_i$ 赋值为 $\max(a_i, x)$；</li>
<li><code>1 l r</code> 求区间 $[l, r]$ 的最大子段和。即：$\max(0, \max_{l\le u\le v\le r} (\sum_{i=u}^v a_i))$。</li>
</ul>
<p>做法：显然的 $\mathrm{segment beats}$，不过没那么容易直接上手。</p>
<p>分析一下，按照那套逻辑，我们还要维护前缀最大值中有几个最小值，后缀的，全局最大的，发现这也不够维护所有信息，于是还得维护个能改变区间结构的最小取 $\max$ 值，这样就差不多了。然后手推一下这一些信息倒还是<del>容易的</del>，于是就给我写麻了，好难写捏。</p>
<p>时间复杂度你冷静分析一下，大概是要 $O(n\log^2 n)$？</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.11.9 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,q;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TR</span>&#123;</span></span><br><span class="line">        LL lm,rm,mx,sum;</span><br><span class="line">        <span class="keyword">int</span> lc,rc,mc,c,mn,laz,tg;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">const</span> res &amp;x)</span></span>&#123;</span><br><span class="line">            sum=mn=x,c=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(x&lt;=<span class="number">0</span>)lm=rm=mx=lc=rc=mc=tg=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">else</span> lm=rm=mx=x,lc=rc=mc=<span class="number">1</span>,tg=inf;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(res val)</span></span>&#123;</span><br><span class="line">            laz=val,<span class="built_in">swap</span>(mn,val),val=mn-val;</span><br><span class="line">            sum+=(LL)val*c,lm+=(LL)val*lc,rm+=(LL)val*rc,mx+=(LL)val*mc;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;tr[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushup</span><span class="params">(<span class="keyword">const</span> res &amp;rt)</span></span>&#123;</span><br><span class="line">        tr[rt].sum=tr[rt&lt;&lt;<span class="number">1</span>].sum+tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum;</span><br><span class="line">        tr[rt].mn=<span class="built_in">min</span>(tr[rt&lt;&lt;<span class="number">1</span>].mn,tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].mn);</span><br><span class="line">        res fl=(tr[rt&lt;&lt;<span class="number">1</span>].mn==tr[rt].mn),fr=(tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].mn==tr[rt].mn);</span><br><span class="line">        tr[rt].c=fl*tr[rt&lt;&lt;<span class="number">1</span>].c+fr*tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].c;</span><br><span class="line">        tr[rt].tg=<span class="built_in">min</span>(&#123;tr[rt&lt;&lt;<span class="number">1</span>].tg,tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].tg,fl?tr[rt&lt;&lt;<span class="number">1</span>].tg:tr[rt&lt;&lt;<span class="number">1</span>].mn<span class="number">-1</span>,fr?tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].tg:tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].mn<span class="number">-1</span>&#125;);</span><br><span class="line">        res c1=fl*tr[rt&lt;&lt;<span class="number">1</span>].lc,c2=fl*tr[rt&lt;&lt;<span class="number">1</span>].c+fr*tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].lc;</span><br><span class="line">        RG LL s1=tr[rt&lt;&lt;<span class="number">1</span>].lm,s2=tr[rt&lt;&lt;<span class="number">1</span>].sum+tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].lm;</span><br><span class="line">        <span class="keyword">if</span>(s2&gt;s1)tr[rt].lm=s2,tr[rt].lc=c2;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            tr[rt].lm=s1,tr[rt].lc=c1;</span><br><span class="line">            <span class="keyword">if</span>(c2&gt;c1)tr[rt].tg=(<span class="keyword">int</span>)<span class="built_in">min</span>((LL)tr[rt].tg,tr[rt].mn+(s1-s2)/(c2-c1));</span><br><span class="line">        &#125;</span><br><span class="line">        c1=fr*tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].rc,c2=fr*tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].c+fl*tr[rt&lt;&lt;<span class="number">1</span>].rc;</span><br><span class="line">        s1=tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].rm,s2=tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].sum+tr[rt&lt;&lt;<span class="number">1</span>].rm;</span><br><span class="line">        <span class="keyword">if</span>(s2&gt;s1)tr[rt].rm=s2,tr[rt].rc=c2;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            tr[rt].rm=s1,tr[rt].rc=c1;</span><br><span class="line">            <span class="keyword">if</span>(c2&gt;c1)tr[rt].tg=(<span class="keyword">int</span>)<span class="built_in">min</span>((LL)tr[rt].tg,tr[rt].mn+(s1-s2)/(c2-c1));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(tr[rt&lt;&lt;<span class="number">1</span>].rm+tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].lm&gt;<span class="built_in">max</span>(tr[rt&lt;&lt;<span class="number">1</span>].mx,tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].mx))tr[rt].mx=tr[rt&lt;&lt;<span class="number">1</span>].rm+tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].lm,tr[rt].mc=fl*tr[rt&lt;&lt;<span class="number">1</span>].rc+fr*tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].lc;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(tr[rt&lt;&lt;<span class="number">1</span>].mx&gt;tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].mx)tr[rt].mx=tr[rt&lt;&lt;<span class="number">1</span>].mx,tr[rt].mc=fl*tr[rt&lt;&lt;<span class="number">1</span>].mc;</span><br><span class="line">        <span class="keyword">else</span> tr[rt].mx=tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].mx,tr[rt].mc=fr*tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].mc;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(res rt,res l,res r)</span></span>&#123;</span><br><span class="line">        tr[rt].laz=inf;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;tr[rt].<span class="built_in">init</span>(<span class="built_in">read</span>());<span class="keyword">return</span>;&#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(rt&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r),<span class="built_in">pushup</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">const</span> res &amp;rt)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(tr[rt].laz!=inf)&#123;</span><br><span class="line">            <span class="keyword">if</span>(tr[rt].laz&gt;tr[rt&lt;&lt;<span class="number">1</span>].mn)tr[rt&lt;&lt;<span class="number">1</span>].<span class="built_in">change</span>(tr[rt].laz);</span><br><span class="line">            <span class="keyword">if</span>(tr[rt].laz&gt;tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].mn)tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>].<span class="built_in">change</span>(tr[rt].laz);</span><br><span class="line">            tr[rt].laz=inf;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R,<span class="keyword">const</span> res &amp;val)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(val&lt;=tr[rt].mn)<span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R&amp;&amp;val&lt;=tr[rt].tg)&#123;tr[rt].<span class="built_in">change</span>(val);<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;tr[rt].<span class="built_in">init</span>(val);<span class="keyword">return</span>;&#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R,val);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R,val);</span><br><span class="line">        <span class="built_in">pushup</span>(rt);</span><br><span class="line">    &#125;</span><br><span class="line">    LL qmx,qrm;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;</span><br><span class="line">            qmx=<span class="built_in">max</span>(&#123;qmx,tr[rt].mx,qrm+tr[rt].lm&#125;),qrm=<span class="built_in">max</span>(qrm+tr[rt].sum,tr[rt].rm);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)<span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),q=<span class="built_in">read</span>(),<span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">        <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">            res opt=<span class="built_in">read</span>(),l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">if</span>(opt==<span class="number">0</span>)<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,l,r,<span class="built_in">read</span>());</span><br><span class="line">            <span class="keyword">else</span> qmx=qrm=<span class="number">0</span>,<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">1</span>,n,l,r),<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,qmx);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="JOI-Open-2016-摩天大楼"><a href="#JOI-Open-2016-摩天大楼" class="headerlink" title="[JOI Open 2016] 摩天大楼"></a>[JOI Open 2016] 摩天大楼</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：将互不相同的 $N$ 个整数 $A_1, A_2, \dots, A_N$ 按照一定顺序排列。  假设排列为 $f_1, f_2, \dots, f_N$，要求：$ | f_1 − f_2| + | f_2 − f_3| + \dots + | f_{N−1} − f_N| ≤ L$。  求满足题意的排列的方案数 $\bmod (10^9+7)$。</p>
<p>做法：直接考虑从小到大插入似乎不太行，因为和不是单调的，所以 $L$ 这一维那开到 $nA$ ，过不了。</p>
<p>但如果考虑将 $|f_{i}-f_{i-1}|$ 看成 $\sum A_i-A_{i-1}$ ，那考虑算 $A_i-A_{i-1}$ 的贡献就有搞头了。这个东西的系数显然是满足一个大于等于 $A_i$，一个小于等于 $A_{i-1}$ 的相邻数对个数。那仍旧考虑从小到大插入，$f_{i,j,k,p}$ 分别表示当前插到了第 $i$ 个数，形成了 $j$ 个连续段，贡献和为 $k$，头尾用了 $p$ 个的方案数。这里的贡献和我们考虑上面那个贡献，意思就是考虑 $A_i-A_{i-1}$ 的贡献。这个利用连续段是可以直接算的，因为接下来插入的都会比 $A_i$ 大，而之前的都小于等于 $A_{i-1}$，于是只要插在一个段的两边就可以了。转移都是类似的，时间复杂度 $O(n^2l)$。</p>
<p>坑：$n=1$ 时头就是尾，需要特判。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.11.12 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">100</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,l;</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    <span class="keyword">int</span> f[N][N][<span class="number">1000</span>+<span class="number">1</span>][<span class="number">3</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),l=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="number">1</span>)&#123;<span class="built_in">puts</span>(<span class="string">&quot;1&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">sort</span>(a+<span class="number">1</span>,a+n+<span class="number">1</span>),f[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=i;j++)</span><br><span class="line">                <span class="keyword">for</span>(res k=<span class="number">0</span>;k&lt;=l;k++)</span><br><span class="line">                    <span class="keyword">for</span>(res p=<span class="number">0</span>;p&lt;=<span class="number">2</span>;p++)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(!f[i][j][k][p])<span class="keyword">continue</span>;</span><br><span class="line">                        res val=k+(<span class="number">2</span>*j-p)*(a[i+<span class="number">1</span>]-a[i]);</span><br><span class="line">                        <span class="keyword">if</span>(val&gt;l)<span class="keyword">continue</span>;</span><br><span class="line">                        <span class="built_in">add</span>(f[i+<span class="number">1</span>][j+<span class="number">1</span>][val][p],<span class="built_in">mul</span>(j+<span class="number">1</span>-p,f[i][j][k][p]));</span><br><span class="line">                        <span class="built_in">add</span>(f[i+<span class="number">1</span>][j][val][p],<span class="built_in">mul</span>(<span class="number">2</span>*j-p,f[i][j][k][p]));</span><br><span class="line">                        <span class="keyword">if</span>(p&lt;<span class="number">2</span>)<span class="built_in">add</span>(f[i+<span class="number">1</span>][j+<span class="number">1</span>][val][p+<span class="number">1</span>],<span class="built_in">mul</span>(<span class="number">2</span>-p,f[i][j][k][p]));</span><br><span class="line">                        <span class="keyword">if</span>(j)<span class="built_in">add</span>(f[i+<span class="number">1</span>][j<span class="number">-1</span>][val][p],<span class="built_in">mul</span>(j<span class="number">-1</span>,f[i][j][k][p]));</span><br><span class="line">                        <span class="keyword">if</span>(p&lt;<span class="number">2</span>&amp;&amp;j)<span class="built_in">add</span>(f[i+<span class="number">1</span>][j][val][p+<span class="number">1</span>],<span class="built_in">mul</span>(<span class="number">2</span>-p,f[i][j][k][p]));</span><br><span class="line">                    &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        res ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=l;i++)<span class="built_in">add</span>(ans,f[n][<span class="number">1</span>][i][<span class="number">2</span>]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="TC12336"><a href="#TC12336" class="headerlink" title="[TC12336]"></a>[TC12336]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给你一张图，要求删去若干条边，让残余图无论以什么形态都不能有边相交。求可以得到的残余图数量。</p>
<p>做法：观察一下就只有三角形或者菊花是可以的。于是枚举哪个点作为菊花的中心点以及有几个三角线即可。注意只剩一条边的情况会被端点算重，减掉即可。时间复杂度 $O(m\sqrt{m})$ 或者暴力点来个 $O(n^3)$ 之类的。</p>
</div></div>
<h3 id="CF674-F"><a href="#CF674-F" class="headerlink" title="[CF674 F]"></a>[CF674 F]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：酒店中有 $n$ 只熊和 $p$ 张床，这些熊正在开晚会。</p>
<p>熊喜欢喝果汁，它们不喜欢喝葡萄酒。但是它们无法仅通过颜色和气味辨别果汁和葡萄酒。</p>
<p>一只熊可以一直在晚会上活动而不睡觉，除非它喝了葡萄酒。当一只熊喝完葡萄酒后，它立即会去睡觉，且在晚会期间不再醒来。</p>
<p>现在有若干个酒桶，每个酒桶中装填了果汁或葡萄酒，其中<strong>恰有一个桶中</strong>装了葡萄酒。酒桶的主人为了测试熊的智力，给它们一个如下挑战：</p>
<p>晚会会进行许多天。每天，会依次发生如下三件事情：</p>
<ol>
<li><p>每只熊需要选择一个桶的子集 (可以为空集)，多个熊可以同时选择一个桶。</p>
</li>
<li><p>每只熊需要把它选择的桶中的所有饮料都喝一小杯 (假设桶足够大，够所有的熊喝)。</p>
</li>
<li><p>对于所有喝到过酒的熊 (喝完饮料后它们自己能发现是否喝到过酒)，马上会上床睡觉，并在<strong>整个晚会期间不再醒来</strong> (i.e. 即它们不能参与剩下几天的活动了)。</p>
<p>每张床恰能容纳一只熊，如果有熊无床睡觉，则挑战失败。</p>
</li>
</ol>
<p>如果晚会结束后，这些熊中至少有一只没睡觉，且没有无床睡觉，并且它们能推理出哪个桶中装了葡萄酒 (假设熊足够聪明)，则挑战成功。</p>
<p>容易证明，对于一个确定的 $i$，如果晚会开了 $i$ 天，则存在非负整数 $R_i$，满足：这些熊可以在 $R_i$ 个酒桶中<strong>确保挑战成功</strong>，但在 $R_i+1$ 个酒桶中<strong>无法保证挑战成功</strong>。</p>
<p>给定正整数 $n,p,q$，你需要求出 $\displaystyle \bigoplus_{i=1}^q \left( \left( i \cdot R_i \right) \bmod 2^{32} \right)$，其中 $\bigoplus$ 表示按位异或运算。</p>
<p>做法：通过手玩样例 $3$，容易意识到我们总想每一桶饮料喝的熊的集合不相同。</p>
<p>于是枚举每一桶饮料喝的熊的数量 $i$，那么共有 $\binom{n}{i} q^i$ 种熊去喝的情况。同时一桶饮料若没有熊去喝，那么也可以判断。</p>
<p>再加上熊不能全喝醉，所以答案就是</p>
<script type="math/tex; mode=display">
\sum_{i=0}^{\min(n-1,p)} \binom{n}{i}q^i</script><p>注意到 $p$ 很小，所以暴力预处理组合数即可。组合数考虑将分子分母的 $2$ 都先拿出来，最后再放回去。那分母就是奇数，利用欧拉定理就可以直接求逆元了。时间复杂度 $O(pq)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.11.18 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    uint inv[<span class="number">140</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> uint <span class="title">Qpow</span><span class="params">(uint x,uint y)</span></span>&#123;</span><br><span class="line">        uint ret=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(y)&#123;</span><br><span class="line">            <span class="keyword">if</span>(y&amp;<span class="number">1</span>)ret*=x;</span><br><span class="line">            x*=x,y&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    uint C[<span class="number">140</span>];</span><br><span class="line">    <span class="keyword">int</span> even[<span class="number">140</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">130</span>;i++)inv[i]=<span class="built_in">Qpow</span>(i,(((uint)<span class="number">1</span>)&lt;&lt;<span class="number">31</span>)<span class="number">-1</span>);</span><br><span class="line">        res n=<span class="built_in">read</span>(),p=<span class="built_in">read</span>(),q=<span class="built_in">read</span>();</span><br><span class="line">        C[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="built_in">min</span>(p,n<span class="number">-1</span>);i++)&#123;</span><br><span class="line">            uint x=i,z=n-i+<span class="number">1</span>;</span><br><span class="line">            even[i]=even[i<span class="number">-1</span>]+<span class="built_in">ctz</span>(n-i+<span class="number">1</span>)-<span class="built_in">ctz</span>(i);</span><br><span class="line">            x&gt;&gt;=<span class="built_in">ctz</span>(i),z&gt;&gt;=<span class="built_in">ctz</span>(n-i+<span class="number">1</span>);</span><br><span class="line">            C[i]=C[i<span class="number">-1</span>]*z*inv[x];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="built_in">min</span>(p,n<span class="number">-1</span>);i++)C[i]&lt;&lt;=even[i];</span><br><span class="line">        uint ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=q;i++)&#123;</span><br><span class="line">            uint X=<span class="number">0</span>,r=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=<span class="built_in">min</span>(p,n<span class="number">-1</span>);j++)X+=C[j]*r,r*=i;</span><br><span class="line">            ans^=X*i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%u\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF674-G"><a href="#CF674-G" class="headerlink" title="[CF674 G]"></a>[CF674 G]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给定一个长度为 $n$ 的序列和一个整数 $p$。有 $m$ 个操作，操作要么是区间赋值，要么是询问区间内出现次数至少占 $p\%$ 的数。输出询问的答案时，可以包含错的数，也可以重复输出，但对的数一定要在答案中，且输出的数的个数不超过 $\lfloor\frac{100}{p}\rfloor$。</p>
<p>做法：考虑摩根（ 忘记名字了 ）投票法，就那个加一个就删一个的。注意到 $p\geq 20$，所以最多维护五个数。所以线段树每个节点维护个五元组就好了，时间复杂度 $O(5^2n\log n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.11.19 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">150000</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m,p;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">P</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> num,tag,a[<span class="number">5</span>],b[<span class="number">5</span>];</span><br><span class="line">    &#125;tr[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> len[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> P <span class="title">merge</span><span class="params">(<span class="keyword">const</span> RG P &amp;A,<span class="keyword">const</span> RG P &amp;B)</span></span>&#123;</span><br><span class="line">        RG P ret=A;</span><br><span class="line">        ret.tag=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;B.num;i++)&#123;</span><br><span class="line">            RG <span class="keyword">bool</span> fl=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;ret.num&amp;&amp;!fl;j++)<span class="keyword">if</span>(B.a[i]==ret.a[j])ret.b[j]+=B.b[i],fl=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(fl)<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">if</span>(ret.num&lt;p)&#123;ret.a[ret.num]=B.a[i],ret.b[ret.num]=B.b[i],ret.num++;<span class="keyword">continue</span>;&#125;</span><br><span class="line">            res mnid=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;ret.num;j++)<span class="keyword">if</span>(ret.b[j]&lt;ret.b[mnid])mnid=j;</span><br><span class="line">            <span class="keyword">if</span>(B.b[i]&lt;ret.b[mnid])&#123;</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;ret.num;j++)ret.b[j]-=B.b[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                res tmp=ret.b[mnid];</span><br><span class="line">                ret.a[mnid]=B.a[i],ret.b[mnid]=B.b[i];</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;ret.num;j++)ret.b[j]-=tmp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(res rt,res l,res r)</span></span>&#123;</span><br><span class="line">        len[rt]=r-l+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>();</span><br><span class="line">            tr[rt].num=tr[rt].b[<span class="number">0</span>]=<span class="number">1</span>,tr[rt].a[<span class="number">0</span>]=x;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(rt&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r),tr[rt]=<span class="built_in">merge</span>(tr[rt&lt;&lt;<span class="number">1</span>],tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">const</span> res &amp;rt,<span class="keyword">const</span> res &amp;val)</span></span>&#123;</span><br><span class="line">        tr[rt].num=<span class="number">1</span>,tr[rt].b[<span class="number">0</span>]=len[rt],tr[rt].a[<span class="number">0</span>]=val,tr[rt].tag=val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">const</span> res &amp;rt)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!tr[rt].tag)<span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">change</span>(rt&lt;&lt;<span class="number">1</span>,tr[rt].tag),<span class="built_in">change</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,tr[rt].tag),tr[rt].tag=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R,<span class="keyword">const</span> res &amp;val)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;<span class="built_in">change</span>(rt,val);<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R,val);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R,val);</span><br><span class="line">        tr[rt]=<span class="built_in">merge</span>(tr[rt&lt;&lt;<span class="number">1</span>],tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">P <span class="title">query</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)<span class="keyword">return</span> tr[rt];</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid&amp;&amp;R&gt;mid)<span class="keyword">return</span> <span class="built_in">merge</span>(<span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R),<span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R));</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="keyword">return</span> <span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>(),p=<span class="number">100</span>/<span class="built_in">read</span>(),<span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">        <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">            res opt=<span class="built_in">read</span>(),l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">if</span>(opt==<span class="number">1</span>)<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,l,r,<span class="built_in">read</span>());</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                RG P ret=<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">1</span>,n,l,r);</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,ret.num);</span><br><span class="line">                <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;ret.num;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,ret.a[i]);</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="Code-Festival-Final-17-C"><a href="#Code-Festival-Final-17-C" class="headerlink" title="[Code Festival Final 17 C]"></a>[Code Festival Final 17 C]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：来自世界各地的 $n+1$ 名选手参加了比赛，A 调查并计算出第 $i$ 名选手所在城市与他自己所在城市的时差 $D_i$。时差如下定义：对于城市 A 和城市 B，当 A 为 $0$ 点时，B 为 $b$ 点，此时时差为 $\min(b,24-b)$（24小时制）。例如，当 A 所在城市为 $0$ 点时，第 $i$ 名选手所在城市的时间要么是 $D_i$，要么是 $24-D_i$。<br>记 $S$ 为 A 所在城市为 $0$ 点时，每两个城市间的时差的最小值。求出尽可能大的 $S$。</p>
<p>做法：首先注意到鸽巢原理，$n\geq 24$ 直接就是 $0$，因为必有两个城市重复了。剩下来的直接暴搜。时间复杂度 $O(2^{24})$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.11.21 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> h[<span class="number">30</span>];</span><br><span class="line">    <span class="keyword">int</span> ans;</span><br><span class="line">    <span class="keyword">int</span> fl[<span class="number">30</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(res dep)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(dep==n+<span class="number">1</span>)&#123;</span><br><span class="line">            res mn=<span class="number">30</span>,las=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;<span class="number">24</span>;i++)<span class="keyword">if</span>(fl[i])mn=<span class="built_in">min</span>(mn,i-las),las=i;</span><br><span class="line">            mn=<span class="built_in">min</span>(mn,<span class="number">24</span>-las),ans=<span class="built_in">max</span>(ans,mn);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!fl[h[dep]])fl[h[dep]]=<span class="number">1</span>,<span class="built_in">dfs</span>(dep+<span class="number">1</span>),fl[h[dep]]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(!fl[(<span class="number">24</span>-h[dep])%<span class="number">24</span>])fl[(<span class="number">24</span>-h[dep])%<span class="number">24</span>]=<span class="number">1</span>,<span class="built_in">dfs</span>(dep+<span class="number">1</span>),fl[(<span class="number">24</span>-h[dep])%<span class="number">24</span>]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>()+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(n&gt;<span class="number">24</span>)&#123;<span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;n;i++)h[i]=<span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">1</span>),<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="TC12118"><a href="#TC12118" class="headerlink" title="[TC12118]"></a>[TC12118]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有两个由 $a,b,c$ 构成的字符串，将某个位置的 $a$ 变成 $b$ 的代价为 $c_0$，$b$ 变成 $c$ 为 $c_1$，$c$ 变成 $a$ 为 $c_2$，最大代价为 $mc$，问将第一个串变成第二个的方案数。</p>
<p>做法：注意到记录代价无意义，因为一个合法方案一定是有将第一个串变成第二个串，然后在每个位置循环变化，所以实际上记录代价可以被记录变化次数所代替。</p>
<p>令 $f_{i,j,k}$ 表示当前已经动了 $i$ 步，还有 $j$ 个位置差一步，$k$ 个位置差两步的方案数。转移就是 $f_{i,j,k}=(j+1)f_{i-1,j+1,k}+(k+1)f_{i-1,j-1,k+1}+(n-j-k+1)f_{i-1,j,k-1}$。观察一下就知道这个可以矩乘优化了，时间复杂度 $O(n^6\log m)$，其中 $n$ 为字符串长，$m$ 为步数。</p>
</div></div>
<h3 id="Code-Festival-Final-17-F"><a href="#Code-Festival-Final-17-F" class="headerlink" title="[Code Festival Final 17 F]"></a>[Code Festival Final 17 F]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有 $n$ 张纸，每张纸上要写 $k$ 个数，要求这 $k\cdot n$ 个数都在 $[1,n]$ 内，且 $[1,n]$ 中的每个数恰好出现 $k$ 次。还要求每张纸不能写相同的数，且任意两张纸的数字交集大小为 $1$，让你构造 $1000\leq n\leq 2000$ 和 $k$ 以及染色方案。</p>
<p>做法：首先根据每两个相同数字都要在不同的纸张，以及不同纸张之间都要有相同的数字，可以得到 $\frac{n(n-1)}{2}=\frac{nk(k-1)}{2}$，即 $n=k^2-k+1$。然后我们手动玩一下 $k=3,4$ 的情况，会得到一个这样的构造：</p>
<p>第一张到第 $k$ 张都是 $1,(k-1)i+1,(k-1)i,…$，然后接下来是以 $2$ 打头，剩下来的取一排。然后是以 $3$ 打头，然后隔一格取。类似这样，可以证明 $k-1$ 是质数时大概是有解的，然后就构造完了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.26 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> k=<span class="number">42</span>,n=k*k-k+<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> a[<span class="number">100</span>][<span class="number">100</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d %d\n&quot;</span>,n,k);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=k;i++)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;1 &quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(res j=(i<span class="number">-1</span>)*(k<span class="number">-1</span>)+<span class="number">2</span>;j&lt;=i*(k<span class="number">-1</span>)+<span class="number">1</span>;j++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,j),a[i][j-(i<span class="number">-1</span>)*(k<span class="number">-1</span>)<span class="number">-2</span>]=j;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;k<span class="number">-1</span>;i++)<span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;k<span class="number">-1</span>;j++)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i+<span class="number">2</span>);</span><br><span class="line">            <span class="keyword">for</span>(res l=<span class="number">2</span>,cur=j;l&lt;=k;l++,cur=(cur+i)%(k<span class="number">-1</span>))<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,a[l][cur]);</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="TC12161"><a href="#TC12161" class="headerlink" title="[TC12161]"></a>[TC12161]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有 $n$ 个数 $a_i$，一个排列的价值为 $\sum_{i=1}^{n-1} \max(a_{p_i},a_{p_{i+1}})$，求价值最小且字典序最小的排列。</p>
<p>做法：肯定想要越大的越少出现，那么除了最小的，其他都是出现一次，即一个 V 字形。剩下来的直接贪心就可以了。时间复杂度 $O(n\log)$。</p>
</div></div>
<h3 id="LG6327"><a href="#LG6327" class="headerlink" title="[LG6327]"></a>[LG6327]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：中文不会自己看？</p>
<p>做法：考虑那个啥公式，就 $\sin(x+y)=\sin x\cos y+\sin y\cos x$，那么线段树上每个结点只用维护 $\sum \sin $ 和 $\sum \cos$ 了。时间复杂度 $O(n\log)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.11.25 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ld long db</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    ld si[N&lt;&lt;<span class="number">2</span>],cs[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    LL tag[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(res rt,res l,res r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>();</span><br><span class="line">            si[rt]=<span class="built_in">sin</span>(x),cs[rt]=<span class="built_in">cos</span>(x);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(rt&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">        si[rt]=si[rt&lt;&lt;<span class="number">1</span>]+si[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">        cs[rt]=cs[rt&lt;&lt;<span class="number">1</span>]+cs[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">const</span> res &amp;rt,<span class="keyword">const</span> RG LL &amp;val)</span></span>&#123;</span><br><span class="line">        RG ld vs=si[rt],vc=cs[rt];</span><br><span class="line">        si[rt]=vs*<span class="built_in">cos</span>(val)+vc*<span class="built_in">sin</span>(val);</span><br><span class="line">        cs[rt]=vc*<span class="built_in">cos</span>(val)-vs*<span class="built_in">sin</span>(val);</span><br><span class="line">        tag[rt]+=val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">const</span> res &amp;rt)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!tag[rt])<span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">change</span>(rt&lt;&lt;<span class="number">1</span>,tag[rt]),<span class="built_in">change</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,tag[rt]),tag[rt]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R,<span class="keyword">const</span> res &amp;val)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;</span><br><span class="line">            <span class="built_in">change</span>(rt,val);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R,val);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R,val);</span><br><span class="line">        si[rt=si[rt&lt;&lt;<span class="number">1</span>]+si[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">        cs[rt]=cs[rt&lt;&lt;<span class="number">1</span>]+cs[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ld <span class="title">query</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)<span class="keyword">return</span> si[rt];</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        RG ld ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)ret=<span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)ret+=<span class="built_in">query</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),<span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">        res q=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">            res opt=<span class="built_in">read</span>(),l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">if</span>(opt==<span class="number">1</span>)&#123;</span><br><span class="line">                res v=<span class="built_in">read</span>();</span><br><span class="line">                <span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,l,r,v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%.1Lf\n&quot;</span>,<span class="built_in">query</span>(<span class="number">1</span>,<span class="number">1</span>,n,l,r));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF453-E"><a href="#CF453-E" class="headerlink" title="[CF453 E]"></a>[CF453 E]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：你有 $n$ 只小马（ 编号从 $1$ 到 $n$ ）。每只小马有三种属性。</p>
<p>$s_i$：时间为 $0$ 时这只小马拥有的法力值。</p>
<p>$m_i$：这只小马可以拥有的最大法力值。</p>
<p>$r_i$：这只小马单位时间内回复的法力值。</p>
<p>提雷克会给出 $m$ 条指令，每一条都可以被描述为 $3$ 个整数：$t_i, l_i, r_i$。表示在时间为 $t_i$ 时，提雷克会从区间 $[l_i,r_i]$ 的小马中吸取魔力，指令保证 $t$ 升序，计算每一条指令之后提雷克可以吸取多少点魔力。</p>
<p>做法：考虑 $\mathrm{ODT}$ 那一套逻辑，把上次修改时间一致的连续点连成一个区间，发现这样的区间个数是 $O(n+m)$ 的。于是可以暴力处理这些区间，注意到一共就两类情况，即 $T-t\leq \frac{m}{r}$ 与否，可以容易注意到这东西是二维数点，离线下来可以一维数点，不过直接可持久化线段树挺好写的捏。时间复杂度 $O(n\log n)$。<del>当然可以注意到这是分段函数，所以可以上闵科夫斯基凸包和</del>。</p>
<p>坑：这题实现上一车细节。比如就 $r=0$ 的这些点你要怎么安排的小细节，因为此时直接用乘法会遇到 $r=m=0$ 的情况导致无序而 <code>RE</code>。（ 我不会说我写了一个半小时的 ）</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.11.30 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tup tuple<span class="meta-string">&lt;int,int,int&gt;</span></span></span><br><span class="line">    set&lt;tup&gt; S;</span><br><span class="line">    <span class="keyword">int</span> s[N],m[N],u[N];</span><br><span class="line">    set&lt;<span class="keyword">int</span>&gt; T;</span><br><span class="line">    <span class="keyword">int</span> ls[N*<span class="number">30</span>],rs[N*<span class="number">30</span>],tot;</span><br><span class="line">    pair&lt;LL,LL&gt; su[N*<span class="number">30</span>];</span><br><span class="line">    <span class="keyword">inline</span> pair&lt;LL,LL&gt; <span class="keyword">operator</span> + (pair&lt;LL,LL&gt; a,pair&lt;LL,LL&gt; b)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mp</span>(a.fi+b.fi,a.se+b.se);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(res &amp;rt,res l,res r)</span></span>&#123;</span><br><span class="line">        rt=++tot;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;su[rt]=<span class="built_in">mp</span>(u[l],<span class="number">0ll</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(ls[rt],l,mid),<span class="built_in">build</span>(rs[rt],mid+<span class="number">1</span>,r),su[rt]=su[ls[rt]]+su[rs[rt]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(res &amp;rt,res RT,res l,res r,<span class="keyword">const</span> res &amp;p)</span></span>&#123;</span><br><span class="line">        rt=++tot;</span><br><span class="line">        ls[rt]=ls[RT],rs[rt]=rs[RT],su[rt]=su[RT];</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;<span class="keyword">if</span>(u[l])su[rt]=<span class="built_in">mp</span>(<span class="number">0ll</span>,m[l]);<span class="keyword">return</span>;&#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(p&lt;=mid)<span class="built_in">insert</span>(ls[rt],ls[RT],l,mid,p);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">insert</span>(rs[rt],rs[RT],mid+<span class="number">1</span>,r,p);</span><br><span class="line">        su[rt]=su[ls[rt]]+su[rs[rt]];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">pair&lt;LL,LL&gt; <span class="title">query</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!rt)<span class="keyword">return</span> su[rt];</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)<span class="keyword">return</span> su[rt];</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        RG pair&lt;LL,LL&gt; ret=<span class="built_in">mp</span>(<span class="number">0ll</span>,<span class="number">0ll</span>);</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)ret=<span class="built_in">query</span>(ls[rt],l,mid,L,R);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)ret=ret+<span class="built_in">query</span>(rs[rt],mid+<span class="number">1</span>,r,L,R);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> rt[N];</span><br><span class="line">    <span class="keyword">int</span> id[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> res &amp;A,<span class="keyword">const</span> res &amp;B)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!u[A])<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(!u[B])<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> (LL)m[A]*u[B]-(LL)m[B]*u[A]&lt;<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> pair&lt;LL,LL&gt; <span class="title">calc</span><span class="params">(<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R,<span class="keyword">const</span> res &amp;t)</span></span>&#123;</span><br><span class="line">        res l=<span class="number">0</span>,r=n,ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;=r)&#123;</span><br><span class="line">            res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(m[id[mid]]&lt;=(LL)t*u[id[mid]])l=mid+<span class="number">1</span>,ret=mid;</span><br><span class="line">            <span class="keyword">else</span> r=mid<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">query</span>(rt[ret],<span class="number">1</span>,n,L,R);</span><br><span class="line">    &#125;</span><br><span class="line">    set&lt;tup&gt;::iterator L,R;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)s[i]=<span class="built_in">read</span>(),m[i]=<span class="built_in">read</span>(),u[i]=<span class="built_in">read</span>(),T.<span class="built_in">insert</span>(i),id[i]=i;</span><br><span class="line">        S.<span class="built_in">insert</span>(<span class="built_in">tup</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>));</span><br><span class="line">        <span class="built_in">build</span>(rt[<span class="number">0</span>],<span class="number">1</span>,n),<span class="built_in">sort</span>(id+<span class="number">1</span>,id+n+<span class="number">1</span>,cmp);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">insert</span>(rt[i],rt[i<span class="number">-1</span>],<span class="number">1</span>,n,id[i]);</span><br><span class="line">        res q=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">            res t=<span class="built_in">read</span>(),l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>();</span><br><span class="line">            LL ans=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">auto</span> IT=T.<span class="built_in">lower_bound</span>(l);</span><br><span class="line">            <span class="keyword">while</span>(IT!=T.<span class="built_in">end</span>()&amp;&amp;(*IT)&lt;=r)&#123;</span><br><span class="line">                res i=(*IT);</span><br><span class="line">                ans+=<span class="built_in">min</span>((LL)m[i],(LL)u[i]*t+s[i]),T.<span class="built_in">erase</span>(IT),IT=T.<span class="built_in">lower_bound</span>(l);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(S.<span class="built_in">empty</span>())L=R=S.<span class="built_in">end</span>();</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(r==n)R=S.<span class="built_in">end</span>();</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">auto</span> it=(--S.<span class="built_in">upper_bound</span>(<span class="built_in">tup</span>(r+<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>)));</span><br><span class="line">                    tup tmp=(*it);</span><br><span class="line">                    <span class="keyword">if</span>(r&gt;=get&lt;<span class="number">1</span>&gt;(tmp))R=(++it);</span><br><span class="line">                    <span class="keyword">else</span> S.<span class="built_in">erase</span>(it),S.<span class="built_in">insert</span>(<span class="built_in">tup</span>(get&lt;<span class="number">0</span>&gt;(tmp),r,get&lt;<span class="number">2</span>&gt;(tmp))),R=S.<span class="built_in">insert</span>(<span class="built_in">tup</span>(r+<span class="number">1</span>,get&lt;<span class="number">1</span>&gt;(tmp),get&lt;<span class="number">2</span>&gt;(tmp))).fi;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">auto</span> it=(--S.<span class="built_in">upper_bound</span>(<span class="built_in">tup</span>(l+<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>)));</span><br><span class="line">                tup tmp=(*it);</span><br><span class="line">                <span class="keyword">if</span>(l&gt;get&lt;<span class="number">1</span>&gt;(tmp))L=(++it);</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span>(l&gt;get&lt;<span class="number">0</span>&gt;(tmp))S.<span class="built_in">erase</span>(it),S.<span class="built_in">insert</span>(<span class="built_in">tup</span>(get&lt;<span class="number">0</span>&gt;(tmp),l<span class="number">-1</span>,get&lt;<span class="number">2</span>&gt;(tmp))),L=S.<span class="built_in">insert</span>(<span class="built_in">tup</span>(l,get&lt;<span class="number">1</span>&gt;(tmp),get&lt;<span class="number">2</span>&gt;(tmp))).fi;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(l==get&lt;<span class="number">0</span>&gt;(tmp))L=it;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">auto</span> nL=L;</span><br><span class="line">            <span class="keyword">for</span>(;L!=R;L++)&#123;</span><br><span class="line">                pair&lt;LL,LL&gt; ret=<span class="built_in">calc</span>(get&lt;<span class="number">0</span>&gt;(*L),get&lt;<span class="number">1</span>&gt;(*L),t-get&lt;<span class="number">2</span>&gt;(*L));</span><br><span class="line">                ans+=ret.fi*(t-get&lt;<span class="number">2</span>&gt;(*L))+ret.se;</span><br><span class="line">            &#125;</span><br><span class="line">            S.<span class="built_in">erase</span>(nL,R),S.<span class="built_in">insert</span>(<span class="built_in">tup</span>(l,r,t)),<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="Wannafly-6-E"><a href="#Wannafly-6-E" class="headerlink" title="[Wannafly 6 E]"></a>[Wannafly 6 E]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：中文题面不会自己看？</p>
<p>做法：所以说构造题千万不能看样例和数据范围啊。</p>
<p>$n\leq 3$ 时，显然不能找到两组使得右边的数大于左边，所以都无解。而其它的 $n$，$n=4$ 可以找到 $1144$，$n=5$ 可以找到 $16400$，然后你发现这样往后每次添加两个 $0$，只要第二位和第三位处划分就可以了。时间复杂度 $O(n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.12.1 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">if</span>(n&lt;=<span class="number">3</span>)<span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(n&amp;<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;16400&quot;</span>);</span><br><span class="line">                <span class="keyword">for</span>(res i=n<span class="number">-5</span>;i;i--)<span class="built_in">printf</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;1144&quot;</span>);</span><br><span class="line">                <span class="keyword">for</span>(res i=n<span class="number">-4</span>;i;i--)<span class="built_in">printf</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="Ynoi2007-rgxsxrs"><a href="#Ynoi2007-rgxsxrs" class="headerlink" title="[Ynoi2007] rgxsxrs"></a>[Ynoi2007] rgxsxrs</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：中文题面不会自己看？</p>
<p>做法：整体或树上操作都类同于 $21$ 年暑假 $\mathrm{hdu}$ 多校第三场的那道 $C$，即考虑到以 $[0,x-1],[x,2x],[2x+1,\infty)$ 分段考虑，中间那一段暴力，后面那一段直接打标记。然后分块，之后再写好了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF739-A"><a href="#CF739-A" class="headerlink" title="[CF739 A]"></a>[CF739 A]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：长度为 $n$ 的序列，有 $m$ 个区间限制，要求构造这个序列，使得这 $m$ 个区间的最小 $\mathrm{mex}$ 最大。</p>
<p>做法：注意到最大值不能超过最短区间的长度，考虑构造这个下界。发现循环 $0,1,…,l$ 构造就行了，其中 $l$ 为最短区间长度。时间复杂度 $O(n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.12.6 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>(),L=n;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            res l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>();</span><br><span class="line">            L=<span class="built_in">min</span>(L,r-l+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        res now=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,L);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,now),now=(now==L<span class="number">-1</span>?<span class="number">0</span>:now+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF733-C"><a href="#CF733-C" class="headerlink" title="[CF733 C]"></a>[CF733 C]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有 $n$ 个怪兽，第 $i$ 个的重量是 $a_i$。</p>
<p>一秒钟内，能让恰好一个怪兽吃掉相邻的比它重量小的怪兽。重量大的重量加上重量小的的重量；重量小的怪兽死掉。死后重新靠拢。</p>
<p>求一种顺序，变成：共 $k$ 个怪兽，第 $j$ 个的重量是 $b_j$。</p>
<p>做法：注意每次合并的一定是一个区间，那么就可以逐个确定是否能构造出 $b$。另一方面一个区间能能否构造，当且仅当和等于 $b$ 且不全部相等。因为如果全部相等则没得吃，若有一个不等，那么一定存在一个最大的数能吃相邻的一个。于是只要每次拿最大的那个来吃就好了。时间复杂度 $O(n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.12.7 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">500</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    <span class="keyword">int</span> k,b[N];</span><br><span class="line">    vector&lt;pair&lt;<span class="keyword">int</span>,<span class="keyword">char</span>&gt; &gt; ans;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>();</span><br><span class="line">        k=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=k;i++)b[i]=<span class="built_in">read</span>();</span><br><span class="line">        res now=<span class="number">1</span>,cur=<span class="number">1</span>,ret=<span class="number">0</span>,st=<span class="number">0</span>,sum=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(now&lt;=n+<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(now&gt;n&amp;&amp;ret!=b[cur])&#123;<span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">            <span class="keyword">if</span>(!ret)&#123;st=now,ret=a[now++];<span class="keyword">continue</span>;&#125;</span><br><span class="line">            <span class="keyword">if</span>(ret&lt;b[cur])&#123;ret+=a[now++];<span class="keyword">continue</span>;&#125;</span><br><span class="line">            <span class="keyword">if</span>(ret&gt;b[cur])&#123;<span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">            res fl=<span class="number">0</span>,mx=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(st+<span class="number">1</span>==now)&#123;ret=<span class="number">0</span>,cur++;<span class="keyword">continue</span>;&#125;</span><br><span class="line">            <span class="keyword">for</span>(res i=st+<span class="number">1</span>;i&lt;now;i++)<span class="keyword">if</span>(a[i]!=a[st])&#123;fl=<span class="number">1</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">            <span class="keyword">if</span>(!fl)&#123;<span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">            <span class="keyword">for</span>(res i=st;i&lt;now;i++)<span class="keyword">if</span>(a[mx]&lt;a[i])mx=i;</span><br><span class="line">            <span class="keyword">if</span>(mx==st&amp;&amp;a[mx]==a[mx+<span class="number">1</span>])&#123;</span><br><span class="line">                <span class="keyword">for</span>(res i=st;i&lt;now<span class="number">-1</span>;i++)<span class="keyword">if</span>(a[mx]==a[i]&amp;&amp;a[i]&gt;a[i+<span class="number">1</span>])&#123;mx=i;<span class="keyword">break</span>;&#125;</span><br><span class="line">                <span class="keyword">for</span>(res i=mx+<span class="number">1</span>;i&lt;now;i++)ans.<span class="built_in">pb</span>(<span class="built_in">mp</span>(mx-sum,<span class="string">&#x27;R&#x27;</span>));</span><br><span class="line">                <span class="keyword">for</span>(res i=st;i&lt;mx;i++)ans.<span class="built_in">pb</span>(<span class="built_in">mp</span>(mx-sum-(i-st),<span class="string">&#x27;L&#x27;</span>));</span><br><span class="line">                sum+=now-st<span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span>(res i=st;i&lt;mx;i++)ans.<span class="built_in">pb</span>(<span class="built_in">mp</span>(mx-sum-(i-st),<span class="string">&#x27;L&#x27;</span>));</span><br><span class="line">                sum+=mx-st;</span><br><span class="line">                <span class="keyword">for</span>(res i=mx+<span class="number">1</span>;i&lt;now;i++)ans.<span class="built_in">pb</span>(<span class="built_in">mp</span>(mx-sum,<span class="string">&#x27;R&#x27;</span>));</span><br><span class="line">                sum+=now<span class="number">-1</span>-mx;</span><br><span class="line">            &#125;</span><br><span class="line">            ret=<span class="number">0</span>,cur++;</span><br><span class="line">            <span class="keyword">if</span>(now&gt;n&amp;&amp;cur&lt;=k)&#123;<span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">            <span class="keyword">if</span>(now&gt;n&amp;&amp;cur&gt;k)<span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x:ans)<span class="built_in">printf</span>(<span class="string">&quot;%d %c\n&quot;</span>,x.fi,x.se);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF429-E"><a href="#CF429-E" class="headerlink" title="[CF429 E]"></a>[CF429 E]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给定 $n$ 条线段 $[l_i,r_i]$，然后给这些线段红蓝染色，要求最后直线上任意一个点被蓝色及红色线段覆盖次数之差的绝对值之差小于等于 $1$。</p>
<p>做法：绝对值之差小于等于 $1$ 实际都是可以用欧拉回路解决的。差分后考虑区间端点处连边，然后把相邻的点度为奇数的点连边，这样保证了每个点的度数为偶数。接下来跑个欧拉回路，给无向图边定向，这样顺时针为红，逆时针为蓝，即可保证每个点的红蓝染色次数相等。时间复杂度 $O(n)$。</p>
<p>坑：因为相邻点连边了，所以空间要乘 $2$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.12.7 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">4e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tup tuple<span class="meta-string">&lt;int,int,int&gt;</span></span></span><br><span class="line">    tup a[N];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">E</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> next,to;</span><br><span class="line">        <span class="built_in">E</span>() &#123;&#125;</span><br><span class="line">        <span class="built_in">E</span>(res next,res to):<span class="built_in">next</span>(next),<span class="built_in">to</span>(to) &#123;&#125;</span><br><span class="line">    &#125;edge[N];</span><br><span class="line">    <span class="keyword">int</span> head[N],cnt=<span class="number">-1</span>;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">const</span> res &amp;u,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        edge[++cnt]=<span class="built_in">E</span>(head[u],v),head[u]=cnt;</span><br><span class="line">        edge[++cnt]=<span class="built_in">E</span>(head[v],u),head[v]=cnt;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> pos[N];</span><br><span class="line">    <span class="keyword">int</span> vis[N],ans[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(res x)</span></span>&#123;</span><br><span class="line">        vis[x]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res &amp;i=head[x];~i;i=edge[i].next)<span class="keyword">if</span>(!ans[i])ans[i]=<span class="number">1</span>,ans[i^<span class="number">1</span>]=<span class="number">2</span>,<span class="built_in">dfs</span>(edge[i].to);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),<span class="built_in">memset</span>(head,<span class="number">-1</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(head));</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>();</span><br><span class="line">            a[i]=<span class="built_in">tup</span>(l,<span class="number">1</span>,i),a[i+n]=<span class="built_in">tup</span>(r+<span class="number">1</span>,<span class="number">-1</span>,i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(a+<span class="number">1</span>,a+<span class="number">2</span>*n+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">2</span>*n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(get&lt;<span class="number">0</span>&gt;(a[i])&gt;get&lt;<span class="number">0</span>&gt;(a[i<span class="number">-1</span>]))&#123;</span><br><span class="line">                m++;</span><br><span class="line">                <span class="keyword">if</span>(!(i&amp;<span class="number">1</span>))<span class="built_in">addedge</span>(m<span class="number">-1</span>,m);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(get&lt;<span class="number">1</span>&gt;(a[i])==<span class="number">1</span>)pos[get&lt;<span class="number">2</span>&gt;(a[i])]=m;</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">addedge</span>(pos[get&lt;<span class="number">2</span>&gt;(a[i])],m),pos[get&lt;<span class="number">2</span>&gt;(a[i])]=cnt;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)<span class="keyword">if</span>(!vis[i])<span class="built_in">dfs</span>(i);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,ans[pos[i]]&amp;<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF725-C"><a href="#CF725-C" class="headerlink" title="[CF725 C]"></a>[CF725 C]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给一个长度为 $27$ 的大写字母串，其中除了一个字符出现两次，其他都出现一次。要求构造出 $2\times 13$ 的字符网格，使得每个字符都出现一次，且原字符串中相邻的字母在网格中八连通。</p>
<p>做法：注意到若我们按原字符串直接塞入网格中（ 即第二行处的末尾和第一行的末尾相连 ），我们不断向前旋转这个网格，相邻的字符仍然是相邻的。那么只用考虑那个出现两次的字符。出现两次的字符我们保留一个即可，设另一个相邻的字符是 $a,b$，那么不断旋转，这个字符一定会和 $a,b$ 相遇。这是小学二年级的相遇问题，而且因为删去这个字符后 $a,b$ 就在网格中相邻了，所以是对的。除非当这个出现两次的字符相邻了，那么显然无解。</p>
<p>时间复杂度 $O(26\ast 26)$，当然可以更优。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.12.8 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">char</span> str[<span class="number">30</span>];</span><br><span class="line">    <span class="keyword">int</span> vis[<span class="number">26</span>];</span><br><span class="line">    <span class="keyword">int</span> id1,id2;</span><br><span class="line">    <span class="keyword">char</span> p[<span class="number">4</span>],q[<span class="number">8</span>],a[<span class="number">5</span>][<span class="number">15</span>],b[<span class="number">5</span>][<span class="number">15</span>];</span><br><span class="line">    <span class="keyword">int</span> fl[<span class="number">4</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        str[<span class="number">0</span>]=<span class="string">&#x27;!&#x27;</span>,str[<span class="number">28</span>]=<span class="string">&#x27;!&#x27;</span>;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str+<span class="number">1</span>);</span><br><span class="line">        res n=<span class="built_in"><span class="keyword">int</span></span>(<span class="built_in">strlen</span>(str+<span class="number">1</span>));</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!vis[str[i]-<span class="string">&#x27;A&#x27;</span>])vis[str[i]-<span class="string">&#x27;A&#x27;</span>]=i;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                id1=i,id2=vis[str[i]-<span class="string">&#x27;A&#x27;</span>];<span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(i==id1)p[<span class="number">0</span>]=str[i<span class="number">-1</span>],p[<span class="number">1</span>]=str[i+<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span>(i==id2)p[<span class="number">2</span>]=str[i<span class="number">-1</span>],p[<span class="number">3</span>]=str[i+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">abs</span>(id1-id2)==<span class="number">1</span>)&#123;<span class="built_in">puts</span>(<span class="string">&quot;Impossible&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">        res now=<span class="number">1</span>,ni,nj;</span><br><span class="line">        <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=<span class="number">13</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(now==id2)now++;</span><br><span class="line">            <span class="keyword">if</span>(now==id1)ni=<span class="number">1</span>,nj=j;</span><br><span class="line">            a[<span class="number">1</span>][j]=str[now],now++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res j=<span class="number">13</span>;j;j--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(now==id2)now++;</span><br><span class="line">            <span class="keyword">if</span>(now==id1)ni=<span class="number">2</span>,nj=j;</span><br><span class="line">            a[<span class="number">2</span>][j]=str[now],now++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res T=<span class="number">1</span>;T&lt;=<span class="number">26</span>;T++)&#123;</span><br><span class="line">            q[<span class="number">0</span>]=a[ni][nj<span class="number">-1</span>],q[<span class="number">1</span>]=a[ni][nj+<span class="number">1</span>],q[<span class="number">2</span>]=a[ni<span class="number">-1</span>][nj],q[<span class="number">3</span>]=a[ni+<span class="number">1</span>][nj];</span><br><span class="line">            q[<span class="number">4</span>]=a[ni<span class="number">-1</span>][nj<span class="number">-1</span>],q[<span class="number">5</span>]=a[ni<span class="number">-1</span>][nj+<span class="number">1</span>],q[<span class="number">6</span>]=a[ni+<span class="number">1</span>][nj<span class="number">-1</span>],q[<span class="number">7</span>]=a[ni+<span class="number">1</span>][nj+<span class="number">1</span>];</span><br><span class="line">            fl[<span class="number">0</span>]=fl[<span class="number">1</span>]=fl[<span class="number">2</span>]=fl[<span class="number">3</span>]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res k=<span class="number">0</span>;k&lt;<span class="number">4</span>;k++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(q[i]==p[k]||p[k]==<span class="string">&#x27;!&#x27;</span>)fl[k]=<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(fl[<span class="number">0</span>]==<span class="number">1</span>&amp;&amp;fl[<span class="number">1</span>]==<span class="number">1</span>&amp;&amp;fl[<span class="number">2</span>]==<span class="number">1</span>&amp;&amp;fl[<span class="number">3</span>]==<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">2</span>;i++)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=<span class="number">13</span>;j++)<span class="built_in">putchar</span>(a[i][j]);</span><br><span class="line">                    <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(nj&lt;<span class="number">13</span>&amp;&amp;ni==<span class="number">1</span>)nj++;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(ni==<span class="number">1</span>&amp;&amp;nj==<span class="number">13</span>)ni=<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(ni==<span class="number">2</span>&amp;&amp;nj==<span class="number">1</span>)ni=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> nj--;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;<span class="number">13</span>;j++)b[<span class="number">1</span>][j+<span class="number">1</span>]=a[<span class="number">1</span>][j];</span><br><span class="line">            b[<span class="number">2</span>][<span class="number">13</span>]=a[<span class="number">1</span>][<span class="number">13</span>];</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">2</span>;j&lt;=<span class="number">13</span>;j++)b[<span class="number">2</span>][j<span class="number">-1</span>]=a[<span class="number">2</span>][j];</span><br><span class="line">            b[<span class="number">1</span>][<span class="number">1</span>]=a[<span class="number">2</span>][<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">2</span>;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=<span class="number">13</span>;j++)a[i][j]=b[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">        now=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=<span class="number">13</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(now==id1)now++;</span><br><span class="line">            <span class="keyword">if</span>(now==id2)ni=<span class="number">1</span>,nj=j;</span><br><span class="line">            a[<span class="number">1</span>][j]=str[now],now++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res j=<span class="number">13</span>;j;j--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(now==id1)now++;</span><br><span class="line">            <span class="keyword">if</span>(now==id2)ni=<span class="number">2</span>,nj=j;</span><br><span class="line">            a[<span class="number">2</span>][j]=str[now],now++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res T=<span class="number">1</span>;T&lt;=<span class="number">26</span>;T++)&#123;</span><br><span class="line">            q[<span class="number">0</span>]=a[ni][nj<span class="number">-1</span>],q[<span class="number">1</span>]=a[ni][nj+<span class="number">1</span>],q[<span class="number">2</span>]=a[ni<span class="number">-1</span>][nj],q[<span class="number">3</span>]=a[ni+<span class="number">1</span>][nj];</span><br><span class="line">            q[<span class="number">4</span>]=a[ni<span class="number">-1</span>][nj<span class="number">-1</span>],q[<span class="number">5</span>]=a[ni<span class="number">-1</span>][nj+<span class="number">1</span>],q[<span class="number">6</span>]=a[ni+<span class="number">1</span>][nj<span class="number">-1</span>],q[<span class="number">7</span>]=a[ni+<span class="number">1</span>][nj+<span class="number">1</span>];</span><br><span class="line">            fl[<span class="number">0</span>]=fl[<span class="number">1</span>]=fl[<span class="number">2</span>]=fl[<span class="number">3</span>]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res k=<span class="number">0</span>;k&lt;<span class="number">4</span>;k++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;<span class="number">8</span>;i++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(q[i]==p[k]||p[k]==<span class="string">&#x27;!&#x27;</span>)fl[k]=<span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(fl[<span class="number">0</span>]==<span class="number">1</span>&amp;&amp;fl[<span class="number">1</span>]==<span class="number">1</span>&amp;&amp;fl[<span class="number">2</span>]==<span class="number">1</span>&amp;&amp;fl[<span class="number">3</span>]==<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">2</span>;i++)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=<span class="number">13</span>;j++)<span class="built_in">putchar</span>(a[i][j]);</span><br><span class="line">                    <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(nj&lt;<span class="number">13</span>&amp;&amp;ni==<span class="number">1</span>)nj++;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(ni==<span class="number">1</span>&amp;&amp;nj==<span class="number">13</span>)ni=<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(ni==<span class="number">2</span>&amp;&amp;nj==<span class="number">1</span>)ni=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> nj--;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;<span class="number">13</span>;j++)b[<span class="number">1</span>][j+<span class="number">1</span>]=a[<span class="number">1</span>][j];</span><br><span class="line">            b[<span class="number">2</span>][<span class="number">13</span>]=a[<span class="number">1</span>][<span class="number">13</span>];</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">2</span>;j&lt;=<span class="number">13</span>;j++)b[<span class="number">2</span>][j<span class="number">-1</span>]=a[<span class="number">2</span>][j];</span><br><span class="line">            b[<span class="number">1</span>][<span class="number">1</span>]=a[<span class="number">2</span>][<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">2</span>;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=<span class="number">13</span>;j++)a[i][j]=b[i][j];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;Impossible&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="ARC093-D"><a href="#ARC093-D" class="headerlink" title="[ARC093 D]"></a>[ARC093 D]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：构造 $100\times 100$ 的网格染黑白色，使得白连通块个数为 $A$，黑为 $B$，$A,B\leq 500$。</p>
<p>做法：注意到 $A,B$ 不大，考虑将 $100\times 100$ 的网格分成上下两个部分，分别染全黑全白，然后在其中一些小空处染另一种颜色。比如一行行隔一个染一个这样子。具体可以看代码。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.12.10 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">100</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> a[N][N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res A=<span class="built_in">read</span>()<span class="number">-1</span>,B=<span class="built_in">read</span>()<span class="number">-1</span>;</span><br><span class="line">        res x=<span class="number">1</span>,y=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=A;i++)&#123;</span><br><span class="line">            a[x][y]=<span class="number">1</span>,y+=<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(y&gt;<span class="number">100</span>)x+=<span class="number">2</span>,y=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">51</span>;i&lt;=<span class="number">100</span>;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=<span class="number">100</span>;j++)a[i][j]=<span class="number">1</span>;</span><br><span class="line">        x=<span class="number">100</span>,y=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=B;i++)&#123;</span><br><span class="line">            a[x][y]=<span class="number">0</span>,y+=<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(y&gt;<span class="number">100</span>)x-=<span class="number">2</span>,y=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;100 100&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">100</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=<span class="number">100</span>;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(a[i][j])<span class="built_in">putchar</span>(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">                <span class="keyword">else</span> <span class="built_in">putchar</span>(<span class="string">&#x27;#&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="Code-Festival-Qual-17-A"><a href="#Code-Festival-Qual-17-A" class="headerlink" title="[Code Festival Qual 17 A]"></a>[Code Festival Qual 17 A]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给定一个 $n\cdot m$ 的网格。一些人站在网格的边界上。一个人可以占据他面前的一行（列），过程是一直往前染色（每个人的颜色都不一样），直到下一个格子染上了颜色或者到达了边界。显然不同顺序会有不同的最终状态。求最终状态的方案数。</p>
<p>做法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="POI-2011-IMP"><a href="#POI-2011-IMP" class="headerlink" title="[POI 2011] IMP"></a>[POI 2011] IMP</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给定一张 $n$ 个点 $m$ 条边的图 $n\equiv 0(\mod 3)$，保证存在一个大小为 $\frac{2}{3}n$ 的团，要求输出一个大小为 $\frac{n}{3}$ 的团。</p>
<p>做法：高中时就知道的题了，结果现在才第一次做啊。</p>
<p>注意若两个点之间没有连边则一定不会在一个团里。考虑每次删掉两个不在一个团里的点，那么最多删 $\frac{n}{3}$ 次，因为存在一个大小为 $\frac{2}{3}n$ 的团。而剩下的 $\frac{1}{3}n$ 个点自然就是答案了。时间复杂度 $O(n^2+m)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.12.14 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">3e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="keyword">int</span> G[N][N];</span><br><span class="line">    <span class="keyword">int</span> vis[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            res u=<span class="built_in">read</span>(),v=<span class="built_in">read</span>();</span><br><span class="line">            G[u][v]=G[v][u]=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(vis[i])<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(res j=i+<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(G[i][j]||vis[j])<span class="keyword">continue</span>;</span><br><span class="line">                vis[i]=vis[j]=<span class="number">1</span>;<span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>,t=<span class="number">1</span>;i&lt;=n&amp;&amp;t&lt;=n/<span class="number">3</span>;i++)<span class="keyword">if</span>(!vis[i])<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,i),t++;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF765-F"><a href="#CF765-F" class="headerlink" title="[CF765 F]"></a>[CF765 F]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：$n$ 个数，$m$ 次询问 $[l,r]$，问 $[l,r]$ 区间内两数之差的最小值。</p>
<p>做法：一眼莫队，然后想把添加改成删除也去不掉 <code>set</code> 这一个 $\log$，感受一下过不了，就不写了。</p>
<p>接下来先考虑一个大暴力，离线下来后，考虑每次添加一个 $r$ 对所有右端点是 $r$ 的询问的贡献。考虑在 $[1,r]$ 中找到最靠右的大于 $a_r$ 的数 $a_p$，那么 $[1,p]$ 的答案就会更新个 $a_p-a_r$。以此类推，暴力的话，我们只用一个升序数列就将其卡到 $O(n^2)$。再观察观察这个东西到底有什么性质，注意到有一部分贡献是一定无意义的。因为找到一个 $p’$ 时，一定要求 $a_{p’}-a_r&lt;a_{p}-a_{p’}$，那么 $0&lt;a_{p’}-a_r&lt;\frac{a_{p}-a_r}{2}$。于是这样要不断递减下去，最多只会有 $O(\log V)$ 次，即合法的 $p’$ 只有 $O(\log V)$。那么用一棵线段树维护下值域，再用棵 $\mathrm{BIT}$ 维护答案更新就行了。总复杂度 $O(n\log n\log V)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.12.21 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">3e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    vector&lt;Pair&gt; que[N];</span><br><span class="line">    <span class="keyword">int</span> tr[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">const</span> res &amp;x,<span class="keyword">const</span> res &amp;y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=x;i;i-=<span class="built_in">lowbit</span>(i))tr[i]=<span class="built_in">min</span>(tr[i],y);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">const</span> res &amp;x)</span></span>&#123;</span><br><span class="line">        res ret=<span class="number">1000000000</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=x;i&lt;=n;i+=<span class="built_in">lowbit</span>(i))ret=<span class="built_in">min</span>(ret,tr[i]);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> mx[N*<span class="number">30</span>],tot,ls[N*<span class="number">30</span>],rs[N*<span class="number">30</span>];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(res &amp;rt,res l,res r,<span class="keyword">const</span> res &amp;p,<span class="keyword">const</span> res &amp;va)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!rt)rt=++tot;</span><br><span class="line">        mx[rt]=<span class="built_in">max</span>(mx[rt],va);</span><br><span class="line">        <span class="keyword">if</span>(l==r)<span class="keyword">return</span>;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(p&lt;=mid)<span class="built_in">modify</span>(ls[rt],l,mid,p,va);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">modify</span>(rs[rt],mid+<span class="number">1</span>,r,p,va);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!rt)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)<span class="keyword">return</span> mx[rt];</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>,ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)ret=<span class="built_in">query</span>(ls[rt],l,mid,L,R);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)ret=<span class="built_in">max</span>(ret,<span class="built_in">query</span>(rs[rt],mid+<span class="number">1</span>,r,L,R));</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> RT;</span><br><span class="line">    <span class="keyword">int</span> ans[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>(),tr[i]=<span class="number">1000000000</span>;</span><br><span class="line">        m=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            res l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>();</span><br><span class="line">            que[r].<span class="built_in">pb</span>(<span class="built_in">mp</span>(l,i)),ans[i]=<span class="number">1000000000</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res p=<span class="built_in">query</span>(RT,<span class="number">0</span>,<span class="number">1000000000</span>,a[i],<span class="number">1000000000</span>);</span><br><span class="line">            <span class="keyword">while</span>(p)<span class="built_in">modify</span>(p,a[p]-a[i]),p=<span class="built_in">query</span>(RT,<span class="number">0</span>,<span class="number">1000000000</span>,a[i],(a[i]+a[p])/<span class="number">2</span>-(~(a[i]+a[p])&amp;<span class="number">1</span>));</span><br><span class="line">            <span class="built_in">modify</span>(RT,<span class="number">0</span>,<span class="number">1000000000</span>,a[i],i);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> [l,id]:que[i])ans[id]=<span class="built_in">min</span>(ans[id],<span class="built_in">query</span>(l));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)tr[i]=<span class="number">1000000000</span>,a[i]=<span class="number">1000000000</span>-a[i];</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=tot;i++)ls[i]=rs[i]=mx[i]=<span class="number">0</span>;</span><br><span class="line">        tot=RT=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res p=<span class="built_in">query</span>(RT,<span class="number">0</span>,<span class="number">1000000000</span>,a[i],<span class="number">1000000000</span>);</span><br><span class="line">            <span class="keyword">while</span>(p)<span class="built_in">modify</span>(p,a[p]-a[i]),p=<span class="built_in">query</span>(RT,<span class="number">0</span>,<span class="number">1000000000</span>,a[i],(a[i]+a[p])/<span class="number">2</span>-(~(a[i]+a[p])&amp;<span class="number">1</span>));</span><br><span class="line">            <span class="built_in">modify</span>(RT,<span class="number">0</span>,<span class="number">1000000000</span>,a[i],i);</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> [l,id]:que[i])ans[id]=<span class="built_in">min</span>(ans[id],<span class="built_in">query</span>(l));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="Gym102956-K"><a href="#Gym102956-K" class="headerlink" title="[Gym102956 K]"></a>[Gym102956 K]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有 $n$ 块木板，第 $i$ 块木板有稳定性 $a_i$，木板从高到低排列。在木板上放置果子，第 $i$ 块木板被放了大于等于 $a_i$ 个果子后会碎裂，有 $\lfloor\frac k 2\rfloor$ 会下坠到下一块木板上。求至少需要多少果子才可以砸碎前 $i$ 块木板。</p>
<p>做法：注意到可以先用一些少的果子让下面的木板被破掉，然后上面的果子就不会被除二。于是会考虑区间 $\mathrm{dp}$，$f_{l,r,x}$ 表示破掉了 $l$ 到 $r$ 还剩 $x$ 个果子的最小代价，转移就很显然了。注意到破掉一个区间最多只会剩 $\max a_i$ 个果子，因为剩更多还无意义。总复杂度 $O(n^3a^2)$，因为跑不满，所以可以过。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.12.23 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">70</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    <span class="keyword">int</span> f[N][N][<span class="number">150</span>+<span class="number">10</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),<span class="built_in">memset</span>(f,<span class="number">0x3f</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(f));</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>(),f[i][i][a[i]/<span class="number">2</span>]=a[i];</span><br><span class="line">        <span class="keyword">for</span>(res len=<span class="number">2</span>;len&lt;=n;len++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(res l=<span class="number">1</span>,r=l+len<span class="number">-1</span>;r&lt;=n;l++,r++)&#123;</span><br><span class="line">                <span class="keyword">for</span>(res x=a[r]&gt;&gt;<span class="number">1</span>;x&lt;=<span class="number">150</span>;x++)&#123;</span><br><span class="line">                    res &amp;ret=f[l][r][x];</span><br><span class="line">                    <span class="keyword">for</span>(res k=l+<span class="number">1</span>;k&lt;r;k++)&#123;</span><br><span class="line">                        <span class="keyword">for</span>(res X=a[r<span class="number">-1</span>]/<span class="number">2</span>;X&lt;=<span class="number">150</span>;X++)&#123;</span><br><span class="line">                            res c=<span class="built_in">max</span>(a[r]-X,<span class="number">0</span>);</span><br><span class="line">                            <span class="keyword">if</span>(x-(X+c)/<span class="number">2</span>&gt;=a[k<span class="number">-1</span>]/<span class="number">2</span>)ret=<span class="built_in">min</span>(ret,f[l][k<span class="number">-1</span>][x-(X+c)/<span class="number">2</span>]+f[k][r<span class="number">-1</span>][X]+c);</span><br><span class="line">                            <span class="keyword">else</span> <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(x==a[r]&gt;&gt;<span class="number">1</span>)&#123;</span><br><span class="line">                        <span class="keyword">for</span>(res X=a[r<span class="number">-1</span>]&gt;&gt;<span class="number">1</span>;X&lt;=a[r]+<span class="number">1</span>;X++)&#123;</span><br><span class="line">                            res c=<span class="built_in">max</span>(a[r]-X,<span class="number">0</span>);</span><br><span class="line">                            <span class="keyword">if</span>((c+X)/<span class="number">2</span>!=a[r]/<span class="number">2</span>)<span class="keyword">break</span>;</span><br><span class="line">                            ret=<span class="built_in">min</span>(ret,f[l][r<span class="number">-1</span>][X]+c);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">for</span>(res X=a[r<span class="number">-1</span>]&gt;&gt;<span class="number">1</span>;X&lt;=<span class="number">150</span>;X++)&#123;</span><br><span class="line">                        <span class="keyword">if</span>(X/<span class="number">2</span>&gt;x)<span class="keyword">break</span>;</span><br><span class="line">                        res c=<span class="built_in">max</span>(x*<span class="number">2</span>-X,<span class="number">0</span>);</span><br><span class="line">                        <span class="keyword">if</span>(c+X&gt;=a[r])ret=<span class="built_in">min</span>(ret,f[l][r<span class="number">-1</span>][X]+c);</span><br><span class="line">                    &#125;</span><br><span class="line">                    ret=<span class="built_in">min</span>(ret,f[l][r<span class="number">-1</span>][x-a[r]/<span class="number">2</span>]+a[r]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res ans=inf;</span><br><span class="line">            <span class="keyword">for</span>(res j=a[i]&gt;&gt;<span class="number">1</span>;j&lt;=<span class="number">150</span>;j++)ans=<span class="built_in">min</span>(ans,f[<span class="number">1</span>][i][j]);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="统一省选2021-A卷-矩阵游戏"><a href="#统一省选2021-A卷-矩阵游戏" class="headerlink" title="[统一省选2021 A卷] 矩阵游戏"></a>[统一省选2021 A卷] 矩阵游戏</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：中文不会自己看？</p>
<p>做法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="TC12304"><a href="#TC12304" class="headerlink" title="[TC12304]"></a>[TC12304]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给出一棵 $n$ 个点的树和 $k$，问有多少个 $n$ 的排列，满足按排列重标号后，对于每一个 $i=1,…,n-k+1$，$[i,i+k-1]$ 总是个连通块。</p>
<p>做法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF708-E"><a href="#CF708-E" class="headerlink" title="[CF708 E]"></a>[CF708 E]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有一个 $(n+2) \times m$ 的网格。</p>
<p>除了第一行和最后一行，其他每一行每一天最左边和最右边的格子都有 $p$ 的概率消失。</p>
<p>求 $k$ 天后，网格始终保持连通的概率。</p>
<p>做法：纯高中数列题。</p>
<p>考虑一个暴力 $\mathrm{dp}$，即设 $f(i,l,r)$ 表示当前算到第 $i$ 行，存在的是 $[l,r]$ 的概率。转移就是 </p>
<script type="math/tex; mode=display">
f(i,l,r)=p_{l-1}p_{m-r}\sum_{[l',r']\cap [l,r]} f(i-1,l',r')</script><p>其中 $p_x$ 为有 $x$ 次删除的概率，等于 $\binom{k}{x}p^x(1-p)^{k-x}$。</p>
<p>发现这个转移正着有点难讨论，不如算不交，即</p>
<script type="math/tex; mode=display">
f(i,l,r)=p_{l-1}p_{m-r}(\sum_{l'<r'} f(i-1,l',r')-\sum_{l'\leq r'<l}f(i-1,l',r')-\sum_{r<l'\leq r'}f(i-1,l',r'))</script><p>写好看点，即设第一个 $\sum$ 为 $F(i-1)$，第二个为 $L(i-1,l)$，第三个为 $R(i-1,r)$，那么就得看看这三个咋求。</p>
<p>首先根据对称性，有 $L(i,x)=R(i,m-x+1)$。</p>
<p>可惜 $L,R$ 还是 $O(n^2)$，我们把它们拆解一下，即 </p>
<script type="math/tex; mode=display">
L(i,x)=\sum_{l\leq r<x} f(i,l,r)=\sum_{r<x} \sum_{l\leq r} f(i,l,r)\\\\
=\sum_{r<x} F_L(i,r)</script><p>注意到 $F_L$ 的形式很类似 $F$，所以我们类似地去推一下式子</p>
<script type="math/tex; mode=display">
\begin{align*}
&F_L(i,x)=\sum_{l<x} f(i,l,x)=\sum_{l<x} p_{l-1}p_{m-x}(F(i-1)-L(i-1,l)-R(i-1,x))\\
&=p_{m-x}(F(i-1)-R(i-1,x))\sum_{l<x}p_{l-1}-p_{m-x}\sum_{l<x}p_{l-1}L(i-1,l)
&\end{align*}</script><p>于是就得到了一个递推过程，一共 $n$ 层，每一层处理出 $p_{l-1}L(i,l)$ 的前缀和，这样就可以 $O(1)$ 推出 $F_L$，再处理 $F_L$ 的前缀和，这样就可以得到 $L$ 和 $F$。总时间复杂度 $O(nm)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2021.12.27 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M=<span class="number">1500</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m,p,k;</span><br><span class="line">    <span class="keyword">int</span> F[M][M],L[M][M],FL[M][M],P[N],q[N];</span><br><span class="line">    <span class="keyword">int</span> fac[N],inv[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">C</span><span class="params">(<span class="keyword">const</span> res &amp;x,<span class="keyword">const</span> res &amp;y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mul</span>(fac[x],<span class="built_in">mul</span>(inv[y],inv[x-y]));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>(),p=<span class="built_in">read</span>(),p=<span class="built_in">mul</span>(p,<span class="built_in">qpow</span>(<span class="built_in">read</span>())),k=<span class="built_in">read</span>(),fac[<span class="number">0</span>]=fac[<span class="number">1</span>]=inv[<span class="number">0</span>]=inv[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=k;i++)fac[i]=<span class="built_in">mul</span>(fac[i<span class="number">-1</span>],i),inv[i]=<span class="built_in">mul</span>(inv[kcz%i],kcz-kcz/i);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=k;i++)inv[i]=<span class="built_in">mul</span>(inv[i<span class="number">-1</span>],inv[i]);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=<span class="built_in">min</span>(m,k);i++)P[i]=<span class="built_in">mul</span>(<span class="built_in">C</span>(k,i),<span class="built_in">mul</span>(<span class="built_in">qpow</span>(p,i),<span class="built_in">qpow</span>(<span class="number">1</span>+kcz-p,k-i)));</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)q[i]=<span class="built_in">Add</span>(q[i<span class="number">-1</span>],P[i<span class="number">-1</span>]);</span><br><span class="line">        F[<span class="number">0</span>][m]=L[<span class="number">0</span>][m]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=m;j++)&#123;</span><br><span class="line">            F[i][j]=<span class="built_in">mul</span>(P[m-j],<span class="built_in">Add</span>(<span class="built_in">mul</span>(<span class="built_in">Add</span>(L[i<span class="number">-1</span>][m],kcz-L[i<span class="number">-1</span>][m-j]),q[j]),kcz-FL[i<span class="number">-1</span>][j]));</span><br><span class="line">            L[i][j]=<span class="built_in">Add</span>(L[i][j<span class="number">-1</span>],F[i][j]);</span><br><span class="line">            FL[i][j]=<span class="built_in">Add</span>(FL[i][j<span class="number">-1</span>],<span class="built_in">mul</span>(P[j<span class="number">-1</span>],L[i][j<span class="number">-1</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,L[n][m]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="loj6215"><a href="#loj6215" class="headerlink" title="[loj6215]"></a>[loj6215]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：中文题面建议自己看。如果读不懂可以手玩下样例。</p>
<p>做法：完全不会，直接偷学 EI 和 xy 的做法。</p>
<p>$k$ 次幂直接是不好算的，考虑用第二类斯特林数拆解，即最终要求的是</p>
<script type="math/tex; mode=display">
\sum_{T_n} \sum_{u,v\in \mathrm{leaf}} \sum_{i} \begin{Bmatrix}k\\i \end{Bmatrix}i!\binom{\mathrm{len(u,v)}}{i}\\\\
=\sum_i \begin{Bmatrix}k\\i \end{Bmatrix}i! \sum_{T_n} \sum_{u,v\in \mathrm{leaf}}\binom{\mathrm{len(u,v)}}{i}</script><p>我们想把后面对应每个 $i$ 求出来，这里是个比较经典的做法，具体证明可以用范德蒙德卷积（ 我好像以前写过，或许也有其它理解 ）。</p>
<p>令二叉树数量的 $\mathrm{GF}$ 为 $F$，$\sum_{T_n}\sum_{u\in \mathrm{leaf}} \binom{\mathrm{len(u,rt)}}{i}y^ix^n$ 的 $\mathrm{GF}$ 为 $G$，$\sum_{T_n} \sum_{u,v\in \mathrm{leaf}}\binom{\mathrm{len(u,v)}}{i}y^ix^n$ 为 $H$。</p>
<p>为了方便起见，在 $\mathrm{GF}$ 暂时不考虑路径端点和 $\mathrm{LCA}$ 的存在，这只用在最后的地方乘上 $x^3(1+y)^3$ 进行修正。</p>
<p>利用固定根，枚举左右子树来得到 $\mathrm{GF}$ 的递推式，即</p>
<script type="math/tex; mode=display">
\begin{align*}
&F=1+xF^2\\
&G=1+2x(y+1)FG\\
&H=G^2+2xFH\\
&\end{align*}</script><p>解释下最后一条式子，考虑到 $H$ 要么是根的两个子树合并起来，那么 $\mathrm{LCA}$ 就是根，这样路径总长就是相加（ 因为不考虑路径端点和 $\mathrm{LCA}$ ），按范德蒙德卷积那样，这样的组合数上标刚好是路径之和、$H$ 还可以是某个子树算好了，那另外一边就是任意树，由于可以翻转，所以乘个 $2$。</p>
<p>最后算出 $H$，再乘上一个 $x^3(1+y)^3$，即答案为 （ 令 $\sqrt{1-4x}=t$ ）</p>
<script type="math/tex; mode=display">
[x^ny^i] \frac{x^3(1+y)^3}{(y(t-1)+t)^2t}\\\\
=[x^{n-3}y^i]\frac{(1+y)^3}{t^3(1-(\frac{1}{t}-1)y)^2}</script><p>分子那个可以先不管，最后乘上组合数即可，那么求的就是</p>
<script type="math/tex; mode=display">
[x^{n-3}y^i] \frac{1}{t^3(1-(\frac{1}{t}-1)y)^2}\\\\
=[x^{n-3}]\frac{1}{t^3}(i+1)(\frac{1}{t}-1)^i</script><p>这样的话，我们只要求出 $[x^n] \frac{1}{t^i}$ 即可在 $O(m^2)$ 的时间内解决这道题了 。（ EI 写的那个理论复杂度我看不懂。。。水平太低了，呜呜呜 ）</p>
<p>这是比较容易的，用一个拉格朗日反演即可，即</p>
<script type="math/tex; mode=display">
\begin{align*}
&[x^n] \frac{1}{(\sqrt{1-4x})^i}=\frac{1}{n} [x^{-1}] (\frac{1-\frac{1}{x^{\frac{2}{i}}}}{4})^{-n}\\
&=\frac{4^n}{n}[x](1-x^{\frac{2}{i}})^{-n}\\
&=\frac{4^n}{n}[x^{\frac{i}{2}}](1-x)^{-n}\\
&=\frac{4^n}{n} \binom{\frac{i}{2}+n-1}{n-1}
&\end{align*}</script><p>这个二项式系数至少可以在 $O(n+m)$ 的时间复杂度内求出，于是总复杂度就是 $O(n+m^2)$ 了。 </p>
<p>然后我们会发现自己忽略了 $u=v$ 的情况，这个情况也是可以用 $\mathrm{GF}$ 推的，可以推出这个的 $\mathrm{GF}$ 是 $P=1+2FP$，于是 $P=\frac{1}{\sqrt{1-4x}}$。所以这个情况的答案就是 $[x^n] \frac{x}{\sqrt{1-4x}}=\binom{2n-2}{n-1}$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.1.1 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e7</span>+<span class="number">300</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M=<span class="number">300</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> f[N],g[M],C[M][M],h[M];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pre</span><span class="params">(<span class="keyword">const</span> res &amp;n,<span class="keyword">const</span> res &amp;m)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(n&lt;<span class="number">0</span>)<span class="keyword">return</span>;</span><br><span class="line">        res inv2=<span class="built_in">qpow</span>(<span class="number">2</span>),ret=<span class="built_in">mul</span>(inv2,<span class="number">3</span>),fac=<span class="number">1</span>;</span><br><span class="line">        f[<span class="number">0</span>]=<span class="number">1</span>,f[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)f[<span class="number">1</span>]=<span class="built_in">mul</span>(f[<span class="number">1</span>],i+n),fac=<span class="built_in">mul</span>(fac,i);</span><br><span class="line">        f[<span class="number">1</span>]=<span class="built_in">mul</span>(f[<span class="number">1</span>],<span class="built_in">qpow</span>(fac)),f[<span class="number">2</span>]=<span class="built_in">qpow</span>(<span class="number">4</span>,n);</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="number">0</span>)<span class="keyword">for</span>(res i=<span class="number">3</span>;i&lt;=m;i++)f[i]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">for</span>(res i=<span class="number">3</span>;i&lt;=m;i++)f[i]=<span class="built_in">mul</span>(f[i<span class="number">-2</span>],<span class="built_in">qpow</span>(ret<span class="number">-1</span>)),f[i]=<span class="built_in">mul</span>(f[i],<span class="built_in">Add</span>(ret,n<span class="number">-1</span>)),<span class="built_in">add</span>(ret,inv2);</span><br><span class="line">        C[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            C[i][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=i;j++)C[i][j]=<span class="built_in">Add</span>(C[i<span class="number">-1</span>][j],C[i<span class="number">-1</span>][j<span class="number">-1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> S[M][M];</span><br><span class="line">    <span class="keyword">int</span> ans[M];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">        <span class="built_in">pre</span>(n<span class="number">-3</span>,m+<span class="number">3</span>);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=i;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(j&amp;<span class="number">1</span>)<span class="built_in">add</span>(g[i],kcz-<span class="built_in">mul</span>(C[i][j],f[i-j+<span class="number">3</span>]));</span><br><span class="line">                <span class="keyword">else</span> <span class="built_in">add</span>(g[i],<span class="built_in">mul</span>(C[i][j],f[i-j+<span class="number">3</span>]));</span><br><span class="line">            &#125;</span><br><span class="line">            g[i]=<span class="built_in">mul</span>(g[i],i+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=m;i++)<span class="built_in">add</span>(h[i],g[i]),<span class="built_in">add</span>(h[i+<span class="number">1</span>],<span class="built_in">mul</span>(g[i],<span class="number">3</span>)),<span class="built_in">add</span>(h[i+<span class="number">2</span>],<span class="built_in">mul</span>(g[i],<span class="number">3</span>)),<span class="built_in">add</span>(h[i+<span class="number">3</span>],g[i]);</span><br><span class="line">        <span class="comment">//S=S_2(i,j)*j!</span></span><br><span class="line">        S[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=i;j++)S[i][j]=<span class="built_in">mul</span>(<span class="built_in">Add</span>(S[i<span class="number">-1</span>][j<span class="number">-1</span>],S[i<span class="number">-1</span>][j]),j);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=m;i++)<span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=i;j++)<span class="built_in">add</span>(ans[i],<span class="built_in">mul</span>(S[i][j],h[j]));</span><br><span class="line">        res Fac=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(n&gt;=<span class="number">3</span>)&#123;</span><br><span class="line">            Fac=f[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=<span class="number">5</span>;i++)Fac=<span class="built_in">mul</span>(Fac,<span class="number">2</span>*n-i);</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">2</span>;i++)Fac=<span class="built_in">mul</span>(Fac,<span class="built_in">qpow</span>(<span class="built_in">mul</span>(n-i,n-i)));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;n;i++)Fac=<span class="built_in">mul</span>(Fac,<span class="built_in">mul</span>(<span class="built_in">qpow</span>(i),i+n<span class="number">-1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=m;i++)<span class="built_in">add</span>(ans[i],Fac),<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,ans[i]);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF891-B"><a href="#CF891-B" class="headerlink" title="[CF891 B]"></a>[CF891 B]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有一个长度为 $n$ 且数互不相同的序列 $a$，现要求将 $a$ 排列成 $b$，满足任何一个非空下标真子集的 $a$ 和不等于 $b$ 和。</p>
<p>做法：一道降智题。</p>
<p>不要被构造题的数据范围迷惑了。平凡地，我们认为 $a$ 是递增的。那么将 $a$ 位移一位就是 $b$。证明也是容易的，若不包含 $n$，则下者一定大于上者；若包含，则考虑补集，于是下者一定小于上者。时间复杂度 $O(n)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.1.10 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">100</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    Pair b[N];</span><br><span class="line">    <span class="keyword">int</span> c[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i]=<span class="built_in">read</span>(),b[i]=<span class="built_in">mp</span>(a[i],i);</span><br><span class="line">        <span class="built_in">sort</span>(b+<span class="number">1</span>,b+n+<span class="number">1</span>),b[n+<span class="number">1</span>].fi=b[<span class="number">1</span>].fi;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            c[b[i].se]=b[i+<span class="number">1</span>].fi;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,c[i]);</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CC-NOV19A-PBOXES-CF802-O"><a href="#CC-NOV19A-PBOXES-CF802-O" class="headerlink" title="[CC NOV19A PBOXES/CF802 O]"></a>[CC NOV19A PBOXES/CF802 O]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：不会有人不知道 codechef 有官方汉化吧，不会吧不会吧。</p>
<p>做法：典中典之模拟费用流，之前因为实在不想写代码所以一直没用这种做法。</p>
<p>首先建个费用流模型，方便起见，我们将以前习惯的四层图模型改成三层，因为这类题的边是单向的，CC 这题经过贪心后也是单向的，CF 那题本来就是要求单向的。即 $S$ 向每个点连个权值 $a_i$ 流量 $1$，每个点向 $T$ 连个权值 $b_i$ 流量 $1$，然后点与点之间的连边是单向的，所以只要 $i$ 向 $i+1$ 连个权值 $0$ 流量 $\inf$ 即可。</p>
<p>这种题的增广都有一个很好的贪心性质：不会退回已经增广过的有权值边。这个性质保证了我们的增广路径实际就两种，一种是从 $i$ 到 $j$，其中 $i\leq j$。一种是 $i$ 到 $j$，但 $i&gt;j$，那么这里就满足 $[j,i]$ 之间的边的反边有流量了，即被增广过了。也可以发现流量改变是区间的，要么加一，要么减一，于是我们分别考虑如何维护这两种增广信息。</p>
<p>第一种增广是随意的，只要找到左边一个最小的 $a_i$，右边一个最小的 $b_i$，直接加起来就是答案。这东西完全可以用线段树在合并区间的时候维护下即可。第二种增广有要求，它要求 $[j,i]$ 之间的反边流量不为 $0$，那要咋维护呢？如果我们已经想要用线段树的话，那就是要考虑两个区间合并要用哪些信息。发现这个东西其实挺类似最大区间和的，一个区间要维护连着左端点的最长反边流量不为 $0$ 的位置以及这一段的最小 $a_i$，还有右端点类似的一段位置和最小 $b_i$。发现如果没有修改的话，我们已经维护了答案。如果是区间加一，那等于直接包揽了整段区间；如果是区间减一，我们还需要知道哪些反边流量为 $1$，然后缩短那一段。实际上维护为 $1$ 的这个信息是艰难的，不如维护从左边开始的最小反边流量的位置和值（ 说得有点绕，不过手画一下是可以理解的 ），右边同理（ 同时可以注意到最小值都是一样的 ），然后也要把之前维护的流量不为 $0$ 的信息改成不跨过这个最小值点。发现这样的话区间减某个数可以直接从哪个最小反边流量处断开即可（ 因为每次能减就已经保证了反边流量减完后还大于等于 $0$ ）。于是就可以做了，时间复杂度 $O(n+k\log n)$。</p>
<p>实现上，我们会发现两种情况的答案不能直接放一起比较大小，不然下传减到 $0$ 的标记时会无法更新。</p>
<p>坑：注意到边实际是区间，别当做点了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.1.13 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    Pair a[N];</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Ans</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> ans,ansl,ansr;</span><br><span class="line">        <span class="built_in">Ans</span>() &#123;&#125;</span><br><span class="line">        <span class="built_in">Ans</span>(res ans,res ansl,res ansr):<span class="built_in">ans</span>(ans),<span class="built_in">ansl</span>(ansl),<span class="built_in">ansr</span>(ansr) &#123;&#125;</span><br><span class="line">        <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> Ans &amp;B) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">if</span>(ans&lt;B.ans)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(ans&gt;B.ans)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">if</span>(ansl&lt;=ansr)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span></span>&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d %d %d\n&quot;</span>,ans,ansl,ansr);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">TR</span>&#123;</span></span><br><span class="line">        <span class="keyword">int</span> mn;<span class="comment">//min flow</span></span><br><span class="line">        <span class="keyword">int</span> lm,rm;<span class="comment">//position of mn from left to right or otherwise</span></span><br><span class="line">        Pair lmv,rmv;<span class="comment">//min value &amp; position of before lm/rm</span></span><br><span class="line">        <span class="comment">//l a r b</span></span><br><span class="line">        Pair ma,mb;</span><br><span class="line">        Ans ans[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">int</span> ls,rs;</span><br><span class="line">    &#125;tr[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> tag[N&lt;&lt;<span class="number">2</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> Ans <span class="title">merge</span><span class="params">(<span class="keyword">const</span> Pair &amp;A,<span class="keyword">const</span> Pair &amp;B)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Ans</span>(A.fi+B.fi&gt;inf?inf:A.fi+B.fi,A.se,B.se);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> TR <span class="title">merge</span><span class="params">(<span class="keyword">const</span> TR &amp;A,<span class="keyword">const</span> TR &amp;B)</span></span>&#123;</span><br><span class="line">        TR C;</span><br><span class="line">        C.ls=A.ls,C.rs=B.rs;</span><br><span class="line">        C.mn=<span class="built_in">min</span>(A.mn,B.mn);</span><br><span class="line">        C.ans[<span class="number">0</span>]=<span class="built_in">min</span>(A.ans[<span class="number">0</span>],B.ans[<span class="number">0</span>]);</span><br><span class="line">        <span class="keyword">if</span>(A.mn&gt;B.mn)&#123;</span><br><span class="line">            C.ans[<span class="number">0</span>]=<span class="built_in">min</span>(C.ans[<span class="number">0</span>],A.ans[<span class="number">1</span>]);</span><br><span class="line">            C.ans[<span class="number">0</span>]=<span class="built_in">min</span>(C.ans[<span class="number">0</span>],<span class="built_in">merge</span>(B.lmv,A.mb));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(A.mn&lt;B.mn)&#123;</span><br><span class="line">            C.ans[<span class="number">0</span>]=<span class="built_in">min</span>(C.ans[<span class="number">0</span>],B.ans[<span class="number">1</span>]);</span><br><span class="line">            C.ans[<span class="number">0</span>]=<span class="built_in">min</span>(C.ans[<span class="number">0</span>],<span class="built_in">merge</span>(B.ma,A.rmv));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            C.ans[<span class="number">0</span>]=<span class="built_in">min</span>(C.ans[<span class="number">0</span>],<span class="built_in">merge</span>(B.lmv,A.rmv));</span><br><span class="line">        &#125;</span><br><span class="line">        C.ans[<span class="number">1</span>]=<span class="built_in">min</span>(&#123;A.ans[<span class="number">1</span>],B.ans[<span class="number">1</span>],<span class="built_in">merge</span>(B.ma,A.mb)&#125;);</span><br><span class="line">        C.ans[<span class="number">2</span>]=<span class="built_in">min</span>(&#123;A.ans[<span class="number">2</span>],B.ans[<span class="number">2</span>],<span class="built_in">merge</span>(A.ma,B.mb)&#125;);</span><br><span class="line">        C.ma=<span class="built_in">min</span>(A.ma,B.ma),C.mb=<span class="built_in">min</span>(A.mb,B.mb);</span><br><span class="line">        <span class="keyword">if</span>(A.mn&gt;B.mn)C.lm=B.lm,C.lmv=<span class="built_in">min</span>(A.ma,B.lmv);</span><br><span class="line">        <span class="keyword">else</span> C.lm=A.lm,C.lmv=A.lmv;</span><br><span class="line">        <span class="keyword">if</span>(A.mn&lt;B.mn)C.rm=A.rm,C.rmv=<span class="built_in">min</span>(B.mb,A.rmv);</span><br><span class="line">        <span class="keyword">else</span> C.rm=B.rm,C.rmv=B.rmv;</span><br><span class="line">        <span class="keyword">return</span> C;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">const</span> res &amp;rt,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        tag[rt]+=v,tr[rt].mn+=v;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">pushdown</span><span class="params">(<span class="keyword">const</span> res &amp;rt)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!tag[rt])<span class="keyword">return</span>;</span><br><span class="line">        <span class="built_in">change</span>(rt&lt;&lt;<span class="number">1</span>,tag[rt]),<span class="built_in">change</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,tag[rt]),tag[rt]=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(res rt,res l,res r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">            tr[rt].ls=tr[rt].rs=l;</span><br><span class="line">            tr[rt].ma=<span class="built_in">mp</span>(-a[l].se,l),tr[rt].mb=<span class="built_in">mp</span>(a[l].se,l);</span><br><span class="line">            tr[rt].ans[<span class="number">0</span>]=<span class="built_in">Ans</span>(inf,l,l),tr[rt].ans[<span class="number">1</span>]=tr[rt].ans[<span class="number">2</span>]=<span class="built_in">Ans</span>(<span class="number">0</span>,l,l);</span><br><span class="line">            tr[rt].lm=tr[rt].rm=l;</span><br><span class="line">            tr[rt].lmv=tr[rt].rmv=<span class="built_in">mp</span>(inf,<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">build</span>(rt&lt;&lt;<span class="number">1</span>,l,mid),<span class="built_in">build</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r);</span><br><span class="line">        tr[rt]=<span class="built_in">merge</span>(tr[rt&lt;&lt;<span class="number">1</span>],tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;L,<span class="keyword">const</span> res &amp;R,<span class="keyword">const</span> res &amp;v)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=l&amp;&amp;r&lt;=R)&#123;</span><br><span class="line">            <span class="built_in">change</span>(rt,v);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(L&lt;=mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,L,R,v);</span><br><span class="line">        <span class="keyword">if</span>(R&gt;mid)<span class="built_in">modify</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,L,R,v);</span><br><span class="line">        tr[rt]=<span class="built_in">merge</span>(tr[rt&lt;&lt;<span class="number">1</span>],tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">erase</span><span class="params">(res rt,res l,res r,<span class="keyword">const</span> res &amp;p)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;tr[rt].ma=tr[rt].mb=<span class="built_in">mp</span>(inf,p),tr[rt].ans[<span class="number">0</span>]=tr[rt].ans[<span class="number">1</span>]=tr[rt].ans[<span class="number">2</span>]=<span class="built_in">Ans</span>(inf,l,l);<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="built_in">pushdown</span>(rt);</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(p&lt;=mid)<span class="built_in">erase</span>(rt&lt;&lt;<span class="number">1</span>,l,mid,p);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">erase</span>(rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>,mid+<span class="number">1</span>,r,p);</span><br><span class="line">        tr[rt]=<span class="built_in">merge</span>(tr[rt&lt;&lt;<span class="number">1</span>],tr[rt&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>(),y=<span class="built_in">read</span>();</span><br><span class="line">            a[i]=<span class="built_in">mp</span>(x,y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(a+<span class="number">1</span>,a+n+<span class="number">1</span>),<span class="built_in">reverse</span>(a+<span class="number">1</span>,a+n+<span class="number">1</span>),<span class="built_in">build</span>(<span class="number">1</span>,<span class="number">1</span>,n);</span><br><span class="line">        RG LL ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;&lt;<span class="number">1</span>&lt;=n;i++)&#123;</span><br><span class="line">            Ans ret=<span class="built_in">min</span>(tr[<span class="number">1</span>].ans[<span class="number">0</span>],tr[<span class="number">1</span>].ans[<span class="number">2</span>]);</span><br><span class="line">            <span class="keyword">if</span>(tr[<span class="number">1</span>].mn&gt;<span class="number">0</span>)ret=<span class="built_in">min</span>(ret,tr[<span class="number">1</span>].ans[<span class="number">1</span>]);</span><br><span class="line">            ans+=ret.ans;</span><br><span class="line">            res l=ret.ansl,r=ret.ansr;</span><br><span class="line">            <span class="built_in">erase</span>(<span class="number">1</span>,<span class="number">1</span>,n,l),<span class="built_in">erase</span>(<span class="number">1</span>,<span class="number">1</span>,n,r);</span><br><span class="line">            <span class="keyword">if</span>(l&lt;=r)<span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,l,r<span class="number">-1</span>,<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">modify</span>(<span class="number">1</span>,<span class="number">1</span>,n,r,l<span class="number">-1</span>,<span class="number">-1</span>);</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,-ans);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF901-D"><a href="#CF901-D" class="headerlink" title="[CF901 D]"></a>[CF901 D]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给你一个有 $n$ 个顶点与 $m$ 条边的无向图，那些顶点的编号依次为 $1$ 到 $n$。</p>
<p>再给你 $n$ 个整数 $C_1,C_2,…,C_n$ 每一个数都在区间 $[-n,n]$ 之间。保证 $C_v$ 的奇偶性与顶点 $v$ 的度的奇偶性相同。一个顶点的的度是指连接到它的边数。</p>
<p>你需要按照下列的要求为所有边写上一个在 $-2\cdot n^2$ 与 $2\cdot n^2$ 之间的一个重量：对于任何一个顶点 $v$，所有连接到这个顶点的边的重量和等于 $C_v$。或者，确定这是不可能达到的。</p>
<p>做法：属于是想当然了，导致代码调急了。</p>
<p>首先可以注意到度数为 $1$ 的点直接就确定了它所在的边的边权，类似地，我们直接搞出一棵生成树，然后从叶子到根跑一遍。如果此时根权值已经达到要求，就可行了。否则考虑非树边的影响。</p>
<p>注意到除了根的总和是不变的，于是每次选择一条非树边，影响总和的值总是偶数的，这意味着根权值的差若为奇数则已经无解了。而若有一个奇环，一旦确定了那条非树边，绕一圈加减，则等价于 $\mathrm{lca}$ 的权值加或减了两倍，再一路到根就已经构造出答案了。若只有偶环，可以证明偶环的变化对根的相对影响为 $0$，所以直接是不行的。时间复杂度 $O(n)$。</p>
<p>坑：注意正负符号的变化。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.1.14 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    LL C[N];</span><br><span class="line">    Pair edge[N];</span><br><span class="line">    <span class="keyword">int</span> fa[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(res x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(x!=fa[x])x=fa[x]=fa[fa[x]];</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    vector&lt;Pair&gt; G[N];</span><br><span class="line">    <span class="keyword">int</span> dep[N],F[N][<span class="number">21</span>],Fa[N];</span><br><span class="line">    LL a[N],val[N];</span><br><span class="line">    <span class="keyword">int</span> fl[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(res x,res fax,res depx)</span></span>&#123;</span><br><span class="line">        dep[x]=depx,F[x][<span class="number">0</span>]=fax;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">20</span>;i++)F[x][i]=F[F[x][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> [tox,id]:G[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(tox==fax)<span class="keyword">continue</span>;</span><br><span class="line">            Fa[tox]=id,<span class="built_in">dfs</span>(tox,x,depx+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> [tox,id]:G[x])<span class="keyword">if</span>(tox==fax)&#123;val[id]=C[x]-a[x],a[fax]+=val[id],a[x]=C[x];<span class="keyword">break</span>;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">getlca</span><span class="params">(res x,res y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(dep[x]&lt;dep[y])<span class="built_in">swap</span>(x,y);</span><br><span class="line">        res d=dep[x]-dep[y];</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">20</span>;~i;i--)<span class="keyword">if</span>(d&amp;(<span class="number">1</span>&lt;&lt;i))x=F[x][i];</span><br><span class="line">        <span class="keyword">if</span>(x==y)<span class="keyword">return</span> x;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">20</span>;~i;i--)<span class="keyword">if</span>(F[x][i]!=F[y][i])x=F[x][i],y=F[y][i];</span><br><span class="line">        <span class="keyword">return</span> F[x][<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)C[i]=<span class="built_in">read</span>(),fa[i]=i;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            res u=<span class="built_in">read</span>(),v=<span class="built_in">read</span>();</span><br><span class="line">            edge[i]=<span class="built_in">mp</span>(u,v);</span><br><span class="line">            res fu=<span class="built_in">find</span>(u),fv=<span class="built_in">find</span>(v);</span><br><span class="line">            <span class="keyword">if</span>(fu==fv)<span class="keyword">continue</span>;</span><br><span class="line">            fl[i]=<span class="number">1</span>,G[u].<span class="built_in">pb</span>(<span class="built_in">mp</span>(v,i)),G[v].<span class="built_in">pb</span>(<span class="built_in">mp</span>(u,i)),fa[fu]=fv;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">dfs</span>(<span class="number">1</span>,<span class="number">0</span>,<span class="number">1</span>);</span><br><span class="line">        RG LL p=C[<span class="number">1</span>]-a[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span>(p&amp;<span class="number">1</span>)&#123;<span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="keyword">if</span>(!p)&#123;</span><br><span class="line">            <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,val[i]);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(fl[i])<span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">auto</span> [u,v]=edge[i];</span><br><span class="line">            res lca=<span class="built_in">getlca</span>(u,v);</span><br><span class="line">            <span class="keyword">if</span>(~(dep[u]+dep[v]<span class="number">-2</span>*dep[lca])&amp;<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(~(dep[u]-dep[lca])&amp;<span class="number">1</span>)p=-p;</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;YES&quot;</span>);</span><br><span class="line">                <span class="keyword">if</span>(~(dep[lca]-dep[<span class="number">1</span>])&amp;<span class="number">1</span>)p=-p;</span><br><span class="line">                val[i]+=p/<span class="number">2</span>,p=-p;</span><br><span class="line">                res now=u;</span><br><span class="line">                <span class="keyword">while</span>(now!=lca)val[Fa[now]]+=p/<span class="number">2</span>,now=F[now][<span class="number">0</span>],p=-p;</span><br><span class="line">                now=v;</span><br><span class="line">                p=C[<span class="number">1</span>]-a[<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">if</span>(~(dep[u]-dep[lca])&amp;<span class="number">1</span>)p=-p;</span><br><span class="line">                <span class="keyword">if</span>(~(dep[lca]-dep[<span class="number">1</span>])&amp;<span class="number">1</span>)p=-p;</span><br><span class="line">                p=-p;</span><br><span class="line">                <span class="keyword">while</span>(now!=lca)val[Fa[now]]+=p/<span class="number">2</span>,now=F[now][<span class="number">0</span>],p=-p;</span><br><span class="line">                now=lca;</span><br><span class="line">                <span class="keyword">while</span>(now!=<span class="number">1</span>)val[Fa[now]]+=p,now=F[now][<span class="number">0</span>],p=-p;</span><br><span class="line">                <span class="keyword">for</span>(res _=<span class="number">1</span>;_&lt;=m;_++)<span class="built_in">printf</span>(<span class="string">&quot;%lld\n&quot;</span>,val[_]);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;NO&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="Uva1467"><a href="#Uva1467" class="headerlink" title="[Uva1467]"></a>[Uva1467]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：工程师要安装 $n$ 个服务， 其中第 $i$ 个服务 $J_i$ 需要 $s_i$ 单位的安装时间，截止时间为 $d_i$。如果在截止时间之前完成任务， 不会有任何惩罚；否则惩罚值为任务完成时间与截止时间之差。从 $t=0$ 时刻开始执行任务，同一时刻只能执行一个任务， 你的任务是让惩罚值最大的两个任务惩罚值之和最小。求出最小值。</p>
<p>做法：如果只是让最大的一个最小，那么我们直接按截止时间升序、安装时间升序排序即可，这个贪心的证明直接调整法即可，因为最后的时间是不变的，所以容易证出。另一方面，当排好序之后，我们考虑最大的两个分别是 $J_1,J_2$，设它们完成的时间是 $a_1,a_2$。首先容易说明交换任何数到 $J_1,J_2$ 之间都是会让答案变大，因为一定有一个惩罚不变，而交换之后 $a-d&lt;a’-d’$，$a’,d’$ 为交换后的某个数。举个例子，比如从前交换到中间。本来是 $a’&lt;a_1,d’&lt;d_1$，交换后 $a_1&lt;a’$，那么 $a_1-d_1&lt;a’-d’$，所以这样交换一定是亏的。所以有效的交换只有 $J_1$ 前交换到 $J_2$ 后。而我们可以证明交换两个一定是亏的，这和上面那个类似，会发现 $a_1-d_1+a_2-d_2&lt;a’’-d’’+a’-d’$，于是不如不交换。于是有了这个贪心就容易了，想 $O(n^3),O(n^2),O(n\log n)$ 都可以，当然我个人比较懒，写个能过的就跑路了。</p>
<p>注意我这里的交换可能是和空气交换。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.1.16 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    Pair a[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>(),y=<span class="built_in">read</span>();</span><br><span class="line">            a[i]=<span class="built_in">mp</span>(y,x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(a+<span class="number">1</span>,a+n+<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">for</span>(res i=n;i;i--)a[<span class="number">2</span>*i<span class="number">-1</span>]=a[i],a[<span class="number">2</span>*i]=<span class="built_in">mp</span>(inf,<span class="number">0</span>);</span><br><span class="line">        n&lt;&lt;=<span class="number">1</span>;</span><br><span class="line">        res mx=<span class="number">0</span>,smx=<span class="number">0</span>,s=<span class="number">0</span>,vmx=<span class="number">0</span>,vsmx=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            s+=a[i].se;</span><br><span class="line">            <span class="keyword">if</span>(s-a[i].fi&gt;vmx)smx=mx,vsmx=vmx,mx=i,vmx=s-a[i].fi;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(s-a[i].fi&gt;vsmx)smx=i,vsmx=s-a[i].fi;</span><br><span class="line">        &#125;</span><br><span class="line">        res ans=vmx+vsmx;</span><br><span class="line">        <span class="keyword">for</span>(res _=<span class="number">1</span>,t=<span class="built_in">min</span>(smx,mx),p=<span class="built_in">max</span>(smx,mx);_&lt;=t;_++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(res j=p;j&lt;=n;j++)&#123;</span><br><span class="line">                <span class="built_in">swap</span>(a[_],a[j]);</span><br><span class="line">                s=<span class="number">0</span>,vmx=<span class="number">0</span>,vsmx=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">                    s+=a[i].se;</span><br><span class="line">                    <span class="keyword">if</span>(s-a[i].fi&gt;vmx)vsmx=vmx,vmx=s-a[i].fi;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(s-a[i].fi&gt;vsmx)vsmx=s-a[i].fi;</span><br><span class="line">                &#125;</span><br><span class="line">                ans=<span class="built_in">min</span>(ans,vmx+vsmx);</span><br><span class="line">                <span class="built_in">swap</span>(a[_],a[j]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="uoj91"><a href="#uoj91" class="headerlink" title="[uoj91]"></a>[uoj91]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：中文题面不会自己看？</p>
<p>做法：带删除的线性基。</p>
<p>首先操作一二的区间操作可以利用差分变成单点操作以及区间清零（ 线性代数小知识 ），然后只需思考修改一个向量为向量空间的基底的影响。</p>
<p>一共两种情况，要么这个向量是基底中的一个不能被其他向量线性表出，即删除后会让空间降维，要么可以被被表出，那么就需要找到另一个可以表出它的且与基底线性无关的向量加入基底之中。</p>
<p>发现这两种情况类似，只需要维护每个非基底向量可以被哪几位表出，删除全是暴力的。由于总向量个数是 $O(n+q)$ 的，所以暴力的复杂度也只是 $O(\frac{(n+m)mq}{\omega})$，其中 $\omega$ 是用 <code>bitset</code> 压位的。</p>
<p>坑：注意遇到零向量就直接跑路，小心复杂度错误。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.1.16 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m,q;</span><br><span class="line">    <span class="keyword">int</span> id[N];</span><br><span class="line">    bitset&lt;N&gt; val[N],a[N],ex[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> res &amp;I)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=m<span class="number">-1</span>;~i;i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(val[I].<span class="built_in">test</span>(i))&#123;</span><br><span class="line">                <span class="keyword">if</span>(id[i])val[I]^=val[id[i]],ex[I]^=ex[id[i]];</span><br><span class="line">                <span class="keyword">else</span> &#123;id[i]=I;<span class="keyword">return</span>;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">Xor</span><span class="params">(<span class="keyword">const</span> res &amp;p,<span class="keyword">const</span> bitset&lt;N&gt; &amp;v)</span></span>&#123;</span><br><span class="line">        res g=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(v.<span class="built_in">none</span>())<span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(val[i].<span class="built_in">none</span>()&amp;&amp;ex[i].<span class="built_in">test</span>(p))&#123;g=i;<span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">if</span>(!g)<span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;m;i++)<span class="keyword">if</span>(id[i]&amp;&amp;ex[id[i]].<span class="built_in">test</span>(p))&#123;g=id[i],id[i]=<span class="number">0</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(i!=g&amp;&amp;ex[i].<span class="built_in">test</span>(p))val[i]^=val[g],ex[i]^=ex[g];</span><br><span class="line">        val[g]^=v,<span class="built_in">insert</span>(g);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>(),q=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)cin&gt;&gt;a[i],val[i]=a[i]^a[i<span class="number">-1</span>],ex[i].<span class="built_in">set</span>(i),<span class="built_in">insert</span>(i);</span><br><span class="line">        <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">            res opt=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">if</span>(opt==<span class="number">1</span>)&#123;</span><br><span class="line">                res l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>();</span><br><span class="line">                bitset&lt;N&gt; v;</span><br><span class="line">                cin&gt;&gt;v;</span><br><span class="line">                <span class="keyword">for</span>(res i=l;i&lt;=r;i++)a[i]^=v;</span><br><span class="line">                <span class="built_in">Xor</span>(l,v);</span><br><span class="line">                <span class="keyword">if</span>(r!=n)<span class="built_in">Xor</span>(r+<span class="number">1</span>,v);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(opt==<span class="number">2</span>)&#123;</span><br><span class="line">                res l=<span class="built_in">read</span>(),r=<span class="built_in">read</span>();</span><br><span class="line">                bitset&lt;N&gt; v;</span><br><span class="line">                cin&gt;&gt;v;</span><br><span class="line">                <span class="built_in">Xor</span>(l,a[l]^v);</span><br><span class="line">                <span class="keyword">if</span>(r!=n)<span class="built_in">Xor</span>(r+<span class="number">1</span>,a[r]^v);</span><br><span class="line">                <span class="keyword">for</span>(res i=r;i&gt;l;i--)<span class="built_in">Xor</span>(i,a[i]^a[i<span class="number">-1</span>]),a[i]=v;</span><br><span class="line">                a[l]=v;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                bitset&lt;N&gt; ans;</span><br><span class="line">                ans.<span class="built_in">reset</span>();</span><br><span class="line">                <span class="keyword">for</span>(res i=m<span class="number">-1</span>;~i;i--)<span class="keyword">if</span>(id[i]&amp;&amp;!ans.<span class="built_in">test</span>(i))ans^=val[id[i]];</span><br><span class="line">                <span class="keyword">for</span>(res i=m<span class="number">-1</span>;~i;i--)<span class="built_in">printf</span>(<span class="string">&quot;%0d&quot;</span>,ans.<span class="built_in">test</span>(i));</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF901-A"><a href="#CF901-A" class="headerlink" title="[CF901 A]"></a>[CF901 A]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给定一棵树的深度 $n$ 和每个深度的结点数，说明这样的树是否唯一。</p>
<p>做法：显然若有两层点数都是大于 $1$ 则不唯一，否则唯一。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.1.17 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> a[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n+<span class="number">1</span>;i++)a[i]=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)</span><br><span class="line">            <span class="keyword">if</span>(a[i]&gt;<span class="number">1</span>&amp;&amp;a[i+<span class="number">1</span>]&gt;<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;ambiguous&quot;</span>);</span><br><span class="line">                res now=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=n+<span class="number">1</span>;j++)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(res k=<span class="number">1</span>;k&lt;=a[j];k++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,now);</span><br><span class="line">                    now+=a[j];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">                now=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=i;j++)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(res k=<span class="number">1</span>;k&lt;=a[j];k++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,now);</span><br><span class="line">                    now+=a[j];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,now<span class="number">-1</span>);</span><br><span class="line">                <span class="keyword">for</span>(res k=<span class="number">1</span>;k&lt;a[i+<span class="number">1</span>];k++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,now);</span><br><span class="line">                now+=a[i+<span class="number">1</span>];</span><br><span class="line">                <span class="keyword">for</span>(res j=i+<span class="number">2</span>;j&lt;=n+<span class="number">1</span>;j++)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(res k=<span class="number">1</span>;k&lt;=a[j];k++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,now);</span><br><span class="line">                    now+=a[j];</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="built_in">puts</span>(<span class="string">&quot;perfect&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="Acmtimus1599"><a href="#Acmtimus1599" class="headerlink" title="[Acmtimus1599]"></a>[Acmtimus1599]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有 $n$ 个点，A 从第一个点开始走，按序经过第二三 $\cdots$ 个点，最后从第 $n$ 个点回到第一个点。多次询问，每次询问 B 在一个给定的点 $(x,y)$，目光跟着 A 走路，你需要计算在这个过程中 B 逆时针转的圈数减去顺时针转的圈数的结果是多少。</p>
<p>做法：注意到完整的圈才算，不完整的不是。再思考怎么才会完整的转一圈，发现只有当一个多边形把 B 包含在里面才会，另一方面，这个圈数就等价于被有向包含了几次。考虑以 B 做一条水平射线，每碰一次边界看看是还在里面还是在外面，里面加一，外面减一，发现这就是答案。实现时，没必要算这个交点，而直接对边界的边做一些判断，具体判断画个图即可。时间复杂度  $O(nm)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.1.17 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">5e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    Pair a[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> LL <span class="title">cross</span><span class="params">(<span class="keyword">const</span> Pair &amp;p0,<span class="keyword">const</span> Pair &amp;p1,<span class="keyword">const</span> Pair &amp;p2)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> (p1.fi-p0.fi)*(p2.se-p0.se)-(p2.fi-p0.fi)*(p1.se-p0.se);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>(),y=<span class="built_in">read</span>();</span><br><span class="line">            a[i]=<span class="built_in">mp</span>(x,y);</span><br><span class="line">        &#125;</span><br><span class="line">        a[n+<span class="number">1</span>]=a[<span class="number">1</span>];</span><br><span class="line">        res q=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>(),y=<span class="built_in">read</span>();</span><br><span class="line">            Pair p=<span class="built_in">mp</span>(x,y);</span><br><span class="line">            res wn=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">cross</span>(a[i],a[i+<span class="number">1</span>],p)==<span class="number">0</span>)&#123;<span class="built_in">puts</span>(<span class="string">&quot;EDGE&quot;</span>),wn=n+<span class="number">1</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">                <span class="keyword">if</span>(a[i].se&lt;=p.se)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(a[i+<span class="number">1</span>].se&gt;p.se)<span class="keyword">if</span>(<span class="built_in">cross</span>(a[i],a[i+<span class="number">1</span>],p)&gt;<span class="number">0</span>)wn++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span>(a[i+<span class="number">1</span>].se&lt;=p.se)<span class="keyword">if</span>(<span class="built_in">cross</span>(a[i],a[i+<span class="number">1</span>],p)&lt;<span class="number">0</span>)wn--;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(wn&lt;=n)<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,wn);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="ICPC2020昆明-I"><a href="#ICPC2020昆明-I" class="headerlink" title="[ICPC2020昆明 I]"></a>[ICPC2020昆明 I]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：A 坐火车从 $s$ 到 $t$，经过了许多风车。火车在一条线段上行驶。随着火车的行驶，风车在 A 的视野里会发生位置相对变化。现在给出风车们的坐标，多次询问 $(h,k)$，请你找到当第 $h$ 个风车与其他风车的相对位置变化 $k$ 次时火车的位置。</p>
<p>做法：直接把 $O(n^2)$ 条直线与火车路径交一下，按 $x$ 排个序即可。时间复杂度 $O(n^2+m)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.1.17 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">sgn</span><span class="params">(<span class="keyword">const</span> RG ld &amp;x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x&lt;-eps)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(x&gt;eps)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">vec</span>&#123;</span></span><br><span class="line">        ld x,y;</span><br><span class="line">        <span class="built_in">vec</span>() &#123;x=y=<span class="number">0</span>;&#125;</span><br><span class="line">        <span class="built_in">vec</span>(ld A,ld B)&#123;x=A,y=B;&#125;</span><br><span class="line">        <span class="keyword">inline</span> vec <span class="keyword">operator</span> + (<span class="keyword">const</span> RG vec &amp;v) <span class="keyword">const</span> &#123;<span class="keyword">return</span> &#123;x+v.x,y+v.y&#125;;&#125;</span><br><span class="line">        <span class="keyword">inline</span> vec <span class="keyword">operator</span> - (<span class="keyword">const</span> RG vec &amp;v) <span class="keyword">const</span> &#123;<span class="keyword">return</span> &#123;x-v.x,y-v.y&#125;;&#125;</span><br><span class="line">        <span class="keyword">inline</span> vec <span class="keyword">operator</span> * (<span class="keyword">const</span> RG ld &amp;v) <span class="keyword">const</span> &#123;<span class="keyword">return</span> &#123;x*v,y*v&#125;;&#125;</span><br><span class="line">        <span class="keyword">inline</span> vec <span class="keyword">operator</span> / (<span class="keyword">const</span> RG ld &amp;v) <span class="keyword">const</span> &#123;<span class="keyword">return</span> &#123;x/v,y/v&#125;;&#125;</span><br><span class="line">        <span class="keyword">inline</span> ld <span class="keyword">operator</span> * (<span class="keyword">const</span> RG vec &amp;v) <span class="keyword">const</span> &#123;<span class="keyword">return</span> x*v.x+y*v.y;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> ld <span class="title">len</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">hypotl</span>(x,y);&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> ld <span class="title">len_sqr</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;<span class="keyword">return</span> x*x+y*y;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> vec <span class="title">rotate</span><span class="params">(<span class="keyword">const</span> RG ld &amp;c)</span> <span class="keyword">const</span> </span>&#123;<span class="keyword">return</span> &#123;x*<span class="built_in">cosl</span>(c)-y*<span class="built_in">sinl</span>(c),x*<span class="built_in">sinl</span>(c)+y*<span class="built_in">cosl</span>(c)&#125;;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> vec <span class="title">trunc</span><span class="params">(<span class="keyword">const</span> RG ld &amp;l)</span> <span class="keyword">const</span> </span>&#123;<span class="keyword">return</span> (*<span class="keyword">this</span>)*l/<span class="built_in">len</span>();&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> vec <span class="title">rot90</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;<span class="keyword">return</span> &#123;-y,x&#125;;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">            x=<span class="built_in">read</span>(),y=<span class="built_in">read</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> RG vec &amp;A) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> x&lt;A.x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ld <span class="title">cross</span><span class="params">(<span class="keyword">const</span> RG vec &amp;A,<span class="keyword">const</span> RG vec &amp;B)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> A.x*B.y-A.y*B.x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">line_intersection</span><span class="params">(<span class="keyword">const</span> RG vec &amp;a,<span class="keyword">const</span> RG vec &amp;b,<span class="keyword">const</span> RG vec &amp;p,<span class="keyword">const</span> RG vec &amp;q,vec &amp;o,ld *t=<span class="number">0</span>)</span></span>&#123;</span><br><span class="line">        RG ld U=<span class="built_in">cross</span>(p-a,q-p);</span><br><span class="line">        RG ld D=<span class="built_in">cross</span>(b-a,q-p);</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">sgn</span>(D)==<span class="number">0</span>)<span class="keyword">return</span> <span class="built_in">sgn</span>(U)==<span class="number">0</span>?<span class="number">2</span>:<span class="number">0</span>;</span><br><span class="line">        o=a+(b-a)*(U/D);</span><br><span class="line">        <span class="keyword">if</span>(t)*t=U/D;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">ck_in</span><span class="params">(<span class="keyword">const</span> vec &amp;a,<span class="keyword">const</span> vec &amp;b,<span class="keyword">const</span> RG vec &amp;c)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a.x&lt;=c.x&amp;&amp;c.x&lt;=b.x;</span><br><span class="line">    &#125;</span><br><span class="line">    vec a[N];</span><br><span class="line">    vector&lt;vec&gt; b[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">        vec st,ed;</span><br><span class="line">        res fl=<span class="number">0</span>;</span><br><span class="line">        st.<span class="built_in">init</span>(),ed.<span class="built_in">init</span>();</span><br><span class="line">        <span class="keyword">if</span>(ed&lt;st)<span class="built_in">swap</span>(st,ed),fl=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i].<span class="built_in">init</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i==j)<span class="keyword">continue</span>;</span><br><span class="line">                vec p;</span><br><span class="line">                <span class="built_in">line_intersection</span>(st,ed,a[i],a[j],p);</span><br><span class="line">                <span class="keyword">if</span>(<span class="built_in">ck_in</span>(st,ed,p))b[i].<span class="built_in">pb</span>(p);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">sort</span>(b[i].<span class="built_in">begin</span>(),b[i].<span class="built_in">end</span>());</span><br><span class="line">            <span class="keyword">if</span>(fl)<span class="built_in">reverse</span>(b[i].<span class="built_in">begin</span>(),b[i].<span class="built_in">end</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(m--)&#123;</span><br><span class="line">            res h=<span class="built_in">read</span>(),k=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">if</span>(b[h].<span class="built_in">size</span>()&lt;k)<span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%.10Lf %.10Lf\n&quot;</span>,b[h][k<span class="number">-1</span>].x,b[h][k<span class="number">-1</span>].y);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="2017WF-A"><a href="#2017WF-A" class="headerlink" title="[2017WF A]"></a>[2017WF A]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：逆时针方向给出一个简单多边形，问内部可放置的线段的最长长度，保证无两边共线。</p>
<p>做法：注意到答案的线段一定是多边形某两个端点连线所在的直线（ 可以通过旋转反证 ），然后考虑一条直线被切割成若干段，会是一段在里面，一段在外面反复的，所有合起来取个 $\max$ 就好了。时间复杂度 $O(n^3)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.1.17 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">sgn</span><span class="params">(<span class="keyword">const</span> RG ld &amp;x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(x&lt;-eps)<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">if</span>(x&gt;eps)<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">vec</span>&#123;</span></span><br><span class="line">        ld x,y;</span><br><span class="line">        <span class="built_in">vec</span>() &#123;x=y=<span class="number">0</span>;&#125;</span><br><span class="line">        <span class="built_in">vec</span>(ld A,ld B)&#123;x=A,y=B;&#125;</span><br><span class="line">        <span class="keyword">inline</span> vec <span class="keyword">operator</span> + (<span class="keyword">const</span> RG vec &amp;v) <span class="keyword">const</span> &#123;<span class="keyword">return</span> &#123;x+v.x,y+v.y&#125;;&#125;</span><br><span class="line">        <span class="keyword">inline</span> vec <span class="keyword">operator</span> - (<span class="keyword">const</span> RG vec &amp;v) <span class="keyword">const</span> &#123;<span class="keyword">return</span> &#123;x-v.x,y-v.y&#125;;&#125;</span><br><span class="line">        <span class="keyword">inline</span> vec <span class="keyword">operator</span> * (<span class="keyword">const</span> RG ld &amp;v) <span class="keyword">const</span> &#123;<span class="keyword">return</span> &#123;x*v,y*v&#125;;&#125;</span><br><span class="line">        <span class="keyword">inline</span> vec <span class="keyword">operator</span> / (<span class="keyword">const</span> RG ld &amp;v) <span class="keyword">const</span> &#123;<span class="keyword">return</span> &#123;x/v,y/v&#125;;&#125;</span><br><span class="line">        <span class="keyword">inline</span> ld <span class="keyword">operator</span> * (<span class="keyword">const</span> RG vec &amp;v) <span class="keyword">const</span> &#123;<span class="keyword">return</span> x*v.x+y*v.y;&#125;</span><br><span class="line">        <span class="keyword">inline</span> ld <span class="keyword">operator</span> ^ (<span class="keyword">const</span> RG vec &amp;v) <span class="keyword">const</span> &#123;<span class="keyword">return</span> x*v.y-y*v.x;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> ld <span class="title">len</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;<span class="keyword">return</span> <span class="built_in">hypotl</span>(x,y);&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> ld <span class="title">len_sqr</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;<span class="keyword">return</span> x*x+y*y;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> vec <span class="title">rotate</span><span class="params">(<span class="keyword">const</span> RG ld &amp;c)</span> <span class="keyword">const</span> </span>&#123;<span class="keyword">return</span> &#123;x*<span class="built_in">cosl</span>(c)-y*<span class="built_in">sinl</span>(c),x*<span class="built_in">sinl</span>(c)+y*<span class="built_in">cosl</span>(c)&#125;;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> vec <span class="title">trunc</span><span class="params">(<span class="keyword">const</span> RG ld &amp;l)</span> <span class="keyword">const</span> </span>&#123;<span class="keyword">return</span> (*<span class="keyword">this</span>)*l/<span class="built_in">len</span>();&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> vec <span class="title">rot90</span><span class="params">()</span> <span class="keyword">const</span> </span>&#123;<span class="keyword">return</span> &#123;-y,x&#125;;&#125;</span><br><span class="line">        <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">            x=<span class="built_in">read</span>(),y=<span class="built_in">read</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">inline</span> <span class="keyword">bool</span> <span class="keyword">operator</span> &lt; (<span class="keyword">const</span> RG vec &amp;A) <span class="keyword">const</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> x&lt;A.x;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> ld <span class="title">len</span><span class="params">(<span class="keyword">const</span> vec &amp;a,<span class="keyword">const</span> vec &amp;b,<span class="keyword">const</span> vec &amp;A,<span class="keyword">const</span> vec &amp;B)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> B^(a-A)/(b^B)*b.<span class="built_in">len</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    vec a[N];</span><br><span class="line">    ld ans;</span><br><span class="line">    pair&lt;ld,<span class="keyword">int</span>&gt; b[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">solve</span><span class="params">(<span class="keyword">const</span> vec &amp;v,<span class="keyword">const</span> vec &amp;p)</span></span>&#123;</span><br><span class="line">        res cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res c0=<span class="built_in">sgn</span>(p^(a[i]-v)),c1=<span class="built_in">sgn</span>(p^(a[i+<span class="number">1</span>]-v));</span><br><span class="line">            <span class="keyword">if</span>(c0!=c1)b[++cnt]=<span class="built_in">mp</span>(<span class="built_in">len</span>(v,p,a[i],a[i+<span class="number">1</span>]-a[i]),c0-c1);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(b+<span class="number">1</span>,b+cnt+<span class="number">1</span>);</span><br><span class="line">        res fl=<span class="number">0</span>;</span><br><span class="line">        ld ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=cnt;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(fl)ret+=b[i].fi-b[i<span class="number">-1</span>].fi;</span><br><span class="line">            <span class="keyword">else</span> ans=<span class="built_in">max</span>(ans,ret),ret=<span class="number">0</span>;</span><br><span class="line">            fl+=b[i].se;</span><br><span class="line">        &#125;</span><br><span class="line">        ans=<span class="built_in">max</span>(ans,ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)a[i].<span class="built_in">init</span>();</span><br><span class="line">        a[n+<span class="number">1</span>]=a[<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=i+<span class="number">1</span>;j&lt;=n;j++)<span class="built_in">solve</span>(a[i],a[j]-a[i]);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%.10Lf\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="集训队作业2018-围绕着我们的圆环"><a href="#集训队作业2018-围绕着我们的圆环" class="headerlink" title="[集训队作业2018] 围绕着我们的圆环"></a>[集训队作业2018] 围绕着我们的圆环</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：uoj 的题面当然是中文的啊。</p>
<p>做法：其实看到这样的式子容易想到线性方程组，于是就猜到了基本和 $C$ 细节无关，只和秩有关。这也是容易证明的，考虑两个秩相同的 $C$，分别等于两组 $A,B$ 的乘积。注意到秩相同代表可以被初等变换成一致，又等价于分别左乘右乘一堆初等矩阵，于是发现每一组 $(A,B)$ 一定对应一组 $(A’,B’)$，所以证明了秩相同的 $C$ 答案是一致的。</p>
<p>设 $C$ 的秩为 $r$，不妨枚举 $A$ 的秩为 $t$，我们考虑 $A$ 能组出的秩为 $r$ 的矩阵有多少个。（ 因为我们会发现用 $C$ 算 $A$ 似乎无比艰难 ）$A$ 的秩为 $t$ 意味着它的列向量所组成的空间维度为 $t$，也即极大线性无关组的大小为 $t$。那么其他都被线性表出。而 $C$ 的列向量的线性极大无关组大小为 $r$，它的行只有 $t$ 行是线性无关的，其他都可被表出。于是这就说明 $A$ 能表出的 $C$ 只有 $t$ 行是有效的，也即能表出的 $C$ 只有 $f_{t,s,r}$，其中 $f_{a,b,c}$ 表示大小为 $a\cdot b$ 秩为 $c$ 的矩阵数量。（ 上面证明不太严谨，建议自己严谨证明一下 ）再考虑 $B$ 有几个，这就容易了，拿着 $A$ 的列向量去乘 $B$，考虑这个线性方程组的解数，容易得出 $B$ 的数量为 $2^{(q-t)s}$。而我们知道相同秩的 $C$ 答案是一样的，于是整体除以相同秩的 $C$ 的数量。即答案为 </p>
<script type="math/tex; mode=display">
\frac{1}{f_{p,s,r}}\sum_{t} f_{p,q,t}f_{t,s,r}2^{(q-t)s}</script><p> 现在考虑如何算 $f$，显然想到 $\mathrm{q-binomial}$，具体证明可以看<a target="_blank" rel="noopener" href="https://xyix.github.io/posts/?&amp;sortby=last_modi&amp;page=2&amp;postname=loj-562">这里</a>，于是</p>
<script type="math/tex; mode=display">
f_{a,b,c}=2^{c(c-1)/2}[c]_2!\binom{a}{c}_2\binom{b}{c}_2\\\\
=2^{c(c-1)/2}\frac{[a]_2![b]_2!}{[a-c]_2![b-c]_2![c]_2!}</script><p>然后改写下答案形式，即</p>
<script type="math/tex; mode=display">
[p-r]_2![q]_2!\sum_{t\geq r} \frac{2^{t(t-1)/2}2^{(q-t)s}}{[p-t]_2![q-t]_2![t-r]_2!}</script><p>剩下来就是要动态算 $C$ 的秩，带删除的线性基即可。时间复杂度 $O(n^2+\frac{n^2(n+m)}{\omega})$。</p>
<p>代码实现上我直接比较暴力，显然取模次数可以更少，不过我懒得优化了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.1.20 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e3</span>+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> A,B,C;</span><br><span class="line">    <span class="keyword">int</span> rnk,id[N];</span><br><span class="line">    bitset&lt;N&gt; val[N],ex[N];</span><br><span class="line">    <span class="function">bitset&lt;N&gt; <span class="title">re</span><span class="params">()</span></span>&#123;</span><br><span class="line">        bitset&lt;N&gt; ret;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;C;i++)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>();</span><br><span class="line">            ret.<span class="built_in">set</span>(i,x);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">const</span> res &amp;p)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=C<span class="number">-1</span>;~i;i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(val[p].<span class="built_in">test</span>(i))&#123;</span><br><span class="line">                <span class="keyword">if</span>(id[i])val[p]^=val[id[i]],ex[p]^=ex[id[i]];</span><br><span class="line">                <span class="keyword">else</span> &#123;id[i]=p,rnk++;<span class="keyword">return</span>;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">const</span> res &amp;p,<span class="keyword">const</span> bitset&lt;N&gt; &amp;v)</span></span>&#123;</span><br><span class="line">        res g=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=A;i++)<span class="keyword">if</span>(val[i].<span class="built_in">none</span>()&amp;&amp;ex[i].<span class="built_in">test</span>(p))&#123;g=i;<span class="keyword">break</span>;&#125;</span><br><span class="line">        <span class="keyword">if</span>(!g)&#123;</span><br><span class="line">            rnk--;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;C;i++)<span class="keyword">if</span>(id[i]&amp;&amp;ex[id[i]].<span class="built_in">test</span>(p))&#123;g=id[i],id[i]=<span class="number">0</span>;<span class="keyword">break</span>;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=A;i++)<span class="keyword">if</span>(i!=g&amp;&amp;ex[i].<span class="built_in">test</span>(p))val[i]^=val[g],ex[i]^=ex[g];</span><br><span class="line">        val[g]=v,ex[g].<span class="built_in">reset</span>().<span class="built_in">set</span>(p),<span class="built_in">insert</span>(g);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> pw2[N*N*<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> fac2[N],ifac2[N];</span><br><span class="line">    <span class="keyword">int</span> lastans;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">get</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res t=rnk;t&lt;=A&amp;&amp;t&lt;=B;t++)&#123;</span><br><span class="line">            res r=pw2[t*(t<span class="number">-1</span>)/<span class="number">2</span>+(B-t)*C];</span><br><span class="line">            r=<span class="built_in">mul</span>(<span class="built_in">mul</span>(ifac2[A-t],ifac2[B-t]),<span class="built_in">mul</span>(ifac2[t-rnk],r));</span><br><span class="line">            <span class="built_in">add</span>(ret,r);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">mul</span>(<span class="built_in">mul</span>(fac2[A-rnk],fac2[B]),ret);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        A=<span class="built_in">read</span>(),B=A,C=A,pw2[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;N*N*<span class="number">2</span>;i++)pw2[i]=<span class="built_in">Add</span>(pw2[i<span class="number">-1</span>],pw2[i<span class="number">-1</span>]);</span><br><span class="line">        fac2[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        res lim=<span class="built_in">max</span>(&#123;A,B,C&#125;);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=lim;i++)fac2[i]=<span class="built_in">mul</span>(fac2[i<span class="number">-1</span>],pw2[i]<span class="number">-1</span>);</span><br><span class="line">        ifac2[lim]=<span class="built_in">qpow</span>(fac2[lim]);</span><br><span class="line">        <span class="keyword">for</span>(res i=lim;i;i--)ifac2[i<span class="number">-1</span>]=<span class="built_in">mul</span>(ifac2[i],pw2[i]<span class="number">-1</span>);</span><br><span class="line">        res q=<span class="number">0</span>,k=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=A;i++)val[i]=<span class="built_in">re</span>(),ex[i].<span class="built_in">set</span>(i),<span class="built_in">insert</span>(i);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,lastans=<span class="built_in">get</span>());</span><br><span class="line">        <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>()^(k*lastans);</span><br><span class="line">            <span class="built_in">change</span>(x,<span class="built_in">re</span>());</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,lastans=<span class="built_in">get</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF960-G"><a href="#CF960-G" class="headerlink" title="[CF960 G]"></a>[CF960 G]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给你三个正整数 $n,a,b$，定义 $A$ 为一个排列中是前缀最大值的数的个数，定义 $B$ 为一个排列中是后缀最大值的数的个数，求长度为 $n$ 的排列中满足 $A=a$ 且 $B=b$ 的排列个数。</p>
<p>做法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="Cometoj-2-F"><a href="#Cometoj-2-F" class="headerlink" title="[Cometoj#2 F]"></a>[Cometoj#2 F]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：是中文题面捏。</p>
<p>做法：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF468-C"><a href="#CF468-C" class="headerlink" title="[CF468 C]"></a>[CF468 C]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：$f(x)$ 表示 $x$ 的每一位数的和，给出 $a$，构造 $l,r$，使得 $\sum_{i=l}^r f(i)$ 是 $a$ 的倍数。</p>
<p>做法：注意到在某个数的最前面添加个 $1$ 是会让答案加一，我们为了让 $\sum_{i=l}^r f(i)$ 至少要大于 $a$，所以先算了下 $\sum_{i=1}^{10^{18}-1} f(i)$ 的值，可以组合意义得出这个是 $9\times9\times10^{18}$。另一方面，根据位移的性质，我们只用位移 $a-(9\times9\times10^{18}\mod a)$ 位即可让缺少的部分被补上了，所以就做完了。时间复杂度 $O(1)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.1.21 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        LL a=<span class="built_in">Read</span>();</span><br><span class="line">        RG LL t=<span class="number">1000000000000000000</span>%a;</span><br><span class="line">        t=t*<span class="number">9</span>%a*<span class="number">9</span>%a;</span><br><span class="line">        t=a-t;</span><br><span class="line">        t%=a;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%lld %lld\n&quot;</span>,<span class="built_in">max</span>(t,<span class="number">1ll</span>),t+<span class="number">1000000000000000000</span><span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="POI2013-GRA"><a href="#POI2013-GRA" class="headerlink" title="[POI2013] GRA"></a>[POI2013] GRA</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：有一个 $n$ 个点 $m$ 条边的图，每条边距离是 $1$，已知用 $k$ 个攻击距离为 $1$ 的塔可以打到整个地图，让构造一个方案使得用小于等于 $k$ 个攻击距离为 $2$ 的塔打到整个地图。</p>
<p>做法：猜一猜都知道是直接贪心，想一想发现证明也容易。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.23 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">5e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; G[N];</span><br><span class="line">    <span class="keyword">int</span> vis[N];</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; ans;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>(),<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            res u=<span class="built_in">read</span>(),v=<span class="built_in">read</span>();</span><br><span class="line">            G[u].<span class="built_in">pb</span>(v),G[v].<span class="built_in">pb</span>(u);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(vis[i])<span class="keyword">continue</span>;</span><br><span class="line">            ans.<span class="built_in">pb</span>(i),vis[i]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> x:G[i])&#123;</span><br><span class="line">                vis[x]=<span class="number">1</span>;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">auto</span> tox:G[x])vis[tox]=<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in"><span class="keyword">int</span></span>(ans.<span class="built_in">size</span>()));</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> x:ans)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,x);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="Code-1-Yazid-的新生舞会"><a href="#Code-1-Yazid-的新生舞会" class="headerlink" title="[Code+#1] Yazid 的新生舞会"></a>[Code+#1] Yazid 的新生舞会</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：不是只有中文题面？</p>
<p>做法：呃呃，<a href="https://foreverlasting1202.github.io/2021/08/03/2021%E5%A4%9A%E6%A0%A15/">这里</a> 的 $1009$ 就是了。</p>
</div></div>
<h3 id="CF710-C"><a href="#CF710-C" class="headerlink" title="[CF710 C]"></a>[CF710 C]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：请你构造一个 $n\cdot n$ 的矩阵，并且该矩阵是由 $1$ 到 $n^2$ 的数构成的，每个数只能使用一次，且这个矩阵的每行，每列，以及主对角线的和都为奇数。</p>
<p>做法：思路比较多。一种是注意到 $\frac{(n^2+1)n}{2}$ 一定是奇数，那么直接幻方构造就行了。</p>
<p>或者是每次取正方形边的中点来构成新的正方形，然后在边上的都填奇数，其他填偶数，可以发现这样每一行每一列的奇数个数都是奇数的（ 因为对称，然后中线正好有一个 ），而对角线因为中间那一个是奇数则刚好是奇数个。</p>
<p>我写了幻方，因为比较容易。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.24 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> a[<span class="number">100</span>][<span class="number">100</span>];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        res n=<span class="built_in">read</span>();</span><br><span class="line">        a[<span class="number">1</span>][n/<span class="number">2</span>+<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        res x=<span class="number">1</span>,y=n/<span class="number">2</span>+<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n*n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(x==<span class="number">1</span>&amp;&amp;y!=n)a[n][y+<span class="number">1</span>]=i,x=n,y++;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(y==n&amp;&amp;x!=<span class="number">1</span>)a[x<span class="number">-1</span>][<span class="number">1</span>]=i,x--,y=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(x==<span class="number">1</span>&amp;&amp;y==n)a[x+<span class="number">1</span>][y]=i,x++;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span>(!a[x<span class="number">-1</span>][y+<span class="number">1</span>])a[x<span class="number">-1</span>][y+<span class="number">1</span>]=i,x--,y++;</span><br><span class="line">                <span class="keyword">else</span> a[x+<span class="number">1</span>][y]=i,x++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)<span class="built_in">printf</span>(<span class="string">&quot;%d &quot;</span>,a[i][j]);<span class="built_in">puts</span>(<span class="string">&quot;&quot;</span>);&#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="Xmas-Contest-2021-C"><a href="#Xmas-Contest-2021-C" class="headerlink" title="[Xmas Contest 2021 C]"></a>[Xmas Contest 2021 C]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给定一个 <code>0</code>、<code>1</code>、<code>?</code> 构成的字符串。将每个 <code>?</code> 枚举其填 <code>0</code> 或 <code>1</code> 后得到一个 <code>01</code> 串 $S$，对所有 $S$ 的 $f(S)$ 求和，$f(S)$ 为如下序列的数量：</p>
<ul>
<li>$S_0,S_1,…,S_N=S$ 皆为 <code>01</code> 序列，其中第 $k$ 项的长度为 $k$。</li>
<li>$S_k$ 是 $S_{k+1}$ 的子序列。</li>
</ul>
<p>做法：<del>呃呃，构造双射失败，疑似有点急了。</del>疑似是因为我太弱智了，呃呃。</p>
<p>先假装没有 $?$，考虑将 $0$ 看成 $&gt;$，$1$ 看成 $&lt;$，然后中间插入一个长度为 $n+1$ 的排列，可以证明这个排列数与答案是一样的。这个双射是容易构造的，考虑每次删掉最大的数，然后改变的地方自适应不等号，而另一方面 $f(S)$ 实际上等价于每次让某一段全 $0$ 或全 $1$ 子段长度减一，我们直接规定它减去的是这一段最大的数。于是就构造双射成功了。</p>
<p>而有 $?$ 意味着每一段被 $?$ 隔开的子段之间都是独立的，于是答案一定是这些个子段答案的乘积。而这个答案是可以容斥出来的。考虑 $f_i$ 表示考虑前 $i$ 个 $&gt;$ 之前的符号（ 包括 $&lt;$ ）满足的方案数。显然有一个容斥的转移，即</p>
<script type="math/tex; mode=display">
f_i=[s_i='>']\sum_{j<i}[s_j='>'](-1)^{c_i-c_j-1}\binom{i}{i-j}f_j</script><p>其中 $c_i$ 表示 $i$ 之前 $&gt;$ 的个数。对这个转移式稍微化个简，即</p>
<script type="math/tex; mode=display">
\frac{f_i}{i!}=[s_i='>']\sum_{j<i}\frac{(-1)^{c_i-c_j-1}}{(i-j)!}[s_j='>']\frac{f_j}{j!}</script><p>右边是两个东西的卷积，于是就可以分治 FFT 在 $O(n\log^2 n)$ 或者 $O(n\frac{\log^2n}{\log\log n})$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.26 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> Og[N],pos[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">FFT</span><span class="params">(res *A,<span class="keyword">const</span> res &amp;type,<span class="keyword">const</span> res &amp;lim)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;lim;i++)<span class="keyword">if</span>(i&lt;pos[i])<span class="built_in">swap</span>(A[i],A[pos[i]]);</span><br><span class="line">        <span class="keyword">for</span>(res mid=<span class="number">1</span>;mid&lt;lim;mid&lt;&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">            res wn=<span class="built_in">qpow</span>(type==<span class="number">1</span>?G:GI,(kcz<span class="number">-1</span>)/(mid&lt;&lt;<span class="number">1</span>));</span><br><span class="line">            Og[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;mid;i++)Og[i]=<span class="built_in">mul</span>(Og[i<span class="number">-1</span>],wn);</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;lim;j+=mid&lt;&lt;<span class="number">1</span>)</span><br><span class="line">                <span class="keyword">for</span>(res k=<span class="number">0</span>;k&lt;mid;k++)&#123;</span><br><span class="line">                    res x=A[j+k],y=<span class="built_in">mul</span>(A[j+mid+k],Og[k]);</span><br><span class="line">                    A[j+k]=<span class="built_in">Add</span>(x,y),A[j+mid+k]=<span class="built_in">Add</span>(x,kcz-y);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(type==<span class="number">-1</span>)&#123;</span><br><span class="line">            res INV=<span class="built_in">qpow</span>(lim,kcz<span class="number">-2</span>);</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;lim;i++)A[i]=<span class="built_in">mul</span>(A[i],INV);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">char</span> str[N];</span><br><span class="line">    <span class="keyword">int</span> f[N],inv[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">mulpre</span><span class="params">(<span class="keyword">const</span> res &amp;len)</span></span>&#123;</span><br><span class="line">        res l=<span class="number">1</span>,qaq=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;=len&lt;&lt;<span class="number">1</span>)l&lt;&lt;=<span class="number">1</span>,qaq++;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;l;i++)pos[i]=(pos[i&gt;&gt;<span class="number">1</span>]&gt;&gt;<span class="number">1</span>)|((i&amp;<span class="number">1</span>)&lt;&lt;(qaq<span class="number">-1</span>));</span><br><span class="line">        <span class="keyword">return</span> l;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> A[N],B[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">cdqFFT</span><span class="params">(res l,res r)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l==r)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!l)f[l]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(str[l]!=<span class="string">&#x27;0&#x27;</span>)f[l]=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">        <span class="built_in">cdqFFT</span>(l,mid);</span><br><span class="line">        res len=<span class="built_in">mulpre</span>(r-l);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;len;i++)A[i]=B[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=l;i&lt;=mid;i++)A[i-l]=f[i];</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=r-l;i++)B[i]=kcz-inv[i];</span><br><span class="line">        <span class="built_in">FFT</span>(A,<span class="number">1</span>,len),<span class="built_in">FFT</span>(B,<span class="number">1</span>,len);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;len;i++)A[i]=<span class="built_in">mul</span>(A[i],B[i]);</span><br><span class="line">        <span class="built_in">FFT</span>(A,<span class="number">-1</span>,len);</span><br><span class="line">        <span class="keyword">for</span>(res i=mid+<span class="number">1</span>;i&lt;=r;i++)<span class="built_in">add</span>(f[i],A[i-l]);</span><br><span class="line">        <span class="built_in">cdqFFT</span>(mid+<span class="number">1</span>,r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">solve</span><span class="params">(res n)</span></span>&#123;</span><br><span class="line">        str[++n]=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=n;i++)f[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">cdqFFT</span>(<span class="number">0</span>,n);</span><br><span class="line">        res ans=f[n];</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">if</span>(str[i]==<span class="string">&#x27;0&#x27;</span>)ans=kcz-ans;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">char</span> s[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),<span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,s+<span class="number">1</span>),inv[<span class="number">0</span>]=inv[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        s[++n]=<span class="string">&#x27;?&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)inv[i]=<span class="built_in">mul</span>(inv[kcz%i],kcz-kcz/i);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=n;i++)inv[i]=<span class="built_in">mul</span>(inv[i<span class="number">-1</span>],inv[i]);</span><br><span class="line">        res pre=<span class="number">0</span>,ans=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(s[i]==<span class="string">&#x27;?&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i-pre&gt;<span class="number">1</span>)&#123;</span><br><span class="line">                    <span class="keyword">for</span>(res j=pre+<span class="number">1</span>;j&lt;i;j++)str[j-pre]=s[j];</span><br><span class="line">                    ans=<span class="built_in">mul</span>(ans,<span class="built_in">solve</span>(i-pre<span class="number">-1</span>));</span><br><span class="line">                &#125;</span><br><span class="line">                pre=i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)ans=<span class="built_in">mul</span>(ans,i);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="TC12703"><a href="#TC12703" class="headerlink" title="[TC12703]"></a>[TC12703]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：$2\cdot n$ 的方格图，每个方格染三种颜色之一，每 $2\times 2$ 的方格这三种颜色都至少存在一次，且相邻方格颜色不同，现告诉你三种颜色分别的数量，问染色方案数。</p>
<p>做法：注意到相邻格子颜色不同，于是只能有 $RB,BG,GR$ 了（ 上下颠倒仅仅是乘 $2$ ），然后它们分别的数量是直接确定的。于是题意转化成已知三种元素个数，相同的不能相邻，问填充方案数。这是个日经问题了，考虑先把第一个元素全部插入，然后剩下的空位只要确定一个接下来的位置也就都确定了，而由于有元素个数限制，那么就看有多少个连续空位是奇数还是偶数来确定有多少个可以第二个元素多一个，这些都是直接手推的组合数，前者是隔板法，后者是直接 $2$ 的幂次算，总复杂度 $O(n)$。</p>
<p>坑：连续空位数量是要分类讨论的。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.25 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> fac[N],inv[N],pw[N];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">C</span><span class="params">(<span class="keyword">const</span> res &amp;x,<span class="keyword">const</span> res &amp;y)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (x&gt;=<span class="number">0</span>&amp;&amp;y&gt;=<span class="number">0</span>&amp;&amp;x&gt;=y)?<span class="built_in">mul</span>(fac[x],<span class="built_in">mul</span>(inv[y],inv[x-y])):<span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">calc</span><span class="params">(<span class="keyword">const</span> res &amp;x,<span class="keyword">const</span> res &amp;y,<span class="keyword">const</span> res &amp;z)</span></span>&#123;</span><br><span class="line">    res ret=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(res g=x<span class="number">-1</span>,oy,ry,oz,rz;g&lt;=x;++g)</span><br><span class="line">        <span class="keyword">for</span>(res e=<span class="number">0</span>;e&lt;=g;++e)</span><br><span class="line">            <span class="keyword">if</span>(((y^z^g^e)&amp;<span class="number">1</span>)==<span class="number">0</span>)&#123;</span><br><span class="line">                oy=(y-z+g-e)&gt;&gt;<span class="number">1</span>,ry=y-oy-e,oz=g-e-oy,rz=z-oz-e;</span><br><span class="line">                <span class="keyword">if</span>(oy&gt;=<span class="number">0</span>&amp;&amp;ry&gt;=<span class="number">0</span>&amp;&amp;oz&gt;=<span class="number">0</span>&amp;&amp;rz&gt;=<span class="number">0</span>&amp;&amp;rz==ry)</span><br><span class="line">                    <span class="built_in">add</span>(ret,<span class="built_in">mul</span>(<span class="built_in">mul</span>(<span class="built_in">C</span>(g,e),<span class="built_in">C</span>(g-e,oy)),<span class="built_in">mul</span>(<span class="built_in">C</span>(g+ry<span class="number">-1</span>,ry),pw[e])));</span><br><span class="line">            &#125;</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LittleElephantAndBoard</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getNumber</span><span class="params">(<span class="keyword">int</span> M,<span class="keyword">int</span> R,<span class="keyword">int</span> G,<span class="keyword">int</span> B)</span></span>&#123;</span><br><span class="line">        fac[<span class="number">0</span>]=fac[<span class="number">1</span>]=inv[<span class="number">0</span>]=inv[<span class="number">1</span>]=pw[<span class="number">0</span>]=<span class="number">1</span>,pw[<span class="number">1</span>]=<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=M;i++)fac[i]=<span class="built_in">mul</span>(fac[i<span class="number">-1</span>],i),inv[i]=<span class="built_in">mul</span>(inv[kcz%i],kcz-kcz/i);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=M;i++)inv[i]=<span class="built_in">mul</span>(inv[i<span class="number">-1</span>],inv[i]),pw[i]=<span class="built_in">Add</span>(pw[i<span class="number">-1</span>],pw[i<span class="number">-1</span>]);</span><br><span class="line">        res ans=<span class="number">0</span>;</span><br><span class="line">        <span class="built_in">add</span>(ans,<span class="built_in">calc</span>(M-R,M-G,M-B));</span><br><span class="line">        <span class="built_in">add</span>(ans,<span class="built_in">calc</span>(M-B,M-R,M-G));</span><br><span class="line">        <span class="built_in">add</span>(ans,<span class="built_in">calc</span>(M-G,M-R,M-B));</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">Add</span>(ans,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="TC12782"><a href="#TC12782" class="headerlink" title="[TC12782]"></a>[TC12782]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：定义形如 $0^n1^n$ 的串是好的，好串的连接是好的。长度为 $N$ 的字符串，包含 $0,1,?$ 三种字符，替换 $?$ 为 $0,1$，使得形成的串是好的。求方案数。</p>
<p>做法：有一个显然的 dp，即设 $f_i$ 表示到 $i$ 时的方案数，转移就是枚举长度，然后看看两边分别有没有 $0$ 和 $1$。容易发现每次是从某几段区间转移，当不能转移时就会移到下一个 $0$ 的位置，然后长度只能是 $/2$，于是每次转移区间都是除 $2$ 的，于是对某个端点而言区间段数是 $O(\log n)$。而每次找区间是可以双指针维护的，总复杂度 $O(n\log n)$。</p>
<p>听说有 $O(n)$，但感觉差差不多。</p>
</div></div>
<h3 id="Gym102431-B"><a href="#Gym102431-B" class="headerlink" title="[Gym102431 B]"></a>[Gym102431 B]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给出一张无向图，定义路径长度为 $lex([]) = 0, lex([e_1, e_2, \ldots, e_n]) = \frac{w(e_1) + lex([e_2, e_3, \ldots, e_n])}{10}$，其中 $w(e_i)$ 为边权，值域为 $[0,9]$，求 $0$ 到 $1$ 的最短路径长，模 $10^9+7$。</p>
<p>做法：呃呃，其实这个翻译就不太好，原题面是说字典序了，我把这翻译成路径长度了，还是改成字典序理解吧。</p>
<p>等价于每次走过一条边就把这个边权扔到最后面，求字典序最小路径。</p>
<p>先去掉所有无法抵达 $1$ 的点，然后直接暴力走个 $n$ 步先，这 $n$ 步都是基于贪心地选择最小的边，这样此时抵达的点要么已经在 $1$，要么一定在一个环里。而如果已经在环里，就意味着这个环一定是最优的，即后面到 $1$ 的路径就没有实际价值了，直接舍去。于是就变成找这个环是谁了，再暴力走个 $2n$，循环节就是环，于是就做完了。</p>
<p>由于暴力走实在太暴力了，所以时间复杂度就是 $O(n^2)$。</p>
<p>坑：暴力时注意下把点去重。</p>
<p>坑：为了方便描绘已经到 $1$ 的情况，可以特意对 $1$ 加一条边权为 $0$ 的自环。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.27 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    vector&lt;Pair&gt; G[N];</span><br><span class="line">    vector&lt;<span class="keyword">int</span>&gt; rG[N];</span><br><span class="line">    <span class="keyword">int</span> vis[N];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(res x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> tox:rG[x])<span class="keyword">if</span>(!vis[tox])vis[tox]=<span class="number">1</span>,<span class="built_in">dfs</span>(tox);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">kmp</span><span class="params">(<span class="keyword">const</span> vector&lt;<span class="keyword">int</span>&gt; &amp;s)</span></span>&#123;</span><br><span class="line">        res n=<span class="built_in"><span class="keyword">int</span></span>(s.<span class="built_in">size</span>()),p=<span class="number">-1</span>;</span><br><span class="line">        <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">fail</span><span class="params">(n)</span></span>;</span><br><span class="line">        fail[<span class="number">0</span>]=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(~p&amp;&amp;s[p+<span class="number">1</span>]!=s[i])p=fail[p];</span><br><span class="line">            <span class="keyword">if</span>(s[p+<span class="number">1</span>]==s[i])p++;</span><br><span class="line">            fail[i]=p;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fail[n<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> n,m;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),m=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)vector&lt;Pair&gt;().<span class="built_in">swap</span>(G[i]),vector&lt;<span class="keyword">int</span>&gt;().<span class="built_in">swap</span>(rG[i]),vis[i]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=m;i++)&#123;</span><br><span class="line">            res u=<span class="built_in">read</span>()+<span class="number">1</span>,v=<span class="built_in">read</span>()+<span class="number">1</span>,w=<span class="built_in">read</span>();</span><br><span class="line">            G[u].<span class="built_in">pb</span>(<span class="built_in">mp</span>(v,w));</span><br><span class="line">            rG[v].<span class="built_in">pb</span>(u);</span><br><span class="line">        &#125;</span><br><span class="line">        G[<span class="number">2</span>].<span class="built_in">pb</span>(<span class="built_in">mp</span>(<span class="number">2</span>,<span class="number">0</span>));</span><br><span class="line">        vis[<span class="number">2</span>]=<span class="number">1</span>,<span class="built_in">dfs</span>(<span class="number">2</span>);</span><br><span class="line">        <span class="function">vector&lt;<span class="keyword">int</span>&gt; <span class="title">now</span><span class="params">(<span class="number">1</span>,<span class="number">1</span>)</span>,ans</span>;</span><br><span class="line">        <span class="keyword">for</span>(res T=<span class="number">1</span>;T&lt;=n*<span class="number">3</span>;T++)&#123;</span><br><span class="line">            pair&lt;<span class="keyword">int</span>,vector&lt;<span class="keyword">int</span>&gt;&gt; <span class="built_in">cur</span>(<span class="number">11</span>,vector&lt;<span class="keyword">int</span>&gt;());</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">auto</span> x:now)&#123;</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">auto</span> [tox,c]:G[x])&#123;</span><br><span class="line">                    <span class="keyword">if</span>(!vis[tox])<span class="keyword">continue</span>;</span><br><span class="line">                    <span class="keyword">if</span>(c&lt;cur.fi)cur=&#123;c,vector&lt;<span class="keyword">int</span>&gt;(<span class="number">1</span>,tox)&#125;;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(c==cur.fi)cur.se.<span class="built_in">pb</span>(tox);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ans.<span class="built_in">pb</span>(cur.fi),now=cur.se,<span class="built_in">sort</span>(now.<span class="built_in">begin</span>(),now.<span class="built_in">end</span>()),now.<span class="built_in">erase</span>(<span class="built_in">unique</span>(now.<span class="built_in">begin</span>(),now.<span class="built_in">end</span>()),now.<span class="built_in">end</span>());</span><br><span class="line">        &#125;</span><br><span class="line">        res inv=<span class="built_in">qpow</span>(<span class="number">10</span>);</span><br><span class="line">        <span class="keyword">auto</span> getCyc=[&amp;](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;a)&#123;</span><br><span class="line">            vector&lt;<span class="keyword">int</span>&gt; <span class="built_in">b</span>(a.<span class="built_in">begin</span>()+n,a.<span class="built_in">end</span>());</span><br><span class="line">            res lat=<span class="built_in">kmp</span>(b);</span><br><span class="line">            <span class="keyword">return</span> vector&lt;<span class="keyword">int</span>&gt;(b.<span class="built_in">begin</span>(),b.<span class="built_in">begin</span>()+(<span class="keyword">int</span>)b.<span class="built_in">size</span>()-lat<span class="number">-1</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">auto</span> getInt=[&amp;inv](<span class="keyword">const</span> <span class="keyword">auto</span> &amp;a)&#123;</span><br><span class="line">            res ret=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> x:a)ret=<span class="built_in">Add</span>(<span class="built_in">mul</span>(ret,<span class="number">10</span>),x);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">mul</span>(ret,<span class="built_in">qpow</span>(inv,<span class="built_in"><span class="keyword">int</span></span>(a.<span class="built_in">size</span>())));</span><br><span class="line">        &#125;;</span><br><span class="line">        vector&lt;<span class="keyword">int</span>&gt; cyc=<span class="built_in">getCyc</span>(ans);</span><br><span class="line">        ans=vector&lt;<span class="keyword">int</span>&gt;(ans.<span class="built_in">begin</span>(),ans.<span class="built_in">begin</span>()+n);</span><br><span class="line">        res ret=<span class="built_in">mul</span>(<span class="built_in">mul</span>(<span class="built_in">getInt</span>(cyc),<span class="built_in">qpow</span>(inv,(<span class="keyword">int</span>)ans.<span class="built_in">size</span>())),<span class="built_in">qpow</span>(kcz+<span class="number">1</span>-<span class="built_in">qpow</span>(inv,(<span class="keyword">int</span>)cyc.<span class="built_in">size</span>())));</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;Case #%d: %d\n&quot;</span>,Case,<span class="built_in">Add</span>(ret,<span class="built_in">getInt</span>(ans)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="TC14470"><a href="#TC14470" class="headerlink" title="[TC14470]"></a>[TC14470]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给出 $k$，要求构造一个点数小于等于 $20$ 的有向图，使得 $0$ 节点到编号最大的点的哈密顿路径数恰好为 $k$。</p>
<p>做法：考虑先有一条从末向前的单向链，然后除却起点外都往后连边。此时若起点往 $i$ 点连边的贡献是 $2^{n-i}$ ，所以就构造完了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.28 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">18</span>+<span class="number">10</span>;</span><br><span class="line">vector&lt;string&gt; a;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HamiltonianConstruction</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">vector&lt;string&gt; <span class="title">construct</span><span class="params">(<span class="keyword">int</span> k)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;<span class="number">20</span>;i++)&#123;</span><br><span class="line">            a.<span class="built_in">pb</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;<span class="number">20</span>;j++)a[i].<span class="built_in">pb</span>(<span class="string">&#x27;N&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;<span class="number">18</span>;i++)a[i+<span class="number">1</span>][i]=<span class="string">&#x27;Y&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;<span class="number">20</span>;i++)<span class="keyword">for</span>(res j=i+<span class="number">1</span>;j&lt;<span class="number">20</span>;j++)a[i][j]=<span class="string">&#x27;Y&#x27;</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;<span class="number">18</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(k&amp;(<span class="number">1</span>&lt;&lt;i))a[<span class="number">0</span>][<span class="number">17</span>-i]=<span class="string">&#x27;Y&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CERC2016-Hangar-Hurdles"><a href="#CERC2016-Hangar-Hurdles" class="headerlink" title="[CERC2016 Hangar Hurdles]"></a>[CERC2016 Hangar Hurdles]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：呃呃，洛谷有中文题面。</p>
<p>做法：<code>vector</code> 常数开不开 <code>O2</code> 差十倍是吧，当时就没绷住。</p>
<p>这题思路简单，代码也不复杂。首先我们能算出每个点能放的最大箱子大小，这是二分+二维前缀和 $O(n^2\log )$ 得到的。然后相邻点连边，边权为两点能放的最大箱子大小。接下来等价于有一个图，求两点路径的最小值的最大值，于是就搞出最大生成树，倍增下就做完了。时间复杂度 $O(n^2\log)$，感觉毫无细节哎，一发就过了。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.2.28 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e3</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> M=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> dx[]=&#123;<span class="number">0</span>,<span class="number">-1</span>&#125;,dy[]=&#123;<span class="number">-1</span>,<span class="number">0</span>&#125;;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="keyword">int</span> id[N][N],idx;</span><br><span class="line">    <span class="keyword">int</span> a[N][N],b[N][N];</span><br><span class="line">    <span class="keyword">int</span> sum[N][N];</span><br><span class="line">    <span class="keyword">char</span> str[N];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tup tuple<span class="meta-string">&lt;int,int,int&gt;</span></span></span><br><span class="line">    tup edge[M&lt;&lt;<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">int</span> ex;</span><br><span class="line">    <span class="keyword">int</span> fa[M];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">find</span><span class="params">(res x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">while</span>(x!=fa[x])x=fa[x]=fa[fa[x]];</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    vector&lt;Pair&gt; G[M];</span><br><span class="line">    <span class="keyword">int</span> mn[M][<span class="number">21</span>],F[M][<span class="number">21</span>],dep[M];</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(res x,res fax)</span></span>&#123;</span><br><span class="line">        F[x][<span class="number">0</span>]=fax;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">20</span>;i++)F[x][i]=F[F[x][i<span class="number">-1</span>]][i<span class="number">-1</span>],mn[x][i]=<span class="built_in">min</span>(mn[x][i<span class="number">-1</span>],mn[F[x][i<span class="number">-1</span>]][i<span class="number">-1</span>]);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> [tox,c]:G[x])&#123;</span><br><span class="line">            <span class="keyword">if</span>(tox==fax)<span class="keyword">continue</span>;</span><br><span class="line">            mn[tox][<span class="number">0</span>]=c,dep[tox]=dep[x]+<span class="number">1</span>,<span class="built_in">dfs</span>(tox,x);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">get_mn</span><span class="params">(res x,res y)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">find</span>(x)!=<span class="built_in">find</span>(y))<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span>(dep[x]&lt;dep[y])<span class="built_in">swap</span>(x,y);</span><br><span class="line">        res d=dep[x]-dep[y],ret=<span class="number">3</span>*n;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">20</span>;~i;i--)<span class="keyword">if</span>(d&amp;(<span class="number">1</span>&lt;&lt;i))ret=<span class="built_in">min</span>(ret,mn[x][i]),x=F[x][i];</span><br><span class="line">        <span class="keyword">if</span>(x==y)<span class="keyword">return</span> ret;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">20</span>;~i;i--)<span class="keyword">if</span>(F[x][i]!=F[y][i])ret=<span class="built_in">min</span>(&#123;ret,mn[x][i],mn[y][i]&#125;),x=F[x][i],y=F[y][i];</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">min</span>(&#123;ret,mn[x][<span class="number">0</span>],mn[y][<span class="number">0</span>]&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="built_in">scanf</span>(<span class="string">&quot;%s&quot;</span>,str+<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)a[i][j]=str[j]==<span class="string">&#x27;#&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)sum[i][j]=sum[i<span class="number">-1</span>][j]+sum[i][j<span class="number">-1</span>]-sum[i<span class="number">-1</span>][j<span class="number">-1</span>]+a[i][j];</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(a[i][j])<span class="keyword">continue</span>;</span><br><span class="line">                res l=<span class="number">1</span>,r=n,ret=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">while</span>(l&lt;=r)&#123;</span><br><span class="line">                    res mid=(l+r)&gt;&gt;<span class="number">1</span>;</span><br><span class="line">                    res U=i-mid+<span class="number">1</span>,D=i+mid<span class="number">-1</span>,L=j-mid+<span class="number">1</span>,R=j+mid<span class="number">-1</span>;</span><br><span class="line">                    <span class="keyword">if</span>(U&lt;=<span class="number">0</span>||D&gt;n||L&lt;=<span class="number">0</span>||R&gt;n)r=mid<span class="number">-1</span>;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span>(sum[D][R]-sum[D][L<span class="number">-1</span>]-sum[U<span class="number">-1</span>][R]+sum[U<span class="number">-1</span>][L<span class="number">-1</span>]&gt;<span class="number">0</span>)r=mid<span class="number">-1</span>;</span><br><span class="line">                        <span class="keyword">else</span> l=mid+<span class="number">1</span>,ret=mid;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                b[i][j]=ret*<span class="number">2</span><span class="number">-1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="keyword">for</span>(res j=<span class="number">1</span>;j&lt;=n;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i][j]==<span class="number">0</span>)id[i][j]=++idx,fa[idx]=idx;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">for</span>(res k=<span class="number">0</span>;k&lt;<span class="number">2</span>;k++)&#123;</span><br><span class="line">                res ni=i+dx[k],nj=j+dy[k];</span><br><span class="line">                <span class="keyword">if</span>(ni&lt;=<span class="number">0</span>||nj&lt;=<span class="number">0</span>||ni&gt;n||nj&gt;n)<span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span>(a[ni][nj])<span class="keyword">continue</span>;</span><br><span class="line">                edge[++ex]=<span class="built_in">tup</span>(<span class="built_in">min</span>(b[i][j],b[ni][nj]),id[i][j],id[ni][nj]);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(edge+<span class="number">1</span>,edge+ex+<span class="number">1</span>,[&amp;](<span class="keyword">const</span> tup &amp;A,<span class="keyword">const</span> tup &amp;B)&#123;<span class="keyword">return</span> get&lt;<span class="number">0</span>&gt;(A)&gt;get&lt;<span class="number">0</span>&gt;(B);&#125;);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=ex;i++)&#123;</span><br><span class="line">            <span class="keyword">auto</span> [c,u,v]=edge[i];</span><br><span class="line">            res fu=<span class="built_in">find</span>(u),fv=<span class="built_in">find</span>(v);</span><br><span class="line">            <span class="keyword">if</span>(fu==fv)<span class="keyword">continue</span>;</span><br><span class="line">            fa[fu]=fv,G[u].<span class="built_in">pb</span>(<span class="built_in">mp</span>(v,c)),G[v].<span class="built_in">pb</span>(<span class="built_in">mp</span>(u,c));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=idx;i++)<span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=<span class="number">20</span>;j++)mn[i][j]=<span class="number">3</span>*n;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=idx;i++)<span class="keyword">if</span>(!dep[i])dep[i]=<span class="number">1</span>,<span class="built_in">dfs</span>(i,<span class="number">0</span>);</span><br><span class="line">        res q=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">while</span>(q--)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>(),y=<span class="built_in">read</span>(),X=<span class="built_in">read</span>(),Y=<span class="built_in">read</span>();</span><br><span class="line">            res u=id[x][y],v=id[X][Y];</span><br><span class="line">            <span class="keyword">if</span>(!u||!v)<span class="built_in">puts</span>(<span class="string">&quot;0&quot;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">get_mn</span>(u,v));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="CF961-G"><a href="#CF961-G" class="headerlink" title="[CF961 G]"></a>[CF961 G]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：$n$ 个数，一个子集的权值定义为其子集的和乘子集大小，求所有对 $n$ 个数的分割的子集权值和的和。</p>
<p>做法：注意到每个数地位一致，要算的只有子集大小之和。然后枚举第一个数所在集合大小，剩下来的数是任意分割的，于是子集大小之和就是 $\sum_{i=1}^n \binom{n-1}{i-1}\begin{Bmatrix}n-i\\k-1\end{Bmatrix}\cdot i$。其实这里已经做完了，求出第二类斯特林数列的生成函数，那东西可以用分治 FFT 或者倍增求出，那么总复杂度就是 $O(n\log^2 n)$ 或者 $O(n\log n)$。</p>
<p>其实这式子可以显然的化简，随手化简下</p>
<script type="math/tex; mode=display">
\begin{align*}
&\sum_{i=1}^n \binom{n-1}{i-1}\begin{Bmatrix}n-i\\k-1\end{Bmatrix}\cdot i\\
&=(n-1)!\sum_{j=0}^{k-1} \frac{(-1)^j}{j!(k-1-j)!}\sum_{i=1}^n \frac{(k-1-j)^{n-i}}{(i-1)!(n-i)!}+\frac{(k-1-j)^{n-i}}{(i-2)!(n-i)!}\\
&=(n-1)!\sum_{j=0}^{k-1}\frac{(-1)^j}{j!(k-1-j)!}(\frac{(k-j)^{n-2}}{(n-2)!}+\frac{(k-j)^{n-1}}{(n-1)!})
&\end{align*}</script><p>这样就 $O(k)$ 或者带个 $\log$，反正按照惯例我肯定简单点，带个 $\log$。</p>
<p>似乎有个组合意义，大概是考虑每个数对这个集的贡献，写出来就是 $\begin{Bmatrix}n\\k\end{Bmatrix}+(n-1)\begin{Bmatrix}n-1\\k\end{Bmatrix}$。</p>
<p>坑：注意特判 $n=1$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.3.3 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">2e5</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,k;</span><br><span class="line">    <span class="keyword">int</span> inv[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),k=<span class="built_in">read</span>(),inv[<span class="number">0</span>]=inv[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(n==<span class="number">1</span>)&#123;<span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">read</span>());<span class="keyword">return</span>;&#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=k;i++)inv[i]=<span class="built_in">mul</span>(inv[kcz%i],kcz-kcz/i);</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">2</span>;i&lt;=k;i++)inv[i]=<span class="built_in">mul</span>(inv[i<span class="number">-1</span>],inv[i]);</span><br><span class="line">        res ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;k;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(j&amp;<span class="number">1</span>)<span class="built_in">add</span>(ans,kcz-<span class="built_in">mul</span>(<span class="built_in">mul</span>(<span class="built_in">qpow</span>(k-j,n<span class="number">-2</span>),n<span class="number">-1</span>+k-j),<span class="built_in">mul</span>(inv[j],inv[k<span class="number">-1</span>-j])));</span><br><span class="line">            <span class="keyword">else</span> <span class="built_in">add</span>(ans,<span class="built_in">mul</span>(<span class="built_in">mul</span>(<span class="built_in">qpow</span>(k-j,n<span class="number">-2</span>),n<span class="number">-1</span>+k-j),<span class="built_in">mul</span>(inv[j],inv[k<span class="number">-1</span>-j])));</span><br><span class="line">        &#125;</span><br><span class="line">        res ret=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)<span class="built_in">add</span>(ret,<span class="built_in">read</span>());</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,<span class="built_in">mul</span>(ret,ans));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="清华集训2014-文学"><a href="#清华集训2014-文学" class="headerlink" title="[清华集训2014] 文学"></a>[清华集训2014] 文学</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：？还想要英文题面？</p>
<p>做法：首先式子本身就是一条直线切割一块区域的意思，这分为两种直线，一种区域是直线以上，一种是直线以下。其次答案一定是两个凸壳，另一方面当点按 $x$ 递增排序后，凸壳上覆盖这个点的直线顺序也是单调的，于是设 $f_{i,j,k}$ 表示当前到了第 $i$ 个点，上凸壳最后一条直线是 $j$，下凸壳是 $k$，由于直线顺序单调，所以直接固定某一个凸壳转移就行了。时间复杂度 $O(np^2)$。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.3.4 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">100</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n,p;</span><br><span class="line">    <span class="keyword">int</span> f[N][N],g[N][N];</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> tup tuple<span class="meta-string">&lt;int,int,int,int&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">sig</span><span class="params">(<span class="keyword">const</span> res &amp;x)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> x&gt;<span class="number">0</span>?<span class="number">1</span>:(x&lt;<span class="number">0</span>?<span class="number">-1</span>:<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">bool</span> <span class="title">ck</span><span class="params">(<span class="keyword">const</span> tup &amp;A,<span class="keyword">const</span> Pair &amp;B)</span></span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> [a,b,c,w]=A;</span><br><span class="line">        <span class="keyword">auto</span> [x,y]=B;</span><br><span class="line">        <span class="keyword">return</span> (LL)a*x+(LL)b*y-c&lt;=<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    tup a[N],b[N];</span><br><span class="line">    <span class="keyword">int</span> ax,bx;</span><br><span class="line">    Pair c[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>(),p=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">            res A=<span class="built_in">read</span>(),B=<span class="built_in">read</span>(),C=<span class="built_in">read</span>(),w=<span class="built_in">read</span>();</span><br><span class="line">            <span class="keyword">if</span>(B&gt;<span class="number">0</span>)a[++ax]=<span class="built_in">tup</span>(A,B,C,w);</span><br><span class="line">            <span class="keyword">else</span> b[++bx]=<span class="built_in">tup</span>(A,B,C,w);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=p;i++)&#123;</span><br><span class="line">            res x=<span class="built_in">read</span>(),y=<span class="built_in">read</span>();</span><br><span class="line">            c[i]=<span class="built_in">mp</span>(x,y);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">sort</span>(c+<span class="number">1</span>,c+p+<span class="number">1</span>),<span class="built_in">memset</span>(f,<span class="number">0x3f</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(f)),f[<span class="number">0</span>][<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=p;i++)&#123;</span><br><span class="line">            <span class="built_in">memset</span>(g,<span class="number">0x3f</span>,<span class="built_in"><span class="keyword">sizeof</span></span>(g));</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=ax;j++)&#123;</span><br><span class="line">                res mn=inf;</span><br><span class="line">                <span class="keyword">for</span>(res k=<span class="number">0</span>;k&lt;=bx;k++)mn=<span class="built_in">min</span>(mn,f[j][k]);</span><br><span class="line">                <span class="keyword">for</span>(res k=<span class="number">1</span>;k&lt;=bx;k++)<span class="keyword">if</span>(<span class="built_in">ck</span>(b[k],c[i]))g[j][k]=<span class="built_in">min</span>(f[j][k],mn+get&lt;<span class="number">3</span>&gt;(b[k]));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=bx;j++)&#123;</span><br><span class="line">                res mn=inf;</span><br><span class="line">                <span class="keyword">for</span>(res k=<span class="number">0</span>;k&lt;=ax;k++)mn=<span class="built_in">min</span>(mn,f[k][j]);</span><br><span class="line">                <span class="keyword">for</span>(res k=<span class="number">1</span>;k&lt;=ax;k++)<span class="keyword">if</span>(<span class="built_in">ck</span>(a[k],c[i]))g[k][j]=<span class="built_in">min</span>(f[k][j],mn+get&lt;<span class="number">3</span>&gt;(a[k]));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">memcpy</span>(f,g,<span class="built_in"><span class="keyword">sizeof</span></span>(f));</span><br><span class="line">        &#125;</span><br><span class="line">        res ans=inf;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">0</span>;i&lt;=ax;i++)<span class="keyword">for</span>(res j=<span class="number">0</span>;j&lt;=bx;j++)ans=<span class="built_in">min</span>(ans,f[i][j]);</span><br><span class="line">        <span class="keyword">if</span>(ans&gt;<span class="number">100000000</span>)<span class="built_in">puts</span>(<span class="string">&quot;-1&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span> <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="UER-10-随机薅羊毛"><a href="#UER-10-随机薅羊毛" class="headerlink" title="[UER #10]随机薅羊毛"></a>[UER #10]随机薅羊毛</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：中文的捏。</p>
<p>做法：容易想到设 $f_i$ 表示 $i$ 开始时的期望，有转移 $f_i=\frac{\sum_{j\neq i} f_j}{n-1}(1-p_i)+1$，这东西两边同时加出 $\sum f_i$ 就做完了，时间复杂度 $O(n)$。</p>
<p>坑：由于实现的式子不太好，所以被卡精度，建议使用 <code>__float128</code>。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.3.26 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    __float128 p[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        n=<span class="built_in">read</span>();</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)p[i]=(__float128)<span class="built_in">read</span>()/<span class="number">1000000</span>;</span><br><span class="line">        __float128 A=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)A+=((__float128)<span class="number">1</span>-p[i])/((ld)n-p[i]);</span><br><span class="line">        __float128 B=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=n;i++)B+=((__float128)<span class="number">1</span>)/((ld)n-p[i]);</span><br><span class="line">        A=(__float128)<span class="number">1</span>-A;</span><br><span class="line">        __float128 S=B/A;</span><br><span class="line">        __float128 ans=S*(n<span class="number">-1</span>)/(__float128)n;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%.10Lf\n&quot;</span>,(ld)ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
<h3 id="ARC135-F"><a href="#ARC135-F" class="headerlink" title="[ARC135 F]"></a>[ARC135 F]</h3><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>solution</span></div>
    <div class="hide-content"><p>题面：给出一个序列为 $1,2,\cdots,n$，操作 $k$ 轮，每轮使所有模 $3=1$ 的位置的数删去，问最终序列的数的和。</p>
<p>做法：显然每次序列长度大致减少原序列的 $\frac{1}{3}$，且最终序列上每个位置上的数可以通过乘 $\frac{3}{2}$ 上取整来递推出来。这样的复杂度是 $O(n(\frac{2}{3})^kk)$。这在 $k$ 比较大时可以过，小的时候过不了。</p>
<p>设 $f^k(i)$ 表示 $k$ 轮后 $i$ 位置上的数。接下来就是莫名其妙注意到 $f^k(n+2^k)=f^k(n)+3^k$。这个倒是容易证明，可以归纳或者其它办法，这样的话我们就只用算前 $2^k$ 个数，这样复杂度是 $O(2^kk)$，仍然过不了。</p>
<p>接下来我们想去将 $k$ 的大小。为什么会有这个想法呢？仍然是因为这个 $2^k$ 分块似乎给了我们信心，如果我们有 $2^y$ 分块，然后 $y$ 和 $k$ 之间的东西能直接整体算出来，那我们成功做完这道题。不妨设 $k=x+y$，有 $f^k(i+j\cdot 2^y)=f^{x}(f^y(i)+j\cdot 3^y)$。这样子 $i$ 就只用枚举到 $2^y$ 了，于是 $f^y(i)$ 是可以在 $O(2^yy)$ 的复杂度内处理出来的。接下来算的就是 $\sum_{j=0}^{2^i-1} f^x(a+j\cdot 3^y)$。设这东西为 $g(a,i)$，有递推式 $g(a,i)=g(a,i-1)+g(a+3^y2^{i-1},i-1)$，初始态为 $g(a,0)=f^x(a)$。</p>
<p>而在暴力递归算 $g$ 的时候继续利用 $f^x(n+2^x)=f^x(n)+3^x$ 这个性质，保证了递归时 $a$ 一直在 $2^x$ 以内，这样记忆化一下，可以发现复杂度是 $O(2^x\log n)$，此时取 $x=y$，则复杂度为 $O(2^{\frac{k}{2}}(\log n+\frac{k}{2}))$。</p>
<p>于是 $k\leq 40$ 的时候跑这个，大于的时候跑之前那个就可以过了。</p>
<p>ps：讲个有趣的笑话，我写这题的时候 <code>&lt;&lt;</code> 写成小于号，调了半个小时，哈哈。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2022.3.30 by ljz</span></span><br><span class="line"><span class="comment">//email 573902690@qq.com</span></span><br><span class="line"><span class="comment">//if you find any bug in my code</span></span><br><span class="line"><span class="comment">//please tell me</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N=<span class="number">100</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">namespace</span> MAIN&#123;</span><br><span class="line">    LL cnt[N];</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> LL <span class="title">f</span><span class="params">(LL x,<span class="keyword">const</span> res &amp;k)</span></span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=k;i++)x=(<span class="number">3</span>*x+<span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">        <span class="keyword">return</span> x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> G[(<span class="number">1</span>&lt;&lt;<span class="number">20</span>)+<span class="number">10</span>][N];</span><br><span class="line">    <span class="keyword">int</span> x,y;</span><br><span class="line">    LL X,Y;</span><br><span class="line">    LL pw3[N];</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">g</span><span class="params">(LL a,res i)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(a&gt;X)&#123;</span><br><span class="line">            res ret=(<span class="keyword">int</span>)((a<span class="number">-1</span>)/X%kcz);</span><br><span class="line">            ret=<span class="built_in">mul</span>(ret,(<span class="keyword">int</span>)(pw3[x]%kcz));</span><br><span class="line">            ret=<span class="built_in">mul</span>(ret,(<span class="keyword">int</span>)((<span class="number">1ll</span>&lt;&lt;i)%kcz));</span><br><span class="line">            res p=<span class="built_in">g</span>((a<span class="number">-1</span>)%X+<span class="number">1</span>,i);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">Add</span>(ret,p);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!i)<span class="keyword">return</span> (<span class="keyword">int</span>)(<span class="built_in">f</span>(a,x)%kcz);</span><br><span class="line">        <span class="keyword">if</span>(G[a][i])<span class="keyword">return</span> G[a][i];</span><br><span class="line">        res p=<span class="built_in">g</span>(a,i<span class="number">-1</span>),q=<span class="built_in">g</span>(a+pw3[y]*(<span class="number">1ll</span>&lt;&lt;(i<span class="number">-1</span>)),i<span class="number">-1</span>);</span><br><span class="line">        <span class="keyword">return</span> G[a][i]=<span class="built_in">Add</span>(p,q);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">MAIN</span><span class="params">(<span class="keyword">const</span> res &amp;Case)</span></span>&#123;</span><br><span class="line">        LL n=<span class="built_in">Read</span>();</span><br><span class="line">        res k=<span class="built_in">read</span>();</span><br><span class="line">        cnt[<span class="number">0</span>]=n;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=k;i++)cnt[i]=(<span class="number">2</span>*cnt[i<span class="number">-1</span>])/<span class="number">3</span>;</span><br><span class="line">        <span class="keyword">if</span>(k&gt;<span class="number">40</span>)&#123;</span><br><span class="line">            res ans=<span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=cnt[k];i++)<span class="built_in">add</span>(ans,(<span class="keyword">int</span>)(<span class="built_in">f</span>(i,k)%kcz));</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        res ans=<span class="number">0</span>;</span><br><span class="line">        x=k/<span class="number">2</span>,y=k-x,pw3[<span class="number">0</span>]=<span class="number">1</span>,X=<span class="number">1ll</span>&lt;&lt;x,Y=<span class="number">1ll</span>&lt;&lt;y;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>;i&lt;=<span class="number">30</span>;i++)pw3[i]=pw3[i<span class="number">-1</span>]*<span class="number">3</span>;</span><br><span class="line">        <span class="keyword">for</span>(res i=<span class="number">1</span>,sz=(<span class="keyword">int</span>)(<span class="built_in">min</span>(cnt[k],Y));i&lt;=sz;i++)&#123;</span><br><span class="line">            LL now=<span class="built_in">f</span>(i,y),j=(cnt[k]-i)/Y+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(res _=<span class="number">0</span>;_&lt;=<span class="number">50</span>;_++)<span class="keyword">if</span>(j&amp;(<span class="number">1ll</span>&lt;&lt;_))<span class="built_in">add</span>(ans,<span class="built_in">g</span>(now,_)),now+=pw3[y]*(<span class="number">1ll</span>&lt;&lt;_);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%d\n&quot;</span>,ans);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></div>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">foreverlasting</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://foreverlasting1202.github.io/2021/10/18/%E5%81%9A%E9%A2%98%E8%AE%B0%E5%BD%95/">http://foreverlasting1202.github.io/2021/10/18/做题记录/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/OI/">OI</a></div><div class="post_share"><div class="social-share" data-image="https://pic.imgdb.cn/item/61fa049e2ab3f51d91b7852f.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/10/23/The%202020%20ICPC%20Asia%20Macau%20Regional%20Contest/"><img class="prev-cover" src="https://pic.imgdb.cn/item/61fa2e5a2ab3f51d91ddd3cb.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">The 2020 ICPC Asia Macau Regional Contest</div></div></a></div><div class="next-post pull-right"><a href="/2021/10/16/2020-2021%20ACM-ICPC,%20Asia%20Seoul%20Regional%20Contest/"><img class="next-cover" src="https://pic.imgdb.cn/item/61fa051f2ab3f51d91b7edfb.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">2020-2021 ACM-ICPC, Asia Seoul Regional Contest</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2022/02/28/bijectivepr/" title="A few solutions of bijective proof problems"><img class="cover" src="https://s2.loli.net/2022/02/01/Wz7gP12JrlYMpKB.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-28</div><div class="title">A few solutions of bijective proof problems</div></div></a></div><div><a href="/2022/02/05/loj%E9%9A%8F%E6%9C%BA%E5%81%9A%E9%A2%98/" title="loj 随机做题"><img class="cover" src="https://pic.imgdb.cn/item/61fa02b12ab3f51d91b5f703.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-02-05</div><div class="title">loj 随机做题</div></div></a></div><div><a href="/2021/08/10/%E5%8F%A3%E8%83%A1%E8%AE%B0%E5%BD%95/" title="口胡记录"><img class="cover" src="https://pic.imgdb.cn/item/61fa039f2ab3f51d91b6b75b.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-08-10</div><div class="title">口胡记录</div></div></a></div><div><a href="/2021/07/06/%E8%AE%AD%E7%BB%83%E5%AE%9E%E5%BD%95/" title="训练实录"><img class="cover" src="https://pic.imgdb.cn/item/61fa02e92ab3f51d91b6242f.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-06</div><div class="title">训练实录</div></div></a></div><div><a href="/2021/06/13/%E5%A4%8D%E5%81%A5%E8%AE%AD%E7%BB%83/" title="复 健 训 练"><img class="cover" src="https://s2.loli.net/2022/02/01/ZGLrd376Kyx9wvE.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-13</div><div class="title">复 健 训 练</div></div></a></div><div><a href="/2021/06/13/tips/" title="一些需注意的点"><img class="cover" src="https://s2.loli.net/2022/02/01/9BMbc35xJVwjUKr.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-13</div><div class="title">一些需注意的点</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/cute.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">foreverlasting</div><div class="author-info__description">呜呜呜。</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">141</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">3</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">40</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/foreverlasting1202" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="/573902690@qq.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">现在装了个大概，还有 tag、link 之类的东西没整好，同时文章部分预览也没完成，以后慢慢整吧。</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#CF1368-F"><span class="toc-number">1.</span> <span class="toc-text">[CF1368 F]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CEOI-2016-kangaroo"><span class="toc-number">2.</span> <span class="toc-text">[CEOI 2016] kangaroo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SNOI-2020-%E5%8C%BA%E9%97%B4%E5%92%8C"><span class="toc-number">3.</span> <span class="toc-text">[SNOI 2020] 区间和</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#JOI-Open-2016-%E6%91%A9%E5%A4%A9%E5%A4%A7%E6%A5%BC"><span class="toc-number">4.</span> <span class="toc-text">[JOI Open 2016] 摩天大楼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TC12336"><span class="toc-number">5.</span> <span class="toc-text">[TC12336]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF674-F"><span class="toc-number">6.</span> <span class="toc-text">[CF674 F]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF674-G"><span class="toc-number">7.</span> <span class="toc-text">[CF674 G]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-Festival-Final-17-C"><span class="toc-number">8.</span> <span class="toc-text">[Code Festival Final 17 C]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TC12118"><span class="toc-number">9.</span> <span class="toc-text">[TC12118]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-Festival-Final-17-F"><span class="toc-number">10.</span> <span class="toc-text">[Code Festival Final 17 F]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TC12161"><span class="toc-number">11.</span> <span class="toc-text">[TC12161]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#LG6327"><span class="toc-number">12.</span> <span class="toc-text">[LG6327]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF453-E"><span class="toc-number">13.</span> <span class="toc-text">[CF453 E]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Wannafly-6-E"><span class="toc-number">14.</span> <span class="toc-text">[Wannafly 6 E]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Ynoi2007-rgxsxrs"><span class="toc-number">15.</span> <span class="toc-text">[Ynoi2007] rgxsxrs</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF739-A"><span class="toc-number">16.</span> <span class="toc-text">[CF739 A]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF733-C"><span class="toc-number">17.</span> <span class="toc-text">[CF733 C]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF429-E"><span class="toc-number">18.</span> <span class="toc-text">[CF429 E]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF725-C"><span class="toc-number">19.</span> <span class="toc-text">[CF725 C]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ARC093-D"><span class="toc-number">20.</span> <span class="toc-text">[ARC093 D]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-Festival-Qual-17-A"><span class="toc-number">21.</span> <span class="toc-text">[Code Festival Qual 17 A]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POI-2011-IMP"><span class="toc-number">22.</span> <span class="toc-text">[POI 2011] IMP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF765-F"><span class="toc-number">23.</span> <span class="toc-text">[CF765 F]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gym102956-K"><span class="toc-number">24.</span> <span class="toc-text">[Gym102956 K]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%9F%E4%B8%80%E7%9C%81%E9%80%892021-A%E5%8D%B7-%E7%9F%A9%E9%98%B5%E6%B8%B8%E6%88%8F"><span class="toc-number">25.</span> <span class="toc-text">[统一省选2021 A卷] 矩阵游戏</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TC12304"><span class="toc-number">26.</span> <span class="toc-text">[TC12304]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF708-E"><span class="toc-number">27.</span> <span class="toc-text">[CF708 E]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loj6215"><span class="toc-number">28.</span> <span class="toc-text">[loj6215]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF891-B"><span class="toc-number">29.</span> <span class="toc-text">[CF891 B]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CC-NOV19A-PBOXES-CF802-O"><span class="toc-number">30.</span> <span class="toc-text">[CC NOV19A PBOXES&#x2F;CF802 O]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF901-D"><span class="toc-number">31.</span> <span class="toc-text">[CF901 D]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Uva1467"><span class="toc-number">32.</span> <span class="toc-text">[Uva1467]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#uoj91"><span class="toc-number">33.</span> <span class="toc-text">[uoj91]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF901-A"><span class="toc-number">34.</span> <span class="toc-text">[CF901 A]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Acmtimus1599"><span class="toc-number">35.</span> <span class="toc-text">[Acmtimus1599]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ICPC2020%E6%98%86%E6%98%8E-I"><span class="toc-number">36.</span> <span class="toc-text">[ICPC2020昆明 I]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2017WF-A"><span class="toc-number">37.</span> <span class="toc-text">[2017WF A]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9B%86%E8%AE%AD%E9%98%9F%E4%BD%9C%E4%B8%9A2018-%E5%9B%B4%E7%BB%95%E7%9D%80%E6%88%91%E4%BB%AC%E7%9A%84%E5%9C%86%E7%8E%AF"><span class="toc-number">38.</span> <span class="toc-text">[集训队作业2018] 围绕着我们的圆环</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF960-G"><span class="toc-number">39.</span> <span class="toc-text">[CF960 G]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cometoj-2-F"><span class="toc-number">40.</span> <span class="toc-text">[Cometoj#2 F]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF468-C"><span class="toc-number">41.</span> <span class="toc-text">[CF468 C]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#POI2013-GRA"><span class="toc-number">42.</span> <span class="toc-text">[POI2013] GRA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Code-1-Yazid-%E7%9A%84%E6%96%B0%E7%94%9F%E8%88%9E%E4%BC%9A"><span class="toc-number">43.</span> <span class="toc-text">[Code+#1] Yazid 的新生舞会</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF710-C"><span class="toc-number">44.</span> <span class="toc-text">[CF710 C]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Xmas-Contest-2021-C"><span class="toc-number">45.</span> <span class="toc-text">[Xmas Contest 2021 C]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TC12703"><span class="toc-number">46.</span> <span class="toc-text">[TC12703]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TC12782"><span class="toc-number">47.</span> <span class="toc-text">[TC12782]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Gym102431-B"><span class="toc-number">48.</span> <span class="toc-text">[Gym102431 B]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TC14470"><span class="toc-number">49.</span> <span class="toc-text">[TC14470]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CERC2016-Hangar-Hurdles"><span class="toc-number">50.</span> <span class="toc-text">[CERC2016 Hangar Hurdles]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#CF961-G"><span class="toc-number">51.</span> <span class="toc-text">[CF961 G]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B8%85%E5%8D%8E%E9%9B%86%E8%AE%AD2014-%E6%96%87%E5%AD%A6"><span class="toc-number">52.</span> <span class="toc-text">[清华集训2014] 文学</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UER-10-%E9%9A%8F%E6%9C%BA%E8%96%85%E7%BE%8A%E6%AF%9B"><span class="toc-number">53.</span> <span class="toc-text">[UER #10]随机薅羊毛</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ARC135-F"><span class="toc-number">54.</span> <span class="toc-text">[ARC135 F]</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/9102/01/01/%E8%BF%91%E6%9C%9F%E6%9B%B4%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2/" title="近期更新的博客"><img src="https://pic.imgdb.cn/item/61fa032b2ab3f51d91b65997.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="近期更新的博客"/></a><div class="content"><a class="title" href="/9102/01/01/%E8%BF%91%E6%9C%9F%E6%9B%B4%E6%96%B0%E7%9A%84%E5%8D%9A%E5%AE%A2/" title="近期更新的博客">近期更新的博客</a><time datetime="9102-01-01T13:50:00.000Z" title="Created 9102-01-01 21:50:00">9102-01-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/20/CF1654/" title="CF1654"><img src="https://pic.imgdb.cn/item/61fa03072ab3f51d91b63d74.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CF1654"/></a><div class="content"><a class="title" href="/2022/03/20/CF1654/" title="CF1654">CF1654</a><time datetime="2022-03-20T15:30:00.000Z" title="Created 2022-03-20 23:30:00">2022-03-20</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/16/CF1483/" title="CF1483"><img src="https://pic.imgdb.cn/item/61f9323b2ab3f51d9107fde1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CF1483"/></a><div class="content"><a class="title" href="/2022/03/16/CF1483/" title="CF1483">CF1483</a><time datetime="2022-03-16T15:30:00.000Z" title="Created 2022-03-16 23:30:00">2022-03-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/14/CF1647/" title="CF1647"><img src="https://pic.imgdb.cn/item/61f9323b2ab3f51d9107fde1.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="CF1647"/></a><div class="content"><a class="title" href="/2022/03/14/CF1647/" title="CF1647">CF1647</a><time datetime="2022-03-14T15:30:00.000Z" title="Created 2022-03-14 23:30:00">2022-03-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/12/2022.3.12/" title="2022.3.12"><img src="https://pic.imgdb.cn/item/61fa041f2ab3f51d91b72144.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="2022.3.12"/></a><div class="content"><a class="title" href="/2022/03/12/2022.3.12/" title="2022.3.12">2022.3.12</a><time datetime="2022-03-11T16:30:00.000Z" title="Created 2022-03-12 00:30:00">2022-03-12</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 By foreverlasting</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">Local search</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  Loading the Database</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]],
      tags: 'ams'
    },
    chtml: {
      scale: 1.2
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, ''],
        insertScript: [200, () => {
          document.querySelectorAll('mjx-container:not\([display]\)').forEach(node => {
            const target = node.parentNode
            if (target.nodeName.toLowerCase() === 'li') {
              target.parentNode.classList.add('has-jax')
            } else {
              target.classList.add('has-jax')
            }
          });
        }, '', false]
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typeset()
}</script><script>function loadValine () {
  function initValine () {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'vBIv3E8Y4e1znLKVs85Y0uSh-gzGzoHsz',
      appKey: 'Dpqs6OR87Ev6XoG6XcSPjToh',
      avatar: 'monsterid',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  if (typeof Valine === 'function') initValine() 
  else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
}

if ('Valine' === 'Valine' || !true) {
  if (true) btf.loadComment(document.getElementById('vcomment'),loadValine)
  else setTimeout(loadValine, 0)
} else {
  function loadOtherComment () {
    loadValine()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>